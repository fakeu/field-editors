"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0}),require("codemirror/mode/markdown/markdown"),require("codemirror/mode/xml/xml"),require("codemirror/addon/edit/continuelist"),require("codemirror/addon/mode/overlay"),require("codemirror/addon/display/autorefresh");var t=require("react"),n=e(t),r=require("emotion"),a=e(require("@contentful/f36-tokens")),i=require("@contentful/field-editor-shared"),o=require("@contentful/f36-components"),l=require("@contentful/f36-icons"),c=e(require("codemirror"));require("codemirror/addon/edit/matchbrackets");var s=e(require("lodash/throttle")),u=e(require("lodash/transform")),d=e(require("lodash/get")),m=e(require("lodash/range")),f=e(require("lodash/min")),p=e(require("lodash/max")),h=e(require("lodash/times")),g=e(require("lodash/repeat")),v=e(require("dompurify")),b=e(require("markdown-to-jsx")),E=e(require("lodash/inRange")),k=e(require("lodash/isObject")),w=e(require("lodash/extend")),x=e(require("lodash/isString")),y=e(require("lodash/isFinite")),C=e(require("lodash/forEach"));function q(e,t,n,r,a,i,o){try{var l=e[i](o),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,a)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){q(i,r,a,o,l,"next",e)}function l(e){q(i,r,a,o,l,"throw",e)}o(void 0)}))}}function I(){return(I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function N(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t.indexOf(n=i[r])>=0||(a[n]=e[n]);return a}function L(e,t){return t||(t=e.slice(0)),e.raw=t,e}var z={root:r.css({display:"flex",zIndex:10,flexDirection:"row",justifyContent:"flex-end",overflow:"hidden",marginBottom:"-1px",fontSize:a.fontSizeM}),tab:r.css({cursor:"pointer",color:a.gray700,padding:a.spacingXs,minWidth:"70px",border:"1px solid "+a.gray400,borderTopLeftRadius:a.borderRadiusSmall,borderTopRightRadius:a.borderRadiusSmall,marginLeft:a.spacingXs,textAlign:"center",backgroundColor:a.gray100,borderBottomColor:a.gray100,outline:"none","&:focus":{boxShadow:a.boxShadowHeavy},transition:"all "+a.transitionEasingDefault+" "+a.transitionDurationShort}),inactiveTab:r.css({background:a.gray200,borderBottomColor:a.gray400,"&:hover":{background:a.gray300}})};function T(e){var t;return n.createElement("div",{className:r.cx(z.tab,(t={},t[z.inactiveTab]=!1===e.isActive,t)),onClick:function(){e.onSelect(e.name)},onKeyDown:function(t){13===t.keyCode&&e.onSelect(e.name)},tabIndex:0,role:"tab","aria-controls":e.name,"aria-selected":!0===e.isActive,"data-test-id":e.testId},e.children)}function M(e){return n.createElement("div",{className:z.root},n.createElement(T,{name:"editor",onSelect:e.onSelect,isActive:"editor"===e.active,testId:"markdown-tab-md"},"Editor"),n.createElement(T,{name:"preview",onSelect:e.onSelect,isActive:"preview"===e.active,testId:"markdown-tab-preview"},"Preview"))}var H=["label"],B=["label"],F=["label"],A=["label"],D=["label"],R=["label"],O=["label"],V=["label"],P=["label"],j=["label"],_=r.css({position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",border:"0"}),U=function(e){var t=e.label,r=N(e,H);return n.createElement("svg",I({width:14,height:14,viewBox:"0 0 1792 1792"},r),n.createElement("path",{d:"M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17 39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355 355 144 144q31 30 14 69-17 40-59 40H192q-26 0-45-19t-19-45v-448q0-42 40-59 39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12 0-24-5-40-17-40-59V192q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69L541 381l355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19 45v448q0 42-39 59-13 5-25 5-26 0-45-19z"}),n.createElement("span",{className:_},t))},X=function(e){var t=e.label,r=N(e,B);return n.createElement("svg",I({width:14,height:14,viewBox:"0 0 1792 1792"},r),n.createElement("path",{d:"M1760 896q14 0 23 9t9 23v64q0 14-9 23t-23 9H32q-14 0-23-9t-9-23v-64q0-14 9-23t23-9h1728zM483 832q-28-35-51-80-48-98-48-188 0-181 134-309 133-127 393-127 50 0 167 19 66 12 177 48 10 38 21 118 14 123 14 183 0 18-5 45l-12 3-84-6-14-2q-50-149-103-205-88-91-210-91-114 0-182 59-67 58-67 146 0 73 66 140t279 129q69 20 173 66 58 28 95 52H483zm507 256h411q7 39 7 92 0 111-41 212-23 56-71 104-37 35-109 81-80 48-153 66-80 21-203 21-114 0-195-23l-140-40q-57-16-72-28-8-8-8-22v-13q0-108-2-156-1-30 0-68l2-37v-44l102-2q15 34 30 71t22.5 56 12.5 27q35 57 80 94 43 36 105 57 59 22 132 22 64 0 139-27 77-26 122-86 47-61 47-129 0-84-81-157-34-29-137-71z"}),n.createElement("span",{className:_},t))},W=function(e){var t=e.label,r=N(e,F);return n.createElement("svg",I({width:14,height:14,viewBox:"0 0 1792 1792"},r),n.createElement("path",{d:"M352 832q0 14-9 23L55 1143q-9 9-23 9-13 0-22.5-9.5T0 1120V544q0-13 9.5-22.5T32 512q14 0 23 9l288 288q9 9 9 23zm1440 480v192q0 13-9.5 22.5t-22.5 9.5H32q-13 0-22.5-9.5T0 1504v-192q0-13 9.5-22.5T32 1280h1728q13 0 22.5 9.5t9.5 22.5zm0-384v192q0 13-9.5 22.5t-22.5 9.5H672q-13 0-22.5-9.5T640 1120V928q0-13 9.5-22.5T672 896h1088q13 0 22.5 9.5t9.5 22.5zm0-384v192q0 13-9.5 22.5T1760 768H672q-13 0-22.5-9.5T640 736V544q0-13 9.5-22.5T672 512h1088q13 0 22.5 9.5t9.5 22.5zm0-384v192q0 13-9.5 22.5T1760 384H32q-13 0-22.5-9.5T0 352V160q0-13 9.5-22.5T32 128h1728q13 0 22.5 9.5t9.5 22.5z"}),n.createElement("span",{className:_},t))},G=function(e){var t=e.label,r=N(e,A);return n.createElement("svg",I({width:14,height:14,viewBox:"0 0 1792 1792"},r),n.createElement("path",{d:"M384 544v576q0 13-9.5 22.5T352 1152q-14 0-23-9L41 855q-9-9-9-23t9-23l288-288q9-9 23-9 13 0 22.5 9.5T384 544zm1408 768v192q0 13-9.5 22.5t-22.5 9.5H32q-13 0-22.5-9.5T0 1504v-192q0-13 9.5-22.5T32 1280h1728q13 0 22.5 9.5t9.5 22.5zm0-384v192q0 13-9.5 22.5t-22.5 9.5H672q-13 0-22.5-9.5T640 1120V928q0-13 9.5-22.5T672 896h1088q13 0 22.5 9.5t9.5 22.5zm0-384v192q0 13-9.5 22.5T1760 768H672q-13 0-22.5-9.5T640 736V544q0-13 9.5-22.5T672 512h1088q13 0 22.5 9.5t9.5 22.5zm0-384v192q0 13-9.5 22.5T1760 384H32q-13 0-22.5-9.5T0 352V160q0-13 9.5-22.5T32 128h1728q13 0 22.5 9.5t9.5 22.5z"}),n.createElement("span",{className:_},t))},K=function(e){var t=e.label,r=N(e,D);return n.createElement("svg",I({width:18,height:14,viewBox:"0 0 2304 1792"},r),n.createElement("path",{d:"M640 1632l384-192v-314l-384 164v342zm-64-454l404-173-404-173-404 173zm1088 454l384-192v-314l-384 164v342zm-64-454l404-173-404-173-404 173zm-448-293l384-165V454l-384 164v267zm-64-379l441-189-441-189-441 189zm1088 518v416q0 36-19 67t-52 47l-448 224q-25 14-57 14t-57-14l-448-224q-4-2-7-4-2 2-7 4l-448 224q-25 14-57 14t-57-14L71 1554q-33-16-52-47t-19-67v-416q0-38 21.5-70T78 906l434-186V320q0-38 21.5-70t56.5-48l448-192q23-10 50-10t50 10l448 192q35 16 56.5 48t21.5 70v400l434 186q36 16 57 48t21 70z"}),n.createElement("span",{className:_},t))},$=function(e){var t=e.label,r=N(e,R);return n.createElement("svg",I({width:14,height:14,viewBox:"0 0 1792 1792"},r),n.createElement("path",{d:"M576 1376v-192q0-14-9-23t-23-9H224q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm0-384V800q0-14-9-23t-23-9H224q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm512 384v-192q0-14-9-23t-23-9H736q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zM576 608V416q0-14-9-23t-23-9H224q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm512 384V800q0-14-9-23t-23-9H736q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm512 384v-192q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm-512-768V416q0-14-9-23t-23-9H736q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm512 384V800q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm0-384V416q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v192q0 14 9 23t23 9h320q14 0 23-9t9-23zm128-320v1088q0 66-47 113t-113 47H224q-66 0-113-47t-47-113V288q0-66 47-113t113-47h1344q66 0 113 47t47 113z"}),n.createElement("span",{className:_},t))},Y=function(e){var t=e.label,r=N(e,O);return n.createElement("svg",I({width:14,height:14,viewBox:"0 0 1792 1792"},r),n.createElement("path",{d:"M1360 1307l35 159q3 12-3 22.5t-17 14.5l-5 1q-4 2-10.5 3.5t-16 4.5-21.5 5.5-25.5 5-30 5-33.5 4.5-36.5 3-38.5 1q-234 0-409-130.5T511 1054h-95q-13 0-22.5-9.5T384 1022V909q0-13 9.5-22.5T416 877h66q-2-57 1-105h-67q-14 0-23-9t-9-23V626q0-14 9-23t23-9h98q67-210 243.5-338T1158 128q102 0 194 23 11 3 20 15 6 11 3 24l-43 159q-3 13-14 19.5t-24 2.5l-4-1q-4-1-11.5-2.5L1261 364l-22.5-3.5-26-3-29-2.5-29.5-1q-126 0-226 64T778 594h468q16 0 25 12 10 12 7 26l-24 114q-5 26-32 26H734q-3 37 0 105h459q15 0 25 12 9 12 6 27l-24 112q-2 11-11 18.5t-20 7.5H782q48 117 149.5 185.5T1160 1308q18 0 36-1.5t33.5-3.5 29.5-4.5 24.5-5 18.5-4.5l12-3 5-2q13-5 26 2 12 7 15 21z"}),n.createElement("span",{className:_},t))},Z=function(e){var t=e.label,r=N(e,V);return n.createElement("svg",I({width:14,height:14,viewBox:"0 0 1792 1792"},r),n.createElement("path",{d:"M1792 1248v320q0 40-28 68t-68 28h-320q-40 0-68-28t-28-68v-320q0-40 28-68t68-28h96V960H960v192h96q40 0 68 28t28 68v320q0 40-28 68t-68 28H736q-40 0-68-28t-28-68v-320q0-40 28-68t68-28h96V960H320v192h96q40 0 68 28t28 68v320q0 40-28 68t-68 28H96q-40 0-68-28t-28-68v-320q0-40 28-68t68-28h96V960q0-52 38-90t90-38h512V640h-96q-40 0-68-28t-28-68V224q0-40 28-68t68-28h320q40 0 68 28t28 68v320q0 40-28 68t-68 28h-96v192h512q52 0 90 38t38 90v192h96q40 0 68 28t28 68z"}),n.createElement("span",{className:_},t))},Q=function(e){var t=e.label,r=N(e,P);return n.createElement("svg",I({width:14,height:14,viewBox:"0 0 1792 1792"},r),n.createElement("path",{d:"M1664 896q0 156-61 298t-164 245-245 164-298 61q-172 0-327-72.5T305 1387q-7-10-6.5-22.5t8.5-20.5l137-138q10-9 25-9 16 2 23 12 73 95 179 147t225 52q104 0 198.5-40.5T1258 1258t109.5-163.5T1408 896t-40.5-198.5T1258 534t-163.5-109.5T896 384q-98 0-188 35.5T548 521l137 138q31 30 14 69-17 40-59 40H192q-26 0-45-19t-19-45V256q0-42 40-59 39-17 69 14l130 129q107-101 244.5-156.5T896 128q156 0 298 61t245 164 164 245 61 298z"}),n.createElement("span",{className:_},t))},J=function(e){var t=e.label,r=N(e,j);return n.createElement("svg",I({width:14,height:14,viewBox:"0 0 1792 1792"},r),n.createElement("path",{d:"M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l138-138q-148-137-349-137-104 0-198.5 40.5T534 534 424.5 697.5 384 896t40.5 198.5T534 1258t163.5 109.5T896 1408q119 0 225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109 132-264 204.5T896 1664q-156 0-298-61t-245-164-164-245-61-298 61-298 164-245 245-164 298-61q147 0 284.5 55.5T1425 340l130-129q29-31 70-14 39 17 39 59z"}),n.createElement("span",{className:_},t))},ee=function(e){var t=function(t){e.onSelect(t)};return n.createElement(o.Menu,null,n.createElement(o.Menu.Trigger,null,e.children),n.createElement(o.Menu.List,null,n.createElement(o.Menu.Item,{testId:"markdown-action-button-heading-h1",onClick:function(){return t("h1")}},"Heading 1"),n.createElement(o.Menu.Item,{testId:"markdown-action-button-heading-h2",onClick:function(){return t("h2")}},"Heading 2"),n.createElement(o.Menu.Item,{testId:"markdown-action-button-heading-h3",onClick:function(){return t("h3")}},"Heading 3")))},te=function(e){return e.canAddNew?n.createElement(ne,I({},e)):n.createElement(o.Button,{isDisabled:e.disabled,startIcon:n.createElement(l.AssetIcon,null),testId:"markdownEditor.linkExistingAssets",size:"small",variant:"secondary",onClick:function(){e.onSelectExisting()}},"Insert media")},ne=function(e){return n.createElement(o.Menu,{placement:"bottom-end"},n.createElement(o.Menu.Trigger,null,n.createElement(o.Button,{endIcon:n.createElement(l.ChevronDownIcon,null),isDisabled:e.disabled,startIcon:n.createElement(l.AssetIcon,null),testId:"markdownEditor.insertMediaDropdownTrigger",size:"small",variant:"secondary"},"Insert media")),n.createElement(o.Menu.List,null,n.createElement(o.Menu.Item,{testId:"markdownEditor.uploadAssetsAndLink",onClick:function(){return e.onAddNew()}},"Add new media and link"),n.createElement(o.Menu.Item,{testId:"markdownEditor.linkExistingAssets",onClick:function(){return e.onSelectExisting()}},"Link existing media")))},re=["tooltip","onClick","children","className","variant","tooltipPlace","isDisabled"],ae={root:r.css({position:"relative",zIndex:Number(a.zIndexWorkbenchHeader),border:"1px solid "+a.gray400,backgroundColor:a.gray100,padding:a.spacingXs,borderTopLeftRadius:a.borderRadiusSmall}),button:r.css({height:"30px",width:"36px",marginLeft:a.spacing2Xs,marginRight:a.spacing2Xs}),icon:r.css({fill:a.gray700,verticalAlign:"middle"}),zenButton:r.css({marginLeft:a.spacingXs}),zenButtonPressed:r.css({backgroundColor:a.gray400}),tooltip:r.css({zIndex:Number(a.zIndexTooltip)})},ie=n.forwardRef((function(e,t){var a=e.tooltip,i=e.onClick,l=e.children,c=e.className,s=e.variant,u=void 0===s?"transparent":s,d=e.tooltipPlace,m=void 0===d?"top":d,f=e.isDisabled,p=void 0!==f&&f,h=N(e,re);return n.createElement(o.Tooltip,{className:ae.tooltip,placement:m,content:a},n.createElement(o.IconButton,I({},h,{ref:t,className:r.cx(ae.button,c),isDisabled:p,onClick:i,variant:u,size:"small",icon:l,"aria-label":a})))}));function oe(e){var t="zen"===e.mode?"bottom":"top";return n.createElement(n.Fragment,null,n.createElement(ee,{onSelect:function(t){t&&e.actions.headings[t]&&e.actions.headings[t]()}},n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-heading",tooltip:"Headings",tooltipPlace:t},n.createElement(l.HeadingIcon,{"aria-label":"Headings",className:ae.icon}))),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-bold",tooltip:"Bold",tooltipPlace:t,onClick:e.actions.simple.bold},n.createElement(l.FormatBoldIcon,{"aria-label":"Bold",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-italic",tooltip:"Italic",tooltipPlace:t,onClick:e.actions.simple.italic},n.createElement(l.FormatItalicIcon,{"aria-label":"Italic",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-quote",tooltip:"Quote",tooltipPlace:t,onClick:e.actions.simple.quote},n.createElement(l.QuoteIcon,{"aria-label":"Quote",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-ul",tooltip:"Unordered list",tooltipPlace:t,onClick:e.actions.simple.ul},n.createElement(l.ListBulletedIcon,{"aria-label":"Unordered list",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-ol",tooltip:"Ordered list",tooltipPlace:t,onClick:e.actions.simple.ol},n.createElement(l.ListNumberedIcon,{"aria-label":"Ordered list",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-link",tooltip:"Link",tooltipPlace:t,onClick:e.actions.insertLink},n.createElement(l.LinkIcon,{"aria-label":"Link",className:ae.icon})))}function le(e){var t="zen"===e.mode?"bottom":"top";return n.createElement(n.Fragment,null,n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-strike",tooltip:"Strike out",tooltipPlace:t,onClick:e.actions.simple.strike},n.createElement(X,{label:"Strike out",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-code",tooltip:"Code block",tooltipPlace:t,onClick:e.actions.simple.code},n.createElement(l.CodeIcon,{"aria-label":"Code block",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-hr",tooltip:"Horizontal rule",tooltipPlace:t,onClick:e.actions.simple.hr},n.createElement(l.HorizontalRuleIcon,{"aria-label":"Horizontal rule",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-indent",tooltip:"Increase indentation",tooltipPlace:t,onClick:e.actions.simple.indent},n.createElement(W,{label:"Increase indentation",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-dedent",tooltip:"Decrease indentation",tooltipPlace:t,onClick:e.actions.simple.dedent},n.createElement(G,{label:"Decrease indentation",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-embed",tooltip:"Embed external content",tooltipPlace:t,onClick:e.actions.embedExternalContent},n.createElement(K,{label:"Embed external content",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-table",tooltip:"Insert table",tooltipPlace:t,onClick:e.actions.insertTable},n.createElement($,{label:"Insert table",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-special",tooltip:"Insert special character",tooltipPlace:t,onClick:e.actions.insertSpecialCharacter},n.createElement(Y,{label:"Insert special character",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-organizeLinks",tooltip:"Organize links",tooltipPlace:t,onClick:e.actions.organizeLinks},n.createElement(Z,{label:"Organize links",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-undo",tooltip:"Undo",tooltipPlace:t,onClick:e.actions.history.undo},n.createElement(Q,{label:"Undo",className:ae.icon})),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-redo",tooltip:"Redo",tooltipPlace:t,onClick:e.actions.history.redo},n.createElement(J,{label:"Redo",className:ae.icon})))}function ce(e){var t=n.useState(!1),r=t[0],a=t[1];return n.createElement("div",{className:ae.root},n.createElement(o.Flex,{justifyContent:"space-between"},n.createElement(o.Flex,null,n.createElement(oe,I({},e)),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-toggle-additional",tooltip:r?"Hide additional actions":"More actions",onClick:function(){a(!r)}},n.createElement(l.MoreHorizontalIcon,{className:ae.icon}))),n.createElement(o.Flex,null,n.createElement(te,{disabled:e.disabled,onSelectExisting:e.actions.linkExistingMedia,onAddNew:e.actions.addNewMedia,canAddNew:e.canUploadAssets}),n.createElement(ie,{isDisabled:e.disabled,testId:"markdown-action-button-zen",variant:"secondary",onClick:e.actions.openZenMode,className:ae.zenButton,tooltip:"Expand"},n.createElement(U,{label:"Expand",className:ae.icon})))),r&&n.createElement(o.Flex,{justifyContent:"space-between",marginTop:"spacingXs"},n.createElement(o.Flex,null,n.createElement(le,I({},e)))))}function se(e){return n.createElement("div",{className:ae.root},n.createElement(o.Flex,{justifyContent:"space-between"},n.createElement(o.Flex,null,n.createElement(oe,I({},e)),n.createElement(le,I({},e))),n.createElement(o.Flex,null,n.createElement(te,{disabled:e.disabled,onSelectExisting:e.actions.linkExistingMedia,onAddNew:e.actions.addNewMedia,canAddNew:e.canUploadAssets}),n.createElement(o.IconButton,{testId:"markdown-action-button-zen-close",variant:"secondary",size:"small",className:r.cx(ae.zenButton,ae.zenButtonPressed),onClick:function(){e.actions.closeZenMode()},icon:n.createElement(U,{label:"Collapse",className:ae.icon}),"aria-label":"Collapse"}))))}ie.displayName="ToolbarButton";var ue=n.memo((function(e){return n.createElement("zen"===e.mode?se:ce,I({},e))}));ue.displayName="MarkdownToolbar";var de=d(window,"navigator.userAgent",""),me=d(window,"navigator.platform",""),fe="Ctrl";function pe(){return fe}function he(e){if("string"!=typeof e)return e;if(!e.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/))throw new Error("Couldn't match unit in given string");return parseFloat(e)}function ge(e){return function(t){t.lineStartsWith(e)?t.removeFromLineBeginning(e.length):t.insertAtLineBeginning(e)}}function ve(e,t,n){return function(){if(e.usePrimarySelection(),e.getSelection()){var r=e.getSelectedText();if(r.startsWith(t)&&r.endsWith(t)){var a=t.length,i=r.slice(a,r.length-a);e.replaceSelectedText(i)}else e.wrapSelection(t)}else e.insertAtCursor(t+n+t),e.selectBackwards(t.length,n.length)}}(/(iphone os|ipad|iphone|ipod)/i.test(de)&&!window.MSStream||/mac(68k|ppc|intel)/i.test(me))&&(fe="Cmd");var be,Ee,ke=ge("> "),we=ge("    ");function xe(e){return{bold:ve(e,"__","text in bold"),italic:ve(e,"*","text in italic"),strike:ve(e,"~~","striked out"),quote:ye(e,ke),code:ye(e,we),link:function(t,n,r){e.usePrimarySelection(),e.replaceSelectedText(n?"["+n+"]("+t+(r?' "'+r+'"':"")+")":"<"+t+">","around")},h1:Ie(e,1),h2:Ie(e,2),h3:Ie(e,3),ul:ye(e,qe,!0),ol:ye(e,Se,!0),undo:function(){e.cmd("undo")},redo:function(){e.cmd("redo")},hr:function(){e.moveIfNotEmpty();var t=e.getNl();e.insertAtCursor(t+"---"+t+t)},indent:function(){e.insertAtLineBeginning(e.getIndentation())},dedent:function(){var t=e.getIndentation();e.lineStartsWith(t)&&e.removeFromLineBeginning(t.length)},table:function(t){var n=e.getNl();e.moveIfNotEmpty(),e.insertAtCursor(n);var r=e.getCurrentLineNumber();e.insertAtCursor(function(e,t){var n=new Array(11),r=" "+n.join(" ")+" |",a=" "+n.join("-")+" |",i="|",o="|";h(t,(function(){i+=r,o+=a}));var l=m(e).map((function(){return i.replace(/\| {5}/g,"| Cell")}));return[i.replace(/\| {7}/g,"| Header"),o].concat(l)}(t.rows,t.cols).join(n)),e.insertAtCursor(n+n),e.restoreCursor(2,r)}}}function ye(e,t,n){return function(){e.usePrimarySelection();var r=e.getSelection();r?(function(n,r){var a=[n.anchor.line,n.head.line],i=p(a),o=f(a);m(o||0,void 0!==i?i+1:void 0).forEach((function(n,r){!function(n,r){e.moveToLineBeginning(n),t(e,r)}(n,r+1)}))}(r),e.moveToLineEnd()):(!n||Ce(e)||e.lineStartsWith("- ")||function(e){var t=e.getCurrentLineNumber(),n=e.isLineEmpty(t),r=n?2:4;t>0&&e.isLineEmpty(t-1)&&(r-=1),(!(t<e.getLinesCount()-1)||e.isLineEmpty(t+1))&&(r-=1),e.moveToLineEnd(),e.insertAtCursor(e.getNl(r)),e.restoreCursor(0,n?t:t+2)}(e),t(e))}}function Ce(e){var t=e.getCurrentLine().match(/^(\d+\. )/);return t?t[1]:null}function qe(e){if(e.lineStartsWith("- "))e.removeFromLineBeginning(2);else{var t=Ce(e);t&&e.removeFromLineBeginning(t.length),e.insertAtLineBeginning("- ")}}function Se(e,t){var n=Ce(e);n?e.removeFromLineBeginning(n.length):(e.lineStartsWith("- ")&&e.removeFromLineBeginning(2),e.insertAtLineBeginning((t||1)+". "))}function Ie(e,t){return function(){var n=e.getCurrentCharacter(),r=function(e){var t=e.getCurrentLine().match(/^( {0,3})(#{1,6}) /);if(!t)return null;var n=t[1],r=t[2];return e.select(a(0),a(r.length)),e.getSelection();function a(t){return{line:e.getCurrentLineNumber(),ch:n.length+t}}}(e),a=g("#",t);if(!r)return e.moveToLineBeginning(),e.insertAtCursor(a+" "),void e.restoreCursor(n+a.length+1);if(e.getSelectedText()===a){e.extendSelectionBy(1);var i=e.getSelectionLength();return e.removeSelectedText(),void e.restoreCursor(n-i)}var o=a.length-e.getSelectionLength();e.replaceSelectedText(a),e.restoreCursor(n+o)}}var Ne={root:r.css(be||(be=L(["\n    border: 1px solid ",";\n    border-width: 0 1px;\n    overflow-y: auto;\n    height: auto;\n    min-height: 300px;\n\n    .CodeMirror {\n      height: auto;\n      line-height: ",";\n    }\n    .CodeMirror-lines {\n      color: ",";\n      padding: ",";\n    }\n    .CodeMirror-code {\n      font-family: ",";\n      font-size: ",";\n    }\n    .CodeMirror-scroll {\n      min-height: '6rem';\n    }\n\n    .cm-header {\n      color: ",";\n    }\n    span.cm-variable-2 {\n      color: ",";\n    }\n    .cm-header-1 {\n      font-size: 1.9em;\n    }\n    .cm-header-2 {\n      font-size: 1.75em;\n    }\n    .cm-header-3 {\n      font-size: 1.6em;\n    }\n    .cm-header-4 {\n      font-size: 1.45em;\n    }\n    .cm-header-5 {\n      font-size: 1.3em;\n    }\n    .cm-header-6 {\n      font-size: 1.15em;\n    }\n\n    span.cm-tag,\n    span.cm-string,\n    span.cm-attribute {\n      color: ",";\n    }\n    span.cm-string {\n      text-decoration: none !important;\n    }\n    span.cm-quote,\n    span.cm-comment {\n      color: ",";\n    }\n    span.cm-link,\n    span.cm-url {\n      color: "," !important;\n    }\n    span.cm-link {\n      text-decoration: underline;\n    }\n  "])),a.gray400,a.lineHeightDefault,a.gray700,a.spacingL,a.fontStackMonospace,a.fontSizeM,a.gray900,a.gray700,a.red600,a.gray600,a.blue500),framed:r.css({".CodeMirror":{maxHeight:"500px"}}),zen:r.css({border:"none !important",".CodeMirror-lines":{maxWidth:"650px",margin:"0 auto"}}),disabled:r.css(Ee||(Ee=L(["\n    .CodeMirror {\n      background: ",";\n      cursor: 'not-allowed';\n    }\n    .CodeMirror-cursors {\n      visibility: hidden !important;\n    }\n    .CodeMirror-scroll,\n    .CodeMirror-sizer,\n    .CodeMirror-lines {\n      cursor: not-allowed;\n    }\n  "])),a.gray100)},Le=n.memo((function(e){var a=t.useRef(null),i=t.useState(null),o=i[0],l=i[1];t.useEffect((function(){a.current&&l(function(e,t){var n=function(e,t){var n=t||{},r=n.direction,a=n.fixedHeight,i=n.height,o=n.readOnly,l=!1,d={min:i?he(i):300,max:500,shift:50},m=c(e,{direction:r,readOnly:o,mode:"markdown",lineNumbers:!1,undoDepth:200,matchBrackets:!0,lineWrapping:!0,lineSeparator:null,theme:"elegant",tabSize:2,indentWithTabs:!1,indentUnit:2,autoRefresh:!0,spellcheck:!0,inputStyle:"contenteditable"});return m.setSize("100%",d.min),a||m.on("change",s((function(){var e=m.heightAtLine(m.lastLine(),"local")+d.shift,t=e;e<d.min&&(t=d.min),e>d.max&&(t=d.max),m.setSize("100%",t)}),150)),m.setOption("extraKeys",{Tab:function(){k(N())},Enter:"newlineAndIndentContinueMarkdownList",Esc:function(){m.getInputField().blur()}}),{destroy:function(){m.toTextArea()},disable:function(){m.setOption("readOnly","nocursor")},enable:function(){m.setOption("readOnly",!1)},attachEvent:function(e,t,n){n&&(t=s(t,n)),m.on(e,t)},addKeyShortcuts:function(e){var t=pe();m.addKeyMap(u(e,(function(e,n,r){e[t+"-"+r]=n}),{}))},setValue:function(e){if(e=e||"",z()!==e){var t=q(),n=S();m.setValue(e),h(n,t,!0),l||(m.clearHistory(),l=!0)}},cmd:f,moveToLineBeginning:p,moveIfNotEmpty:function(){if(!(I()<1)){var e=q()+1;m.lastLine()<e&&(g(),E(L())),p(e)}},restoreCursor:h,moveToLineEnd:g,usePrimarySelection:function(){f("singleSelection")},focus:function(){m.focus()},select:b,selectBackwards:function(e,t){function n(e){return{line:q(),ch:S()+e}}b(n(-e-t),n(-e))},selectAll:function(){return m.execCommand("selectAll")},extendSelectionBy:function(e){function t(e,t){var n=w();return n?{line:n[e].line,ch:n[e].ch+t}:{line:0,ch:0}}b(t("anchor",0),t("head",e))},insertAtCursor:E,insertAtLineBeginning:function(e){var t=S();p(),E(e),h(t+e.length),m.focus()},wrapSelection:function(e){var t=e+y()+e,n=w();n&&(m.replaceRange(t,n.anchor,null==n?void 0:n.head),m.focus())},removeFromLineBeginning:function(e){var t=q();m.replaceRange("",{line:t,ch:0},{line:t,ch:e}),m.focus()},removeSelectedText:function(){m.replaceSelection(""),m.focus()},replaceSelectedText:k,getCursor:function(){return m.getCursor()},setCursor:function(e){m.setCursor(e)},getSelection:w,getLine:x,isLineEmpty:function(e){var t=v(e);return t>-1&&x(t).length<1&&t<m.lineCount()},getSelectedText:y,getSelectionLength:function(){return y().length},getCurrentLine:C,getCurrentLineNumber:q,getCurrentCharacter:S,getCurrentLineLength:I,lineStartsWith:function(e){return C().startsWith(e)},getIndentation:N,getNl:L,getValue:z,getLinesCount:function(){return m.lineCount()},getHistorySize:function(e){var t=m.historySize();return e?t[e]:t},setReadOnly:function(e){return m.setOption("readOnly",e)},getHistory:function(){return m.getHistory()},setHistory:function(e){return m.setHistory(e)},setFullsize:function(){m.setSize("100%","100%"),m.refresh()},refresh:function(){return m.refresh()}};function f(e){m.execCommand(e),m.focus()}function p(e){m.setCursor({line:v(e),ch:0}),m.focus()}function h(e,t,n){m.setCursor(v(t),e,{scroll:!n}),n||m.focus()}function g(e){m.setCursor({line:v(e),ch:I()}),m.focus()}function v(e){return 0===e||void 0!==e&&e>0?e:q()}function b(e,t){m.setSelection(e,t),m.focus()}function E(e){m.replaceRange(e,m.getCursor()),m.focus()}function k(e,t){m.replaceSelection(e,t),m.focus()}function w(){var e=m.listSelections();return!m.somethingSelected()||!e||e.length<1?null:e[0]}function x(e){return m.getLine(e)||""}function y(){return w()?m.getSelection():""}function C(){return x(q())}function q(){return m.getCursor().line}function S(){return m.getCursor().ch}function I(){return C().length}function N(){var e;return T(" ",null!=(e=m.getOption("indentUnit"))?e:0)}function L(e){return void 0===e&&(e=1),e<1?"":T("\n",e)}function z(){return m.getValue()||""}function T(e,t){return new Array(t+1).join(e)}}(e,t),r={actions:xe(n),history:{hasUndo:function(){return n.getHistorySize("undo")>0},hasRedo:function(){return n.getHistorySize("redo")>0}},events:{onScroll:function(e){n.attachEvent("scroll",e,150)},onChange:function(e){n.attachEvent("change",function(e){return function(t,r){e(n.getValue(),t,r)}}(e),0)},onPaste:function(e){n.attachEvent("paste",e,0)}},insert:n.insertAtCursor,focus:n.focus,getContent:n.getValue,destroy:n.destroy,setContent:n.setValue,getSelectedText:n.getSelectedText,usePrimarySelection:n.usePrimarySelection,setReadOnly:n.setReadOnly,selectBackwards:n.selectBackwards,getCursor:n.getCursor,setCursor:n.setCursor,clear:function(){return n.setValue("")},selectAll:n.selectAll,setFullsize:n.setFullsize,refresh:n.refresh};return n.addKeyShortcuts({B:r.actions.bold,I:r.actions.italic}),r}(a.current,Object.assign({},{direction:e.direction,readOnly:!0},"zen"===e.mode?{fixedHeight:!0,height:"100%"}:{},void 0!==e.minHeight?{height:e.minHeight}:{})))}),[]),t.useEffect((function(){o&&e.onReady(o)}),[o]);var d=r.cx(Ne.root,void 0!==e.minHeight?r.css({minHeight:e.minHeight}):void 0,"default"===e.mode?Ne.framed:Ne.zen,e.disabled&&Ne.disabled);return n.createElement("div",{className:d,ref:a,"data-test-id":"markdown-textarea",style:{display:e.visible?"block":"none"}})}));Le.displayName="MarkdownTextarea";var ze,Te={root:r.css({display:"flex",justifyContent:"space-between",background:a.gray100,border:"1px solid "+a.gray400,borderBottomLeftRadius:a.borderRadiusSmall,borderBottomRightRadius:a.borderRadiusSmall,padding:a.spacingXs+" "+a.spacingS}),help:r.css({color:a.gray700,fontSize:a.fontSizeS,button:{fontSize:a.fontSizeS,lineHeight:"inherit"}})};function Me(e){return n.createElement(o.Paragraph,{marginBottom:"none",className:Te.help},"Format your text like a pro with the"," ",n.createElement(o.TextLink,{as:"button",testId:"open-markdown-cheatsheet-button",onClick:function(){e.onClick()}},"markdown cheatsheet"),".")}function He(e){return n.createElement("div",{className:Te.root},e.children)}!function(e){e.cheatsheet="markdown-cheatsheet",e.insertLink="markdown-insertLink",e.insertSpecialCharacter="markdown-insertSpecialCharacter",e.insertTable="markdown-insertTable",e.embedExternalContent="markdown-embedExternalContent",e.confirmInsertAsset="markdown-confirmInsertAsset",e.zenMode="markdown-zenMode"}(ze||(ze={}));var Be,Fe={flexColumnContainer:r.css({display:"flex",flexWrap:"nowrap"}),flexColumn:r.css({flexGrow:1}),verticalDivider:r.css({borderRight:"1px solid "+a.gray500,paddingRight:a.spacing3Xl,marginRight:a.spacing2Xl}),preview:r.css({display:"inline-block",paddingRight:a.spacingL,width:"50%"}),unOrderedListPreview:r.css({listStyleType:"disc",marginLeft:a.spacingS}),orderedListPreview:r.css({listStyleType:"decimal",marginLeft:a.spacingS}),markup:r.css({display:"inline-block",color:a.gray600,paddingLeft:a.spacingL,width:"50%"}),h1:r.css({fontSize:a.fontSize2Xl}),h2:r.css({fontSize:a.fontSizeXl}),h3:r.css({fontSize:a.fontSizeL}),helpItem:r.css({marginBottom:a.spacingS,display:"flex",alignItems:"flex-end",height:a.spacingXl}),helpLink:r.css({margin:"auto"}),flexRowContainer:r.css({display:"flex",width:"100%",justifyContent:"center",marginTop:a.spacingXl})},Ae=function(){return n.createElement(o.ModalContent,{testId:"markdown-cheatsheet-dialog-content"},n.createElement("div",{className:Fe.flexColumnContainer},n.createElement("div",{className:r.cx(Fe.flexColumn,Fe.verticalDivider)},n.createElement("div",{className:Fe.helpItem},n.createElement(o.Heading,{marginBottom:"none",as:"h1",className:r.cx(Fe.preview,Fe.h1)},"H1"),n.createElement("div",{className:Fe.markup},"# heading")),n.createElement("div",{className:Fe.helpItem},n.createElement(o.Heading,{marginBottom:"none",as:"h2",className:r.cx(Fe.preview,Fe.h2)},"H2"),n.createElement("div",{className:Fe.markup},"## heading")),n.createElement("div",{className:Fe.helpItem},n.createElement(o.Heading,{marginBottom:"none",as:"h3",className:r.cx(Fe.preview,Fe.h3)},"H3"),n.createElement("div",{className:Fe.markup},"### heading")),n.createElement("div",{className:Fe.helpItem},n.createElement("strong",{className:Fe.preview},"bold"),n.createElement("div",{className:Fe.markup},"__text__")),n.createElement("div",{className:Fe.helpItem},n.createElement("em",{className:Fe.preview},"italic"),n.createElement("div",{className:Fe.markup},"*text*")),n.createElement("div",{className:Fe.helpItem},n.createElement("div",{className:Fe.preview},"strikethrough"),n.createElement("div",{className:Fe.markup},"~~text~~")),n.createElement("div",{className:Fe.helpItem},n.createElement(o.TextLink,{as:"button",className:Fe.preview},"Link"),n.createElement("div",{className:Fe.markup},"[text](url)"))),n.createElement("div",{className:Fe.flexColumn},n.createElement("div",{className:Fe.helpItem},n.createElement("div",{className:Fe.preview},"Image"),n.createElement("div",{className:Fe.markup},"![alt-text](url)")),n.createElement("div",{className:Fe.helpItem},n.createElement("div",{className:Fe.preview},"Unordered list"),n.createElement("div",{className:Fe.markup},"* list item")),n.createElement("div",{className:Fe.helpItem},n.createElement("div",{className:Fe.preview},n.createElement("div",null,"Ordered list")),n.createElement("div",{className:Fe.markup},"1. list item")),n.createElement("div",{className:Fe.helpItem},n.createElement("div",{className:Fe.preview},n.createElement("div",null,"Blockquote")),n.createElement("div",{className:Fe.markup},"> quote")),n.createElement("div",{className:Fe.helpItem},n.createElement("div",{className:Fe.preview},"code span"),n.createElement("div",{className:Fe.markup},"`code here`")),n.createElement("div",{className:Fe.helpItem},n.createElement("div",{className:Fe.preview},"code block"),n.createElement("div",{className:Fe.markup},"```code here```")))),n.createElement("div",{className:Fe.flexRowContainer},n.createElement(o.TextLink,{className:Fe.helpLink,href:"https://help.github.com/en/github/writing-on-github/basic-writing-and-formatting-syntax",target:"_blank",rel:"noopener noreferrer"},"View the full GitHub-flavored Markdown syntax help (opens in a new window)")))},De=function(e){return e.openCurrent({title:"Markdown formatting help",width:"large",minHeight:"415px",shouldCloseOnEscapePress:!0,shouldCloseOnOverlayClick:!0,parameters:{type:ze.cheatsheet}})},Re=["Embedly","children"],Oe={root:r.css(Be||(Be=L(["\n    border: 1px solid ",";\n    border-width: 0 1px;\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n    min-height: 300px;\n    padding: ",";\n    font-size: ",";\n    font-family: ",";\n    line-height: ",";\n    color: ",";\n    white-space: pre-line;\n\n    h1,\n    h2,\n    h3,\n    h4,\n    h5,\n    h6 {\n      margin-top: ",";\n      margin-bottom: ",";\n      color: ",";\n    }\n\n    h1:first-child,\n    h2:first-child,\n    h3:first-child,\n    h4:first-child,\n    h5:first-child,\n    h6:first-child {\n      margin-top: 0;\n    }\n\n    h1 {\n      font-size: 1.9em;\n    }\n    h2 {\n      font-size: 1.75em;\n    }\n    h3 {\n      font-size: 1.6em;\n    }\n    h4 {\n      font-size: 1.45em;\n    }\n    h5 {\n      font-size: 1.3em;\n    }\n    h6 {\n      font-size: 1.15em;\n    }\n\n    p {\n      margin-top: 0;\n      margin-bottom: ",";\n    }\n\n    ul,\n    ol {\n      margin: "," 0;\n      padding-left: ",";\n    }\n    ul > li {\n      list-style-type: disc;\n      margin-bottom: 0;\n    }\n\n    ol > li {\n      list-style-type: decimal;\n      margin-bottom: 0;\n    }\n\n    table {\n      table-layout: fixed;\n      border-right-width: 0;\n      border-bottom-width: 0;\n      width: 80%;\n      margin: "," auto;\n      border-spacing: 0;\n      border-collapse: collapse;\n      border: 1px solid ",";\n    }\n\n    table th,\n    table td {\n      padding: 5px;\n      border-left-width: 0;\n      border-top-width: 0;\n    }\n\n    table th {\n      background: ",";\n    }\n\n    table td {\n      border: 1px solid ",";\n    }\n\n    a {\n      color: ",";\n    }\n\n    hr {\n      margin-top: ",";\n      margin-bottom: ",";\n      height: 1px;\n      background-color: ",";\n      border: none;\n    }\n\n    blockquote {\n      border-left: 4px solid ",";\n      padding-left: ",";\n      margin: 0;\n      margin-top: ",";\n      font-style: italic;\n    }\n\n    img {\n      margin: "," auto;\n      display: block;\n      max-width: 80%;\n      max-height: 250px;\n    }\n\n    pre code {\n      font-size: ",";\n      font-family: ",";\n    }\n\n    .embedly-card {\n      margin: "," auto;\n      display: block;\n    }\n  "])),a.gray400,a.spacingL,a.fontSizeM,a.fontStackPrimary,a.lineHeightDefault,a.gray700,a.spacingL,a.spacingM,a.gray900,a.spacingM,a.spacingS,a.spacingM,a.spacingM,a.gray300,a.gray200,a.gray300,a.blue500,a.spacingL,a.spacingL,a.gray300,a.gray200,a.spacingL,a.spacingM,a.spacingM,a.fontSizeS,a.fontStackMonospace,a.spacingM),framed:r.css({height:"100%",maxHeight:"500px",overflowY:"auto"}),zen:r.css({maxWidth:"650px",margin:"0 auto",border:"none !important"}),rtl:r.css({direction:"rtl"})};function Ve(e){var t=e.Embedly,r=e.children,a=N(e,Re);return"embedly-card"===e.className&&t?n.createElement(t,{url:e.href}):n.createElement("a",I({},a,{target:"_blank",rel:"noopener noreferrer"}),r)}var Pe=n.memo((function(e){var t,a=r.cx(Oe.root,void 0!==e.minHeight?r.css({minHeight:e.minHeight}):void 0,"default"===e.mode?Oe.framed:Oe.zen,"rtl"===e.direction?Oe.rtl:void 0),i=n.useMemo((function(){return v.sanitize(e.value).replace(/href="mailto:[^"]*&amp;/g,(function(e){return e.replace(/&amp;/g,"&")}))}),[e.value]);return n.createElement("div",{className:a,"data-test-id":"markdown-preview"},n.createElement(b,{options:{overrides:{a:{component:Ve,props:{Embedly:null==(t=e.previewComponents)?void 0:t.embedly}}}}},i))}));Pe.displayName="MarkdownPreview";var je={root:r.css({display:"flex",justifyContent:"space-between",fontSize:a.fontSizeM,marginTop:a.spacingXs,color:a.gray700})};function _e(e){var t=i.ConstraintsUtils.fromFieldValidations(e.sdk.field.validations,e.sdk.field.type),r=i.ConstraintsUtils.makeChecker(t);return n.createElement("div",{className:je.root},n.createElement(i.CharCounter,{value:e.value,checkConstraint:r}),n.createElement(i.CharValidation,{constraints:t}))}function Ue(e,t){return e(t={exports:{}},t.exports),t.exports}var Xe=Ue((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=Object.create((t&&t.prototype instanceof d?t:d).prototype),i=new y(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return{value:void 0,done:!0}}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var l=k(o,n);if(l){if(l===u)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=s(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,i),a}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function d(){}function m(){}function f(){}var p={};l(p,a,(function(){return this}));var h=Object.getPrototypeOf,g=h&&h(h(C([])));g&&g!==t&&n.call(g,a)&&(p=g);var v=f.prototype=d.prototype=Object.create(p);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){var r;this._invoke=function(a,i){function o(){return new t((function(r,o){!function r(a,i,o,l){var c=s(e[a],e,i);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,l)}),(function(e){r("throw",e,o,l)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return r("throw",e,o,l)}))}l(c.arg)}(a,i,r,o)}))}return r=r?r.then(o,o):o()}}function k(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=s(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function y(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:q}}function q(){return{value:void 0,done:!0}}return m.prototype=f,l(v,"constructor",f),l(f,"constructor",m),m.displayName=l(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,o,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(E.prototype),l(E.prototype,i,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new E(c(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,o,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=C,y.prototype={constructor:y,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})),We=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-/]))?$/;function Ge(e){return We.test(e)}var Ke=function(e){var r=e.selectedText,a=e.onClose,i=t.useRef(null),l=t.useState(r||""),c=l[0],s=l[1],u=t.useState(""),d=u[0],m=u[1],f=t.useState(!1),p=f[0],h=f[1],g=t.useState(""),v=g[0],b=g[1],E=function(e){return a(e)},k=Ge(d);return t.useEffect((function(){var e;null!=i&&null!=(e=i.current)&&e.focus&&i.current.focus()}),[i]),n.createElement(n.Fragment,null,n.createElement(o.ModalContent,{testId:"insert-link-modal"},n.createElement(o.Form,{onSubmit:function(){return E({url:d,text:c,title:v})}},n.createElement(o.FormControl,{id:"link-text-field",isDisabled:Boolean(r)},n.createElement(o.FormControl.Label,null,"Link text"),n.createElement(o.TextInput,{name:"link-text",value:c,onChange:function(e){s(e.target.value)},testId:"link-text-field"})),n.createElement(o.FormControl,{id:"target-url-field",isInvalid:p&&!k},n.createElement(o.FormControl.Label,null,"Target URL"),n.createElement(o.TextInput,{name:"target-url",value:d,onChange:function(e){m(e.target.value),h(!0)},placeholder:"https://",maxLength:2100,testId:"target-url-field",ref:i}),n.createElement(o.FormControl.HelpText,null,"Include protocol (e.g. https://)"),p&&!k&&n.createElement(o.FormControl.ValidationMessage,null,"Invalid URL")),n.createElement(o.FormControl,{id:"link-title-field"},n.createElement(o.FormControl.Label,null,"Link title"),n.createElement(o.TextInput,{name:"link-title",value:v,onChange:function(e){b(e.target.value)},testId:"link-title-field"}),n.createElement(o.FormControl.HelpText,null,"Extra link information, usually shown as a tooltip on mouse hover")))),n.createElement(o.ModalControls,null,n.createElement(o.Button,{testId:"insert-link-cancel",onClick:function(){return a(!1)},variant:"secondary",size:"small"},"Cancel"),n.createElement(o.Button,{testId:"insert-link-confirm",onClick:function(){E({url:d,text:c,title:v})},isDisabled:!k,variant:"positive",size:"small"},"Insert")))},$e=[{code:180,desc:"acute accent"},{code:38,desc:"ampersand"},{code:166,desc:"broken vertical bar"},{code:8226,desc:"bullet"},{code:184,desc:"cedilla"},{code:162,desc:"cent"},{code:169,desc:"copyright"},{code:176,desc:"degree"},{code:247,desc:"division"},{code:189,desc:"fraction half"},{code:188,desc:"fraction quarter"},{code:190,desc:"fraction three quarters"},{code:62,desc:"greater than"},{code:161,desc:"inverted exclamation mark"},{code:191,desc:"inverted question mark"},{code:171,desc:"left-pointing double angle quotation mark"},{code:60,desc:"less than"},{code:175,desc:"macron"},{code:181,desc:"micro"},{code:160,desc:"non-breaking space"},{code:172,desc:"not"},{code:182,desc:"paragraph"},{code:177,desc:"plus-minus"},{code:34,desc:"quotation mark"},{code:174,desc:"registered"},{code:187,desc:"right-pointing double angle quotation mark"},{code:167,desc:"section"},{code:168,desc:"umlaut/diaeresis"},{code:215,desc:"multiplication"},{code:8482,desc:"trade mark"},{code:8364,desc:"euro"},{code:163,desc:"pound"},{code:165,desc:"yen"},{code:8222,desc:"double low-9 quotation mark"},{code:710,desc:"modifier circumflex accent"},{code:8224,desc:"dagger"},{code:8225,desc:"double dagger"},{code:8230,desc:"horizontal ellipsis"},{code:8220,desc:"left double quotation mark"},{code:8249,desc:"single left-pointing angle quotation mark"},{code:8216,desc:"left single quotation mark"},{code:183,desc:"middle dot"},{code:8212,desc:"em dash"},{code:8211,desc:"en dash"},{code:8240,desc:"per mille"},{code:8250,desc:"single right-pointing angle quotation mark"},{code:8217,desc:"right single quotation mark"},{code:8218,desc:"single low-9 quotation mark"},{code:170,desc:"feminine ordinal indicator"},{code:186,desc:"masculine ordinal indicator"},{code:8221,desc:"right double quotation mark"},{code:732,desc:"small tilde"},{code:9829,desc:"black heart"},{code:9830,desc:"diamond"}],Ye={buttonPanel:r.css({display:"flex",flexWrap:"wrap"}),charButton:r.css({border:"1px solid "+a.gray500,width:"4.1rem",height:"4.1rem",fontSize:a.fontSizeXl,marginTop:a.spacing2Xs,marginRight:a.spacing2Xs}),selectedCharButton:r.css({backgroundColor:a.gray100}),tooltip:r.css({zIndex:1e3}),button:r.css({marginTop:a.spacingM,marginRight:a.spacingS})},Ze=function(e){var r=e.onClose,a=t.useState($e[0]),i=a[0],l=a[1];return n.createElement(n.Fragment,null,n.createElement(o.ModalContent,{testId:"insert-special-character-modal"},n.createElement(o.Flex,{flexDirection:"column",alignItems:"center"},n.createElement(o.Text,{as:"div",lineHeight:"lineHeight3Xl",fontSize:"fontSize3Xl",marginBottom:"spacingS"},String.fromCharCode(i.code)),n.createElement(o.Text,{as:"div",marginBottom:"spacingS"},i.desc)),n.createElement("div",{className:Ye.buttonPanel},$e.map((function(e){return n.createElement("div",{key:e.code},n.createElement(o.Tooltip,{className:Ye.tooltip,content:e.desc},n.createElement(o.Button,{testId:"special-character-button",isActive:e.code===i.code,className:Ye.charButton,variant:"transparent",onClick:function(){return l(e)}},String.fromCharCode(e.code))))})))),n.createElement(o.ModalControls,null,n.createElement(o.Button,{testId:"insert-character-cancel",className:Ye.button,onClick:function(){return r(!1)},variant:"secondary",size:"small"},"Cancel"),n.createElement(o.Button,{className:Ye.button,testId:"insert-character-confirm",onClick:function(){return r(String.fromCharCode(i.code))},variant:"positive",size:"small"},"Insert selected")))},Qe=function(e){var r=e.onClose,a=t.useRef(null),i=t.useState(2),l=i[0],c=i[1],s=t.useState(1),u=s[0],d=s[1],m=E(l,2,100),f=E(u,1,100);return t.useEffect((function(){var e;null!=(e=a.current)&&e.focus&&a.current.focus()}),[a]),n.createElement(n.Fragment,null,n.createElement(o.ModalContent,{testId:"insert-table-modal"},n.createElement(o.Form,null,n.createElement(o.FormControl,{id:"insert-table-rows-number-field",isRequired:!0,isInvalid:!m},n.createElement(o.FormControl.Label,null,"Number of rows"),n.createElement(o.TextInput,{name:"rows",value:l.toString(),onChange:function(e){return c(Number(e.target.value))},testId:"insert-table-rows-number-field",min:2,max:100,pattern:"[1-9][0-9]*",type:"number",width:"small",autoComplete:"off",ref:a}),!m&&n.createElement(o.FormControl.ValidationMessage,null,"Should be between 2 and 100")),n.createElement(o.FormControl,{id:"insert-table-columns-number-field",isRequired:!0,isInvalid:!f},n.createElement(o.FormControl.Label,null,"Number of columns"),n.createElement(o.TextInput,{name:"columns",value:u.toString(),onChange:function(e){return d(Number(e.target.value))},testId:"insert-table-columns-number-field",min:1,max:100,pattern:"[1-9][0-9]*",type:"number",width:"small",autoComplete:"off"}),!f&&n.createElement(o.FormControl.ValidationMessage,null,"Should be between 1 and 100")))),n.createElement(o.ModalControls,null,n.createElement(o.Button,{testId:"insert-table-cancel",onClick:function(){return r(!1)},variant:"secondary",size:"small"},"Cancel"),n.createElement(o.Button,{testId:"insert-table-confirm",onClick:function(){return r({rows:l,cols:u})},variant:"positive",size:"small",isDisabled:!m||!f},"Insert")))},Je={widthFiledGroup:r.css({display:"flex",flexWrap:"nowrap",alignItems:"flex-start"}),radioButtonGroup:r.css({display:"inline-flex",alignItems:"flex-start",paddingTop:a.spacingXl}),radioButton:r.css({marginLeft:a.spacingM})},et=function(e,t){return"percent"!==t||e<=100},tt=function(e){var r=e.onClose,a=t.useRef(null),i=t.useState("https://"),l=i[0],c=i[1],s=t.useState("percent"),u=s[0],d=s[1],m=t.useState(!0),f=m[0],p=m[1],h=t.useState("100"),g=h[0],v=h[1],b=t.useState(!1),E=b[0],k=b[1];return t.useEffect((function(){var e;null!=(e=a.current)&&e.focus&&a.current.focus()}),[a]),n.createElement(n.Fragment,null,n.createElement(o.ModalContent,{testId:"embed-external-dialog"},n.createElement(o.Form,null,n.createElement(o.FormControl,{id:"external-link-url-field",isRequired:!0,isInvalid:!f},n.createElement(o.FormControl.Label,null,"Content URL"),n.createElement(o.TextInput,{name:"external-link-url",value:l,onChange:function(e){var t=e.target.value;c(t),p(Ge(t))},testId:"external-link-url-field",placeholder:"https://example.com",ref:a}),n.createElement(o.FormControl.HelpText,null,"Include protocol (e.g. https://)"),!f&&n.createElement(o.FormControl.ValidationMessage,null,"URL is invalid")),n.createElement(o.TextLink,{href:"http://embed.ly/providers",target:"_blank",rel:"noopener noreferrer"},"Supported sources"),n.createElement("div",{className:Je.widthFiledGroup},n.createElement(o.FormControl,{id:"embedded-content-width",isRequired:!0,isInvalid:!et(Number(g),u)},n.createElement(o.FormControl.Label,null,"Width"),n.createElement(o.TextInput,{value:g,name:"embedded-content-width",testId:"embedded-content-width",type:"number",width:"small",onChange:function(e){return v(e.target.value)}}),!et(Number(g),u)&&n.createElement(o.FormControl.ValidationMessage,null,"Should be equal or less then 100")),n.createElement("div",{className:Je.radioButtonGroup},n.createElement(o.Radio,{id:"unit-option-percent",value:"percent",isChecked:"percent"===u,onChange:function(){return d("percent")},className:Je.radioButton},"percent"),n.createElement(o.Radio,{id:"unit-option-pixels",value:"pixels",isChecked:"px"===u,onChange:function(){return d("px")},className:Je.radioButton},"pixels"))),n.createElement(o.Checkbox,{id:"attach-social-checkbox",name:"attach-social-checkbox",value:"Yes",isChecked:E,onChange:function(){return k(!E)},testId:"attach-social-checkbox"},"Attach social sharing links to this element"),n.createElement(o.Text,{as:"p",fontColor:"gray500",marginTop:"spacingXs"},"To enable this embedded content in your application make sure to add the ",n.createElement(o.TextLink,{href:"http://embed.ly/docs/products/cards",target:"_blank",rel:"noopener noreferrer"},"Embedly's platform.js")," on your development environment"))),n.createElement(o.ModalControls,null,n.createElement(o.Button,{testId:"emded-external-cancel",onClick:function(){return r(!1)},variant:"secondary",size:"small"},"Cancel"),n.createElement(o.Button,{testId:"embed-external-confirm",onClick:function(){return r(function(e){var t=e.url;return['<a href="'+t+'" class="embedly-card" ','data-card-width="'+e.width+{percent:"%",px:"px"}[e.selectedUnit]+'" ','data-card-controls="'+(e.attachSocial?"1":"0")+'"',">Embedded content: "+t+"</a>"].join("")}({url:l,width:Number(g),selectedUnit:u,attachSocial:E}))},variant:"positive",size:"small"},"Insert")))},nt=function(e){var t=e.onClose,r=e.assets,a=e.locale,i=r.length;return n.createElement(n.Fragment,null,n.createElement(o.ModalContent,{testId:"confirm-insert-asset"},n.createElement(o.Paragraph,null,1===i?"Link asset with missing file for locale "+a:"Link assets with missing files for locale "+a),n.createElement(o.Paragraph,null,1===i?"Do you want to link to the file in its fallback locale?":"Do you want to link to the files in their fallback locales?"),n.createElement(o.EntityList,null,r.map((function(e){var t=e.thumbnailUrl;return n.createElement(o.EntityList.Item,{key:t,title:e.title,thumbnailUrl:t+"?w=46&h=46&fit=thumb",thumbnailAltText:e.thumbnailAltText,description:e.description})})))),n.createElement(o.ModalControls,null,n.createElement(o.Button,{onClick:function(){return t(!1)},variant:"secondary",size:"small"},"Cancel"),n.createElement(o.Button,{testId:"confirm-insert-asset",onClick:function(){return t(!0)},variant:"positive",size:"small"},"Confirm")))},rt={root:r.css({position:"fixed",left:0,right:0,top:0,bottom:0}),topSplit:r.css({position:"fixed",top:0,height:"48px",left:0,right:0}),bottomSplit:r.css({position:"fixed",bottom:0,left:0,right:0,height:"36px"}),editorSplit:r.css({width:"50%",position:"fixed",top:"48px",left:0,bottom:"36px",overflowX:"hidden",overflowY:"scroll"}),editorSplitFullscreen:r.css({left:0,right:0,width:"100%"}),previewSplit:r.css({width:"50%",position:"fixed",top:"48px",right:0,bottom:"36px",overflowX:"hidden",overflowY:"scroll"}),separator:r.css({position:"fixed",top:"48px",bottom:"36px",width:"1px",background:a.gray400,left:"50%"}),button:r.css({position:"fixed",cursor:"pointer",zIndex:105,top:"49%",height:"30px",backgroundColor:a.gray100,border:"1px solid "+a.gray400,padding:0}),hideButton:r.css({left:"50%"}),showButton:r.css({right:0,borderRightWidth:0}),icon:r.css({verticalAlign:"middle"})},at=function(e){var t,a,i,o=n.useState(null!=(t=e.initialValue)?t:""),c=o[0],s=o[1],u=n.useState(!0),d=u[0],m=u[1],f=n.useState(null),p=f[0],h=f[1];n.useEffect((function(){var t,n;null==(t=e.sdk)||null==(n=t.window)||n.updateHeight("100%")}),[]),n.useEffect((function(){setTimeout((function(){null==p||p.setFullsize(),null==p||p.refresh()}),150)}),[p]);var g=n.useMemo((function(){return kt({sdk:e.sdk,editor:p,locale:e.locale})}),[p]);g.closeZenMode=function(){e.onClose({value:c,cursor:null==p?void 0:p.getCursor()})};var v=null!=(a=e.sdk.locales.direction[e.locale])?a:"ltr";return n.createElement("div",{className:rt.root,"data-test-id":"zen-mode-markdown-editor"},n.createElement("div",{className:rt.topSplit},n.createElement(ue,{mode:"zen",disabled:!1,canUploadAssets:!1,actions:g})),n.createElement("div",{className:r.cx(rt.editorSplit,(i={},i[rt.editorSplitFullscreen]=!1===d,i))},n.createElement(Le,{mode:"zen",visible:!0,disabled:!1,direction:v,onReady:function(t){var n;t.setContent(null!=(n=e.initialValue)?n:""),t.setReadOnly(!1),h(t),t.focus(),t.events.onChange((function(t){s(t),e.saveValueToSDK(t)}))}})),d&&n.createElement("div",{className:rt.previewSplit},n.createElement(Pe,{direction:v,mode:"zen",value:c,previewComponents:e.previewComponents})),d&&n.createElement("div",{className:rt.separator}),d&&n.createElement("button",{className:r.cx(rt.button,rt.hideButton),"aria-label":"Hide preview",onClick:function(){m(!1)}},n.createElement(l.ChevronRightIcon,{variant:"muted",size:"tiny",className:rt.icon})),!d&&n.createElement("button",{className:r.cx(rt.button,rt.showButton),"aria-label":"Show preview",onClick:function(){m(!0)}},n.createElement(l.ChevronLeftIcon,{variant:"muted",size:"tiny",className:rt.icon})),n.createElement("div",{className:rt.bottomSplit},n.createElement(He,null,n.createElement(Me,{onClick:function(){De(e.sdk.dialogs)}}))))};function it(e,t){var n=t.localeCode,r=t.fallbackCode,a=t.defaultLocaleCode,i=d(e,["fields","file",n]),o=r?d(e,["fields","file",r]):null,l=d(e,["fields","file",a]),c=i||o||l;if(k(c)&&c.url){var s=d(e,["fields","title",n])||d(e,["fields","title",r||""])||d(e,["fields","title",a])||function(e){return e?e.trim().replace(/\s{2,}/g," "):e}(function(e){return e.replace(/\.\w+$/g,"")}(c.fileName).replace(/_/g," ")),u=function(e){var t={images:"images.ctfassets.net",assets:"assets.ctfassets.net",downloads:"downloads.ctfassets.net",videos:"videos.ctfassets.net"};return e.replace(/(images|assets|downloads|videos).contentful.com/,(function(e,n){return t[n]}))}(c.url);return{title:s,asset:e,url:u,isLocalized:Boolean(i),isFallback:Boolean(o),asMarkdown:"!["+s+"]("+u+")"}}return null}function ot(e,t){return lt.apply(this,arguments)}function lt(){return(lt=S(Xe.mark((function e(t,n){var r,a,i;return Xe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.filter((function(e){return!d(e,["fields","file",n.localeCode])})),a=t.map((function(e){return it(e,n)})).filter((function(e){return null!==e})),!(r.length>0)){e.next=5;break}return i=a.filter((function(e){return!e.isLocalized})).map((function(e){var t=e.title,r=e.isFallback,a=e.asset,i=r?n.fallbackCode:n.defaultLocaleCode;return{title:t,thumbnailUrl:a.fields.file[i].url,thumbnailAltText:t,description:r?"Fallback locale ("+i+")":"Default locale ("+i+")",asset:a}})),e.abrupt("return",{fallbacks:i,links:a});case 5:return e.abrupt("return",{links:a});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ct(e){return(e=(e=e||"").replace(/^ *('|"|\()*/,"")).replace(/('|"|\))* *$/,"")}function st(e){return e.split(" ").shift()}function ut(e){var t=e.split(" ");return t.shift(),t.join(" ")}var dt={inline:function(e){return{match:e[0],text:e[1],href:st(e[2]),title:ct(ut(e[2]))}},ref:function(e){return{match:e[0],text:e[1],id:e[2]}},label:function(e){return{match:e[0],id:e[1],href:st(e[2]),title:ct(ut(e[2]))}}},mt={inline:/\[([^\r\n[\]]+)]\(([^\r\n)]+)\)/,ref:/\[([^\r\n[\]]+)] ?\[([^\r\n[\]]+)]/,label:/^ {0,3}\[([^\r\n[\]]+)]:\s+(.+)$/},ft=gt("inline"),pt=gt("ref"),ht=gt("label");function gt(e){return function(t){return function(e,t){for(var n=[],r=new RegExp(mt[t].source,"g"+("label"===t?"m":"")),a=r.exec(e);a;)n.push(a),r.lastIndex=a.index+a[0].length,a=r.exec(e);return n}(t,e).map(dt[e])}}function vt(e){return k(e)&&x(e.title)&&e.title.length>0}function bt(e,t){var n="["+t+"]: "+e.href;return vt(e)&&(n+=' "'+e.title+'"'),n}function Et(e,t){return"["+e.text+"]["+t+"]"}function kt(e){var t,n,r,a,i,o,l,c=e.sdk,s=e.editor,u=e.locale,d=function(){var e=S(Xe.mark((function e(t){var n,r,a;return Xe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=14;break}return e.next=3,ot(t,{localeCode:u,defaultLocaleCode:c.locales.default,fallbackCode:c.locales.fallbacks[u]});case 3:if(a=(n=e.sent).fallbacks,!((r=n.links)&&r.length>0)){e.next=14;break}if(!a){e.next=13;break}return e.next=10,c.dialogs.openCurrent({title:"Confirm using fallback assets",width:"medium",minHeight:"270px",shouldCloseOnEscapePress:!0,shouldCloseOnOverlayClick:!0,parameters:I({type:ze.confirmInsertAsset},{locale:u,assets:a})});case 10:if(e.sent){e.next=13;break}throw Error("User decided to not use fallbacks");case 13:return e.abrupt("return",r.map((function(e){return e.asMarkdown})).join("\n\n"));case 14:return e.abrupt("return","");case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{headings:{h1:function(){null==s||s.actions.h1()},h2:function(){null==s||s.actions.h2()},h3:function(){null==s||s.actions.h3()}},simple:{italic:function(){null==s||s.actions.italic()},bold:function(){null==s||s.actions.bold()},quote:function(){null==s||s.actions.quote()},ol:function(){null==s||s.actions.ol()},ul:function(){null==s||s.actions.ul()},strike:function(){null==s||s.actions.strike()},code:function(){null==s||s.actions.code()},hr:function(){null==s||s.actions.hr()},indent:function(){null==s||s.actions.indent()},dedent:function(){null==s||s.actions.dedent()}},history:{undo:function(){null==s||s.actions.undo()},redo:function(){null==s||s.actions.redo()}},insertLink:(l=S(Xe.mark((function e(){var t,n;return Xe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return s.usePrimarySelection(),t=s.getSelectedText(),e.next=6,c.dialogs.openCurrent({title:"Insert link",width:"large",minHeight:"410px",shouldCloseOnEscapePress:!0,shouldCloseOnOverlayClick:!0,parameters:I({type:ze.insertLink},{selectedText:t})});case 6:(n=e.sent)&&s.actions.link(n.url,t||n.text,n.title);case 8:case"end":return e.stop()}}),e)}))),function(){return l.apply(this,arguments)}),insertSpecialCharacter:(o=S(Xe.mark((function e(){var t;return Xe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,c.dialogs.openCurrent({title:"Insert special character",width:"large",minHeight:"600px",shouldCloseOnEscapePress:!0,shouldCloseOnOverlayClick:!0,parameters:{type:ze.insertSpecialCharacter}});case 4:(t=e.sent)&&s.insert(t);case 6:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)}),insertTable:(i=S(Xe.mark((function e(){var t;return Xe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,c.dialogs.openCurrent({title:"Insert table",width:"medium",minHeight:"260px",shouldCloseOnEscapePress:!0,shouldCloseOnOverlayClick:!0,parameters:{type:ze.insertTable}});case 4:(t=e.sent)&&s.actions.table(t);case 6:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)}),organizeLinks:function(){if(s){var e=s.getContent();e&&(e=function(e){var t=function(e){var t={},n={};return C(ht(e),(function(e){var r=t[e.href],a=w({},e);r?vt(a)&&!vt(r)&&(r.title=a.title):t[a.href]=a,n[a.id]=r||a})),{byHref:t,byOldId:n}}(e),n={},r=[],a=[],i=1;return C(pt(e),(function(e){var o=t.byOldId[e.id];if(o){var l=o.href,c=n[l];c||(n[l]=c=i,i+=1,r.push(w({newId:c},o))),a.push(w({newId:c},e))}})),C(ht(e),(function(t){e=e.replace(t.match,"")})),e=e.replace(/[\r\n\s]*$/,""),e+="\n\n",C(a,(function(t){e=e.replace(t.match,Et(t,t.newId))})),C(r,(function(t){e+="\n"+bt(t,t.newId)})),e}(e=function(e){var t=function(e){x(e)&&(e=ht(e));var t=e.map((function(e){return e.id})).map((function(e){return parseInt(e,10)})).filter((function(e){return y(e)&&e>0}));return t.length>0&&p(t)||0}(e);return C(ft(e),(function(n){e=e.replace(n.match,Et(n,t+=1)),e+="\n"+bt(n,t)})),e}(e)),s.setContent(e),c.notifier.success("All your links are now references at the bottom of your document."))}},embedExternalContent:(a=S(Xe.mark((function e(){var t;return Xe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,c.dialogs.openCurrent({title:"Embed external content",width:"large",minHeight:"435px",shouldCloseOnEscapePress:!0,shouldCloseOnOverlayClick:!0,parameters:{type:ze.embedExternalContent}});case 4:(t=e.sent)&&s.insert(t);case 6:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)}),addNewMedia:(r=S(Xe.mark((function e(){var t;return Xe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,c.navigator.openNewAsset({slideIn:{waitForClose:!0}});case 5:return t=e.sent.entity,e.next=9,d([t]);case 9:s.insert(e.sent);case 11:return e.prev=11,s.focus(),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[2,,11,14]])}))),function(){return r.apply(this,arguments)}),linkExistingMedia:(n=S(Xe.mark((function e(){var t;return Xe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,c.dialogs.selectMultipleAssets({locale:u});case 5:return t=e.sent,e.next=8,d(t);case 8:s.insert(e.sent);case 10:return e.prev=10,s.focus(),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])}))),function(){return n.apply(this,arguments)}),openZenMode:(t=S(Xe.mark((function t(){var n;return Xe.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,r=c.dialogs,a={initialValue:s.getContent(),locale:e.locale},r.openCurrent({width:"zen",shouldCloseOnEscapePress:!1,minHeight:"100vh",shouldCloseOnOverlayClick:!1,parameters:{type:ze.zenMode,initialValue:a.initialValue,locale:a.locale}});case 4:s.setContent((n=t.sent).value),n.cursor&&s.setCursor(n.cursor),s.focus();case 8:case"end":return t.stop()}var r,a}),t)}))),function(){return t.apply(this,arguments)}),closeZenMode:function(){}}}var wt={container:r.css({display:"flex",flexDirection:"column",fontFamily:a.fontStackPrimary})};function xt(e){var t,r,a=n.useState(null!=(t=e.initialValue)?t:""),i=a[0],o=a[1],l=n.useState("editor"),c=l[0],s=l[1],u=n.useState(null),d=u[0],m=u[1],f=n.useState(!1),p=f[0],h=f[1];n.useEffect((function(){d&&e.onReady&&(e.onReady(d),setTimeout((function(){d.refresh()}),1))}),[d]),n.useEffect((function(){e.sdk.access.can("create","Asset").then((function(e){h(e)}))}),[]),n.useEffect((function(){d&&d.setReadOnly(e.disabled)}),[d,e.disabled]);var g=null===d||e.disabled||"editor"!==c,v=null!=(r=e.sdk.locales.direction[e.sdk.field.locale])?r:"ltr",b=n.useMemo((function(){return kt({sdk:e.sdk,editor:d,locale:e.sdk.field.locale})}),[d]),E=n.useCallback((function(){De(e.sdk.dialogs)}),[]);return n.createElement("div",{className:wt.container,"data-test-id":"markdown-editor"},n.createElement(M,{active:c,onSelect:function(e){s(e)}}),n.createElement(ue,{mode:"default",disabled:g,canUploadAssets:p,actions:b}),n.createElement(Le,{minHeight:e.minHeight,mode:"default",visible:"editor"===c,disabled:g,direction:v,onReady:function(t){var n;t.setContent(null!=(n=e.initialValue)?n:""),t.setReadOnly(e.disabled),m(t),t.events.onChange((function(t){var n=t.replace(/^\s+$/gm,"");e.saveValueToSDK(n),o(t)}))}}),"preview"===c&&n.createElement(Pe,{direction:v,minHeight:e.minHeight,mode:"default",value:i,previewComponents:e.previewComponents}),n.createElement(He,null,n.createElement(Me,{onClick:E})),n.createElement(_e,{sdk:e.sdk,value:i}))}exports.MarkdownEditor=function(e){return n.createElement(i.FieldConnector,{throttle:300,field:e.sdk.field,isInitiallyDisabled:e.isInitiallyDisabled},(function(t){return n.createElement(xt,I({},e,{key:"markdown-editor-"+t.externalReset,initialValue:t.value,disabled:t.disabled,saveValueToSDK:t.setValue}))}))},exports.MarkdownPreview=Pe,exports.openMarkdownDialog=function(e,t){return function(r){var a,o,l,c,s,u,d;if((null==(a=r.parameters)?void 0:a.type)===ze.cheatsheet)return i.ModalDialogLauncher.openDialog(r,(function(){return n.createElement(Ae,null)}));if((null==(o=r.parameters)?void 0:o.type)===ze.insertLink){var m=r.parameters.selectedText;return i.ModalDialogLauncher.openDialog(r,(function(e){return n.createElement(Ke,{selectedText:m,onClose:e.onClose})}))}if((null==(l=r.parameters)?void 0:l.type)===ze.insertSpecialCharacter)return i.ModalDialogLauncher.openDialog(r,(function(e){return n.createElement(Ze,{onClose:e.onClose})}));if((null==(c=r.parameters)?void 0:c.type)===ze.insertTable)return i.ModalDialogLauncher.openDialog(r,(function(e){return n.createElement(Qe,{onClose:e.onClose})}));if((null==(s=r.parameters)?void 0:s.type)===ze.embedExternalContent)return i.ModalDialogLauncher.openDialog(r,(function(e){return n.createElement(tt,{onClose:e.onClose})}));if((null==(u=r.parameters)?void 0:u.type)===ze.confirmInsertAsset){var f=r.parameters.locale,p=r.parameters.assets;return i.ModalDialogLauncher.openDialog(r,(function(e){return n.createElement(nt,{onClose:e.onClose,locale:f,assets:p})}))}if((null==(d=r.parameters)?void 0:d.type)===ze.zenMode){var h=r.parameters.initialValue,g=r.parameters.locale;return i.ModalDialogLauncher.openDialog(r,(function(r){return n.createElement(at,{saveValueToSDK:function(t){var n,r;return t?null==e||null==(r=e.field)?void 0:r.setValue(t):null==e||null==(n=e.field)?void 0:n.removeValue()},onClose:r.onClose,initialValue:h,locale:g,sdk:e,previewComponents:t})}))}return Promise.reject()}},exports.renderMarkdownDialog=function(e){var t=e.parameters.invocation;if(t.type===ze.cheatsheet)return e.window.startAutoResizer(),n.createElement(Ae,null);if(t.type===ze.insertLink){var r=t.selectedText;return e.window.startAutoResizer(),n.createElement(Ke,{selectedText:r,onClose:e.close})}if(t.type===ze.insertSpecialCharacter)return e.window.startAutoResizer(),n.createElement(Ze,{onClose:e.close});if(t.type===ze.insertTable)return e.window.startAutoResizer(),n.createElement(Qe,{onClose:e.close});if(t.type===ze.embedExternalContent)return e.window.startAutoResizer(),n.createElement(tt,{onClose:e.close});if(t.type===ze.confirmInsertAsset){var a=t.locale,i=t.assets;return e.window.startAutoResizer(),n.createElement(nt,{onClose:e.close,locale:a,assets:i})}if(t.type===ze.zenMode){var o=t.locale,l=t.initialValue;return e.window.updateHeight("100%"),n.createElement(at,{onClose:e.close,saveValueToSDK:function(){},initialValue:l,locale:o,sdk:e})}return n.createElement("div",null)};
//# sourceMappingURL=field-editor-markdown.cjs.production.min.js.map
