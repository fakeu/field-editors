"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),r=e(t),n=require("@contentful/field-editor-shared"),o=require("use-debounce"),i=e(require("speakingurl")),a=e(require("@contentful/f36-tokens")),l=require("emotion"),u=require("@contentful/f36-components"),c=require("@contentful/f36-icons");function s(e,t,r,n,o,i,a){try{var l=e[i](a),u=l.value}catch(e){return void r(e)}l.done?t(u):Promise.resolve(u).then(n,o)}function f(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){s(i,n,o,a,l,"next",e)}function l(e){s(i,n,o,a,l,"throw",e)}a(void 0)}))}}function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return e(t={exports:{}},t.exports),t.exports}var v=d((function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=Object.create((t&&t.prototype instanceof f?t:f).prototype),i=new L(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var l=w(a,r);if(l){if(l===s)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,i),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var s={};function f(){}function h(){}function p(){}var d={};l(d,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(E([])));y&&y!==t&&r.call(y,o)&&(d=y);var g=p.prototype=f.prototype=Object.create(d);function m(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var n;this._invoke=function(o,i){function a(){return new t((function(n,a){!function n(o,i,a,l){var u=c(e[o],e,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==typeof f&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,a,l)}),(function(e){n("throw",e,a,l)})):t.resolve(f).then((function(e){s.value=e,a(s)}),(function(e){return n("throw",e,a,l)}))}l(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return s;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,s;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,s):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,s)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function E(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:S}}function S(){return{value:void 0,done:!0}}return h.prototype=p,l(g,"constructor",p),l(p,"constructor",h),h.displayName=l(p,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,a,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},m(b.prototype),l(b.prototype,i,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},m(g),l(g,a,"Generator"),l(g,o,(function(){return this})),l(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=E,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var l=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),s},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),x(r),s}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;x(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}));function y(e,t){var r=e.entry;return t&&r.fields[t]?r.fields[t]:r.fields[e.contentType.displayField]}var g=function(e){var t,r;function n(t){var r;(r=e.call(this,t)||this).unsubscribeValue=null,r.unsubscribeLocalizedValue=null,r.unsubscribeSysChanges=null;var n=y(t.sdk,t.trackingFieldId),o=t.sdk.entry.getSys(),i=!!n&&t.field.id===n.id;return r.state={titleValue:n?n.getValue():"",isPublished:Boolean(o.publishedVersion),isSame:i},r}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,p(t,r);var o=n.prototype;return o.componentDidMount=function(){var e=this;this.unsubscribeSysChanges=this.props.sdk.entry.onSysChanged((function(t){e.setState({isPublished:Boolean(t.publishedVersion)})}));var t=y(this.props.sdk,this.props.trackingFieldId);t&&(this.state.isSame||(this.unsubscribeLocalizedValue=t.onValueChanged(this.props.field.locale,(function(t){e.setState({titleValue:t})}))),this.props.field.locale!==this.props.defaultLocale&&(this.props.isOptionalLocaleWithFallback||(this.unsubscribeValue=t.onValueChanged(this.props.defaultLocale,(function(r){t.getValue(e.props.field.locale)||e.setState({titleValue:r})})))))},o.componentWillUnmount=function(){"function"==typeof this.unsubscribeValue&&this.unsubscribeValue(),"function"==typeof this.unsubscribeLocalizedValue&&this.unsubscribeLocalizedValue(),"function"==typeof this.unsubscribeSysChanges&&this.unsubscribeSysChanges()},o.render=function(){return this.props.children(h({},this.state))},n}(r.Component);g.defaultProps={children:function(){return null}};var m=["ar","az","cs","de","dv","en","es","fa","fi","fr","ge","gr","hu","it","lt","lv","my","mk","nl","pl","pt","ro","ru","sk","sr","tr","uk","vn"];function b(e){var t=e.slice(0,2).toLowerCase();return m[m.indexOf(t)]}function w(e,t){return void 0===t&&(t="en"),i(e,{separator:"-",lang:b(t)||"en",truncate:76,custom:{"'":"","`":"","’":"","‘":""}})}function k(e){var t=String(e);return 1===t.length?"0"+t:t}function x(e,t){return e?w(e,t.locale):(r=t).isOptionalLocaleWithFallback?"":w("Untitled entry "+(n=new Date(r.createdAt)).getFullYear()+" "+k(n.getUTCMonth()+1)+" "+k(n.getUTCDate())+" at "+k(n.getUTCHours())+" "+k(n.getUTCMinutes())+" "+k(n.getUTCSeconds()),"en-US");var r,n}var L=l.css({position:"relative"}),E=l.css({paddingLeft:"40px"}),S=l.css({position:"absolute",left:"10px",top:"8px",zIndex:2,width:"25px",height:"25px",fill:a.gray500}),V=l.css({position:"absolute",zIndex:2,right:"8px",top:"8px"}),O=l.css({marginTop:a.spacingS});function C(e){var t=e.hasError,n=e.isDisabled,i=e.value,a=e.setValue,l=e.onChange,s=e.onBlur,f=function(e){var t=e.performUniqueCheck,n=r.useState(e.value?"checking":"unique"),i=n[0],a=n[1],l=o.useDebounce(e.value,1e3)[0];return r.useEffect((function(){l?(a("checking"),t(l).then((function(e){a(e?"unique":"duplicate")})).catch((function(){a("checking")}))):a("unique")}),[l,t]),i}(e);return r.createElement("div",{className:L},r.createElement(c.LinkIcon,{className:S}),r.createElement(u.TextInput,{className:E,isInvalid:t||"duplicate"===f,isDisabled:n,value:i||"",onChange:function(e){a(e.target.value),l&&l()},onBlur:function(){s&&s()}}),"checking"===f&&r.createElement("div",{className:V},r.createElement(u.Spinner,{testId:"slug-editor-spinner"})),"duplicate"===f&&r.createElement(u.ValidationMessage,{testId:"slug-editor-duplicate-error",className:O},"This slug has already been published in another entry"))}function F(e){var t=e.titleValue,n=e.isOptionalLocaleWithFallback,o=e.locale,i=e.createdAt,a=e.value,l=r.useCallback((function(){var e=x(t,{isOptionalLocaleWithFallback:n,locale:o,createdAt:i});return a===e}),[t,n,o,i,a]),u=r.useState((function(){return!e.value||!!e.titleValue&&l()})),c=u[0],s=u[1];return r.useEffect((function(){l()&&s(!0)}),[e.titleValue,l]),function(e,t){var n=e.value,o=e.setValue,i=e.createdAt,a=e.locale,l=e.titleValue,u=e.isOptionalLocaleWithFallback;r.useEffect((function(){if(!1!==t){var e=x(l,{isOptionalLocaleWithFallback:u,locale:a,createdAt:i});e!==n&&o(e)}}),[n,l,u,t,i,a,o])}(e,c),r.createElement(C,h({},e,{onChange:function(){s(!1)},onBlur:function(){l()&&s(!0)}}))}function _(e){var r=e.Component,n=e.value,o=e.disabled,i=e.setValue,a=e.errors,l=e.titleValue,u=e.isOptionalLocaleWithFallback,c=e.locale,s=e.createdAt,h=e.performUniqueCheck,p=t.useCallback(f(v.mark((function e(){var t=arguments;return v.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.apply(void 0,t);case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}),e,null,[[0,5]])}))),[i]);return t.createElement("div",{"data-test-id":"slug-editor"},t.createElement(r,{locale:c,createdAt:s,performUniqueCheck:h,hasError:a.length>0,value:n,isOptionalLocaleWithFallback:u,isDisabled:o,titleValue:l,setValue:p}))}function j(e){var r,o,i,a,l=e.field,u=e.parameters,c=e.baseSdk,s=c.locales,f=c.entry,h=c.space;if("Symbol"!==l.type)throw new Error('"'+l.type+'" field type is not supported by SlugEditor');var p=null!=(r=null==u||null==(o=u.instance)?void 0:o.trackingFieldId)?r:void 0,d=f.getSys(),v=s.fallbacks[l.locale],y=Boolean(!l.required||s.optional[l.locale]),m=Boolean(y&&v&&s.available.includes(v)),b=t.useCallback((function(e){var t,r,n,o=((n={content_type:null==d||null==(t=d.contentType)||null==(r=t.sys)?void 0:r.id})["fields."+l.id+"."+l.locale]=e,n["sys.id[ne]"]=d.id,n["sys.publishedAt[exists]"]=!0,n.limit=0,n);return h.getEntries(o).then((function(e){return 0===e.total}))}),[null==d||null==(i=d.contentType)||null==(a=i.sys)?void 0:a.id,l.id,l.locale,d.id,h]);return t.createElement(g,{sdk:e.baseSdk,field:l,defaultLocale:s.default,isOptionalLocaleWithFallback:m,trackingFieldId:p},(function(r){var o=r.titleValue,i=r.isPublished,a=r.isSame;return t.createElement(n.FieldConnector,{field:l,isInitiallyDisabled:e.isInitiallyDisabled,throttle:0},(function(e){return t.createElement(_,{Component:!1===i&&!1===a?F:C,titleValue:o,value:e.value,errors:e.errors,disabled:e.disabled,setValue:e.setValue,isOptionalLocaleWithFallback:m,createdAt:d.createdAt,locale:l.locale,performUniqueCheck:b,key:"slug-editor-"+e.externalReset})}))}))}j.defaultProps={isInitiallyDisabled:!0},exports.SlugEditor=j,exports.makeSlug=x,exports.slugify=w;
//# sourceMappingURL=field-editor-slug.cjs.production.min.js.map
