{"version":3,"file":"field-editor-tags.cjs.production.min.js","sources":["../src/TagsEditorConstraints.tsx","../src/TagsEditor.tsx","../src/TagsEditorContainer.tsx","../src/index.tsx"],"sourcesContent":["import React from 'react';\nimport { css } from 'emotion';\nimport { Constraint, ConstraintsType } from './types';\n\nimport { Text } from '@contentful/f36-components';\n\ninterface TagEditorConstraintsProps {\n  constraintsType: ConstraintsType;\n  constraints: Constraint;\n}\n\nexport function TagsEditorConstraints(props: TagEditorConstraintsProps) {\n  const { constraintsType, constraints } = props;\n  return (\n    <Text\n      as=\"p\"\n      fontColor=\"gray600\"\n      marginBottom=\"none\"\n      marginTop=\"spacingS\"\n      className={css({\n        fontStyle: 'italic',\n      })}\n      testId=\"tag-editor-constraints\">\n      {constraintsType === 'min' && (\n        <span>\n          Requires at least {constraints.min} {constraints.min === 1 ? 'tag' : 'tags'}\n        </span>\n      )}\n      {constraintsType === 'max' && (\n        <span>\n          Requires no more than {constraints.max} {constraints.max === 1 ? 'tag' : 'tags'}\n        </span>\n      )}\n      {constraintsType === 'min-max' && constraints.max !== constraints.min && (\n        <span>\n          Requires between {constraints.min} and {constraints.max} tags\n        </span>\n      )}\n      {constraintsType === 'min-max' && constraints.max === constraints.min && (\n        <span>\n          Requires exactly {constraints.max} {constraints.max === 1 ? 'tag' : 'tags'}\n        </span>\n      )}\n    </Text>\n  );\n}\n","import noop from 'lodash/noop';\nimport React, { useState, useCallback } from 'react';\nimport { css, cx } from 'emotion';\nimport tokens from '@contentful/f36-tokens';\nimport { TagsEditorConstraints } from './TagsEditorConstraints';\nimport { ConstraintsType, Constraint } from './types';\nimport { SortableContainer, SortableElement, SortableHandle } from 'react-sortable-hoc';\nimport arrayMove from 'array-move';\n\nimport { Pill, TextInput } from '@contentful/f36-components';\n\nimport { DragIcon } from '@contentful/f36-icons';\n\nexport interface TagsEditorProps {\n  items: string[];\n  isDisabled: boolean;\n  hasError: boolean;\n  constraintsType?: ConstraintsType;\n  constraints?: Constraint;\n  onUpdate: (items: string[]) => void;\n}\n\nconst styles = {\n  dropContainer: css({\n    whiteSpace: 'nowrap',\n    display: 'flex',\n    flexWrap: 'wrap',\n  }),\n  input: css({\n    marginTop: tokens.spacingS,\n    marginBottom: tokens.spacingM,\n  }),\n  pill: css({\n    marginRight: tokens.spacingS,\n    marginBottom: tokens.spacingS,\n  }),\n  pillDisabled: css({\n    cursor: 'not-allowed !important',\n    button: {\n      cursor: 'not-allowed !important',\n      // instead of changing the @contentful/f36-components package\n      pointerEvents: 'none',\n    },\n  }),\n  handle: css({\n    lineHeight: '1.5rem',\n    padding: '0.375rem 0.625rem',\n    paddingRight: 0,\n    cursor: 'grab',\n    userSelect: 'none',\n    svg: {\n      fill: tokens.gray500,\n      verticalAlign: 'middle',\n    },\n  }),\n};\n\nconst SortablePillHandle = SortableHandle((props: { isDisabled: boolean }) => (\n  <div className={cx(styles.handle, { [styles.pillDisabled]: props.isDisabled })}>\n    <DragIcon variant=\"muted\" />\n  </div>\n));\n\ninterface SortablePillProps {\n  label: string;\n  onRemove: Function;\n  isSortablePillDisabled: boolean;\n  index: number;\n}\n\nconst SortablePill = SortableElement((props: SortablePillProps) => (\n  <Pill\n    testId=\"tag-editor-pill\"\n    className={cx(styles.pill, { [styles.pillDisabled]: props.isSortablePillDisabled })}\n    label={props.label}\n    onClose={() => {\n      if (!props.isSortablePillDisabled) {\n        props.onRemove(props.index);\n      }\n    }}\n    onDrag={noop}\n    dragHandleComponent={<SortablePillHandle isDisabled={props.isSortablePillDisabled} />}\n  />\n));\n\ninterface SortableListProps {\n  children: React.ReactNode;\n}\n\nconst SortableList = SortableContainer((props: SortableListProps) => (\n  <div className={styles.dropContainer}>{props.children}</div>\n));\n\nexport function TagsEditor(props: TagsEditorProps) {\n  const [pendingValue, setPendingValue] = useState('');\n\n  const { isDisabled, items, constraints, constraintsType, hasError } = props;\n\n  const removeItem = useCallback(\n    (index) => {\n      const newItems = props.items.filter((_, filterIndex) => index !== filterIndex);\n      props.onUpdate(newItems);\n    },\n    [props]\n  );\n\n  const swapItems = useCallback(\n    ({ oldIndex, newIndex }) => {\n      const newItems = arrayMove(props.items, oldIndex, newIndex);\n      props.onUpdate(newItems);\n    },\n    [props]\n  );\n\n  return (\n    <div data-test-id=\"tag-editor-container\">\n      <TextInput\n        testId=\"tag-editor-input\"\n        className={styles.input}\n        isDisabled={isDisabled}\n        isInvalid={hasError}\n        type=\"text\"\n        value={pendingValue}\n        placeholder=\"Type the value and hit enter\"\n        onKeyDown={(e: React.KeyboardEvent<HTMLInputElement>) => {\n          if (pendingValue && e.keyCode === 13) {\n            props.onUpdate([...props.items, pendingValue]);\n            setPendingValue('');\n          }\n        }}\n        onChange={(e: React.ChangeEvent<HTMLInputElement>) => {\n          setPendingValue(e.target.value);\n        }}\n      />\n      <SortableList\n        useDragHandle\n        axis=\"xy\"\n        distance={10}\n        onSortEnd={({ oldIndex, newIndex }) => {\n          swapItems({ oldIndex, newIndex });\n        }}>\n        {items.map((item, index) => {\n          return (\n            <SortablePill\n              label={item}\n              index={index}\n              key={item + index}\n              disabled={isDisabled}\n              /**\n               * `isSortablePillDisabled` is needed as SortableElement\n               * from react-sortable-hoc doesn't pass down the disabled prop.\n               * See: https://github.com/clauderic/react-sortable-hoc/issues/612\n               */\n              isSortablePillDisabled={isDisabled}\n              onRemove={() => {\n                removeItem(index);\n              }}\n            />\n          );\n        })}\n      </SortableList>\n      {constraints && constraintsType && (\n        <TagsEditorConstraints constraints={constraints} constraintsType={constraintsType} />\n      )}\n    </div>\n  );\n}\n","import * as React from 'react';\nimport isNumber from 'lodash/isNumber';\nimport { FieldAPI, FieldConnector } from '@contentful/field-editor-shared';\nimport { TagsEditor } from './TagsEditor';\nimport { ConstraintsType, Constraint } from './types';\n\nexport interface TagsEditorContainerProps {\n  /**\n   * is the field disabled initially\n   */\n  isInitiallyDisabled: boolean;\n  /**\n   * sdk.field\n   */\n  field: FieldAPI;\n}\n\ntype TagEditorValue = string[];\n\nfunction isEmptyTagsValue(value: TagEditorValue | null) {\n  return value === null || value.length === 0;\n}\n\nfunction getConstraintsType(sizeConstraints?: Constraint): ConstraintsType | undefined {\n  if (!sizeConstraints) {\n    return undefined;\n  }\n  if (isNumber(sizeConstraints.min) && isNumber(sizeConstraints.max)) {\n    return 'min-max';\n  } else if (isNumber(sizeConstraints.min)) {\n    return 'min';\n  } else if (isNumber(sizeConstraints.max)) {\n    return 'max';\n  } else {\n    return undefined;\n  }\n}\n\nexport function TagsEditorContainer(props: TagsEditorContainerProps) {\n  const field = props.field;\n\n  const validations = field.validations || [];\n\n  const sizeValidations = (validations as { size?: Constraint }[])\n    .filter((validation) => validation.size)\n    .map((validation) => validation.size);\n\n  const constraints = sizeValidations.length > 0 ? sizeValidations[0] : {};\n\n  const constraintsType = getConstraintsType(constraints);\n\n  return (\n    <FieldConnector<TagEditorValue>\n      field={field}\n      isInitiallyDisabled={props.isInitiallyDisabled}\n      isEmptyValue={isEmptyTagsValue}\n      throttle={0}>\n      {({ disabled, value, errors, setValue }) => {\n        const items = value || [];\n        return (\n          <TagsEditor\n            constraints={constraints}\n            constraintsType={constraintsType}\n            isDisabled={disabled}\n            hasError={errors.length > 0}\n            items={items}\n            onUpdate={(items) => {\n              setValue(items);\n            }}\n          />\n        );\n      }}\n    </FieldConnector>\n  );\n}\n\nTagsEditorContainer.defaultProps = {\n  isInitiallyDisabled: true,\n};\n","import { TagsEditorContainer } from './TagsEditorContainer';\n\nexport const TagsEditor = TagsEditorContainer;\n"],"names":["TagsEditorConstraints","props","constraintsType","constraints","React","Text","as","fontColor","marginBottom","marginTop","className","css","fontStyle","testId","min","max","styles","dropContainer","whiteSpace","display","flexWrap","input","tokens","spacingS","spacingM","pill","marginRight","pillDisabled","cursor","button","pointerEvents","handle","lineHeight","padding","paddingRight","userSelect","svg","fill","gray500","verticalAlign","SortablePillHandle","SortableHandle","cx","isDisabled","DragIcon","variant","SortablePill","SortableElement","Pill","isSortablePillDisabled","label","onClose","onRemove","index","onDrag","noop","dragHandleComponent","SortableList","SortableContainer","children","TagsEditor","useState","pendingValue","setPendingValue","items","hasError","removeItem","useCallback","newItems","filter","_","filterIndex","onUpdate","swapItems","arrayMove","oldIndex","newIndex","TextInput","isInvalid","type","value","placeholder","onKeyDown","e","keyCode","onChange","target","useDragHandle","axis","distance","onSortEnd","map","item","key","disabled","isEmptyTagsValue","length","TagsEditorContainer","field","sizeValidations","validations","validation","size","sizeConstraints","isNumber","getConstraintsType","FieldConnector","isInitiallyDisabled","isEmptyValue","throttle","setValue","errors","defaultProps"],"mappings":"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"}