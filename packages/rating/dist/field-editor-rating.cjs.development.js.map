{"version":3,"file":"field-editor-rating.cjs.development.js","sources":["../src/RatingRibbon.tsx","../src/RatingEditor.tsx"],"sourcesContent":["import * as React from 'react';\nimport { css } from 'emotion';\n\nimport { IconButton } from '@contentful/f36-components';\n\nimport { StarIcon } from '@contentful/f36-icons';\n\ntype RatingRibbonProps = {\n  disabled: boolean;\n  stars: number;\n  value: number | null | undefined;\n  onSelect: (val: number) => void;\n};\n\ntype RatingRibbonState = {\n  hovered: null | number;\n};\n\nexport class RatingRibbon extends React.Component<RatingRibbonProps, RatingRibbonState> {\n  state = {\n    hovered: null,\n  };\n\n  isSelected = (num: number) => {\n    const hovered = this.state.hovered;\n    const value = this.props.value;\n\n    if (hovered !== null) {\n      return num <= hovered;\n    }\n    if (value) {\n      return num <= value;\n    }\n    return false;\n  };\n\n  onBlur = () => {\n    if (!this.props.disabled) {\n      this.setState({ hovered: null });\n    }\n  };\n\n  onFocus = (num: number) => () => {\n    if (!this.props.disabled) {\n      this.setState({ hovered: num });\n    }\n  };\n\n  render() {\n    const items: number[] = [];\n    for (let i = 1; i <= this.props.stars; i++) {\n      items.push(i);\n    }\n\n    return (\n      <>\n        {items.map((num) => (\n          <IconButton\n            variant=\"transparent\"\n            size=\"small\"\n            icon={\n              <StarIcon\n                variant={this.isSelected(num) ? 'primary' : 'muted'}\n                className={css({ width: '22px', height: '22px' })}\n              />\n            }\n            data-selected={this.isSelected(num) ? 'true' : 'false'}\n            testId=\"rating-editor-star\"\n            isDisabled={this.props.disabled}\n            key={num}\n            onClick={() => {\n              this.props.onSelect(num);\n            }}\n            onKeyDown={(e: React.KeyboardEvent) => {\n              if (e.keyCode === 13) {\n                this.props.onSelect(num);\n              }\n            }}\n            onMouseOver={this.onFocus(num)}\n            onMouseLeave={this.onBlur}\n            onFocus={this.onFocus(num)}\n            onBlur={this.onBlur}\n            aria-label={num.toString()}\n          />\n        ))}\n      </>\n    );\n  }\n}\n","import * as React from 'react';\nimport get from 'lodash/get';\nimport { FieldAPI, ParametersAPI, FieldConnector } from '@contentful/field-editor-shared';\nimport { RatingRibbon } from './RatingRibbon';\n\nimport { TextLink, Flex } from '@contentful/f36-components';\n\nexport interface RatingEditorProps {\n  /**\n   * is the field disabled initially\n   */\n  isInitiallyDisabled: boolean;\n\n  /**\n   * sdk.field\n   */\n  field: FieldAPI;\n\n  /**\n   * sdk.parameters\n   */\n  parameters?: ParametersAPI & {\n    instance: {\n      stars?: number;\n    };\n  };\n}\n\nfunction isValidCount(count?: string | number): count is number {\n  return typeof count === 'number' && !isNaN(count) && count > 0;\n}\n\nfunction getStarCount(count?: number | string): number {\n  const defaultValue = 5;\n\n  if (isValidCount(count)) {\n    return Math.round(count);\n  } else if (typeof count === 'string') {\n    const parsed = parseInt(count, 10);\n    return isValidCount(parsed) ? Math.round(parsed) : defaultValue;\n  } else {\n    return defaultValue;\n  }\n}\n\nexport function RatingEditor(props: RatingEditorProps) {\n  const { field } = props;\n\n  const starsCount = getStarCount(get(props.parameters, ['instance', 'stars']));\n\n  return (\n    <FieldConnector<number>\n      throttle={0}\n      field={field}\n      isInitiallyDisabled={props.isInitiallyDisabled}>\n      {({ disabled, value, setValue }) => {\n        const clearOption = () => {\n          setValue(null);\n        };\n\n        return (\n          <Flex testId=\"rating-editor\" flexDirection=\"row\" marginTop=\"spacingS\">\n            <RatingRibbon\n              disabled={disabled}\n              value={value}\n              stars={starsCount}\n              onSelect={(num) => {\n                setValue(num);\n              }}\n            />\n            {value !== undefined && !disabled && (\n              <Flex marginLeft=\"spacingM\">\n                <TextLink as=\"button\" testId=\"rating-editor-clear\" onClick={clearOption}>\n                  Clear\n                </TextLink>\n              </Flex>\n            )}\n          </Flex>\n        );\n      }}\n    </FieldConnector>\n  );\n}\n\nRatingEditor.defaultProps = {\n  isInitiallyDisabled: true,\n};\n"],"names":["RatingRibbon","state","hovered","isSelected","num","value","props","onBlur","disabled","setState","onFocus","render","items","i","stars","push","React","map","IconButton","variant","size","icon","StarIcon","className","css","width","height","testId","isDisabled","key","onClick","onSelect","onKeyDown","e","keyCode","onMouseOver","onMouseLeave","toString","isValidCount","count","isNaN","getStarCount","defaultValue","Math","round","parsed","parseInt","RatingEditor","field","starsCount","get","parameters","FieldConnector","throttle","isInitiallyDisabled","setValue","clearOption","Flex","flexDirection","marginTop","undefined","marginLeft","TextLink","as","defaultProps"],"mappings":"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"}