"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),o=e(t),n=require("@contentful/field-editor-shared"),a=e(require("deep-equal")),i=e(require("lodash/throttle")),r=require("@codemirror/lang-json"),s=require("@codemirror/view"),l=e(require("@contentful/f36-tokens")),d=e(require("@uiw/react-codemirror")),c=require("emotion"),u=require("@contentful/f36-components");function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v={root:c.css({cursor:"text",padding:l.spacingS,border:"1px solid "+l.gray200,borderTop:"none",borderBottomLeftRadius:l.borderRadiusSmall,borderBottomRightRadius:l.borderRadiusSmall,fontSize:l.fontSizeM,".cm-editor":{color:l.gray900,"&.cm-focused":{outline:"none"}},".cm-scroller":{fontFamily:l.fontStackMonospace,minHeight:"6rem"},"&.disabled":{cursor:"auto",".cm-scroller ":{minHeight:"6rem",backgroundColor:l.gray100,cursor:"not-allowed"},".cm-editor":{border:"1px solid "+l.gray200},".cm-line":{cursor:"not-allowed"},".cm-lines":{cursor:"not-allowed"}}})};function m(e){return o.createElement("div",{className:c.cx(v.root,{disabled:e.isDisabled}),"data-test-id":"json-editor-code-mirror"},o.createElement(d,{value:e.value,onChange:e.onChange,theme:"light",extensions:[r.json(),s.EditorView.lineWrapping],basicSetup:{closeBrackets:!1,lineNumbers:!1,highlightActiveLineGutter:!1,searchKeymap:!1,highlightActiveLine:!1,foldGutter:!1,bracketMatching:!1,syntaxHighlighting:!1},width:"100%",editable:!e.isDisabled,indentWithTab:!0}))}var b={toolbar:c.css({display:"flex",alignItems:"center",padding:l.spacingXs,justifyContent:"space-between",backgroundColor:l.gray100,border:"1px solid "+l.gray200,borderTopLeftRadius:l.borderRadiusSmall,borderTopRightRadius:l.borderRadiusSmall,borderBottom:"none"}),title:c.css({fontFamily:l.fontStackPrimary,fontSize:l.fontSizeM,color:l.gray600}),actions:c.css({button:{marginLeft:l.spacingS}})};function h(e){return o.createElement("div",{className:b.toolbar},o.createElement("div",{className:b.title},"JSON Editor"),o.createElement("div",{className:b.actions},o.createElement(u.Button,{variant:"secondary",size:"small",isDisabled:e.isUndoDisabled,testId:"json-editor-undo",onClick:function(){e.onUndo()}},"Undo"),o.createElement(u.Button,{variant:"secondary",size:"small",isDisabled:e.isRedoDisabled,testId:"json-editor-redo",onClick:function(){e.onRedo()}},"Redo")))}function g(){return o.createElement("div",{role:"status","data-test-id":"json-editor.invalid-json",className:c.css({marginTop:l.spacingS})},o.createElement(u.ValidationMessage,null,"This is not valid JSON"))}function S(e){return""===e?{value:void 0,valid:!0}:function(e){var t;try{t=JSON.parse(e)}catch(e){return!1}return"object"==typeof t}(e)?{value:JSON.parse(e),valid:!0}:{value:void 0,valid:!1}}var y=function(e){var o,n;function a(t){var o,n;return(o=e.call(this,t)||this).setValidJson=function(e){o.setState({isValidJson:e})},o.pushUndo=i((function(e){o.setState((function(t){return{undoStack:[].concat(t.undoStack,[e])}}))}),400),o.onChange=function(e){var t=S(e);e!==o.state.lastUndo&&o.pushUndo(o.state.value),o.setState({value:e,isValidJson:t.valid}),t.valid&&o.props.setValue(t.value)},o.onUndo=function(){var e=o.state.undoStack;if(0!==e.length){var t=e.pop()||"",n=S(t);o.setState((function(o){return p({},o,{value:t,isValidJson:n.valid,undoStack:e,redoStack:[].concat(o.redoStack,[o.value]),lastUndo:t})}),(function(){n.valid&&o.props.setValue(n.value)}))}},o.onRedo=function(){var e=[].concat(o.state.redoStack);if(0!==e.length){var t=e.pop()||"",n=S(t);o.setState((function(o){return p({},o,{value:t,isValidJson:n.valid,redoStack:e,undoStack:[].concat(o.undoStack,[o.value])})}),(function(){n.valid&&o.props.setValue(n.value)}))}},o.state={value:(n=t.initialValue,null==n?"":JSON.stringify(n,null,4)),isValidJson:!0,undoStack:[],redoStack:[],lastUndo:""},o}return n=e,(o=a).prototype=Object.create(n.prototype),o.prototype.constructor=o,f(o,n),a.prototype.render=function(){return t.createElement("div",{"data-test-id":"json-editor"},t.createElement(h,{isRedoDisabled:this.props.disabled||0===this.state.redoStack.length,isUndoDisabled:this.props.disabled||0===this.state.undoStack.length,onUndo:this.onUndo,onRedo:this.onRedo}),t.createElement(m,{value:this.state.value,onChange:this.onChange,isDisabled:this.props.disabled}),!this.state.isValidJson&&t.createElement(g,null))},a}(t.Component);y.defaultProps={isInitiallyDisabled:!0},exports.JsonEditor=function(e){return t.createElement(n.FieldConnector,{field:e.field,isInitiallyDisabled:e.isInitiallyDisabled,isEqualValues:function(e,t){return a(e,t)}},(function(e){return t.createElement(y,{key:"json-editor-"+e.externalReset,initialValue:e.value,disabled:e.disabled,setValue:e.setValue})}))};
//# sourceMappingURL=field-editor-json.cjs.production.min.js.map
