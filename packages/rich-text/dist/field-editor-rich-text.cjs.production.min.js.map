{"version":3,"file":"field-editor-rich-text.cjs.production.min.js","sources":["../src/internal/hooks.ts","../src/ContentfulEditorProvider.ts","../src/internal/misc.ts","../src/SdkProvider.tsx","../src/internal/queries.ts","../src/internal/transforms.ts","../src/helpers/environment.ts","../src/helpers/editor.ts","../src/helpers/validations.ts","../../../node_modules/regenerator-runtime/runtime.js","../src/plugins/CommandPalette/utils/fetchAssets.ts","../src/plugins/CommandPalette/utils/fetchEntries.ts","../src/plugins/CommandPalette/utils/insertBlock.ts","../src/plugins/CommandPalette/useCommands.ts","../src/plugins/CommandPalette/constants.ts","../src/plugins/CommandPalette/components/CommandList.styles.ts","../src/plugins/CommandPalette/components/CommandList.tsx","../src/plugins/CommandPalette/utils/createInlineEntryNode.ts","../src/plugins/CommandPalette/hooks/useCommandList.tsx","../src/plugins/CommandPalette/components/CommandPrompt.tsx","../src/plugins/CommandPalette/utils/trimLeadingSlash.ts","../src/plugins/links-tracking.tsx","../src/plugins/shared/FetchingWrappedAssetCard.tsx","../src/plugins/shared/FetchingWrappedEntryCard.tsx","../src/plugins/EmbeddedEntityBlock/LinkedEntityBlock.tsx","../src/helpers/getLinkedContentTypeIdsForNodeType.ts","../src/helpers/newEntitySelectorConfigFromRichTextField.ts","../src/plugins/EmbeddedEntityBlock/Util.ts","../src/plugins/EmbeddedEntityBlock/ToolbarIcon.tsx","../src/plugins/EmbeddedEntityBlock/index.tsx","../src/plugins/EmbeddedEntityInline/FetchingWrappedInlineEntryCard.tsx","../src/plugins/EmbeddedEntityInline/Util.ts","../src/plugins/EmbeddedEntityInline/index.tsx","../src/plugins/Heading/components/ToolbarHeadingButton.tsx","../src/helpers/transformers.ts","../src/helpers/extractNodes.ts","../src/plugins/Heading/components/Heading.tsx","../src/plugins/Heading/createHeadingPlugin.ts","../src/plugins/shared/ToolbarButton.tsx","../src/plugins/Hr/index.tsx","../src/plugins/Hyperlink/HyperlinkModal.tsx","../src/plugins/Hyperlink/components/ToolbarHyperlinkButton.tsx","../src/plugins/Hyperlink/utils.ts","../src/plugins/Hyperlink/useEntityInfo.ts","../src/plugins/Hyperlink/components/styles.ts","../src/plugins/Hyperlink/components/EntityHyperlink.tsx","../src/plugins/Hyperlink/components/UrlHyperlink.tsx","../src/plugins/Hyperlink/createHyperlinkPlugin.ts","../src/plugins/List/components/List.tsx","../src/plugins/List/components/ListItem.tsx","../src/plugins/List/transforms/moveListItemDown.ts","../src/internal/constants.ts","../src/plugins/List/transforms/unwrapList.ts","../src/plugins/List/transforms/toggleList.ts","../src/plugins/List/onKeyDownList.ts","../src/plugins/List/transforms/moveListItems.ts","../src/plugins/List/utils.ts","../src/plugins/List/insertListFragment.ts","../src/plugins/List/withList.ts","../src/plugins/List/transforms/deleteBackwardList.ts","../src/plugins/List/insertListBreak.ts","../src/plugins/List/transforms/insertListItem.ts","../src/plugins/List/components/ToolbarListButton.tsx","../src/plugins/Marks/helpers.ts","../src/plugins/Marks/components/MarkToolbarButton.tsx","../src/plugins/Marks/Bold.tsx","../src/plugins/Marks/Code.tsx","../src/plugins/Marks/Italic.tsx","../src/plugins/Marks/Subscript.tsx","../src/plugins/Marks/Superscript.tsx","../src/plugins/Marks/Underline.tsx","../src/plugins/Normalizer/baseRules.ts","../src/plugins/Normalizer/utils.ts","../src/plugins/Normalizer/withNormalizer.ts","../src/plugins/Paragraph/Paragraph.tsx","../src/plugins/Paragraph/createParagraphPlugin.ts","../src/plugins/PasteHTML/utils/sanitizeHTML.ts","../src/plugins/PasteHTML/utils/sanitizeSheets.ts","../src/plugins/PasteHTML/createPasteHTMLPlugin.ts","../src/plugins/Quote/components/Quote.tsx","../src/plugins/Quote/shouldResetQuote.ts","../src/plugins/Quote/toggleQuote.ts","../src/plugins/Quote/withQuote.ts","../src/plugins/Quote/createQuotePlugin.ts","../src/plugins/Quote/components/ToolbarQuoteButton.tsx","../src/plugins/SelectOnBackspace/createSelectOnBackspacePlugin.ts","../src/plugins/Table/actions/addRow.ts","../src/plugins/Table/actions/addColumn.ts","../src/plugins/Table/helpers.ts","../src/plugins/Table/components/TableActions.tsx","../src/plugins/Table/actions/setHeader.ts","../src/plugins/Table/components/Cell.tsx","../src/plugins/Table/components/HeaderCell.tsx","../src/plugins/Table/components/Row.tsx","../src/plugins/Table/components/Table.tsx","../src/plugins/Table/insertTableFragment.ts","../src/plugins/Table/onKeyDownTable.ts","../src/constants/Schema.ts","../src/plugins/Tracking/utils.ts","../src/plugins/Tracking/createTrackingPlugin.ts","../src/plugins/Table/tableTracking.ts","../src/plugins/Table/createTablePlugin.ts","../src/plugins/Table/components/ToolbarButton.tsx","../src/plugins/Text/createTextPlugin.ts","../src/plugins/TrailingParagraph/index.ts","../src/plugins/index.ts","../src/prepareDocument.ts","../src/helpers/sanitizeIncomingSlateDoc.ts","../src/RichTextEditor.styles.ts","../src/Toolbar/components/EmbeddedEntityDropdownButton.tsx","../src/Toolbar/components/EmbedEntityWidget.tsx","../src/Toolbar/index.tsx","../src/Toolbar/components/StickyToolbarWrapper.tsx","../src/helpers/removeInternalMarks.ts","../src/useOnValueChanged.ts","../src/RichTextEditor.tsx","../src/plugins/DragAndDrop/index.tsx","../src/plugins/CommandPalette/createCommandPalettePlugin.ts","../src/plugins/CommandPalette/onKeyDown.ts","../src/plugins/Paragraph/utils.ts","../src/plugins/List/createListPlugin.ts","../src/plugins/Marks/index.ts","../src/plugins/Voids/createVoidsPlugin.ts","../src/plugins/Break/createSoftBreakPlugin.ts","../src/plugins/Break/createExitBreakPlugin.ts","../src/plugins/Break/createResetNodePlugin.ts","../src/plugins/Normalizer/createNormalizerPlugin.ts","../src/dialogs/HypelinkDialog/HyperlinkDialog.jsx","../src/dialogs/openRichTextDialog.tsx","../src/dialogs/renderRichTextDialog.tsx"],"sourcesContent":["import * as p from '@udecode/plate-core';\nimport * as sr from 'slate-react';\n\nexport const useReadOnly = sr.useReadOnly;\nexport const usePlateEditorRef = p.usePlateEditorRef;\nexport const usePlateEditorState = p.usePlateEditorState;\n","import { createContext, useContext } from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\n\nimport { usePlateEditorRef, usePlateEditorState } from './internal/hooks';\nimport { Value, PlateEditor } from './internal/types';\n\nexport function getContentfulEditorId(sdk: FieldExtensionSDK) {\n  const { entry, field } = sdk;\n  const sys = entry.getSys();\n\n  return `rich-text-editor-${sys.id}-${field.id}-${field.locale}`;\n}\n\nexport const editorContext = createContext('');\n\nexport const ContentfulEditorIdProvider = editorContext.Provider;\n\nexport function useContentfulEditorId(id?: string) {\n  const contextId = useContext(editorContext);\n\n  if (id) {\n    return id;\n  }\n\n  if (!contextId) {\n    throw new Error(\n      'could not find editor id. Please ensure the component is wrapped in <ContentfulEditorIdProvider> '\n    );\n  }\n\n  return contextId;\n}\n\n// This hook re-renders when the value changes\n// Use case: Toolbar icons, for example\nexport function useContentfulEditor(id?: string) {\n  const editorId = useContentfulEditorId(id);\n  const editor = usePlateEditorState<Value, PlateEditor>(editorId);\n\n  return editor;\n}\n\n// This doesn't re-render when the value changes\nexport function useContentfulEditorRef(id?: string) {\n  const editorId = useContentfulEditorId(id);\n  const editor = usePlateEditorRef<Value, PlateEditor>(editorId);\n\n  return editor;\n}\n","import * as p from '@udecode/plate-core';\nimport { StoreApiGet } from '@udecode/zustood';\nimport * as s from 'slate';\n\nimport type { Value, PlateEditor, Location, PlatePlugin } from './types';\n\nexport type CreatePlateEditorOptions = Omit<\n  p.CreatePlateEditorOptions<Value, PlateEditor>,\n  'plugins'\n> & {\n  plugins?: PlatePlugin[];\n};\nexport const createPlateEditor = (options: CreatePlateEditorOptions = {}) => {\n  return p.createPlateEditor<Value, PlateEditor>(\n    options as p.CreatePlateEditorOptions<Value, PlateEditor>\n  );\n};\n\nexport const withoutNormalizing = (editor: PlateEditor, fn: () => boolean | void) => {\n  return p.withoutNormalizing(editor, fn);\n};\n\nexport const focusEditor = (editor: PlateEditor, target?: Location) => {\n  p.focusEditor(editor, target);\n};\n\nexport const blurEditor = (editor: PlateEditor) => {\n  p.blurEditor(editor);\n};\n\nexport const selectEditor = (editor: PlateEditor, opts: p.SelectEditorOptions) => {\n  p.selectEditor(editor, opts);\n};\n\nexport const fromDOMPoint = (\n  editor: PlateEditor,\n  domPoint: [Node /* DOM Node*/, number],\n  opts = { exactMatch: false, suppressThrow: false }\n): s.BasePoint | null | undefined => {\n  return p.toSlatePoint(editor, domPoint, opts);\n};\n\nexport const mockPlugin = (plugin?: Partial<PlatePlugin> | undefined) => {\n  return p.mockPlugin(\n    // TODO check if there is a way around this ugly casting\n    plugin as unknown as\n      | Partial<p.PlatePlugin<p.AnyObject, p.Value, p.PlateEditor<p.Value>>>\n      | undefined\n  );\n};\n\nexport const getPlateSelectors = (\n  id?: string | undefined\n): StoreApiGet<p.PlateStoreState<Value, PlateEditor>, {}> => {\n  return p.getPlateSelectors(id);\n};\n","import * as React from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport constate from 'constate';\n\ninterface SdkProviderProps {\n  sdk: FieldExtensionSDK;\n}\n\nfunction useSdk({ sdk }: SdkProviderProps) {\n  const sdkMemo = React.useMemo<FieldExtensionSDK>(() => sdk, []); // eslint-disable-line -- TODO: explain this disable\n\n  return sdkMemo;\n}\n\nexport const [SdkProvider, useSdkContext] = constate(useSdk);\n","/**\n * Re-exporting Plate/Slate queries (aka selectors) to reduce\n * the blast radius of version upgrades\n */\nimport * as p from '@udecode/plate-core';\nimport * as s from 'slate';\n\nimport type {\n  Value,\n  PlateEditor,\n  Location,\n  Node,\n  NodeEntry,\n  BaseRange,\n  Element,\n  Text,\n  Ancestor,\n  BasePoint,\n  Path,\n} from './types';\n\n/**\n * Get text content at location\n */\nexport const getText = (editor: PlateEditor, at?: Location) => {\n  return p.getEditorString(editor, at);\n};\n\nexport const isText = (value: unknown): value is Text => {\n  return p.isText(value);\n};\n\nexport const getEndPoint = (editor: PlateEditor, at: Location) => {\n  return p.getEndPoint(editor, at);\n};\n\nexport const getStartPoint = (editor: PlateEditor, at: Location) => {\n  return p.getStartPoint(editor, at);\n};\n\nexport const isNode = (value: unknown): value is Node => {\n  return p.isNode(value);\n};\n\nexport const isSelectionAtBlockEnd = (\n  editor: PlateEditor,\n  options?: p.GetAboveNodeOptions<Value>\n) => {\n  return p.isSelectionAtBlockEnd(editor, options);\n};\n\nexport const isSelectionAtBlockStart = (\n  editor: PlateEditor,\n  options?: p.GetAboveNodeOptions<Value>\n) => {\n  return p.isSelectionAtBlockStart(editor, options);\n};\n\nexport const getBlockAbove = (editor: PlateEditor, options?: p.GetAboveNodeOptions<p.Value>) => {\n  return p.getBlockAbove(editor, options);\n};\n\nexport const getNodeEntry = (editor: PlateEditor, at: Location, options?: s.EditorNodeOptions) => {\n  return p.getNodeEntry(editor, at, options);\n};\n\nexport const getNodeEntries = (editor: PlateEditor, options?: p.GetNodeEntriesOptions) => {\n  return p.getNodeEntries(editor, options);\n};\n\n// TODO: Ancestor may not be the correct type for root\nexport const getNodeChildren = (\n  root: Ancestor,\n  path: Path,\n  options?: s.NodeChildrenOptions | undefined\n) => {\n  return p.getNodeChildren(root, path, options);\n};\n\nexport const getParentNode = (\n  editor: PlateEditor,\n  at: Location,\n  options?: s.EditorParentOptions\n) => {\n  return p.getParentNode(editor, at, options) as NodeEntry | undefined;\n};\n\nexport const someNode = (editor: PlateEditor, options: p.FindNodeOptions) => {\n  return p.someNode(editor, options);\n};\n\nexport const getChildren = (entry: NodeEntry) => {\n  // Node.children crashes when given a text node\n  if (s.Text.isText(entry[0])) {\n    return [];\n  }\n\n  return p.getChildren(entry) as NodeEntry[];\n};\n\nexport const isFirstChild = (path: Path) => {\n  return p.isFirstChild(path);\n};\n\nexport const getDescendantNodeByPath = (root: Node, path: s.Path): Node => {\n  // @ts-expect-error\n  return s.Node.get(root, path);\n};\n\nexport const getNodeDescendants = (\n  root: PlateEditor | Node,\n  options?: s.NodeDescendantsOptions\n) => {\n  return p.getNodeDescendants(root, { ...options, pass: undefined });\n};\n\nexport const isRangeCollapsed = (range?: BaseRange) => {\n  return p.isCollapsed(range);\n};\n\n// TODO: simplify\nexport const isRangeAcrossBlocks = (\n  editor: p.TEditor<p.Value>,\n  options?:\n    | (Omit<p.GetAboveNodeOptions<p.Value>, 'at'> & { at?: s.BaseRange | null | undefined })\n    | undefined\n) => {\n  return p.isRangeAcrossBlocks(editor, options);\n};\n\nexport const isRangeExpanded = (range?: BaseRange) => {\n  return p.isExpanded(range);\n};\n\nexport const getRange = (editor: PlateEditor, at: Location, to?: Location) => {\n  return p.getRange(editor, at, to);\n};\n\nexport const getRangeEdges = (range: BaseRange) => {\n  return s.Range.edges(range);\n};\n\nexport const getRangeStart = (range: BaseRange) => {\n  return s.Range.start(range);\n};\n\nexport const getRangeEnd = (range: BaseRange) => {\n  return s.Range.end(range);\n};\n\nexport const getAboveNode = (editor: PlateEditor, opts?: p.GetAboveNodeOptions<Value>) => {\n  return p.getAboveNode(editor, opts) as NodeEntry | undefined;\n};\n\nexport const getNextNode = (editor: PlateEditor, opts?: p.GetNextNodeOptions<Value>) => {\n  return p.getNextNode(editor, opts) as NodeEntry | undefined;\n};\n\nexport const getCommonNode = (\n  root: PlateEditor | Node,\n  path: s.Path,\n  another: s.Path\n): NodeEntry => {\n  return p.getCommonNode(root, path, another);\n};\n\nexport const getNodeTexts = (\n  root: Node,\n  opts?: {\n    from?: s.Path;\n    to?: s.Path;\n    pass?: (ne: NodeEntry) => boolean;\n    reverse?: boolean;\n  }\n) => {\n  return p.getNodeTexts(root, opts);\n};\n\nexport const findNode = (editor: PlateEditor, options?: p.FindNodeOptions<p.Value> | undefined) => {\n  return p.findNode(editor, options);\n};\n\nexport const isMarkActive = (editor: PlateEditor, type: string) => {\n  return p.isMarkActive(editor, type);\n};\n\nexport const getMarks = (editor: PlateEditor) => {\n  return p.getMarks(editor);\n};\n\nexport const isEditor = (value: unknown): value is PlateEditor => {\n  return p.isEditor(value);\n};\n\nexport const isEditorReadOnly = (editor: PlateEditor) => {\n  return p.isEditorReadOnly(editor);\n};\n\nexport const isElement = (value: unknown): value is Element => {\n  return p.isElement(value);\n};\n\nexport const isBlockNode = (editor: PlateEditor, value: unknown): value is Element => {\n  return p.isBlock(editor, value);\n};\n\nexport const findNodePath = (editor: PlateEditor, node: Node) => {\n  return p.findNodePath(editor, node);\n};\n\nexport const isAncestorPath = (path: s.Path, another: s.Path) => {\n  return s.Path.isAncestor(path, another);\n};\n\nexport const isAncestorEmpty = (editor: PlateEditor, node: Ancestor) => {\n  return p.isAncestorEmpty(editor, node);\n};\n\nexport const getParentPath = (path: s.Path) => {\n  return s.Path.parent(path);\n};\n\nexport const getNextPath = (path: s.Path) => {\n  return s.Path.next(path);\n};\n\nexport const getPreviousPath = (path: s.Path) => {\n  return s.Path.previous(path);\n};\n\nexport const getLastChildPath = (nodeEntry: NodeEntry) => {\n  return p.getLastChildPath(nodeEntry);\n};\n\nexport const getPathLevels = (path: s.Path, options?: s.PathLevelsOptions) => {\n  return s.Path.levels(path, options);\n};\n\nexport const isCommonPath = (path: s.Path, anotherPath: s.Path) => {\n  return s.Path.isCommon(path, anotherPath);\n};\n\nexport const isFirstChildPath = (path: s.Path) => {\n  return p.isFirstChild(path);\n};\n\nexport const isLastChildPath = (entry: NodeEntry, childPath: s.Path) => {\n  return p.isLastChild(entry, childPath);\n};\n\nexport const isChildPath = (path: s.Path, another: s.Path) => {\n  return s.Path.isChild(path, another);\n};\n\nexport const matchNode = (node: Node, path: s.Path, fn: p.Predicate<PlateEditor | Node>) => {\n  return p.match(node, path, fn);\n};\n\nexport const someHtmlElement = (\n  rootNode: globalThis.Node,\n  predicate: (node: HTMLElement) => boolean\n) => {\n  return p.someHtmlElement(rootNode, predicate);\n};\n\nexport const getPointBefore = (\n  editor: PlateEditor,\n  at: Location,\n  options?: s.EditorBeforeOptions\n) => {\n  return p.getPointBefore(editor, at, options);\n};\n\nexport const getPointAfter = (\n  editor: PlateEditor,\n  at: Location,\n  options?: s.EditorAfterOptions\n) => {\n  return p.getPointAfter(editor, at, options);\n};\n\nexport const isEndPoint = (\n  editor: PlateEditor,\n  point: BasePoint | null | undefined,\n  at: Location\n) => {\n  return p.isEndPoint(editor, point, at);\n};\n\nexport const isInline = (editor: PlateEditor, value: unknown) => {\n  return p.isInline(editor, value);\n};\n\nexport const queryNode = (entry?: NodeEntry, options?: p.QueryNodeOptions) => {\n  return p.queryNode(entry, options);\n};\n\nexport const getPluginType = (editor: PlateEditor, key: string) => {\n  return p.getPluginType(editor, key);\n};\n\nexport const createPathRef = (editor: PlateEditor, at: Path) => {\n  return p.createPathRef(editor, at);\n};\n\nexport const match = (obj: Node, path: Path, predicate?: p.Predicate<Node> | undefined) => {\n  return p.match(obj, path, predicate);\n};\n\nexport const getLastNodeByLevel = (editor: PlateEditor, level: number): NodeEntry | undefined => {\n  return p.getLastNodeByLevel(editor, level);\n};\n","import * as p from '@udecode/plate-core';\nimport * as s from 'slate';\nimport { Except } from 'type-fest';\n\nimport {\n  PlateEditor,\n  Node,\n  ToggleNodeTypeOptions,\n  EditorNodesOptions,\n  BaseRange,\n  Value,\n  SelectionMoveOptions,\n  TextInsertTextOptions,\n  Element,\n  SelectionCollapseOptions,\n  Path,\n  Span,\n  BasePoint,\n  Location,\n} from './types';\n\n/**\n * Apply editor normalization rules\n */\nexport const normalize = (\n  editor: PlateEditor,\n  options: s.EditorNormalizeOptions = { force: true }\n) => {\n  return p.normalizeEditor(editor, options);\n};\n\n/**\n * Set the selection to a location\n */\nexport const setSelection = (editor: PlateEditor, props: Partial<BaseRange>) => {\n  return p.setSelection(editor, props);\n};\n\nexport const select = (editor: PlateEditor, location: Location) => {\n  return p.select(editor, location);\n};\n\nexport const moveSelection = (editor: PlateEditor, options?: SelectionMoveOptions) => {\n  return p.moveSelection(editor, options);\n};\n\nexport const moveChildren = (editor: PlateEditor, options: p.MoveChildrenOptions<Value>) => {\n  return p.moveChildren(editor, options);\n};\n\nexport const collapseSelection = (editor: PlateEditor, options?: SelectionCollapseOptions) => {\n  return p.collapseSelection(editor, options);\n};\n\nexport const setNodes = (\n  editor: PlateEditor,\n  attrs: Partial<Except<Node, 'children' | 'text'>>,\n  opts?: p.SetNodesOptions<Value>\n) => {\n  p.setNodes(editor, attrs, opts);\n};\n\nexport const unsetNodes = (\n  editor: PlateEditor,\n  props: string | number | (string | number)[],\n  options?: p.UnsetNodesOptions<Value> | undefined\n) => {\n  p.unsetNodes(editor, props, options);\n};\n\nexport const insertNodes = (\n  editor: PlateEditor,\n  nodes: Node | Node[],\n  opts?: p.InsertNodesOptions\n) => {\n  return p.insertNodes(editor, nodes, opts);\n};\n\nexport const splitNodes = (editor: PlateEditor, options?: p.SplitNodesOptions<Value>) => {\n  return p.splitNodes(editor, options);\n};\n\nexport const liftNodes = (editor: PlateEditor, options?: p.LiftNodesOptions<Value> | undefined) => {\n  return p.liftNodes(editor, options);\n};\n\nexport const unwrapNodes = (editor: PlateEditor, options?: p.UnwrapNodesOptions<Value>) => {\n  return p.unwrapNodes(editor, options);\n};\n\nexport const wrapNodes = (\n  editor: PlateEditor,\n  element: Element,\n  options?: p.WrapNodesOptions<Value>\n) => {\n  return p.wrapNodes(editor, element, options);\n};\n\nexport const toggleNodeType = (\n  editor: PlateEditor,\n  options: ToggleNodeTypeOptions,\n  editorOptions?: Omit<EditorNodesOptions, 'match'>\n) => {\n  p.toggleNodeType(editor, options, editorOptions);\n};\n\nexport const removeMark = (editor: PlateEditor, type: string, at: BaseRange) => {\n  p.removeMark(editor, { key: type, at });\n};\n\nexport const unhangRange = (\n  editor: PlateEditor,\n  range?: Path | BasePoint | BaseRange | Span | null | undefined,\n  options?: p.UnhangRangeOptions | undefined\n) => {\n  return p.unhangRange(editor, range, options);\n};\n\nexport const toggleMark = (\n  editor: PlateEditor,\n  options: p.ToggleMarkOptions<Value, keyof p.TText>\n) => {\n  return p.toggleMark(editor, options);\n};\n\nexport const addMark = (editor: PlateEditor, type: string, value: unknown = true) => {\n  p.addMark(editor, type, value);\n};\n\nexport const insertText = (editor: PlateEditor, text: string, options?: TextInsertTextOptions) => {\n  return p.insertText(editor, text, options);\n};\n\nexport const deleteText = (editor: PlateEditor, opts?: Parameters<typeof p.deleteText>['1']) => {\n  p.deleteText(editor, opts);\n};\n\nexport const removeNodes = (editor: PlateEditor, opts?: p.RemoveNodesOptions<Value>) => {\n  p.removeNodes(editor, opts);\n};\n\nexport const moveNodes = (editor: PlateEditor, opts?: p.MoveNodesOptions<Value>) => {\n  p.moveNodes(editor, opts);\n};\n\nexport const deleteFragment = (\n  editor: PlateEditor,\n  options?: s.EditorFragmentDeletionOptions | undefined\n) => {\n  return p.deleteFragment(editor, options);\n};\n","export const IS_SAFARI =\n  typeof navigator !== 'undefined' && /Version\\/[\\d.]+.*Safari/.test(navigator.userAgent);\n\nexport const IS_CHROME = /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9.]+)(:?\\s|$)/.test(\n  navigator.userAgent\n);\n","import { Link } from '@contentful/field-editor-reference/dist/types';\nimport { BLOCKS, INLINES } from '@contentful/rich-text-types';\n\nimport { focusEditor } from '../internal/misc';\nimport {\n  getText,\n  getNodeEntries,\n  getNodeEntry,\n  getNodeDescendants,\n  isText,\n  isRangeCollapsed as isSelectionCollapsed,\n  isEditor,\n  isElement,\n  getPathLevels,\n  isCommonPath,\n} from '../internal/queries';\nimport {\n  setNodes,\n  select,\n  insertNodes,\n  toggleNodeType,\n  moveSelection,\n  unwrapNodes,\n  insertText,\n  wrapNodes,\n  deleteText,\n  collapseSelection,\n} from '../internal/transforms';\nimport { EditorNodesOptions, ToggleNodeTypeOptions, Node, Path } from '../internal/types';\nimport { Element, PlateEditor } from '../internal/types';\nimport { IS_SAFARI } from './environment';\n\nexport const LINK_TYPES: INLINES[] = [\n  INLINES.HYPERLINK,\n  INLINES.ENTRY_HYPERLINK,\n  INLINES.ASSET_HYPERLINK,\n];\n\nconst LIST_TYPES: BLOCKS[] = [BLOCKS.OL_LIST, BLOCKS.UL_LIST];\n\nexport function isBlockSelected(editor: PlateEditor, type: string): boolean {\n  const [match] = Array.from(\n    getNodeEntries(editor, {\n      match: (node) => isElement(node) && node.type === type,\n    })\n  );\n  return !!match;\n}\n\nexport function isRootLevel(path: Path): boolean {\n  return path.length === 1;\n}\n\ntype NodeEntry = [Element, Path];\ntype NodeType = BLOCKS | INLINES;\nexport function getNodeEntryFromSelection(\n  editor: PlateEditor,\n  nodeTypeOrTypes: NodeType | NodeType[],\n  path?: Path\n): NodeEntry | [] {\n  path = path ?? editor.selection?.focus.path;\n  if (!path) return [];\n  const nodeTypes = Array.isArray(nodeTypeOrTypes) ? nodeTypeOrTypes : [nodeTypeOrTypes];\n  for (let i = 0; i < path.length; i++) {\n    const nodeEntry = getNodeEntry(editor, path.slice(0, i + 1)) as NodeEntry;\n    if (nodeTypes.includes(nodeEntry[0].type as NodeType)) return nodeEntry;\n  }\n  return [];\n}\n\nexport function isNodeTypeSelected(\n  editor: PlateEditor | null,\n  nodeType: BLOCKS | INLINES\n): boolean {\n  if (!editor) return false;\n  const [node] = getNodeEntryFromSelection(editor, nodeType);\n  return !!node;\n}\n\nexport function moveToTheNextLine(editor: PlateEditor) {\n  moveSelection(editor, { distance: 1, unit: 'line' });\n}\n\nexport function moveToTheNextChar(editor: PlateEditor) {\n  moveSelection(editor, { distance: 1, unit: 'offset' });\n}\n\nexport function insertEmptyParagraph(editor: PlateEditor, options?) {\n  const emptyParagraph: Element = {\n    type: BLOCKS.PARAGRAPH,\n    children: [{ text: '' }],\n    data: {},\n    isVoid: false,\n  };\n  insertNodes(editor, emptyParagraph, options);\n}\n\nexport function getElementFromCurrentSelection(editor: PlateEditor) {\n  if (!editor.selection) return [];\n\n  return Array.from(\n    getNodeEntries(editor, {\n      /**\n       * editor.select is a Range, which includes anchor and focus, the beginning and the end of a selection\n       * when using only editor.selection.focus, we might get only the end of the selection, or where the text cursor is\n       * and in some cases getting the next element instead of the one we want\n       **/\n      at: editor.selection,\n      match: (node) => isElement(node),\n    })\n  ).flat();\n}\n\nexport function isList(editor?: PlateEditor) {\n  if (!editor) {\n    return false;\n  }\n\n  const element = getElementFromCurrentSelection(editor);\n\n  return element.some(\n    (element) => isElement(element) && LIST_TYPES.includes(element.type as BLOCKS)\n  );\n}\n\nexport function getTableSize(table: Element): Record<'numRows' | 'numColumns', number> | null {\n  const numRows = table.children.length;\n  if (!numRows) return null;\n  const [firstRow] = table.children;\n  const numColumns = (firstRow as Element).children?.length;\n  return { numRows, numColumns };\n}\n\ninterface InsertLinkOptions {\n  text: string;\n  type: INLINES.HYPERLINK | INLINES.ENTRY_HYPERLINK | INLINES.ASSET_HYPERLINK;\n  url?: string;\n  target?: Link;\n  path?: Path;\n}\n\n// TODO: move to hyperlink plugin\nexport function insertLink(editor, options: InsertLinkOptions) {\n  if (editor.selection) {\n    wrapLink(editor, options);\n  }\n}\n\n// TODO: move to hyperlink plugin\nexport function isLinkActive(editor?: PlateEditor | null) {\n  if (!editor) {\n    return false;\n  }\n\n  const [link] = Array.from(\n    getNodeEntries(editor, {\n      match: (node) =>\n        !isEditor(node) && isElement(node) && LINK_TYPES.includes(node.type as INLINES),\n    })\n  );\n  return !!link;\n}\n\n// TODO: move to hyperlink plugin\nexport function unwrapLink(editor) {\n  unwrapNodes(editor, {\n    match: (node) =>\n      !isEditor(node) && isElement(node) && LINK_TYPES.includes(node.type as INLINES),\n  });\n}\n\n// TODO: move to hyperlink plugin\nexport function wrapLink(editor, { text, url, target, type, path }: InsertLinkOptions) {\n  if (isLinkActive(editor) && !path) {\n    unwrapLink(editor);\n  }\n\n  const { selection } = editor;\n  const isCollapsed = selection && isSelectionCollapsed(selection);\n  const link = {\n    type,\n    data: {},\n    children: isCollapsed ? [{ text }] : [],\n  };\n\n  if (url) {\n    link.data = { uri: url };\n  }\n\n  if (target) {\n    link.data = { target };\n  }\n\n  // TODO: always set the selection to the end of the inserted link\n  if (path) {\n    setNodes(editor, link, { at: path });\n    insertText(editor, text, { at: path });\n    select(editor, path);\n  } else if (isCollapsed) {\n    insertNodes(editor, link);\n  } else {\n    wrapNodes(editor, link, { split: true });\n    deleteText(editor);\n    insertText(editor, text);\n    collapseSelection(editor, { edge: 'end' });\n  }\n}\n\nexport function getAncestorPathFromSelection(editor: PlateEditor) {\n  if (!editor.selection) return undefined;\n\n  return getPathLevels(editor.selection.focus.path).find((level) => level.length === 1);\n}\n\nexport const isAtEndOfTextSelection = (editor: PlateEditor) =>\n  editor.selection?.focus.offset === getText(editor, editor.selection?.focus.path).length;\n\n/**\n * This traversal strategy is unfortunately necessary because Slate doesn't\n * expose something like Node.next(editor).\n */\nexport function getNextNode(editor: PlateEditor): Element | null {\n  if (!editor.selection) {\n    return null;\n  }\n  const descendants = getNodeDescendants(editor, { from: editor.selection.focus.path });\n  // eslint-disable-next-line no-constant-condition -- TODO: explain this disable\n  while (true) {\n    const { done, value } = descendants.next();\n    if (done) {\n      return null;\n    }\n    const [node, path] = value as NodeEntry;\n    if (isCommonPath(path, editor.selection.focus.path)) {\n      continue;\n    }\n    return node as Element;\n  }\n}\n\nexport const INLINE_TYPES = Object.values(INLINES) as string[];\n\nexport const isInlineOrText = (node: Node) => {\n  // either text or inline elements\n  return isText(node) || (isElement(node) && INLINE_TYPES.includes(node.type));\n};\n\nexport const focus = (editor: PlateEditor) => {\n  const x = window.scrollX;\n  const y = window.scrollY;\n\n  focusEditor(editor);\n\n  // Safari has issues with `editor.focus({ preventScroll: true })`, it ignores the option `preventScroll`\n  if (IS_SAFARI) {\n    setTimeout(function () {\n      window.scrollTo(x, y); // restore position\n    }, 0);\n  }\n};\n\nexport function toggleElement(\n  editor: PlateEditor,\n  options: ToggleNodeTypeOptions,\n  editorOptions?: EditorNodesOptions\n) {\n  toggleNodeType(editor, options, editorOptions);\n\n  // We must reset `data` from one element to another\n  setNodes(editor, { data: {} });\n}\n","/* eslint-disable you-dont-need-lodash-underscore/find */\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { BLOCKS, INLINES, TOP_LEVEL_BLOCKS } from '@contentful/rich-text-types';\nimport find from 'lodash/find';\nimport flow from 'lodash/flow';\nimport get from 'lodash/get';\n\n// TODO: Move these into separate package (maybe rich-text-types) and share with FE.\nexport const VALIDATIONS = {\n  ENABLED_MARKS: 'enabledMarks',\n  ENABLED_NODE_TYPES: 'enabledNodeTypes',\n};\nexport const DEFAULT_ENABLED_NODE_TYPES = [BLOCKS.DOCUMENT, BLOCKS.PARAGRAPH, 'text'];\n\nexport const VALIDATABLE_NODE_TYPES = ([] as Array<BLOCKS | INLINES>)\n  .concat(TOP_LEVEL_BLOCKS)\n  .filter((type) => type !== BLOCKS.PARAGRAPH)\n  .concat(Object.values(INLINES));\n\n// TODO: Memoize\nconst getRichTextValidation = (field, validationType) =>\n  flow(\n    (v) => find(v, validationType),\n    (v) => get(v, validationType)\n  )(field.validations);\n\nconst isFormattingOptionEnabled = (field, validationType, nodeTypeOrMark) => {\n  const enabledFormattings = getRichTextValidation(field, validationType);\n\n  // TODO: In the future, validations will always be opt-in. In that case\n  // we don't need this step.\n  if (enabledFormattings === undefined) {\n    return true;\n  }\n\n  return DEFAULT_ENABLED_NODE_TYPES.concat(enabledFormattings).includes(nodeTypeOrMark);\n};\n\nexport const isNodeTypeEnabled = (field: FieldExtensionSDK['field'], nodeType): boolean =>\n  isFormattingOptionEnabled(field, VALIDATIONS.ENABLED_NODE_TYPES, nodeType);\n\nexport const isMarkEnabled = (field: FieldExtensionSDK['field'], mark) =>\n  isFormattingOptionEnabled(field, VALIDATIONS.ENABLED_MARKS, mark);\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  define(IteratorPrototype, iteratorSymbol, function () {\n    return this;\n  });\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = GeneratorFunctionPrototype;\n  define(Gp, \"constructor\", GeneratorFunctionPrototype);\n  define(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction);\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  define(AsyncIterator.prototype, asyncIteratorSymbol, function () {\n    return this;\n  });\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  define(Gp, iteratorSymbol, function() {\n    return this;\n  });\n\n  define(Gp, \"toString\", function() {\n    return \"[object Generator]\";\n  });\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, in modern engines\n  // we can explicitly access globalThis. In older engines we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","import { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { entityHelpers } from '@contentful/field-editor-shared';\n\nexport async function fetchAssets(sdk: FieldExtensionSDK, query: string) {\n  const assets = await sdk.space.getAssets({ query });\n\n  return assets.items.map((asset) => {\n    const displayTitle = entityHelpers.getAssetTitle({\n      asset,\n      localeCode: sdk.field.locale,\n      defaultLocaleCode: sdk.locales.default,\n      defaultTitle: 'Untitled',\n    });\n\n    return {\n      contentTypeName: 'Asset',\n      displayTitle,\n      id: asset.sys.id,\n      entity: asset,\n      thumbnail:\n        asset.fields.file &&\n        asset.fields.file[sdk.field.locale] &&\n        `${asset.fields.file[sdk.field.locale].url}?h=30`,\n    };\n  });\n}\n","import { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { entityHelpers } from '@contentful/field-editor-shared';\nimport { ContentTypeProps } from 'contentful-management/types';\n\nexport async function fetchEntries(\n  sdk: FieldExtensionSDK,\n  contentType: ContentTypeProps,\n  query: string\n) {\n  const entries = await sdk.space.getEntries({\n    content_type: contentType.sys.id,\n    query,\n  });\n\n  return entries.items.map((entry) => {\n    const description = entityHelpers.getEntityDescription({\n      contentType,\n      // @ts-expect-error inconsistent in typing between app-sdk & field-editors-shared\n      entity: entry,\n      localeCode: sdk.field.locale,\n      defaultLocaleCode: sdk.locales.default,\n    });\n\n    const displayTitle = entityHelpers.getEntryTitle({\n      // @ts-expect-error inconsistent in typing between app-sdk & field-editors-shared\n      entry,\n      contentType,\n      localeCode: sdk.field.locale,\n      defaultLocaleCode: sdk.locales.default,\n      defaultTitle: 'Untitled',\n    });\n\n    return {\n      contentTypeName: contentType.name,\n      displayTitle: displayTitle,\n      id: entry.sys.contentType.sys.id,\n      description,\n      entry,\n    };\n  });\n}\n","import { focus } from '../../../helpers/editor';\nimport { getText } from '../../../internal/queries';\nimport { setNodes, insertNodes } from '../../../internal/transforms';\n\nconst createNode = (nodeType, entity) => ({\n  type: nodeType,\n  data: {\n    target: {\n      sys: {\n        id: entity.sys.id,\n        type: 'Link',\n        linkType: entity.sys.type,\n      },\n    },\n  },\n  children: [{ text: '' }],\n  isVoid: true,\n});\n\nexport function insertBlock(editor, nodeType, entity) {\n  if (!editor?.selection) return;\n\n  const linkedEntityBlock = createNode(nodeType, entity);\n\n  const hasText = editor.selection && !!getText(editor, editor.selection.focus.path);\n\n  if (hasText) {\n    insertNodes(editor, linkedEntityBlock);\n  } else {\n    setNodes(editor, linkedEntityBlock);\n  }\n\n  focus(editor);\n}\n","import { useState } from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { BLOCKS, INLINES } from '@contentful/rich-text-types';\n\nimport { isNodeTypeSelected } from '../../helpers/editor';\nimport { isNodeTypeEnabled } from '../../helpers/validations';\nimport { getRange, getAboveNode } from '../../internal/queries';\nimport { select, insertNodes, deleteText, removeMark } from '../../internal/transforms';\nimport { PlateEditor } from '../../internal/types';\nimport { COMMAND_PROMPT } from './constants';\nimport { createInlineEntryNode } from './utils/createInlineEntryNode';\nimport { fetchAssets } from './utils/fetchAssets';\nimport { fetchEntries } from './utils/fetchEntries';\nimport { insertBlock } from './utils/insertBlock';\n\nexport interface Command {\n  id: string;\n  thumbnail?: string;\n  label: string;\n  callback?: () => void;\n}\n\nexport interface CommandGroup {\n  group: string;\n  commands: Command[];\n}\n\nexport type CommandList = (Command | CommandGroup)[];\n\nconst removeCommand = (editor: PlateEditor) => {\n  const [, path] = getAboveNode(editor)!;\n  const range = getRange(editor, path);\n\n  select(editor, range.focus.path);\n\n  removeMark(editor, COMMAND_PROMPT, range);\n  deleteText(editor);\n};\n\nconst removeQuery = (editor: PlateEditor) => {\n  const [, path] = getAboveNode(editor)!;\n  const range = getRange(editor, path);\n\n  if (range.focus.offset - range.anchor.offset > 1) {\n    deleteText(editor, { at: range.focus, distance: range.focus.offset - 1, reverse: true });\n  }\n};\n\nexport function isCommandPromptPluginEnabled(sdk: FieldExtensionSDK) {\n  const inlineAllowed = isNodeTypeEnabled(sdk.field, INLINES.EMBEDDED_ENTRY);\n  const entriesAllowed = isNodeTypeEnabled(sdk.field, BLOCKS.EMBEDDED_ENTRY);\n  const assetsAllowed = isNodeTypeEnabled(sdk.field, BLOCKS.EMBEDDED_ASSET);\n\n  return {\n    inlineAllowed,\n    entriesAllowed,\n    assetsAllowed,\n  };\n}\n\nfunction getCommandPermissions(sdk: FieldExtensionSDK, editor: PlateEditor) {\n  const canInsertBlocks = !isNodeTypeSelected(editor, BLOCKS.TABLE);\n  const { inlineAllowed, entriesAllowed, assetsAllowed } = isCommandPromptPluginEnabled(sdk);\n\n  return {\n    inlineAllowed,\n    entriesAllowed: entriesAllowed && canInsertBlocks,\n    assetsAllowed: assetsAllowed && canInsertBlocks,\n  };\n}\n\nexport const useCommands = (sdk: FieldExtensionSDK, query: string, editor: PlateEditor) => {\n  const contentTypes = sdk.space.getCachedContentTypes();\n  const { inlineAllowed, entriesAllowed, assetsAllowed } = getCommandPermissions(sdk, editor);\n\n  const [commands, setCommands] = useState((): CommandList => {\n    const getEmbedEntry = (contentType) => {\n      return {\n        id: contentType.sys.id,\n        label: `Embed ${contentType.name}`,\n        callback: () => {\n          fetchEntries(sdk, contentType, query).then((entries) => {\n            removeQuery(editor);\n            if (!entries.length) {\n              setCommands([\n                {\n                  id: 'no-results',\n                  label: 'No results',\n                },\n              ]);\n            } else {\n              setCommands(\n                entries.map((entry) => {\n                  return {\n                    id: `${entry.id}-${entry.displayTitle.replace(/\\W+/g, '-').toLowerCase()}`,\n                    label: entry.displayTitle,\n                    callback: () => {\n                      removeCommand(editor);\n                      if (editor.selection) {\n                        const selection = editor.selection;\n                        editor.insertSoftBreak();\n                        insertBlock(editor, BLOCKS.EMBEDDED_ENTRY, entry.entry);\n                        select(editor, selection);\n                        editor.tracking.onCommandPaletteAction('insert', {\n                          nodeType: BLOCKS.EMBEDDED_ENTRY,\n                        });\n                      }\n                    },\n                  };\n                })\n              );\n            }\n          });\n        },\n      };\n    };\n\n    const getEmbedInline = (contentType) => {\n      return {\n        id: `${contentType.sys.id}-inline`,\n        label: `Embed ${contentType.name} - Inline`,\n        callback: () => {\n          fetchEntries(sdk, contentType, query).then((entries) => {\n            removeQuery(editor);\n            if (!entries.length) {\n              setCommands([\n                {\n                  id: 'no-results',\n                  label: 'No results',\n                },\n              ]);\n            } else {\n              setCommands(\n                entries.map((entry) => {\n                  return {\n                    id: `${entry.id}-${entry.displayTitle.replace(/\\W+/g, '-').toLowerCase()}`,\n                    label: entry.displayTitle,\n                    callback: () => {\n                      const inlineNode = createInlineEntryNode(entry.id);\n                      removeCommand(editor);\n                      insertNodes(editor, inlineNode);\n                      editor.insertText('');\n                      editor.tracking.onCommandPaletteAction('insert', {\n                        nodeType: INLINES.EMBEDDED_ENTRY,\n                      });\n                    },\n                  };\n                })\n              );\n            }\n          });\n        },\n      };\n    };\n    const contentTypeCommands =\n      entriesAllowed || inlineAllowed\n        ? contentTypes.map((contentType) => {\n            return {\n              group: contentType.name,\n              commands:\n                entriesAllowed && inlineAllowed\n                  ? [getEmbedEntry(contentType), getEmbedInline(contentType)]\n                  : entriesAllowed\n                  ? [getEmbedEntry(contentType)]\n                  : [getEmbedInline(contentType)],\n            };\n          })\n        : [];\n    if (assetsAllowed) {\n      const assetCommand = {\n        group: 'Assets',\n        commands: [\n          {\n            id: 'embed-asset',\n            label: 'Embed Asset',\n            callback: () => {\n              fetchAssets(sdk, query).then((assets) => {\n                removeQuery(editor);\n                if (!assets.length) {\n                  setCommands([\n                    {\n                      id: 'no-results',\n                      label: 'No results',\n                    },\n                  ]);\n                } else {\n                  setCommands(\n                    assets.map((asset) => {\n                      return {\n                        id: `${asset.id}-${asset.displayTitle.replace(/\\W+/g, '-').toLowerCase()}`,\n                        label: asset.displayTitle,\n                        thumbnail: asset.thumbnail,\n                        callback: () => {\n                          removeCommand(editor);\n                          if (editor.selection) {\n                            const selection = editor.selection;\n                            editor.insertSoftBreak();\n                            insertBlock(editor, BLOCKS.EMBEDDED_ASSET, asset.entity);\n                            select(editor, selection);\n                            editor.tracking.onCommandPaletteAction('insert', {\n                              nodeType: BLOCKS.EMBEDDED_ASSET,\n                            });\n                          }\n                        },\n                      };\n                    })\n                  );\n                }\n              });\n            },\n          },\n        ],\n      };\n      return [...contentTypeCommands, assetCommand];\n    }\n    return contentTypeCommands;\n  });\n\n  /* filter both commands and groups of commands with the user typed query */\n  return query\n    ? commands.reduce((list, nextItem) => {\n        if ('group' in nextItem) {\n          const subcommands = nextItem.commands.filter((command) => {\n            return command.label.toLowerCase().includes(query.toLowerCase());\n          });\n          if (subcommands.length > 0) {\n            list.push(nextItem);\n          }\n        } else {\n          if (nextItem.label.toLowerCase().includes(query.toLowerCase())) {\n            list.push(nextItem);\n          }\n        }\n        return list;\n      }, [] as CommandList)\n    : commands;\n};\n","export const COMMAND_PROMPT = 'command-prompt';\n","import tokens from '@contentful/f36-tokens';\nimport { css } from 'emotion';\n\nconst styles = {\n  container: css({\n    position: 'absolute',\n    zIndex: tokens.zIndexNotification,\n    fontWeight: tokens.fontWeightNormal,\n    fontStyle: 'normal',\n    fontFamily: tokens.fontStackPrimary,\n    'ul, ol, dl': {\n      listStyle: 'none',\n      marginLeft: 0,\n    },\n  }),\n  menuPoper: css({\n    zIndex: tokens.zIndexModal,\n  }),\n  menuContent: css({\n    width: '400px',\n    maxHeight: '300px',\n  }),\n  menuList: css({\n    overflow: 'auto',\n    maxHeight: '200px',\n  }),\n  menuItem: css({\n    display: 'block',\n    width: '100%',\n    background: 'none',\n    border: 0,\n    margin: 0,\n    outline: 'none',\n    fontSize: tokens.fontSizeM,\n    lineHeight: tokens.lineHeightM,\n    fontWeight: tokens.fontWeightNormal,\n    position: 'relative',\n    textAlign: 'left',\n    padding: `${tokens.spacingXs} ${tokens.spacingM}`,\n    wordBreak: 'break-word',\n    whiteSpace: 'break-spaces',\n    cursor: 'pointer',\n    hyphens: 'auto',\n    minWidth: '150px',\n    textDecoration: 'none',\n    color: tokens.gray800,\n    '&:hover': {\n      backgroundColor: tokens.gray100,\n    },\n    '&:disabled': {\n      opacity: 0.5,\n      cursor: 'auto',\n    },\n  }),\n  menuItemSelected: css({\n    boxShadow: `inset ${tokens.glowPrimary}`,\n    borderRadius: tokens.borderRadiusMedium,\n  }),\n  menuDivider: css({\n    border: 'none',\n    width: '100%',\n    height: '1px',\n    background: tokens.gray300,\n    margin: `${tokens.spacingXs} 0`,\n  }),\n  menuHeader: css({\n    zIndex: tokens.zIndexDefault,\n    top: 0,\n    backgroundColor: tokens.gray100,\n    padding: tokens.spacingM,\n  }),\n  menuFooter: css({\n    position: 'sticky',\n    bottom: 0,\n    backgroundColor: tokens.gray100,\n    padding: tokens.spacingM,\n  }),\n  footerList: css({\n    listStyle: 'none',\n    color: tokens.gray600,\n    fontSize: tokens.fontSizeM,\n  }),\n  thumbnail: css({\n    width: '30px',\n    height: '30px',\n    objectFit: 'cover',\n  }),\n};\n\nexport default styles;\n","import * as React from 'react';\nimport { usePopper } from 'react-popper';\n\nimport { Popover, Stack, SectionHeading, ScreenReaderOnly, Flex } from '@contentful/f36-components';\nimport { Portal } from '@contentful/f36-utils';\nimport { cx } from 'emotion';\n\nimport { PlateEditor } from '../../../internal/types';\nimport { useSdkContext } from '../../../SdkProvider';\nimport { useCommandList } from '../hooks/useCommandList';\nimport { CommandList as CommandItems, Command, useCommands, CommandGroup } from '../useCommands';\nimport styles from './CommandList.styles';\n\nexport interface CommandListProps {\n  query: string;\n  editor: PlateEditor;\n  textContainer?: HTMLSpanElement;\n}\n\nconst Group = ({\n  commandGroup,\n  selectedItem,\n}: {\n  commandGroup: CommandGroup;\n  selectedItem: string;\n}) => (\n  <section key={commandGroup.group}>\n    <SectionHeading\n      as=\"h3\"\n      marginBottom=\"spacingS\"\n      marginTop=\"spacingS\"\n      marginLeft=\"spacingM\"\n      marginRight=\"spacingM\"\n    >\n      {commandGroup.group}\n    </SectionHeading>\n    {commandGroup.commands.map((command: Command) => (\n      <button\n        key={command.id}\n        id={command.id}\n        className={cx(styles.menuItem, {\n          [styles.menuItemSelected]: command.id === selectedItem,\n        })}\n        onClick={command.callback}\n      >\n        {command.label}\n      </button>\n    ))}\n    <hr className={styles.menuDivider} aria-orientation=\"horizontal\" />\n  </section>\n);\n\nconst Asset = ({ command, selectedItem }: { command: Command; selectedItem: string }) => (\n  <button\n    key={command.id}\n    id={command.id}\n    className={cx(styles.menuItem, {\n      [styles.menuItemSelected]: command.id === selectedItem,\n    })}\n    onClick={command.callback}\n  >\n    <Flex alignItems=\"center\" gap=\"spacingS\">\n      {command.thumbnail && (\n        <img width=\"30\" height=\"30\" src={command.thumbnail} alt=\"\" className={styles.thumbnail} />\n      )}\n      <span>{command.label}</span>\n    </Flex>\n  </button>\n);\n\nconst Item = ({ command }: { command: Command }) => (\n  <button key={command.id} id={command.id} className={styles.menuItem}>\n    {command.label}\n  </button>\n);\n\nconst CommandListItems = ({\n  commandItems,\n  selectedItem,\n}: {\n  commandItems: CommandItems;\n  selectedItem: string;\n}) => {\n  return (\n    <>\n      {commandItems.map((command) => {\n        return 'group' in command ? (\n          <Group commandGroup={command} selectedItem={selectedItem} />\n        ) : command.callback ? (\n          <Asset command={command} selectedItem={selectedItem} />\n        ) : (\n          <Item command={command} />\n        );\n      })}\n    </>\n  );\n};\n\nexport const CommandList = ({ query, editor, textContainer }: CommandListProps) => {\n  const sdk = useSdkContext();\n  const popoverContainer = React.useRef<HTMLDivElement>(null);\n  const popper = usePopper(textContainer, popoverContainer?.current, {\n    placement: 'bottom-start',\n  });\n  const commandItems = useCommands(sdk, query, editor);\n  const { selectedItem, isOpen } = useCommandList(commandItems, popoverContainer);\n\n  if (!commandItems.length) {\n    return null;\n  }\n\n  return (\n    <div className={styles.container} tabIndex={-1} contentEditable={false}>\n      {/*\n        We have to make it visually appear as if the buttons have focus, because we can not set both the\n        focus on the textarea and the focus on the button. In HTML you can only set focus on one element at a time.\n        So we have to manually tell the screenreader which item has received focus. The actual code of the\n        popover we will hide from the screenreader, since it is not accessibly relevant and to avoid reading\n        out everything twice.\n        We use role alert here because we want to make the screenreader immediately announce the selected\n        button, and also when the \"fake focus\" changes.\n       */}\n      <div role=\"alert\">\n        <ScreenReaderOnly>\n          {/* TODO - show the label here and not the id */}\n          Richtext commands. Currently focused item: {selectedItem}. Press <kbd>enter</kbd> to\n          select, <kbd>arrows</kbd> to navigate, <kbd>escape</kbd> to close.\n        </ScreenReaderOnly>\n      </div>\n      <Portal>\n        <div\n          aria-hidden={true}\n          ref={popoverContainer}\n          className={styles.menuPoper}\n          style={popper.styles.popper}\n          {...popper.attributes.popper}\n        >\n          <Popover\n            isOpen={isOpen}\n            usePortal={false}\n            /* eslint-disable-next-line jsx-a11y/no-autofocus -- we want to keep focus on text input*/\n            autoFocus={false}\n          >\n            {/* we need an empty trigger here for the positioning of the menu list */}\n            <Popover.Trigger>\n              <span />\n            </Popover.Trigger>\n            <Popover.Content className={styles.menuContent} testId=\"rich-text-commands\">\n              <header className={styles.menuHeader}>\n                <SectionHeading marginBottom=\"none\">Richtext commands</SectionHeading>\n              </header>\n              <div className={styles.menuList} data-test-id=\"rich-text-commands-list\">\n                <CommandListItems commandItems={commandItems} selectedItem={selectedItem} />\n              </div>\n              <footer className={styles.menuFooter}>\n                <Stack\n                  as=\"ul\"\n                  margin=\"none\"\n                  padding=\"none\"\n                  spacing=\"spacingS\"\n                  className={styles.footerList}\n                >\n                  <li>\n                    <kbd></kbd>\n                    <kbd></kbd> to navigate\n                  </li>\n                  <li>\n                    <kbd></kbd> to confirm\n                  </li>\n                  <li>\n                    <kbd>esc</kbd> to close\n                  </li>\n                </Stack>\n              </footer>\n            </Popover.Content>\n          </Popover>\n        </div>\n      </Portal>\n    </div>\n  );\n};\n","import { INLINES } from '@contentful/rich-text-types';\n\nexport function createInlineEntryNode(id: string) {\n  return {\n    type: INLINES.EMBEDDED_ENTRY,\n    children: [{ text: '' }],\n    data: {\n      target: {\n        sys: {\n          id,\n          type: 'Link',\n          linkType: 'Entry',\n        },\n      },\n    },\n  };\n}\n","import * as React from 'react';\n\nimport isHotkey from 'is-hotkey';\n\nexport const useCommandList = (commandItems, container) => {\n  const [selectedItem, setSelectedItem] = React.useState<string>(() => {\n    // select the first item on initial render\n    if (!commandItems.length) {\n      return '';\n    }\n    if ('group' in commandItems[0]) {\n      return commandItems[0].commands[0].id;\n    }\n    return commandItems[0].id;\n  });\n  const [isOpen, setIsOpen] = React.useState(commandItems.length > 0);\n\n  React.useEffect(() => {\n    if (!container.current) {\n      return;\n    }\n    const buttons = Array.from(container.current.querySelectorAll('button')) as HTMLButtonElement[];\n    const currBtn = buttons.find((btn) => btn.id === selectedItem);\n    const currIndex = currBtn ? buttons.indexOf(currBtn) : 0;\n    const shouldSelectFirstBtn = !currBtn && buttons.length;\n\n    if (shouldSelectFirstBtn) {\n      setSelectedItem(buttons[0].id);\n      buttons[0].scrollIntoView({\n        block: 'nearest',\n        inline: 'start',\n      });\n    }\n\n    function handleKeyDown(event: KeyboardEvent) {\n      if (isHotkey('up', event)) {\n        event.preventDefault();\n        if (currIndex === 0) {\n          return;\n        }\n        setSelectedItem(buttons[currIndex - 1].id);\n        buttons[currIndex - 1].scrollIntoView({\n          block: 'nearest',\n          inline: 'start',\n        });\n      } else if (isHotkey('down', event)) {\n        event.preventDefault();\n        if (currIndex === buttons.length - 1) {\n          return;\n        }\n        setSelectedItem(buttons[currIndex + 1].id);\n        buttons[currIndex + 1].scrollIntoView({\n          block: 'nearest',\n          inline: 'start',\n        });\n      } else if (isHotkey('enter', event)) {\n        event.preventDefault();\n        if (currBtn) {\n          setSelectedItem('');\n          currBtn.click();\n        }\n      }\n      //TODO: handle shift+enter, which must be detected using separate events\n    }\n\n    if (commandItems.length) {\n      window.addEventListener('keydown', handleKeyDown);\n    }\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [commandItems, container, selectedItem]);\n\n  React.useEffect(() => {\n    const handleMousedown = (event) => {\n      if (container.current && !container.current.contains(event.target)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleMousedown);\n    return () => {\n      document.removeEventListener('mousedown', handleMousedown);\n    };\n  }, [container]);\n\n  return {\n    selectedItem,\n    isOpen,\n  };\n};\n","import * as React from 'react';\n\nimport { PlateEditor, RenderLeafProps } from '../../../internal/types';\nimport { trimLeadingSlash } from '../utils/trimLeadingSlash';\nimport { CommandList } from './CommandList';\n\nexport const CommandPrompt = (props: RenderLeafProps & { editor: PlateEditor }) => {\n  const query = React.useMemo(() => trimLeadingSlash(props.text.text), [props.text.text]);\n  const editor = props.editor;\n  const [textElement, setTextElement] = React.useState<HTMLSpanElement>();\n\n  return (\n    <span\n      ref={(e) => {\n        setTextElement(e as HTMLSpanElement);\n      }}\n      {...props.attributes}\n    >\n      {props.children}\n      <CommandList query={query} editor={editor} textContainer={textElement} />\n    </span>\n  );\n};\n","/**\n * Trim leading slash character if found. Bails otherwise.\n *\n * @example\n * trimLeadingSlash(\"/my query\") // --> \"my query\"\n */\nexport function trimLeadingSlash(text: string) {\n  if (!text.startsWith('/')) {\n    return text;\n  }\n\n  return text.slice(1);\n}\n","import React, { ComponentProps } from 'react';\n\nimport { useContentfulEditorRef } from '../ContentfulEditorProvider';\nimport { HyperlinkElementProps } from './Hyperlink/components/EntityHyperlink';\n\nexport function withLinkTracking(Component: React.ComponentType<HyperlinkElementProps>) {\n  return function ComponentWithTracking(props: ComponentProps<typeof Component>) {\n    const editor = useContentfulEditorRef();\n\n    const onEntityFetchComplete = React.useCallback(\n      () => editor?.tracking.onViewportAction('linkRendered'),\n      [editor]\n    );\n\n    return <Component {...props} onEntityFetchComplete={onEntityFetchComplete} />;\n  };\n}\n","import * as React from 'react';\n\nimport { Asset, FieldExtensionSDK, ScheduledAction } from '@contentful/app-sdk';\nimport { AssetCard } from '@contentful/f36-components';\nimport {\n  useEntity,\n  useEntityLoader,\n  MissingEntityCard,\n  WrappedAssetCard,\n} from '@contentful/field-editor-reference';\nimport areEqual from 'fast-deep-equal';\n\ninterface InternalAssetCardProps {\n  asset?: Asset | 'failed';\n  isDisabled: boolean;\n  isSelected: boolean;\n  locale: string;\n  onEdit?: () => void;\n  onRemove?: () => unknown;\n  sdk: FieldExtensionSDK;\n  loadEntityScheduledActions: (entityType: string, entityId: string) => Promise<ScheduledAction[]>;\n}\n\nconst InternalAssetCard = React.memo((props: InternalAssetCardProps) => {\n  if (props.asset === undefined) {\n    return <AssetCard size=\"default\" isLoading />;\n  }\n\n  if (props.asset === 'failed') {\n    return (\n      <MissingEntityCard\n        entityType=\"Asset\"\n        isDisabled={props.isDisabled}\n        onRemove={props.onRemove}\n      />\n    );\n  }\n\n  return (\n    <WrappedAssetCard\n      getEntityScheduledActions={props.loadEntityScheduledActions}\n      size=\"small\"\n      isSelected={props.isSelected}\n      isDisabled={props.isDisabled}\n      localeCode={props.locale}\n      defaultLocaleCode={props.sdk.locales.default}\n      asset={props.asset}\n      onEdit={props.onEdit}\n      onRemove={props.isDisabled ? undefined : props.onRemove}\n      isClickable={false}\n    />\n  );\n}, areEqual);\n\nInternalAssetCard.displayName = 'InternalAssetCard';\n\ninterface FetchingWrappedAssetCardProps {\n  assetId: string;\n  isDisabled: boolean;\n  isSelected: boolean;\n  locale: string;\n  onEdit?: () => void;\n  onRemove?: () => unknown;\n  sdk: FieldExtensionSDK;\n  onEntityFetchComplete?: VoidFunction;\n}\n\nexport function FetchingWrappedAssetCard(props: FetchingWrappedAssetCardProps) {\n  const { onEntityFetchComplete } = props;\n  const { data: asset, status } = useEntity<Asset>('Asset', props.assetId);\n  const { getEntityScheduledActions } = useEntityLoader();\n  const loadEntityScheduledActions = React.useCallback(\n    () => getEntityScheduledActions('Asset', props.assetId),\n    [getEntityScheduledActions, props.assetId]\n  );\n\n  React.useEffect(() => {\n    if (status === 'success') {\n      onEntityFetchComplete?.();\n    }\n  }, [onEntityFetchComplete, status]);\n\n  return (\n    <InternalAssetCard\n      asset={asset as Asset | undefined}\n      sdk={props.sdk}\n      isDisabled={props.isDisabled}\n      isSelected={props.isSelected}\n      loadEntityScheduledActions={loadEntityScheduledActions}\n      locale={props.locale}\n      onEdit={props.onEdit}\n      onRemove={props.onRemove}\n    />\n  );\n}\n","import * as React from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { ScheduledAction, Entry } from '@contentful/app-sdk';\nimport { EntryCard } from '@contentful/f36-components';\nimport {\n  useEntity,\n  MissingEntityCard,\n  WrappedEntryCard,\n  useEntityLoader,\n} from '@contentful/field-editor-reference';\nimport areEqual from 'fast-deep-equal';\n\ninterface InternalEntryCard {\n  isDisabled: boolean;\n  isSelected: boolean;\n  locale: string;\n  sdk: FieldExtensionSDK;\n  loadEntityScheduledActions: (entityType: string, entityId: string) => Promise<ScheduledAction[]>;\n  entry?: Entry | 'failed';\n  onEdit?: VoidFunction;\n  onRemove?: VoidFunction;\n}\n\nconst InternalEntryCard = React.memo((props: InternalEntryCard) => {\n  const { entry, sdk, loadEntityScheduledActions } = props;\n\n  if (entry === undefined) {\n    return <EntryCard isLoading />;\n  }\n\n  if (entry === 'failed') {\n    return (\n      <MissingEntityCard\n        entityType=\"Entry\"\n        isDisabled={props.isDisabled}\n        onRemove={props.onRemove}\n      />\n    );\n  }\n\n  const contentType = sdk.space\n    .getCachedContentTypes()\n    .find((contentType) => contentType.sys.id === entry.sys.contentType.sys.id);\n\n  return (\n    <WrappedEntryCard\n      size=\"default\"\n      getAsset={props.sdk.space.getAsset}\n      getEntityScheduledActions={loadEntityScheduledActions}\n      isSelected={props.isSelected}\n      isDisabled={props.isDisabled}\n      localeCode={props.locale}\n      defaultLocaleCode={props.sdk.locales.default}\n      contentType={contentType}\n      entry={entry}\n      onEdit={props.onEdit}\n      onRemove={props.isDisabled ? undefined : props.onRemove}\n      isClickable={false}\n    />\n  );\n}, areEqual);\n\nInternalEntryCard.displayName = 'ReferenceCard';\n\ninterface FetchingWrappedEntryCardProps {\n  entryId: string;\n  isDisabled: boolean;\n  isSelected: boolean;\n  locale: string;\n  sdk: FieldExtensionSDK;\n  onEntityFetchComplete?: VoidFunction;\n  onEdit?: VoidFunction;\n  onRemove?: VoidFunction;\n}\n\nexport const FetchingWrappedEntryCard = (props: FetchingWrappedEntryCardProps) => {\n  const { entryId, onEntityFetchComplete } = props;\n  const { data: entry, status } = useEntity<Entry>('Entry', entryId);\n  const { getEntityScheduledActions } = useEntityLoader();\n  const loadEntityScheduledActions = React.useCallback(\n    () => getEntityScheduledActions('Entry', entryId),\n    [getEntityScheduledActions, entryId]\n  );\n\n  React.useEffect(() => {\n    if (status === 'success') {\n      onEntityFetchComplete?.();\n    }\n  }, [onEntityFetchComplete, status]);\n\n  return (\n    <InternalEntryCard\n      entry={entry}\n      sdk={props.sdk}\n      locale={props.locale}\n      isDisabled={props.isDisabled}\n      isSelected={props.isSelected}\n      onEdit={props.onEdit}\n      onRemove={props.onRemove}\n      loadEntityScheduledActions={loadEntityScheduledActions}\n    />\n  );\n};\n","import React from 'react';\n\nimport { css } from 'emotion';\nimport { useSelected, useReadOnly } from 'slate-react';\n\nimport { useContentfulEditor } from '../../ContentfulEditorProvider';\nimport { IS_CHROME } from '../../helpers/environment';\nimport { findNodePath } from '../../internal/queries';\nimport { removeNodes } from '../../internal/transforms';\nimport { Element, RenderElementProps } from '../../internal/types';\nimport { useSdkContext } from '../../SdkProvider';\nimport { FetchingWrappedAssetCard } from '../shared/FetchingWrappedAssetCard';\nimport { FetchingWrappedEntryCard } from '../shared/FetchingWrappedEntryCard';\n\nconst styles = {\n  root: css({\n    marginBottom: '1.25rem !important',\n    display: 'block',\n  }),\n  container: css({\n    // The next 2 properties ensure Entity card won't be aligned above\n    // a list item marker (i.e. bullet)\n    display: 'inline-block',\n    verticalAlign: 'text-top',\n    width: '100%',\n  }),\n};\n\ntype LinkedEntityBlockProps = {\n  element: Element & {\n    data: {\n      target: {\n        sys: {\n          id: string;\n          linkType: 'Entry' | 'Asset';\n          type: 'Link';\n        };\n      };\n    };\n  };\n  attributes: Pick<RenderElementProps, 'attributes'>;\n  children: Pick<RenderElementProps, 'children'>;\n  onEntityFetchComplete: VoidFunction;\n};\n\nexport function LinkedEntityBlock(props: LinkedEntityBlockProps) {\n  const { attributes, children, element, onEntityFetchComplete } = props;\n  const isSelected = useSelected();\n  const editor = useContentfulEditor();\n  const sdk = useSdkContext();\n  const isDisabled = useReadOnly();\n  const { id: entityId, linkType: entityType } = element.data.target.sys;\n\n  const handleEditClick = React.useCallback(() => {\n    const openEntity = entityType === 'Asset' ? sdk.navigator.openAsset : sdk.navigator.openEntry;\n    return openEntity(entityId, { slideIn: true });\n  }, [sdk, entityId, entityType]);\n\n  const handleRemoveClick = React.useCallback(() => {\n    if (!editor) return;\n    const pathToElement = findNodePath(editor, element);\n    removeNodes(editor, { at: pathToElement });\n  }, [editor, element]);\n\n  return (\n    <div\n      {...attributes}\n      className={styles.root}\n      data-entity-type={entityType}\n      data-entity-id={entityId}\n      // COMPAT: This makes copy & paste work for Firefox\n      contentEditable={IS_CHROME ? undefined : false}\n      draggable={IS_CHROME ? true : undefined}\n    >\n      <div\n        // COMPAT: This makes copy & paste work for Chromium/Blink browsers and Safari\n        contentEditable={IS_CHROME ? false : undefined}\n        draggable={IS_CHROME ? true : undefined}\n        className={styles.container}\n      >\n        {entityType === 'Entry' && (\n          <FetchingWrappedEntryCard\n            sdk={sdk}\n            entryId={entityId}\n            locale={sdk.field.locale}\n            isDisabled={isDisabled}\n            isSelected={isSelected}\n            onRemove={handleRemoveClick}\n            onEdit={handleEditClick}\n            onEntityFetchComplete={onEntityFetchComplete}\n          />\n        )}\n        {entityType === 'Asset' && (\n          <FetchingWrappedAssetCard\n            sdk={sdk}\n            assetId={entityId}\n            locale={sdk.field.locale}\n            isDisabled={isDisabled}\n            isSelected={isSelected}\n            onRemove={handleRemoveClick}\n            onEdit={handleEditClick}\n            onEntityFetchComplete={onEntityFetchComplete}\n          />\n        )}\n      </div>\n      {children}\n    </div>\n  );\n}\n","/* eslint-disable you-dont-need-lodash-underscore/find */\nimport find from 'lodash/find';\nimport flow from 'lodash/flow';\nimport get from 'lodash/get';\n\n/**\n * Given a field object and a rich text node type, return a list of valid\n * content type IDs associated with the node type, based on that node type's\n * `linkContentType` validation.\n *\n * If there is no such validation or the validation is empty, return an empty\n * array.\n *\n * The navigation here is explained by the `nodes` validation having signature:\n * { nodes: { [nodeType]: validationObject[] } }\n *\n * We defensively navigate through this object because\n * 1) the field may not have a `validations` array,\n * 2) the `validations` array may be empty,\n * 3) the `validations` array may not have a `nodes` validation,\n * 4) the `nodes` validation may not validate the `nodeType`, and\n * 5) the `nodeType` validations may not have a `linkContentType` validation.\n *\n * Note that passing an empty array will result in all possible content types\n * being whitelisted.\n *\n * @param {object} field\n * @param {string} nodeType\n * @returns {string[]}\n */\nexport default function getLinkedContentTypeIdsForNodeType(field, nodeType): string[] {\n  return flow(\n    (v) => find(v, 'nodes'),\n    (v) => get(v, ['nodes', nodeType]),\n    (v) => find(v, 'linkContentType'),\n    (v) => get(v, 'linkContentType', [])\n  )(field.validations);\n}\n","import getLinkedContentTypeIdsForNodeType from './getLinkedContentTypeIdsForNodeType';\n\n/**\n * Returns a config for the entity selector based on a given rich text field and a\n * rich text node type that the entity should be picked for. Takes the field\n * validations for the given node type into account.\n *\n * @param {object} field\n * @param {string} nodeType\n * @returns {object}\n */\nexport default function newEntitySelectorConfigFromRichTextField(field, nodeType) {\n  return {\n    entityType: getEntityTypeFromRichTextNode(nodeType),\n    locale: field.locale || null, // Will fall back to default locale.\n    contentTypes: getLinkedContentTypeIdsForNodeType(field, nodeType),\n  };\n}\n\nfunction getEntityTypeFromRichTextNode(nodeType): 'Entry' | 'Asset' | never {\n  const words = nodeType.split('-');\n  if (words.indexOf('entry') !== -1) {\n    return 'Entry';\n  }\n  if (words.indexOf('asset') !== -1) {\n    return 'Asset';\n  }\n  throw new Error(`RichText node type \\`${nodeType}\\` has no associated \\`entityType\\``);\n}\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\n\nimport { focus, insertEmptyParagraph, moveToTheNextChar } from '../../helpers/editor';\nimport newEntitySelectorConfigFromRichTextField from '../../helpers/newEntitySelectorConfigFromRichTextField';\nimport { getText, getAboveNode, getLastNodeByLevel } from '../../internal/queries';\nimport { select, insertNodes, setNodes } from '../../internal/transforms';\nimport { PlateEditor } from '../../internal/types';\nimport { TrackingPluginActions } from '../../plugins/Tracking';\n\nexport async function selectEntityAndInsert(\n  nodeType,\n  sdk,\n  editor,\n  logAction: TrackingPluginActions['onToolbarAction'] | TrackingPluginActions['onShortcutAction']\n) {\n  logAction('openCreateEmbedDialog', { nodeType });\n\n  const { field, dialogs } = sdk;\n  const baseConfig = newEntitySelectorConfigFromRichTextField(field, nodeType);\n  const selectEntity =\n    baseConfig.entityType === 'Asset' ? dialogs.selectSingleAsset : dialogs.selectSingleEntry;\n  const config = { ...baseConfig, withCreate: true };\n\n  const { selection } = editor;\n  const entity = await selectEntity(config);\n  if (!entity) {\n    logAction('cancelCreateEmbedDialog', { nodeType });\n    return;\n  }\n\n  select(editor, selection);\n\n  insertBlock(editor, nodeType, entity);\n  ensureFollowingParagraph(editor);\n\n  logAction('insert', { nodeType });\n}\n\n// TODO: incorporate this logic inside the trailingParagraph plugin instead\nfunction ensureFollowingParagraph(editor: PlateEditor) {\n  const entityBlock = getAboveNode(editor, {\n    match: {\n      type: [BLOCKS.EMBEDDED_ASSET, BLOCKS.EMBEDDED_ENTRY],\n    },\n  });\n\n  if (!entityBlock) {\n    return;\n  }\n\n  const level = entityBlock[1].length - 1;\n  const lastNode = getLastNodeByLevel(editor, level);\n\n  const isTextContainer = (TEXT_CONTAINERS as string[]).includes(\n    (lastNode?.[0].type ?? '') as string\n  );\n\n  // If the new block isn't followed by a sibling text container (e.g. paragraph)\n  // we insert a new empty one. Level 0 is handled by the trailingParagraph plugin\n  if (level !== 0 && !isTextContainer) {\n    insertEmptyParagraph(editor);\n  }\n\n  moveToTheNextChar(editor);\n}\n\nconst createNode = (nodeType, entity) => ({\n  type: nodeType,\n  data: {\n    target: {\n      sys: {\n        id: entity.sys.id,\n        type: 'Link',\n        linkType: entity.sys.type,\n      },\n    },\n  },\n  children: [{ text: '' }],\n  isVoid: true,\n});\n\n// TODO: DRY up copied code from HR\nexport function insertBlock(editor: PlateEditor, nodeType: string, entity) {\n  if (!editor?.selection) return;\n\n  const linkedEntityBlock = createNode(nodeType, entity);\n\n  const hasText = editor.selection && !!getText(editor, editor.selection.focus.path);\n\n  if (hasText) {\n    insertNodes(editor, linkedEntityBlock);\n  } else {\n    setNodes(editor, linkedEntityBlock);\n  }\n\n  focus(editor);\n}\n","import React from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { Flex, Icon, Menu } from '@contentful/f36-components';\nimport { AssetIcon, EmbeddedEntryBlockIcon } from '@contentful/f36-icons';\nimport { css } from 'emotion';\n\nimport { useContentfulEditor } from '../../ContentfulEditorProvider';\nimport { useSdkContext } from '../../SdkProvider';\nimport { selectEntityAndInsert } from './Util';\n\nexport const styles = {\n  icon: css({\n    marginRight: '10px',\n  }),\n};\n\ninterface EmbeddedEntityBlockToolbarIconProps {\n  isDisabled: boolean;\n  nodeType: string;\n  onClose: () => void;\n}\n\nexport function EmbeddedEntityBlockToolbarIcon({\n  isDisabled,\n  nodeType,\n  onClose,\n}: EmbeddedEntityBlockToolbarIconProps) {\n  const editor = useContentfulEditor();\n  const sdk: FieldExtensionSDK = useSdkContext();\n\n  const handleClick = async (event: React.MouseEvent<HTMLButtonElement>) => {\n    event.preventDefault();\n    if (!editor) {\n      return;\n    }\n\n    onClose();\n    await selectEntityAndInsert(nodeType, sdk, editor, editor.tracking.onToolbarAction);\n  };\n\n  const type = getEntityTypeFromNodeType(nodeType);\n  const baseClass = `rich-text__${nodeType}`;\n  return (\n    <Menu.Item\n      disabled={isDisabled}\n      className={`${baseClass}-list-item`}\n      onClick={handleClick}\n      testId={`toolbar-toggle-${nodeType}`}>\n      <Flex alignItems=\"center\" flexDirection=\"row\">\n        <Icon\n          as={type === 'Asset' ? AssetIcon : EmbeddedEntryBlockIcon}\n          className={`rich-text__embedded-entry-list-icon ${styles.icon}`}\n          variant=\"secondary\"\n        />\n        <span>{type}</span>\n      </Flex>\n    </Menu.Item>\n  );\n}\n\nfunction getEntityTypeFromNodeType(nodeType: string): string | never {\n  const words = nodeType.toLowerCase().split('-');\n  if (words.includes('entry')) {\n    return 'Entry';\n  }\n  if (words.includes('asset')) {\n    return 'Asset';\n  }\n  throw new Error(`Node type \\`${nodeType}\\` has no associated \\`entityType\\``);\n}\n","import { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { HotkeyPlugin } from '@udecode/plate-core';\nimport isHotkey from 'is-hotkey';\n\nimport { getNodeEntryFromSelection } from '../../helpers/editor';\nimport { removeNodes } from '../../internal/transforms';\nimport { KeyboardHandler, PlatePlugin } from '../../internal/types';\nimport { withLinkTracking } from '../links-tracking';\nimport { LinkedEntityBlock } from './LinkedEntityBlock';\nimport { selectEntityAndInsert } from './Util';\n\nexport { EmbeddedEntityBlockToolbarIcon as ToolbarIcon } from './ToolbarIcon';\n\nconst entityTypes = {\n  [BLOCKS.EMBEDDED_ENTRY]: 'Entry',\n  [BLOCKS.EMBEDDED_ASSET]: 'Asset',\n};\n\nfunction getWithEmbeddedEntityEvents(\n  nodeType: BLOCKS.EMBEDDED_ENTRY | BLOCKS.EMBEDDED_ASSET,\n  sdk: FieldExtensionSDK\n): KeyboardHandler<HotkeyPlugin> {\n  return (editor, { options: { hotkey } }) =>\n    (event) => {\n      const [, pathToSelectedElement] = getNodeEntryFromSelection(editor, nodeType);\n\n      if (pathToSelectedElement) {\n        const isDelete = event.key === 'Delete';\n        const isBackspace = event.key === 'Backspace';\n\n        if (isDelete || isBackspace) {\n          event.preventDefault();\n          removeNodes(editor, { at: pathToSelectedElement });\n        }\n\n        return;\n      }\n\n      if (hotkey && isHotkey(hotkey, event)) {\n        selectEntityAndInsert(nodeType, sdk, editor, editor.tracking.onShortcutAction);\n      }\n    };\n}\n\nconst createEmbeddedEntityPlugin =\n  (nodeType: BLOCKS.EMBEDDED_ENTRY | BLOCKS.EMBEDDED_ASSET, hotkey: string) =>\n  (sdk: FieldExtensionSDK): PlatePlugin => ({\n    key: nodeType,\n    type: nodeType,\n    isElement: true,\n    isVoid: true,\n    component: withLinkTracking(LinkedEntityBlock),\n    options: { hotkey },\n    handlers: {\n      onKeyDown: getWithEmbeddedEntityEvents(nodeType, sdk),\n    },\n    deserializeHtml: {\n      rules: [\n        {\n          validAttribute: {\n            'data-entity-type': entityTypes[nodeType],\n          },\n        },\n      ],\n      withoutChildren: true,\n      getNode: (el) => ({\n        type: nodeType,\n        children: [{ text: '' }],\n        isVoid: true,\n        data: {\n          target: {\n            sys: {\n              id: el.getAttribute('data-entity-id'),\n              linkType: el.getAttribute('data-entity-type'),\n              type: 'Link',\n            },\n          },\n        },\n      }),\n    },\n  });\n\nexport const createEmbeddedEntryBlockPlugin = createEmbeddedEntityPlugin(\n  BLOCKS.EMBEDDED_ENTRY,\n  'mod+shift+e'\n);\nexport const createEmbeddedAssetBlockPlugin = createEmbeddedEntityPlugin(\n  BLOCKS.EMBEDDED_ASSET,\n  'mod+shift+a'\n);\n","import React from 'react';\n\nimport { InlineEntryCard, MenuItem, Text } from '@contentful/f36-components';\nimport { ClockIcon } from '@contentful/f36-icons';\nimport tokens from '@contentful/f36-tokens';\nimport {\n  useEntity,\n  useEntityLoader,\n  ScheduledIconWithTooltip,\n} from '@contentful/field-editor-reference';\nimport { Entry, entityHelpers, FieldExtensionSDK } from '@contentful/field-editor-shared';\nimport { INLINES } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\n\nconst { getEntryTitle, getEntryStatus } = entityHelpers;\n\nconst styles = {\n  scheduledIcon: css({\n    verticalAlign: 'text-bottom',\n    marginRight: tokens.spacing2Xs,\n  }),\n};\n\ninterface FetchingWrappedInlineEntryCardProps {\n  entryId: string;\n  sdk: FieldExtensionSDK;\n  isSelected: boolean;\n  isDisabled: boolean;\n  onEdit: (event: React.MouseEvent<Element, MouseEvent>) => void;\n  onRemove: (event: React.MouseEvent<Element, MouseEvent>) => void;\n  onEntityFetchComplete?: VoidFunction;\n}\n\nexport function FetchingWrappedInlineEntryCard(props: FetchingWrappedInlineEntryCardProps) {\n  const { data: entry, status: requestStatus } = useEntity<Entry>('Entry', props.entryId);\n  const { getEntityScheduledActions } = useEntityLoader();\n  const loadEntityScheduledActions = () => getEntityScheduledActions('Entry', props.entryId);\n\n  const allContentTypes = props.sdk.space.getCachedContentTypes();\n  const { onEntityFetchComplete } = props;\n  const contentType = React.useMemo(() => {\n    if (!entry || !allContentTypes) return undefined;\n\n    return allContentTypes.find(\n      (contentType) => contentType.sys.id === entry.sys.contentType.sys.id\n    );\n  }, [allContentTypes, entry]);\n\n  React.useEffect(() => {\n    if (requestStatus !== 'success') {\n      return;\n    }\n    onEntityFetchComplete?.();\n  }, [requestStatus, onEntityFetchComplete]);\n\n  const contentTypeName = contentType ? contentType.name : '';\n\n  const title = React.useMemo(\n    () =>\n      getEntryTitle({\n        entry,\n        contentType,\n        localeCode: props.sdk.field.locale,\n        defaultLocaleCode: props.sdk.locales.default,\n        defaultTitle: 'Untitled',\n      }),\n    [entry, contentType, props.sdk.field.locale, props.sdk.locales.default]\n  );\n\n  if (requestStatus === 'error') {\n    return (\n      <InlineEntryCard\n        title=\"Entry missing or inaccessible\"\n        testId={INLINES.EMBEDDED_ENTRY}\n        isSelected={props.isSelected}\n      />\n    );\n  }\n\n  if (requestStatus === 'loading') {\n    return <InlineEntryCard isLoading />;\n  }\n\n  const entryStatus = getEntryStatus(entry.sys);\n  if (entryStatus === 'deleted') {\n    return (\n      <InlineEntryCard\n        title=\"Entry missing or inaccessible\"\n        testId={INLINES.EMBEDDED_ENTRY}\n        isSelected={props.isSelected}\n        actions={[\n          <MenuItem key=\"remove\" onClick={props.onRemove} testId=\"delete\">\n            Remove\n          </MenuItem>,\n        ]}\n      />\n    );\n  }\n\n  return (\n    <InlineEntryCard\n      testId={INLINES.EMBEDDED_ENTRY}\n      isSelected={props.isSelected}\n      title={`${contentTypeName}: ${title}`}\n      status={entryStatus}\n      actions={[\n        <MenuItem key=\"edit\" onClick={props.onEdit}>\n          Edit\n        </MenuItem>,\n        <MenuItem key=\"remove\" onClick={props.onRemove} disabled={props.isDisabled} testId=\"delete\">\n          Remove\n        </MenuItem>,\n      ]}>\n      <ScheduledIconWithTooltip\n        getEntityScheduledActions={loadEntityScheduledActions}\n        entityType=\"Entry\"\n        entityId={entry.sys.id}>\n        <ClockIcon className={styles.scheduledIcon} variant=\"muted\" testId=\"scheduled-icon\" />\n      </ScheduledIconWithTooltip>\n      <Text>{title}</Text>\n    </InlineEntryCard>\n  );\n}\n","import { INLINES } from '@contentful/rich-text-types';\n\nexport function createInlineEntryNode(id: string) {\n  return {\n    type: INLINES.EMBEDDED_ENTRY,\n    children: [{ text: '' }],\n    data: {\n      target: {\n        sys: {\n          id,\n          type: 'Link',\n          linkType: 'Entry',\n        },\n      },\n    },\n  };\n}\n","import * as React from 'react';\n\nimport { Link, FieldExtensionSDK } from '@contentful/app-sdk';\nimport { Menu, Flex } from '@contentful/f36-components';\nimport { EmbeddedEntryInlineIcon } from '@contentful/f36-icons';\nimport tokens from '@contentful/f36-tokens';\nimport { Entry } from '@contentful/field-editor-shared';\nimport { INLINES } from '@contentful/rich-text-types';\nimport { HotkeyPlugin } from '@udecode/plate-core';\nimport { css } from 'emotion';\nimport isHotkey from 'is-hotkey';\nimport { useSelected, useReadOnly } from 'slate-react';\n\nimport { useContentfulEditor } from '../../ContentfulEditorProvider';\nimport { focus, moveToTheNextChar } from '../../helpers/editor';\nimport { IS_CHROME } from '../../helpers/environment';\nimport newEntitySelectorConfigFromRichTextField from '../../helpers/newEntitySelectorConfigFromRichTextField';\nimport { findNodePath } from '../../internal/queries';\nimport { setSelection, insertNodes, removeNodes } from '../../internal/transforms';\nimport { KeyboardHandler, PlatePlugin, Node } from '../../internal/types';\nimport { Element, RenderElementProps } from '../../internal/types';\nimport { TrackingPluginActions } from '../../plugins/Tracking';\nimport { useSdkContext } from '../../SdkProvider';\nimport { withLinkTracking } from '../links-tracking';\nimport { FetchingWrappedInlineEntryCard } from './FetchingWrappedInlineEntryCard';\nimport { createInlineEntryNode } from './Util';\n\nconst styles = {\n  icon: css({\n    marginRight: '10px',\n  }),\n\n  root: css({\n    display: 'inline-block',\n    margin: `0 ${tokens.spacing2Xs}`,\n    fontSize: 'inherit',\n    span: {\n      userSelect: 'none',\n    },\n  }),\n};\n\ntype EmbeddedEntityInlineProps = {\n  target: Link;\n  element: Element & {\n    data: {\n      target: {\n        sys: {\n          id: string;\n          linkType: 'Entry' | 'Asset';\n          type: 'Link';\n        };\n      };\n    };\n  };\n  attributes: Pick<RenderElementProps, 'attributes'>;\n  children: Pick<RenderElementProps, 'children'>;\n  onEntityFetchComplete: VoidFunction;\n};\n\nfunction EmbeddedEntityInline(props: EmbeddedEntityInlineProps) {\n  const editor = useContentfulEditor();\n  const sdk = useSdkContext();\n  const isSelected = useSelected();\n  const { id: entryId } = props.element.data.target.sys;\n  const isDisabled = useReadOnly();\n\n  function handleEditClick() {\n    return sdk.navigator.openEntry(entryId, { slideIn: true });\n  }\n\n  function handleRemoveClick() {\n    if (!editor) return;\n    const pathToElement = findNodePath(editor, props.element);\n    removeNodes(editor, { at: pathToElement });\n  }\n\n  return (\n    <span\n      {...props.attributes}\n      className={styles.root}\n      data-embedded-entity-inline-id={entryId}\n      // COMPAT: This makes copy & paste work for Firefox\n      contentEditable={IS_CHROME ? undefined : false}\n      draggable={IS_CHROME ? true : undefined}\n    >\n      <span\n        // COMPAT: This makes copy & paste work for Chromium/Blink browsers and Safari\n        contentEditable={IS_CHROME ? false : undefined}\n        draggable={IS_CHROME ? true : undefined}\n      >\n        <FetchingWrappedInlineEntryCard\n          sdk={sdk}\n          entryId={entryId}\n          isSelected={isSelected}\n          isDisabled={isDisabled}\n          onRemove={handleRemoveClick}\n          onEdit={handleEditClick}\n          onEntityFetchComplete={props.onEntityFetchComplete}\n        />\n      </span>\n      {props.children}\n    </span>\n  );\n}\n\ninterface ToolbarEmbeddedEntityInlineButtonProps {\n  onClose: () => void;\n  isDisabled: boolean;\n}\n\nasync function selectEntityAndInsert(\n  editor,\n  sdk: FieldExtensionSDK,\n  logAction: TrackingPluginActions['onShortcutAction'] | TrackingPluginActions['onToolbarAction']\n) {\n  logAction('openCreateEmbedDialog', { nodeType: INLINES.EMBEDDED_ENTRY });\n\n  const config = {\n    ...newEntitySelectorConfigFromRichTextField(sdk.field, INLINES.EMBEDDED_ENTRY),\n    withCreate: true,\n  };\n  const selection = editor.selection;\n\n  const entry = await sdk.dialogs.selectSingleEntry<Entry>(config);\n  focus(editor); // Dialog steals focus from editor, return it.\n\n  if (!entry) {\n    logAction('cancelCreateEmbedDialog', { nodeType: INLINES.EMBEDDED_ENTRY });\n    return;\n  }\n\n  const inlineEntryNode = createInlineEntryNode(entry.sys.id);\n\n  logAction('insert', { nodeType: INLINES.EMBEDDED_ENTRY });\n  // Got to wait until focus is really back on the editor or setSelection() won't work.\n  return new Promise<void>((resolve) => {\n    setTimeout(() => {\n      setSelection(editor, selection);\n      insertNodes(editor, inlineEntryNode);\n      resolve();\n    }, 0);\n  });\n}\n\nexport function ToolbarEmbeddedEntityInlineButton(props: ToolbarEmbeddedEntityInlineButtonProps) {\n  const editor = useContentfulEditor();\n  const sdk: FieldExtensionSDK = useSdkContext();\n\n  async function handleClick(event) {\n    event.preventDefault();\n\n    if (!editor) return;\n\n    props.onClose();\n\n    await selectEntityAndInsert(editor, sdk, editor.tracking.onToolbarAction);\n    moveToTheNextChar(editor);\n  }\n\n  return (\n    <Menu.Item\n      disabled={props.isDisabled}\n      className=\"rich-text__entry-link-block-button\"\n      testId={`toolbar-toggle-${INLINES.EMBEDDED_ENTRY}`}\n      onClick={handleClick}\n    >\n      <Flex alignItems=\"center\" flexDirection=\"row\">\n        <EmbeddedEntryInlineIcon\n          variant=\"secondary\"\n          className={`rich-text__embedded-entry-list-icon ${styles.icon}`}\n        />\n        <span>Inline entry</span>\n      </Flex>\n    </Menu.Item>\n  );\n}\n\nexport function createEmbeddedEntityInlinePlugin(sdk: FieldExtensionSDK): PlatePlugin {\n  const htmlAttributeName = 'data-embedded-entity-inline-id';\n\n  return {\n    key: INLINES.EMBEDDED_ENTRY,\n    type: INLINES.EMBEDDED_ENTRY,\n    isElement: true,\n    isInline: true,\n    isVoid: true,\n    component: withLinkTracking(EmbeddedEntityInline),\n    options: {\n      hotkey: 'mod+shift+2',\n    },\n    handlers: {\n      onKeyDown: getWithEmbeddedEntryInlineEvents(sdk),\n    },\n    deserializeHtml: {\n      rules: [\n        {\n          validAttribute: htmlAttributeName,\n        },\n      ],\n      withoutChildren: true,\n      getNode: (el): Node => createInlineEntryNode(el.getAttribute(htmlAttributeName) as string),\n    },\n  };\n}\n\nfunction getWithEmbeddedEntryInlineEvents(sdk: FieldExtensionSDK): KeyboardHandler<HotkeyPlugin> {\n  return function withEmbeddedEntryInlineEvents(editor, { options: { hotkey } }) {\n    return function handleEvent(event) {\n      if (!editor) return;\n\n      if (hotkey && isHotkey(hotkey, event)) {\n        selectEntityAndInsert(editor, sdk, editor.tracking.onShortcutAction);\n      }\n    };\n  };\n}\n","import * as React from 'react';\n\nimport { Menu, Button } from '@contentful/f36-components';\nimport { ChevronDownIcon } from '@contentful/f36-icons';\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { css, cx } from 'emotion';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport {\n  getElementFromCurrentSelection,\n  focus,\n  isBlockSelected,\n  toggleElement,\n} from '../../../helpers/editor';\nimport { isNodeTypeEnabled } from '../../../helpers/validations';\nimport { Element } from '../../../internal/types';\nimport { useSdkContext } from '../../../SdkProvider';\n\nconst styles = {\n  dropdown: {\n    root: css`\n      font-weight: ${tokens.fontWeightDemiBold};\n    `,\n    [BLOCKS.PARAGRAPH]: css`\n      font-size: ${tokens.fontSizeL};\n    `,\n    [BLOCKS.HEADING_1]: css`\n      font-size: 1.625rem;\n    `,\n    [BLOCKS.HEADING_2]: css`\n      font-size: 1.4375rem;\n    `,\n    [BLOCKS.HEADING_3]: css`\n      font-size: 1.25rem;\n    `,\n    [BLOCKS.HEADING_4]: css`\n      font-size: 1.125rem;\n    `,\n    [BLOCKS.HEADING_5]: css`\n      font-size: 1rem;\n    `,\n    [BLOCKS.HEADING_6]: css`\n      font-size: 0.875rem;\n    `,\n  },\n};\n\nconst LABELS = {\n  [BLOCKS.PARAGRAPH]: 'Normal text',\n  [BLOCKS.HEADING_1]: 'Heading 1',\n  [BLOCKS.HEADING_2]: 'Heading 2',\n  [BLOCKS.HEADING_3]: 'Heading 3',\n  [BLOCKS.HEADING_4]: 'Heading 4',\n  [BLOCKS.HEADING_5]: 'Heading 5',\n  [BLOCKS.HEADING_6]: 'Heading 6',\n};\n\nexport interface ToolbarHeadingButtonProps {\n  isDisabled?: boolean;\n}\n\nexport function ToolbarHeadingButton(props: ToolbarHeadingButtonProps) {\n  const sdk = useSdkContext();\n  const editor = useContentfulEditor();\n  const [isOpen, setOpen] = React.useState(false);\n  const [selected, setSelected] = React.useState<string>(BLOCKS.PARAGRAPH);\n\n  React.useEffect(() => {\n    if (!editor?.selection) return;\n\n    const [element] = getElementFromCurrentSelection(editor);\n    const type = (element as Element).type;\n\n    setSelected(LABELS[type] ? type : BLOCKS.PARAGRAPH);\n  }, [editor?.operations, editor?.selection]); // eslint-disable-line -- TODO: explain this disable\n\n  const [nodeTypesByEnablement, someHeadingsEnabled] = React.useMemo(() => {\n    const nodeTypesByEnablement = Object.fromEntries(\n      Object.keys(LABELS).map((nodeType) => [nodeType, isNodeTypeEnabled(sdk.field, nodeType)])\n    );\n    const someHeadingsEnabled = Object.values(nodeTypesByEnablement).filter(Boolean).length > 0;\n    return [nodeTypesByEnablement, someHeadingsEnabled];\n  }, [sdk.field]);\n\n  function handleOnSelectItem(type: BLOCKS): (event: React.MouseEvent<HTMLButtonElement>) => void {\n    return (event: React.MouseEvent<HTMLButtonElement>) => {\n      event.preventDefault();\n\n      if (!editor?.selection) return;\n\n      setSelected(type);\n      setOpen(false);\n\n      const prevOnChange = editor.onChange;\n      /*\n       The focus might happen at point in time when\n       `toggleElement` (helper for toggleNodeType) changes aren't rendered yet, causing the browser\n       to place the cursor at the start of the text.\n       We wait for the change event before focusing\n       the editor again. This ensures the cursor is back at the previous\n       position.*/\n      editor.onChange = (...args) => {\n        focus(editor);\n        editor.onChange = prevOnChange;\n        prevOnChange(...args);\n      };\n\n      const isActive = isBlockSelected(editor, type);\n      editor.tracking.onToolbarAction(isActive ? 'remove' : 'insert', { nodeType: type });\n\n      toggleElement(editor, { activeType: type, inactiveType: type });\n    };\n  }\n\n  if (!editor) return null;\n\n  return (\n    <Menu isOpen={isOpen} onClose={() => setOpen(false)}>\n      <Menu.Trigger>\n        <Button\n          size=\"small\"\n          testId=\"toolbar-heading-toggle\"\n          variant=\"transparent\"\n          endIcon={<ChevronDownIcon />}\n          isDisabled={props.isDisabled}\n          onClick={() => someHeadingsEnabled && setOpen(!isOpen)}\n        >\n          {LABELS[selected]}\n        </Button>\n      </Menu.Trigger>\n      <Menu.List testId=\"dropdown-heading-list\">\n        {' '}\n        {Object.keys(LABELS)\n          .map(\n            (nodeType) =>\n              nodeTypesByEnablement[nodeType] && (\n                <Menu.Item\n                  key={nodeType}\n                  isInitiallyFocused={selected === nodeType}\n                  onClick={handleOnSelectItem(nodeType as BLOCKS)}\n                  testId={`dropdown-option-${nodeType}`}\n                  disabled={props.isDisabled}\n                >\n                  <span className={cx(styles.dropdown.root, styles.dropdown[nodeType])}>\n                    {LABELS[nodeType]}\n                  </span>\n                </Menu.Item>\n              )\n          )\n          .filter(Boolean)}\n      </Menu.List>\n    </Menu>\n  );\n}\n","import { BLOCKS, INLINES } from '@contentful/rich-text-types';\n\nimport {\n  insertNodes,\n  removeNodes,\n  unwrapNodes,\n  wrapNodes,\n  liftNodes,\n} from '../internal/transforms';\nimport { PlateEditor, NodeEntry } from '../internal/types';\nimport { extractParagraphs } from './extractNodes';\n\nexport const transformRemove = (editor: PlateEditor, [, path]: NodeEntry) => {\n  removeNodes(editor, { at: path });\n};\n\nexport const transformParagraphs = (editor: PlateEditor, entry: NodeEntry) => {\n  const path = entry[1];\n  const nodes = extractParagraphs(editor, path);\n\n  transformRemove(editor, entry);\n  insertNodes(editor, nodes, { at: path });\n};\n\nexport const transformUnwrap = (editor: PlateEditor, [, path]: NodeEntry) => {\n  unwrapNodes(editor, {\n    at: path,\n  });\n};\n\nexport const transformWrapIn =\n  (type: BLOCKS | INLINES) =>\n  (editor: PlateEditor, [, path]: NodeEntry) => {\n    wrapNodes(editor, { type, data: {}, children: [] }, { at: path });\n  };\n\nexport const transformLift = (editor: PlateEditor, [, path]: NodeEntry) => {\n  liftNodes(editor, { at: path });\n};\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\n\nimport { getNodeEntries } from '../internal/queries';\nimport { PlateEditor, Node, Path, NodeMatch } from '../internal/types';\n\nfunction extractNodes(editor: PlateEditor, path: Path, match: NodeMatch) {\n  return Array.from(\n    getNodeEntries(editor, {\n      match,\n      at: path,\n      mode: 'lowest',\n    })\n  ).map(([node]) => node);\n}\n\n/**\n * It filters out all paragraphs and headings from a path and convert them into paragraphs.\n */\nexport function extractParagraphs(editor: PlateEditor, path: Path): Node[] {\n  return extractNodes(editor, path, {\n    type: TEXT_CONTAINERS,\n  }).map((node) => ({\n    ...node,\n    type: BLOCKS.PARAGRAPH,\n  }));\n}\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { css, cx } from 'emotion';\nimport * as Slate from 'slate-react';\n\nconst styles = {\n  dropdown: {\n    root: css`\n      font-weight: ${tokens.fontWeightDemiBold};\n    `,\n    [BLOCKS.PARAGRAPH]: css`\n      font-size: ${tokens.fontSizeL};\n    `,\n    [BLOCKS.HEADING_1]: css`\n      font-size: 1.625rem;\n    `,\n    [BLOCKS.HEADING_2]: css`\n      font-size: 1.4375rem;\n    `,\n    [BLOCKS.HEADING_3]: css`\n      font-size: 1.25rem;\n    `,\n    [BLOCKS.HEADING_4]: css`\n      font-size: 1.125rem;\n    `,\n    [BLOCKS.HEADING_5]: css`\n      font-size: 1rem;\n    `,\n    [BLOCKS.HEADING_6]: css`\n      font-size: 0.875rem;\n    `,\n  },\n  headings: {\n    root: css`\n      font-weight: ${tokens.fontWeightMedium};\n      line-height: 1.3;\n      margin: 0 0 ${tokens.spacingS};\n    `,\n    [BLOCKS.HEADING_1]: css`\n      font-size: 1.875rem;\n    `,\n    [BLOCKS.HEADING_2]: css`\n      font-size: 1.5625rem;\n    `,\n    [BLOCKS.HEADING_3]: css`\n      font-size: 1.375rem;\n    `,\n    [BLOCKS.HEADING_4]: css`\n      font-size: 1.25rem;\n    `,\n    [BLOCKS.HEADING_5]: css`\n      font-size: 1.125rem;\n    `,\n    [BLOCKS.HEADING_6]: css`\n      font-size: 1rem;\n    `,\n  },\n};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any -- TODO: explain this disable\nfunction createHeading(Tag: any, block: BLOCKS) {\n  return function Heading(props: Slate.RenderElementProps) {\n    return (\n      <Tag {...props.attributes} className={cx(styles.headings.root, styles.headings[block])}>\n        {props.children}\n      </Tag>\n    );\n  };\n}\n\nexport const HeadingComponents = {\n  [BLOCKS.HEADING_1]: React.memo(createHeading('h1', BLOCKS.HEADING_1)),\n  [BLOCKS.HEADING_2]: React.memo(createHeading('h2', BLOCKS.HEADING_2)),\n  [BLOCKS.HEADING_3]: React.memo(createHeading('h3', BLOCKS.HEADING_3)),\n  [BLOCKS.HEADING_4]: React.memo(createHeading('h4', BLOCKS.HEADING_4)),\n  [BLOCKS.HEADING_5]: React.memo(createHeading('h5', BLOCKS.HEADING_5)),\n  [BLOCKS.HEADING_6]: React.memo(createHeading('h6', BLOCKS.HEADING_6)),\n};\n","import { BLOCKS, HEADINGS } from '@contentful/rich-text-types';\nimport isHotkey from 'is-hotkey';\n\nimport { isBlockSelected, isInlineOrText, toggleElement } from '../../helpers/editor';\nimport { transformLift, transformUnwrap } from '../../helpers/transformers';\nimport { isMarkActive, getAboveNode } from '../../internal/queries';\nimport { KeyboardHandler, PlatePlugin, HotkeyPlugin } from '../../internal/types';\nimport { COMMAND_PROMPT } from '../CommandPalette/constants';\nimport { HeadingComponents } from './components/Heading';\n\nconst buildHeadingEventHandler =\n  (type: BLOCKS): KeyboardHandler<HotkeyPlugin> =>\n  (editor, { options: { hotkey } }) =>\n  (event) => {\n    if (editor.selection && hotkey && isHotkey(hotkey, event)) {\n      const isActive = isBlockSelected(editor, type);\n      editor.tracking.onShortcutAction(isActive ? 'remove' : 'insert', { nodeType: type });\n\n      toggleElement(editor, { activeType: type, inactiveType: BLOCKS.PARAGRAPH });\n    }\n  };\n\nexport const createHeadingPlugin = (): PlatePlugin => ({\n  key: 'HeadingPlugin',\n  softBreak: [\n    // create a new line with SHIFT+Enter inside a heading\n    {\n      hotkey: 'shift+enter',\n      query: {\n        allow: HEADINGS,\n      },\n    },\n  ],\n  normalizer: [\n    {\n      match: {\n        type: HEADINGS,\n      },\n      validChildren: (_, [node]) => isInlineOrText(node),\n      transform: {\n        [BLOCKS.PARAGRAPH]: transformUnwrap,\n        default: transformLift,\n      },\n    },\n  ],\n  then: (editor) => {\n    return {\n      exitBreak: [\n        // Pressing ENTER at the start or end of a heading text inserts a\n        // normal paragraph.\n        {\n          hotkey: 'enter',\n          query: {\n            allow: HEADINGS,\n            end: true,\n            start: true,\n\n            // Exclude headings inside lists as it interferes with the list's\n            // insertBreak implementation\n            filter: ([, path]) =>\n              !getAboveNode(editor, {\n                at: path,\n                match: { type: BLOCKS.LIST_ITEM },\n              }) && !isMarkActive(editor, COMMAND_PROMPT),\n          },\n        },\n      ],\n    } as Partial<PlatePlugin>;\n  },\n  plugins: HEADINGS.map((nodeType, idx) => {\n    const level = idx + 1;\n    const tagName = `h${level}`;\n\n    return {\n      key: nodeType,\n      type: nodeType,\n      isElement: true,\n      component: HeadingComponents[nodeType],\n      options: {\n        hotkey: [`mod+alt+${level}`],\n      },\n      handlers: {\n        onKeyDown: buildHeadingEventHandler(nodeType),\n      },\n      deserializeHtml: {\n        rules: [\n          {\n            validNodeName: tagName.toUpperCase(),\n          },\n        ],\n      },\n    };\n  }),\n});\n","import React from 'react';\n\nimport { Button, Tooltip } from '@contentful/f36-components';\nimport tokens from '@contentful/f36-tokens';\nimport { css, cx } from 'emotion';\n\nconst styles = {\n  button: css({\n    height: '30px',\n    width: '30px',\n    marginLeft: tokens.spacing2Xs,\n    marginRight: tokens.spacing2Xs,\n  }),\n\n  tooltip: css({\n    zIndex: Number(tokens.zIndexTooltip),\n  }),\n};\n\ninterface ToolbarButtonProps {\n  onClick: () => void;\n  isActive?: boolean;\n  isDisabled?: boolean;\n  children: any;\n  title: string;\n  className?: string;\n  testId?: string;\n}\n\nexport function ToolbarButton(props: ToolbarButtonProps) {\n  const { title, testId, isActive, children, className, isDisabled = false } = props;\n  const handleClick = (event) => {\n    event.preventDefault();\n    props.onClick();\n  };\n\n  const button = (\n    <Button\n      className={cx(styles.button, className)}\n      isDisabled={isDisabled}\n      startIcon={children}\n      onClick={handleClick}\n      testId={testId}\n      variant={isActive ? 'secondary' : 'transparent'}\n      size=\"small\"\n    />\n  );\n\n  if (title) {\n    return (\n      <Tooltip className={styles.tooltip} placement=\"bottom\" content={title}>\n        {button}\n      </Tooltip>\n    );\n  }\n\n  return button;\n}\n","import * as React from 'react';\n\nimport { HorizontalRuleIcon } from '@contentful/f36-icons';\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { css, cx } from 'emotion';\nimport * as Slate from 'slate-react';\n\nimport { useContentfulEditor } from '../../ContentfulEditorProvider';\nimport {\n  getNodeEntryFromSelection,\n  isBlockSelected,\n  moveToTheNextLine,\n  focus,\n} from '../../helpers/editor';\nimport { getText } from '../../internal/queries';\nimport { insertNodes, setNodes, removeNodes } from '../../internal/transforms';\nimport { PlatePlugin, PlateEditor } from '../../internal/types';\nimport { ToolbarButton } from '../shared/ToolbarButton';\n\nconst styles = {\n  container: css`\n    margin: 0 0 ${tokens.spacingL};\n  `,\n  hr: css`\n    margin: 0;\n    height: ${tokens.spacingM};\n    background: transparent;\n    position: relative;\n    border: 0;\n    user-select: none;\n    &:hover {\n      cursor: pointer;\n    }\n    &::after {\n      content: '';\n      position: absolute;\n      width: 100%;\n      height: 1px;\n      background: ${tokens.gray300};\n      top: 50%;\n    }\n  `,\n  hrSelected: css`\n    &::after {\n      background: ${tokens.colorPrimary};\n      -webkit-box-shadow: 0px 0px 5px ${tokens.colorPrimary};\n      box-shadow: 0px 0px 5px ${tokens.colorPrimary};\n    }\n  `,\n};\n\ninterface ToolbarHrButtonProps {\n  isDisabled?: boolean;\n}\n\nexport function withHrEvents(editor: PlateEditor) {\n  return (event: React.KeyboardEvent) => {\n    if (!editor) return;\n\n    const [, pathToSelectedHr] = getNodeEntryFromSelection(editor, BLOCKS.HR);\n    if (pathToSelectedHr) {\n      const isBackspace = event.key === 'Backspace';\n      const isDelete = event.key === 'Delete';\n      if (isBackspace || isDelete) {\n        event.preventDefault();\n        removeNodes(editor, { at: pathToSelectedHr });\n      }\n    }\n  };\n}\n\nexport function ToolbarHrButton(props: ToolbarHrButtonProps) {\n  const editor = useContentfulEditor();\n\n  function handleOnClick() {\n    if (!editor?.selection) return;\n\n    const hr = {\n      type: BLOCKS.HR,\n      data: {},\n      children: [{ text: '' }],\n      isVoid: true,\n    };\n\n    const hasText = !!getText(editor, editor.selection.focus.path);\n    hasText ? insertNodes(editor, hr) : setNodes(editor, hr);\n\n    // Move focus to the next paragraph (added by TrailingParagraph plugin)\n    moveToTheNextLine(editor);\n\n    focus(editor);\n  }\n\n  if (!editor) return null;\n\n  return (\n    <ToolbarButton\n      title=\"HR\"\n      isDisabled={props.isDisabled}\n      onClick={handleOnClick}\n      testId=\"hr-toolbar-button\"\n      isActive={isBlockSelected(editor, BLOCKS.HR)}>\n      <HorizontalRuleIcon />\n    </ToolbarButton>\n  );\n}\n\nexport function Hr(props: Slate.RenderLeafProps) {\n  const isSelected = Slate.useSelected();\n  const isFocused = Slate.useFocused();\n\n  return (\n    <div\n      {...props.attributes}\n      className={styles.container}\n      // COMPAT: To make HR copyable in Safari, we verify this attribute below on `deserialize`\n      data-void-element={BLOCKS.HR}>\n      <div\n        draggable={true}\n        // Moving `contentEditable` to this div makes it to be selectable when being the first void element, e.g pressing ctrl + a to select everything\n        contentEditable={false}>\n        <hr className={cx(styles.hr, isSelected && isFocused ? styles.hrSelected : undefined)} />\n      </div>\n      {props.children}\n    </div>\n  );\n}\n\nexport const createHrPlugin = (): PlatePlugin => ({\n  key: BLOCKS.HR,\n  type: BLOCKS.HR,\n  isVoid: true,\n  isElement: true,\n  component: Hr,\n  handlers: {\n    onKeyDown: withHrEvents,\n  },\n  deserializeHtml: {\n    rules: [\n      {\n        validNodeName: ['HR'],\n      },\n      {\n        validAttribute: {\n          'data-void-element': BLOCKS.HR,\n        },\n      },\n    ],\n    withoutChildren: true,\n  },\n});\n","import * as React from 'react';\n\nimport {\n  TextLink,\n  Button,\n  FormControl,\n  FormLabel,\n  Select,\n  TextInput,\n  Form,\n  ModalContent,\n  ModalControls,\n} from '@contentful/f36-components';\nimport tokens from '@contentful/f36-tokens';\nimport { EntityProvider } from '@contentful/field-editor-reference';\nimport { Link } from '@contentful/field-editor-reference/dist/types';\nimport { ModalDialogLauncher, FieldExtensionSDK } from '@contentful/field-editor-shared';\nimport { INLINES } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\n\nimport { getNodeEntryFromSelection, insertLink, LINK_TYPES, focus } from '../../helpers/editor';\nimport getLinkedContentTypeIdsForNodeType from '../../helpers/getLinkedContentTypeIdsForNodeType';\nimport { isNodeTypeEnabled } from '../../helpers/validations';\nimport { withoutNormalizing } from '../../internal';\nimport { getText, isEditorReadOnly } from '../../internal/queries';\nimport { select } from '../../internal/transforms';\nimport { PlateEditor, Path } from '../../internal/types';\nimport { TrackingPluginActions } from '../../plugins/Tracking';\nimport { FetchingWrappedAssetCard } from '../shared/FetchingWrappedAssetCard';\nimport { FetchingWrappedEntryCard } from '../shared/FetchingWrappedEntryCard';\n\nconst styles = {\n  removeSelectionLabel: css`\n    margin-left: ${tokens.spacingS};\n  `,\n};\n\ninterface HyperlinkModalProps {\n  linkText?: string;\n  linkType?: string;\n  linkTarget?: string;\n  linkEntity?: Link;\n  onClose: (value: unknown) => void;\n  sdk: FieldExtensionSDK;\n  readonly: boolean;\n}\n\nconst SYS_LINK_TYPES = {\n  [INLINES.ENTRY_HYPERLINK]: 'Entry',\n  [INLINES.ASSET_HYPERLINK]: 'Asset',\n};\n\nconst LINK_TYPE_SELECTION_VALUES = {\n  [INLINES.HYPERLINK]: 'URL',\n  [INLINES.ENTRY_HYPERLINK]: 'Entry',\n  [INLINES.ASSET_HYPERLINK]: 'Asset',\n};\n\nexport function HyperlinkModal(props: HyperlinkModalProps) {\n  const enabledLinkTypes = LINK_TYPES.filter((nodeType) =>\n    isNodeTypeEnabled(props.sdk.field, nodeType)\n  );\n  const [defaultLinkType] = enabledLinkTypes;\n  const [linkText, setLinkText] = React.useState(props.linkText ?? '');\n  const [linkType, setLinkType] = React.useState(props.linkType ?? defaultLinkType);\n  const [linkTarget, setLinkTarget] = React.useState(props.linkTarget ?? '');\n  const [linkEntity, setLinkEntity] = React.useState<Link | null>(props.linkEntity ?? null);\n\n  function isLinkComplete() {\n    const isRegularLink = linkType === INLINES.HYPERLINK;\n    if (isRegularLink) {\n      return !!(linkText && linkTarget);\n    }\n\n    const entityLinks: string[] = Object.keys(SYS_LINK_TYPES);\n    const isEntityLink = entityLinks.includes(linkType);\n    if (isEntityLink) {\n      return !!(linkText && linkEntity);\n    }\n\n    return false;\n  }\n\n  function handleOnSubmit(event: React.MouseEvent<HTMLButtonElement>) {\n    event.preventDefault();\n\n    props.onClose({ linkText, linkType, linkTarget, linkEntity });\n  }\n\n  function entityToLink(entity): Link {\n    const { id, type } = entity.sys;\n\n    return { sys: { id, type: 'Link', linkType: type } };\n  }\n\n  async function selectEntry() {\n    const options = {\n      locale: props.sdk.field.locale,\n      contentTypes: getLinkedContentTypeIdsForNodeType(props.sdk.field, INLINES.ENTRY_HYPERLINK),\n    };\n    const entry = await props.sdk.dialogs.selectSingleEntry(options);\n    setLinkTarget('');\n    setLinkEntity(entityToLink(entry));\n  }\n\n  async function selectAsset() {\n    const options = {\n      locale: props.sdk.field.locale,\n    };\n    const asset = await props.sdk.dialogs.selectSingleAsset(options);\n    setLinkTarget('');\n    setLinkEntity(entityToLink(asset));\n  }\n\n  function resetLinkEntity(event: React.MouseEvent) {\n    event.preventDefault();\n\n    setLinkEntity(null);\n  }\n\n  return (\n    <EntityProvider sdk={props.sdk}>\n      <React.Fragment>\n        <ModalContent>\n          <Form>\n            {!props.linkType && (\n              <FormControl id=\"link-text\" isRequired>\n                <FormControl.Label>Link text</FormControl.Label>\n                <TextInput\n                  testId=\"link-text-input\"\n                  name=\"link-text\"\n                  value={linkText}\n                  onChange={(event) => setLinkText(event.target.value)}\n                />\n              </FormControl>\n            )}\n\n            {enabledLinkTypes.length > 1 && (\n              <FormControl id=\"link-type\">\n                <FormControl.Label>Link type</FormControl.Label>\n                <Select\n                  value={linkType}\n                  onChange={(event: React.ChangeEvent<HTMLSelectElement>) =>\n                    setLinkType(event.target.value)\n                  }\n                  testId=\"link-type-input\"\n                  isDisabled={props.readonly}\n                >\n                  {enabledLinkTypes.map((nodeType) => (\n                    <Select.Option key={nodeType} value={nodeType}>\n                      {LINK_TYPE_SELECTION_VALUES[nodeType]}\n                    </Select.Option>\n                  ))}\n                </Select>\n              </FormControl>\n            )}\n\n            {linkType === INLINES.HYPERLINK && (\n              <FormControl id=\"linkTarget\" isRequired>\n                <FormControl.Label>Link target</FormControl.Label>\n                <TextInput\n                  name=\"linkTarget\"\n                  value={linkTarget}\n                  onChange={(event: React.ChangeEvent<HTMLInputElement>) => {\n                    setLinkEntity(null);\n                    setLinkTarget(event.target.value);\n                  }}\n                  testId=\"link-target-input\"\n                  isDisabled={props.readonly}\n                />\n                <FormControl.HelpText>\n                  A protocol may be required, e.g. https://\n                </FormControl.HelpText>\n              </FormControl>\n            )}\n\n            {linkType !== INLINES.HYPERLINK && (\n              <div>\n                <FormLabel isRequired htmlFor=\"\">\n                  Link target{' '}\n                </FormLabel>\n\n                {linkEntity && linkEntity.sys.linkType === SYS_LINK_TYPES[linkType] ? (\n                  <>\n                    {!props.readonly && (\n                      <TextLink\n                        testId=\"entity-selection-link\"\n                        onClick={resetLinkEntity}\n                        className={styles.removeSelectionLabel}\n                      >\n                        Remove selection\n                      </TextLink>\n                    )}\n                    <div>\n                      {linkType === INLINES.ENTRY_HYPERLINK && (\n                        <FetchingWrappedEntryCard\n                          sdk={props.sdk}\n                          locale={props.sdk.field.locale}\n                          entryId={linkEntity.sys.id}\n                          isDisabled={true}\n                          isSelected={false}\n                        />\n                      )}\n                      {linkType === INLINES.ASSET_HYPERLINK && (\n                        <FetchingWrappedAssetCard\n                          sdk={props.sdk}\n                          locale={props.sdk.field.locale}\n                          assetId={linkEntity.sys.id}\n                          isDisabled={true}\n                          isSelected={false}\n                        />\n                      )}\n                    </div>\n                  </>\n                ) : (\n                  <div>\n                    {linkType === INLINES.ENTRY_HYPERLINK && (\n                      <TextLink testId=\"entity-selection-link\" onClick={selectEntry}>\n                        Select entry\n                      </TextLink>\n                    )}\n                    {linkType === INLINES.ASSET_HYPERLINK && (\n                      <TextLink testId=\"entity-selection-link\" onClick={selectAsset}>\n                        Select asset\n                      </TextLink>\n                    )}\n                  </div>\n                )}\n              </div>\n            )}\n          </Form>\n        </ModalContent>\n        <ModalControls>\n          <Button\n            type=\"button\"\n            onClick={() => props.onClose(null)}\n            variant=\"secondary\"\n            testId=\"cancel-cta\"\n            size=\"small\"\n          >\n            Cancel\n          </Button>\n          <Button\n            type=\"submit\"\n            variant=\"positive\"\n            size=\"small\"\n            isDisabled={props.readonly || !isLinkComplete()}\n            onClick={handleOnSubmit}\n            testId=\"confirm-cta\"\n          >\n            {props.linkType ? 'Update' : 'Insert'}\n          </Button>\n        </ModalControls>\n      </React.Fragment>\n    </EntityProvider>\n  );\n}\n\ninterface HyperLinkDialogData {\n  linkText: string;\n  linkType: INLINES.HYPERLINK | INLINES.ASSET_HYPERLINK | INLINES.ENTRY_HYPERLINK;\n  linkTarget?: string;\n  linkEntity?: Link;\n}\n\nexport async function addOrEditLink(\n  editor: PlateEditor,\n  sdk: FieldExtensionSDK,\n  logAction:\n    | TrackingPluginActions['onToolbarAction']\n    | TrackingPluginActions['onShortcutAction']\n    | TrackingPluginActions['onViewportAction'],\n  targetPath?: Path\n) {\n  const isReadOnly = isEditorReadOnly(editor);\n  const selectionBeforeBlur = editor.selection ? { ...editor.selection } : undefined;\n  if (!targetPath && !selectionBeforeBlur) return;\n\n  let linkType;\n  let linkText;\n  let linkTarget;\n  let linkEntity;\n  const [node, path] = getNodeEntryFromSelection(editor, LINK_TYPES, targetPath);\n  if (node && path) {\n    linkType = node.type;\n    linkText = getText(editor, path);\n    linkTarget = (node.data as { uri: string }).uri || '';\n    linkEntity = (node.data as { target: Link }).target;\n  }\n\n  const selectionAfterFocus =\n    targetPath ?? (selectionBeforeBlur as NonNullable<typeof selectionBeforeBlur>);\n\n  const currentLinkText = linkText || (editor.selection ? getText(editor, editor.selection) : '');\n  const isEditing = Boolean(node && path);\n\n  logAction(isEditing ? 'openEditHyperlinkDialog' : 'openCreateHyperlinkDialog');\n\n  const data = await ModalDialogLauncher.openDialog(\n    {\n      title: isEditing ? 'Edit hyperlink' : 'Insert hyperlink',\n      width: 'large',\n      shouldCloseOnEscapePress: true,\n      shouldCloseOnOverlayClick: true,\n      allowHeightOverflow: true,\n    },\n    ({ onClose }) => {\n      return (\n        <HyperlinkModal\n          linkTarget={linkTarget}\n          linkText={currentLinkText}\n          linkType={linkType}\n          linkEntity={linkEntity}\n          onClose={onClose}\n          sdk={sdk}\n          readonly={isReadOnly}\n        />\n      );\n    }\n  );\n  select(editor, selectionAfterFocus);\n\n  if (!data) {\n    focus(editor);\n    logAction(isEditing ? 'cancelEditHyperlinkDialog' : 'cancelCreateHyperlinkDialog');\n    return;\n  }\n\n  const {\n    linkText: text,\n    linkTarget: url,\n    linkType: type,\n    linkEntity: target,\n  } = data as HyperLinkDialogData;\n\n  withoutNormalizing(editor, () => {\n    insertLink(editor, { text, url, type, target, path });\n  });\n\n  logAction(isEditing ? 'edit' : 'insert', {\n    nodeType: type,\n    linkType: target?.sys.linkType ?? 'uri', // we want to keep the same values we've been using for the old editor, which can be `uri`, `Asset` or `Entry`\n  });\n\n  focus(editor);\n}\n","import * as React from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { LinkIcon } from '@contentful/f36-icons';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { isLinkActive, unwrapLink } from '../../../helpers/editor';\nimport { useSdkContext } from '../../../SdkProvider';\nimport { ToolbarButton } from '../../shared/ToolbarButton';\nimport { addOrEditLink } from '../HyperlinkModal';\n\ninterface ToolbarHyperlinkButtonProps {\n  isDisabled: boolean | undefined;\n}\n\nexport function ToolbarHyperlinkButton(props: ToolbarHyperlinkButtonProps) {\n  const editor = useContentfulEditor();\n  const isActive = !!(editor && isLinkActive(editor));\n  const sdk: FieldExtensionSDK = useSdkContext();\n\n  async function handleClick() {\n    if (!editor) return;\n\n    if (isActive) {\n      unwrapLink(editor);\n      editor.tracking.onToolbarAction('unlinkHyperlinks');\n    } else {\n      addOrEditLink(editor, sdk, editor.tracking.onToolbarAction);\n    }\n  }\n\n  if (!editor) return null;\n\n  return (\n    <ToolbarButton\n      title=\"Hyperlink\"\n      testId=\"hyperlink-toolbar-button\"\n      onClick={handleClick}\n      isActive={isActive}\n      isDisabled={props.isDisabled}>\n      <LinkIcon />\n    </ToolbarButton>\n  );\n}\n","import { getScheduleTooltipContent } from '@contentful/field-editor-reference';\nimport { isAncestorEmpty } from '@udecode/plate-core';\n\nimport { getText } from '../../internal/queries';\nimport { NodeEntry } from '../../internal/types';\nimport { PlateEditor } from '../../internal/types';\nimport { FetchedEntityData } from './useEntityInfo';\n\nexport const hasText = (editor: PlateEditor, entry: NodeEntry) => {\n  const [node, path] = entry;\n  return !isAncestorEmpty(editor, node as any) && getText(editor, path).trim() !== '';\n};\n\nfunction truncate(str: string, length: number) {\n  if (typeof str === 'string' && str.length > length) {\n    return (\n      str &&\n      str\n        .substr(0, length + 1) // +1 to look ahead and be replaced below.\n        // Get rid of orphan letters but not one letter words (I, a, 2).\n        // Try to not have . as last character to avoid awkward .....\n        .replace(/(\\s+\\S(?=\\S)|\\s*)\\.?.$/, '')\n    );\n  }\n\n  return str;\n}\n\nexport function getEntityInfo(data?: FetchedEntityData) {\n  if (!data) {\n    return '';\n  }\n  const { entityTitle, contentTypeName, entityStatus, jobs } = data;\n\n  const title = truncate(entityTitle, 60) || 'Untitled';\n\n  const scheduledActions =\n    jobs.length > 0 ? getScheduleTooltipContent({ job: jobs[0], jobsCount: jobs.length }) : '';\n\n  return `${contentTypeName || 'Asset'} \"${title}\", ${entityStatus} ${scheduledActions}`;\n}\n","import { useEffect, useState } from 'react';\n\nimport {\n  Asset,\n  ContentEntityType,\n  Entry,\n  FieldExtensionSDK,\n  Link,\n  ScheduledAction,\n} from '@contentful/app-sdk';\nimport { entityHelpers } from '@contentful/field-editor-shared';\n\nimport { getEntityInfo } from './utils';\n\nexport type FetchedEntityData = {\n  jobs: ScheduledAction[];\n  entity: Entry | Asset;\n  entityTitle: string;\n  entityDescription: string;\n  entityStatus: ReturnType<typeof entityHelpers.getEntryStatus>;\n  contentTypeName: string;\n};\n\nasync function fetchAllData({\n  sdk,\n  entityId,\n  entityType,\n  localeCode,\n  defaultLocaleCode,\n}: {\n  sdk: FieldExtensionSDK;\n  entityId: string;\n  entityType: ContentEntityType;\n  localeCode: string;\n  defaultLocaleCode: string;\n}): Promise<FetchedEntityData> {\n  let contentType;\n\n  const getEntity = entityType === 'Entry' ? sdk.space.getEntry : sdk.space.getAsset;\n  const entity = await getEntity(entityId);\n  if (entity.sys.contentType) {\n    const contentTypeId = entity.sys.contentType.sys.id;\n    contentType = sdk.space.getCachedContentTypes().find((ct) => ct.sys.id === contentTypeId);\n  }\n\n  const entityTitle =\n    entityType === 'Entry'\n      ? entityHelpers.getEntryTitle({\n          entry: entity,\n          contentType,\n          localeCode,\n          defaultLocaleCode,\n          defaultTitle: 'Untitled',\n        })\n      : entityHelpers.getAssetTitle({\n          asset: entity,\n          localeCode,\n          defaultLocaleCode,\n          defaultTitle: 'Untitled',\n        });\n\n  const entityDescription = entityHelpers.getEntityDescription({\n    entity,\n    contentType,\n    localeCode,\n    defaultLocaleCode,\n  });\n\n  const jobs = await sdk.space.getEntityScheduledActions(entityType, entityId);\n\n  const entityStatus = entityHelpers.getEntryStatus(entity.sys);\n\n  return {\n    jobs,\n    entity,\n    entityTitle,\n    entityDescription,\n    entityStatus,\n    contentTypeName: contentType ? contentType.name : '',\n  };\n}\n\nexport type EntityInfoProps = {\n  target: Link<ContentEntityType>;\n  sdk: FieldExtensionSDK;\n  onEntityFetchComplete?: VoidFunction;\n};\n\nfunction useRequestStatus({ sdk, target, onEntityFetchComplete }: EntityInfoProps) {\n  const [requestStatus, setRequestStatus] = useState<{\n    type: 'success' | 'loading' | 'error';\n    data?: FetchedEntityData;\n    error?: Error;\n  }>({ type: 'loading' });\n\n  useEffect(() => {\n    if (target) {\n      fetchAllData({\n        sdk,\n        entityId: target?.sys?.id,\n        entityType: target?.sys?.linkType,\n        localeCode: sdk.field.locale,\n        defaultLocaleCode: sdk.locales.default,\n      })\n        .then((entityInfo) => {\n          setRequestStatus({ type: 'success', data: entityInfo });\n        })\n        .catch((e) => {\n          console.log(e);\n          setRequestStatus({ type: 'error', error: e });\n        })\n        .finally(() => {\n          onEntityFetchComplete?.();\n        });\n    }\n  }, [sdk, target, onEntityFetchComplete]);\n\n  return requestStatus;\n}\n\nexport function useEntityInfo(props: EntityInfoProps) {\n  const status = useRequestStatus(props);\n\n  const { linkType } = props.target.sys;\n\n  if (status.type === 'loading') {\n    return `Loading ${linkType.toLowerCase()}...`;\n  }\n\n  if (status.type === 'error') {\n    return `${linkType} missing or inaccessible`;\n  }\n\n  return getEntityInfo(status.data);\n}\n","import tokens from '@contentful/f36-tokens';\nimport { css } from 'emotion';\n\nexport const styles = {\n  hyperlinkWrapper: css({\n    display: 'inline',\n    position: 'static',\n    a: {\n      fontSize: 'inherit !important',\n    },\n  }),\n  hyperlink: css({\n    fontSize: 'inherit !important',\n    display: 'inline !important',\n    '&:hover': {\n      fill: tokens.gray900,\n    },\n    '&:focus': {\n      fill: tokens.gray900,\n    },\n  }),\n};\n","import * as React from 'react';\n\nimport { FieldExtensionSDK, Link } from '@contentful/app-sdk';\nimport { Tooltip, TextLink } from '@contentful/f36-components';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { fromDOMPoint } from '../../../internal';\nimport { Element, RenderElementProps } from '../../../internal/types';\nimport { useSdkContext } from '../../../SdkProvider';\nimport { addOrEditLink } from '../HyperlinkModal';\nimport { useEntityInfo } from '../useEntityInfo';\nimport { styles } from './styles';\n\nexport type HyperlinkElementProps = {\n  element: Element & {\n    data: {\n      target: {\n        sys: {\n          id: string;\n          linkType: 'Entry' | 'Asset';\n          type: 'Link';\n        };\n      };\n    };\n  };\n  target: Link;\n  attributes: Pick<RenderElementProps, 'attributes'>;\n  children: Pick<RenderElementProps, 'children'>;\n  onEntityFetchComplete: VoidFunction;\n};\n\nexport function EntityHyperlink(props: HyperlinkElementProps) {\n  const editor = useContentfulEditor();\n  const sdk: FieldExtensionSDK = useSdkContext();\n  const { target } = props.element.data;\n  const { onEntityFetchComplete } = props;\n\n  const tooltipContent = useEntityInfo({\n    target,\n    sdk,\n    onEntityFetchComplete,\n  });\n\n  if (!target) return null;\n\n  function handleClick(event: React.MouseEvent<HTMLAnchorElement>) {\n    event.preventDefault();\n    event.stopPropagation();\n    if (!editor) return;\n\n    const p = fromDOMPoint(editor, [event.target as Node, 0]);\n\n    if (p) {\n      addOrEditLink(editor, sdk, editor.tracking.onViewportAction, p.path);\n    }\n  }\n\n  return (\n    <Tooltip\n      content={tooltipContent}\n      targetWrapperClassName={styles.hyperlinkWrapper}\n      placement=\"bottom\"\n      maxWidth=\"auto\"\n    >\n      <TextLink\n        as=\"a\"\n        onClick={handleClick}\n        className={styles.hyperlink}\n        data-link-type={target.sys.linkType}\n        data-link-id={target.sys.id}\n      >\n        {props.children}\n      </TextLink>\n    </Tooltip>\n  );\n}\n","import * as React from 'react';\n\nimport { FieldExtensionSDK, Link } from '@contentful/app-sdk';\nimport { Tooltip, TextLink } from '@contentful/f36-components';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { fromDOMPoint } from '../../../internal';\nimport { Element, RenderElementProps } from '../../../internal/types';\nimport { useSdkContext } from '../../../SdkProvider';\nimport { addOrEditLink } from '../HyperlinkModal';\nimport { styles } from './styles';\n\ntype HyperlinkElementProps = {\n  element: Element & {\n    data: {\n      uri?: string;\n      target: {\n        sys: {\n          id: string;\n          linkType: 'Entry' | 'Asset';\n          type: 'Link';\n        };\n      };\n    };\n  };\n  target?: Link;\n  onEntityFetchComplete?: VoidFunction;\n  children: Pick<RenderElementProps, 'children'>;\n};\n\nexport function UrlHyperlink(props: HyperlinkElementProps) {\n  const editor = useContentfulEditor();\n  const sdk: FieldExtensionSDK = useSdkContext();\n  const { uri } = props.element.data;\n\n  function handleClick(event: React.MouseEvent<HTMLAnchorElement>) {\n    event.preventDefault();\n    event.stopPropagation();\n    if (!editor) return;\n    const p = fromDOMPoint(editor, [event.target as Node, 0], {\n      exactMatch: false,\n      suppressThrow: false,\n    });\n    addOrEditLink(editor, sdk, editor.tracking.onViewportAction, p?.path);\n  }\n\n  return (\n    <Tooltip\n      content={uri}\n      targetWrapperClassName={styles.hyperlinkWrapper}\n      placement=\"bottom\"\n      maxWidth=\"auto\"\n    >\n      <TextLink\n        as=\"a\"\n        href={uri}\n        rel=\"noopener noreferrer\"\n        onClick={handleClick}\n        className={styles.hyperlink}\n      >\n        {props.children}\n      </TextLink>\n    </Tooltip>\n  );\n}\n","import * as React from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { INLINES } from '@contentful/rich-text-types';\nimport { AnyObject, HotkeyPlugin } from '@udecode/plate-core';\nimport isHotkey from 'is-hotkey';\n\nimport { isLinkActive, unwrapLink } from '../../helpers/editor';\nimport { transformRemove } from '../../helpers/transformers';\nimport { PlatePlugin, KeyboardHandler } from '../../internal/types';\nimport { withLinkTracking } from '../links-tracking';\nimport { EntityHyperlink } from './components/EntityHyperlink';\nimport { UrlHyperlink } from './components/UrlHyperlink';\nimport { addOrEditLink } from './HyperlinkModal';\nimport { hasText } from './utils';\n\nconst isAnchor = (element: HTMLElement) =>\n  element.nodeName === 'A' &&\n  !!element.getAttribute('href') &&\n  element.getAttribute('href') !== '#';\n\nconst isEntryAnchor = (element: HTMLElement) =>\n  element.nodeName === 'A' && element.getAttribute('data-link-type') === 'Entry';\n\nconst isAssetAnchor = (element: HTMLElement) =>\n  element.nodeName === 'A' && element.getAttribute('data-link-type') === 'Asset';\n\nconst buildHyperlinkEventHandler =\n  (sdk: FieldExtensionSDK): KeyboardHandler<HotkeyPlugin> =>\n  (editor, { options: { hotkey } }) => {\n    return (event: React.KeyboardEvent) => {\n      if (!editor.selection) {\n        return;\n      }\n\n      if (hotkey && !isHotkey(hotkey, event)) {\n        return;\n      }\n\n      if (isLinkActive(editor)) {\n        unwrapLink(editor);\n        editor.tracking.onShortcutAction('unlinkHyperlinks');\n      } else {\n        addOrEditLink(editor, sdk, editor.tracking.onShortcutAction);\n      }\n    };\n  };\n\nconst getNodeOfType = (type: INLINES) => (el: HTMLElement, node: AnyObject) => ({\n  type,\n  children: node.children,\n  data:\n    type === INLINES.HYPERLINK\n      ? {\n          uri: el.getAttribute('href'),\n        }\n      : {\n          target: {\n            sys: {\n              id: el.getAttribute('data-link-id'),\n              linkType: el.getAttribute('data-link-type'),\n              type: 'Link',\n            },\n          },\n        },\n});\n\nexport const createHyperlinkPlugin = (sdk: FieldExtensionSDK): PlatePlugin => {\n  const common: Partial<PlatePlugin> = {\n    isElement: true,\n    isInline: true,\n  };\n\n  return {\n    key: 'HyperlinkPlugin',\n    options: {\n      hotkey: 'mod+k',\n    },\n    handlers: {\n      onKeyDown: buildHyperlinkEventHandler(sdk),\n    },\n    plugins: [\n      // URL Hyperlink\n      {\n        ...common,\n        key: INLINES.HYPERLINK,\n        type: INLINES.HYPERLINK,\n        component: UrlHyperlink,\n        deserializeHtml: {\n          rules: [\n            {\n              validNodeName: ['A'],\n            },\n          ],\n          query: (el) => isAnchor(el) && !(isEntryAnchor(el) || isAssetAnchor(el)),\n          getNode: getNodeOfType(INLINES.HYPERLINK),\n        },\n      },\n      // Entry Hyperlink\n      {\n        ...common,\n        key: INLINES.ENTRY_HYPERLINK,\n        type: INLINES.ENTRY_HYPERLINK,\n        component: withLinkTracking(EntityHyperlink),\n        deserializeHtml: {\n          rules: [\n            {\n              validNodeName: ['A'],\n            },\n          ],\n          query: (el) => isEntryAnchor(el),\n          getNode: getNodeOfType(INLINES.ENTRY_HYPERLINK),\n        },\n      },\n      // Asset Hyperlink\n      {\n        ...common,\n        key: INLINES.ASSET_HYPERLINK,\n        type: INLINES.ASSET_HYPERLINK,\n        component: withLinkTracking(EntityHyperlink),\n        deserializeHtml: {\n          rules: [\n            {\n              validNodeName: ['A'],\n            },\n          ],\n          query: (el) => isAssetAnchor(el),\n          getNode: getNodeOfType(INLINES.ASSET_HYPERLINK),\n        },\n      },\n    ],\n    normalizer: [\n      {\n        match: {\n          type: [INLINES.HYPERLINK, INLINES.ASSET_HYPERLINK, INLINES.ENTRY_HYPERLINK],\n        },\n        validNode: hasText,\n        transform: transformRemove,\n      },\n    ],\n  };\n};\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { css, cx } from 'emotion';\nimport * as Slate from 'slate-react';\n\nconst baseStyle = css`\n  padding: 0;\n  margin: 0 0 1.25rem 1.25rem;\n\n  div:first-child {\n    margin: 0;\n    line-height: ${tokens.lineHeightDefault};\n  }\n`;\n\nconst styles = {\n  [BLOCKS.UL_LIST]: css`\n    list-style-type: disc;\n    ul {\n      list-style-type: circle;\n      ul {\n        list-style-type: square;\n      }\n    }\n  `,\n  [BLOCKS.OL_LIST]: css`\n    list-style-type: decimal;\n    ol {\n      list-style-type: upper-alpha;\n      ol {\n        list-style-type: lower-roman;\n        ol {\n          list-style-type: lower-alpha;\n        }\n      }\n    }\n  `,\n};\n\nfunction createList(Tag, block: BLOCKS) {\n  return function List(props: Slate.RenderElementProps) {\n    return (\n      <Tag {...props.attributes} className={cx(baseStyle, styles[block])}>\n        {props.children}\n      </Tag>\n    );\n  };\n}\n\nexport const ListUL = createList('ul', BLOCKS.UL_LIST);\nexport const ListOL = createList('ol', BLOCKS.OL_LIST);\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { css } from 'emotion';\nimport * as Slate from 'slate-react';\n\nconst style = css`\n  margin: 0;\n  list-style: inherit;\n  margin-top: ${tokens.spacingXs};\n\n  ol,\n  ul {\n    margin: 0 0 0 ${tokens.spacingL};\n  }\n`;\n\nexport function ListItem(props: Slate.RenderElementProps) {\n  return (\n    <li {...props.attributes} className={style}>\n      {props.children}\n    </li>\n  );\n}\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { getListTypes } from '@udecode/plate-list';\n\nimport { withoutNormalizing } from '../../../internal/misc';\nimport {\n  getNodeEntry,\n  getNodeChildren,\n  getNextPath,\n  getPreviousPath,\n  getLastChildPath,\n  match,\n} from '../../../internal/queries';\nimport { wrapNodes, moveNodes } from '../../../internal/transforms';\nimport { NodeEntry, PlateEditor, Element, Path } from '../../../internal/types';\n\nexport interface MoveListItemDownOptions {\n  list: NodeEntry;\n  listItem: NodeEntry;\n}\n\nexport const moveListItemDown = (\n  editor: PlateEditor,\n  { list, listItem }: MoveListItemDownOptions\n) => {\n  const [listNode] = list;\n  const [, listItemPath] = listItem;\n\n  let previousListItemPath: Path;\n\n  try {\n    previousListItemPath = getPreviousPath(listItemPath);\n  } catch (e) {\n    return;\n  }\n\n  // Previous sibling is the new parent\n  const previousSiblingItem = getNodeEntry(editor, previousListItemPath) as NodeEntry;\n\n  if (previousSiblingItem) {\n    const [, previousPath] = previousSiblingItem;\n\n    const subList = Array.from(getNodeChildren(editor, previousPath)).find(([n, path]) =>\n      match(n, path, { type: getListTypes(editor) })\n    ) as NodeEntry | undefined;\n\n    const newPath = getNextPath(getLastChildPath(subList ?? previousSiblingItem));\n\n    withoutNormalizing(editor, () => {\n      if (!subList) {\n        // Create new sub-list\n        wrapNodes(editor, { type: listNode.type, children: [], data: {} } as Element, {\n          at: listItemPath,\n        });\n      }\n\n      // Move the current item to the sub-list\n      moveNodes(editor, {\n        at: listItemPath,\n        to: newPath,\n      });\n    });\n  }\n};\n","import * as p from '@udecode/plate-core';\n\nexport const ELEMENT_DEFAULT = p.ELEMENT_DEFAULT;\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { BLOCKS } from '@contentful/rich-text-types';\n\nimport { withoutNormalizing } from '../../../internal';\nimport { getNodeEntries, isElement } from '../../../internal/queries';\nimport { unwrapNodes, liftNodes } from '../../../internal/transforms';\nimport { PlateEditor, Path } from '../../../internal/types';\n\nfunction hasUnliftedListItems(editor: PlateEditor, at?: Path) {\n  return getNodeEntries(editor, {\n    at,\n    match: (node, path) => isElement(node) && node.type === BLOCKS.LIST_ITEM && path.length >= 2,\n  }).next().done;\n}\nexport const unwrapList = (editor: PlateEditor, { at }: { at?: Path } = {}) => {\n  withoutNormalizing(editor, () => {\n    do {\n      // lift list items to the root level\n      liftNodes(editor, {\n        at,\n        match: (node) => isElement(node) && node.type === BLOCKS.LIST_ITEM,\n        mode: 'lowest',\n      });\n    } while (!hasUnliftedListItems(editor, at));\n\n    // finally unwrap all lifted items\n    unwrapNodes(editor, {\n      at,\n      match: { type: BLOCKS.LIST_ITEM },\n      split: false,\n    });\n  });\n};\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { ELEMENT_LIC } from '@udecode/plate-list';\nimport { getListItemEntry } from '@udecode/plate-list';\n\nimport { ELEMENT_DEFAULT } from '../../../internal/constants';\nimport { withoutNormalizing } from '../../../internal/misc';\nimport {\n  findNode,\n  getNodeEntries,\n  isRangeCollapsed,\n  getRangeEdges,\n  isRangeAcrossBlocks,\n  getParentNode,\n  getPluginType,\n  getCommonNode,\n  getRangeStart,\n  getRangeEnd,\n} from '../../../internal/queries';\nimport { setNodes, wrapNodes } from '../../../internal/transforms';\nimport { PlateEditor, Element, Location, NodeEntry } from '../../../internal/types';\nimport { unwrapList } from './unwrapList';\n\nconst listTypes = [BLOCKS.UL_LIST, BLOCKS.OL_LIST] as string[];\n\nexport const toggleList = (editor: PlateEditor, { type }: { type: string }) =>\n  withoutNormalizing(editor, () => {\n    if (!editor.selection) {\n      return;\n    }\n\n    if (isRangeCollapsed(editor.selection) || !isRangeAcrossBlocks(editor)) {\n      // selection is collapsed\n      const res = getListItemEntry(editor);\n\n      if (res) {\n        const { list } = res;\n        if (list[0].type !== type) {\n          setNodes(\n            editor,\n            { type },\n            {\n              at: editor.selection,\n              match: (n) => listTypes.includes(n.type as string),\n              mode: 'lowest',\n            }\n          );\n        } else {\n          unwrapList(editor);\n        }\n      } else {\n        const list = { type, children: [], data: {} };\n        wrapNodes(editor, list);\n\n        const nodes = [\n          ...getNodeEntries(editor, {\n            match: { type: getPluginType(editor, ELEMENT_DEFAULT) },\n          }),\n        ];\n\n        const listItem = {\n          type: BLOCKS.LIST_ITEM,\n          children: [],\n          data: {},\n        };\n\n        for (const [, path] of nodes) {\n          wrapNodes(editor, listItem, {\n            at: path,\n          });\n        }\n      }\n    } else {\n      // selection is a range\n\n      const [startPoint, endPoint] = getRangeEdges(editor.selection);\n      const commonEntry = getCommonNode(editor, startPoint.path, endPoint.path) as NodeEntry;\n\n      if (\n        listTypes.includes((commonEntry[0] as Element).type) ||\n        commonEntry[0].type === BLOCKS.LIST_ITEM\n      ) {\n        let listType = commonEntry[0].type;\n        if (commonEntry[0].type === BLOCKS.LIST_ITEM) {\n          listType = (getParentNode(editor, commonEntry[1] as Location)?.[0] as Element | undefined)\n            ?.type;\n        }\n        if (listType !== type) {\n          const startList = findNode(editor, {\n            at: getRangeStart(editor.selection),\n            match: { type: listTypes },\n            mode: 'lowest',\n          });\n\n          const endList = findNode(editor, {\n            at: getRangeEnd(editor.selection),\n            match: { type: listTypes },\n            mode: 'lowest',\n          });\n\n          if (!startList || !endList) {\n            return;\n          }\n\n          const rangeLength = Math.min(startList[1].length, endList[1].length);\n          setNodes(\n            editor,\n            { type },\n            {\n              at: editor.selection,\n              match: (n, path) =>\n                listTypes.includes(n.type as string) && path.length >= rangeLength,\n              mode: 'all',\n            }\n          );\n        } else {\n          unwrapList(editor);\n        }\n      } else {\n        const rootPathLength = commonEntry[1].length;\n        const nodes = (\n          Array.from(\n            getNodeEntries(editor, {\n              mode: 'all',\n            })\n          ) as NodeEntry[]\n        )\n          .filter(([, path]) => path.length === rootPathLength + 1)\n          .reverse();\n\n        nodes.forEach((n) => {\n          if (listTypes.includes(n[0].type as string)) {\n            setNodes(editor, { type }, { at: n[1] });\n          } else {\n            setNodes(editor, { type: getPluginType(editor, ELEMENT_LIC) }, { at: n[1] });\n\n            const listItem = {\n              type: BLOCKS.LIST_ITEM,\n              children: [],\n              data: {},\n            };\n\n            wrapNodes(editor, listItem, {\n              at: n[1],\n            });\n\n            const list = { type, children: [], data: {} };\n            wrapNodes(editor, list, { at: n[1] });\n          }\n        });\n      }\n    }\n  });\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { HotkeyPlugin } from '@udecode/plate-core';\nimport isHotkey from 'is-hotkey';\nimport castArray from 'lodash/castArray';\n\nimport { getAboveNode } from '../../internal/queries';\nimport { KeyboardHandler } from '../../internal/types';\nimport { moveListItems } from './transforms/moveListItems';\nimport { toggleList } from './transforms/toggleList';\n\nexport const onKeyDownList: KeyboardHandler<HotkeyPlugin> =\n  (editor, { type, options: { hotkey } }) =>\n  (e) => {\n    if (e.key === 'Tab' && editor.selection) {\n      const listSelected = getAboveNode(editor, {\n        at: editor.selection,\n        match: { type },\n      });\n\n      if (listSelected) {\n        e.preventDefault();\n        moveListItems(editor, { increase: !e.shiftKey });\n        return;\n      }\n    }\n\n    if (!hotkey) return;\n\n    const hotkeys = castArray(hotkey);\n\n    for (const _hotkey of hotkeys) {\n      if (isHotkey(_hotkey)(e)) {\n        toggleList(editor, { type });\n      }\n    }\n  };\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { isListNested, ELEMENT_LIC, getListItemEntry, moveListItemUp } from '@udecode/plate-list';\n\nimport { withoutNormalizing } from '../../../internal/misc';\nimport {\n  getNodeEntries,\n  getPluginType,\n  createPathRef,\n  getParentPath,\n  isAncestorPath,\n} from '../../../internal/queries';\nimport { EditorNodesOptions, PlateEditor, Path, PathRef } from '../../../internal/types';\nimport { moveListItemDown } from './moveListItemDown';\n\nexport type MoveListItemsOptions = {\n  increase?: boolean;\n  at?: EditorNodesOptions['at'];\n};\n\nexport const moveListItems = (\n  editor: PlateEditor,\n  { increase = true, at = editor.selection ?? undefined }: MoveListItemsOptions = {}\n) => {\n  const _nodes = getNodeEntries(editor, {\n    at,\n    match: {\n      type: getPluginType(editor, ELEMENT_LIC),\n    },\n  });\n\n  // Get the selected lic\n  const lics = Array.from(_nodes);\n\n  if (!lics.length) return;\n\n  const highestLicPaths: Path[] = [];\n  const highestLicPathRefs: PathRef[] = [];\n\n  // Filter out the nested lic, we just need to move the highest ones\n  lics.forEach((lic) => {\n    const licPath = lic[1];\n    const liPath = getParentPath(licPath);\n\n    const isAncestor = highestLicPaths.some((path) => {\n      const highestLiPath = getParentPath(path);\n\n      return isAncestorPath(highestLiPath, liPath);\n    });\n    if (!isAncestor) {\n      highestLicPaths.push(licPath);\n      highestLicPathRefs.push(createPathRef(editor, licPath));\n    }\n  });\n\n  const licPathRefsToMove = increase ? highestLicPathRefs : highestLicPathRefs.reverse();\n\n  withoutNormalizing(editor, () => {\n    licPathRefsToMove.forEach((licPathRef) => {\n      const licPath = licPathRef.unref();\n      if (!licPath) return;\n\n      const liEntry = getListItemEntry(editor, { at: licPath });\n\n      if (!liEntry) {\n        return;\n      }\n\n      if (increase) {\n        moveListItemDown(editor, liEntry);\n      } else if (isListNested(editor, liEntry.list[1])) {\n        moveListItemUp(editor, liEntry);\n      }\n    });\n  });\n};\n","import { BLOCKS } from '@contentful/rich-text-types';\n\nimport {\n  isText,\n  getCommonNode,\n  isRangeExpanded,\n  getRangeEdges,\n  getChildren,\n  getAboveNode,\n  getBlockAbove,\n  getParentNode,\n} from '../../internal/queries';\nimport { insertNodes, removeNodes, wrapNodes } from '../../internal/transforms';\nimport { Node, NodeEntry, PlateEditor, Path, Element } from '../../internal/types';\n\nconst isList = (node: Node) => [BLOCKS.OL_LIST, BLOCKS.UL_LIST].includes(node.type as BLOCKS);\n\nexport const hasListAsDirectParent = (editor: PlateEditor, [, path]: NodeEntry) => {\n  const [parentNode] = (getParentNode(editor, path) || []) as NodeEntry;\n  return isList(parentNode);\n};\n\nconst getNearestListAncestor = (editor: PlateEditor, path: Path) => {\n  return getAboveNode(editor, { at: path, mode: 'lowest', match: isList }) || [];\n};\n\n/**\n * Places orphaned list items in a list. If there's a list somewhere\n * in the node's ancestors, defaults to that list type, else places\n * the list item in an unordered list.\n */\nexport const normalizeOrphanedListItem = (editor: PlateEditor, [, path]: NodeEntry) => {\n  const [parentList] = getNearestListAncestor(editor, path);\n  const parentListType = parentList?.type as string | undefined;\n\n  wrapNodes(\n    editor,\n    { type: parentListType || BLOCKS.UL_LIST, children: [], data: {} },\n    { at: path }\n  );\n};\n\nexport const isNonEmptyListItem = (_: PlateEditor, entry: NodeEntry) => {\n  const listItemChildren = getChildren(entry);\n\n  return listItemChildren.length !== 0;\n};\n\nexport const firstNodeIsNotList = (_editor: PlateEditor, [node]: NodeEntry<Element>) => {\n  if (node.children.length === 1) {\n    const firstNode = node.children[0];\n\n    return !isText(firstNode) && !isList(firstNode);\n  }\n\n  return true;\n};\n\nexport const insertParagraphAsChild = (editor: PlateEditor, [, path]: NodeEntry) => {\n  insertNodes(editor, [{ type: BLOCKS.PARAGRAPH, data: {}, children: [{ text: '' }] }], {\n    at: path.concat([0]),\n  });\n};\n\nexport const replaceNodeWithListItems = (editor: PlateEditor, entry: NodeEntry<Element>) => {\n  const [node, path] = entry;\n\n  removeNodes(editor, { at: path });\n  insertNodes(editor, (node.children[0] as Element).children, { at: path });\n};\n\nexport const isListTypeActive = (editor: PlateEditor, type: BLOCKS): boolean => {\n  const { selection } = editor;\n\n  if (!selection) {\n    return false;\n  }\n\n  if (isRangeExpanded(selection)) {\n    const [start, end] = getRangeEdges(selection);\n    const node = getCommonNode(editor, start.path, end.path);\n\n    if (node[0].type === type) {\n      return true;\n    }\n  }\n\n  // Lists can be nested. Here, we take the list type at the lowest level\n  const listNode = getBlockAbove(editor, {\n    match: {\n      type: [BLOCKS.OL_LIST, BLOCKS.UL_LIST],\n    },\n    mode: 'lowest',\n  });\n\n  return listNode?.[0].type === type;\n};\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { TEXT_CONTAINERS, BLOCKS } from '@contentful/rich-text-types';\nimport { findNode } from '@udecode/plate-core';\n\nimport {\n  isBlockNode,\n  isAncestorPath,\n  getCommonNode,\n  getNodeTexts,\n  getParentPath,\n  getDescendantNodeByPath,\n} from '../../internal/queries';\nimport { insertNodes } from '../../internal/transforms';\nimport { PlateEditor, NodeEntry, Node, Element } from '../../internal/types';\n\nconst getFirstAncestorOfType = (root: Node, entry: NodeEntry): NodeEntry => {\n  let ancestor = getParentPath(entry[1]);\n  while (getDescendantNodeByPath(root, ancestor).type !== BLOCKS.LIST_ITEM) {\n    ancestor = getParentPath(ancestor);\n  }\n\n  return [getDescendantNodeByPath(root, ancestor), ancestor];\n};\n\nconst isListRoot = (node: Node): boolean =>\n  [BLOCKS.UL_LIST, BLOCKS.OL_LIST].includes((node as Element).type as BLOCKS);\n\n/**\n * Removes the \"empty\" leading lis. Empty in this context means lis only with other lis as children.\n *\n * @returns If argument is not a list root, returns it, otherwise returns ul[] or li[].\n */\nconst trimList = (listRoot: Node): Node[] => {\n  if (!isListRoot(listRoot)) {\n    return [listRoot];\n  }\n\n  const textEntries = Array.from(getNodeTexts(listRoot));\n\n  const commonAncestorEntry = textEntries.reduce<NodeEntry>(\n    (commonAncestor, textEntry) =>\n      isAncestorPath(commonAncestor[1], textEntry[1])\n        ? commonAncestor\n        : getCommonNode(listRoot, textEntry[1], commonAncestor[1]),\n    // any list item would do, we grab the first one\n    getFirstAncestorOfType(listRoot, textEntries[0])\n  );\n\n  return isListRoot(commonAncestorEntry[0])\n    ? (commonAncestorEntry[0].children as Node[])\n    : [commonAncestorEntry[0]];\n};\n\n/**\n * Removes leading li when pasting a single li with a single child.\n */\nconst trimLiWrapper = (nodes: Node[]): Node[] => {\n  if (nodes.length !== 1) {\n    return nodes;\n  }\n\n  const node = nodes[0];\n\n  if (node.type !== BLOCKS.LIST_ITEM || (node as Element).children.length !== 1) {\n    return nodes;\n  }\n\n  return node.children as Node[];\n};\n\nconst unwrapTextContainerAtStart = (nodes: Node[]): Node[] => {\n  const node = nodes[0];\n\n  if (TEXT_CONTAINERS.includes((node as Element).type as BLOCKS)) {\n    return [...(node as Element).children, ...nodes.slice(1)];\n  }\n\n  return nodes;\n};\n\nexport const insertListFragment = (editor: PlateEditor) => {\n  const { insertFragment } = editor;\n\n  return (fragment: Node[]) => {\n    if (!editor.selection) {\n      return;\n    }\n\n    const liEntry = findNode(editor, {\n      match: { type: BLOCKS.LIST_ITEM },\n      mode: 'lowest',\n    });\n\n    if (liEntry) {\n      const nodes = unwrapTextContainerAtStart(\n        trimLiWrapper(fragment.flatMap((node) => trimList(node)))\n      );\n\n      let firstBlockIndex = nodes.findIndex((node) => isBlockNode(editor, node));\n\n      if (firstBlockIndex < 0) {\n        firstBlockIndex = nodes.length;\n      }\n\n      const inlines = nodes.slice(0, firstBlockIndex);\n      const blocks = nodes.slice(firstBlockIndex);\n\n      // Two calls to insertNodes are required here. Otherwise, all blocks\n      // after a text or inline element occurrence will be unwrapped for\n      // some reason.\n      insertNodes(editor, inlines, {\n        at: editor.selection,\n        select: true,\n      });\n\n      return insertNodes(editor, blocks, {\n        at: editor.selection,\n        select: true,\n      });\n    }\n\n    const filtered = isListRoot(fragment[0]) ? [{ text: '' }, ...fragment] : fragment;\n\n    return insertFragment(filtered);\n  };\n};\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { LIST_ITEM_BLOCKS } from '@contentful/rich-text-types';\nimport { normalizeList, deleteFragmentList, deleteForwardList } from '@udecode/plate-list';\n\nimport { WithOverride } from '../../internal/types';\nimport { insertListBreak } from './insertListBreak';\nimport { insertListFragment } from './insertListFragment';\nimport { deleteBackwardList } from './transforms/deleteBackwardList';\n\nconst validLiChildrenTypes = LIST_ITEM_BLOCKS;\n\nexport const withList: WithOverride = (editor) => {\n  const { deleteBackward, deleteForward, deleteFragment } = editor;\n\n  editor.deleteBackward = (unit) => {\n    if (deleteBackwardList(editor, unit)) return;\n\n    deleteBackward(unit);\n  };\n\n  editor.deleteForward = (unit) => {\n    if (deleteForwardList(editor)) return;\n\n    deleteForward(unit);\n  };\n\n  editor.deleteFragment = () => {\n    if (deleteFragmentList(editor)) return;\n\n    deleteFragment();\n  };\n\n  editor.insertBreak = insertListBreak(editor);\n\n  editor.insertFragment = insertListFragment(editor);\n\n  // TODO: replace with our own Normalizer rules\n  editor.normalizeNode = normalizeList(editor, { validLiChildrenTypes });\n\n  return editor;\n};\n","/**\n * Credit: Modified version of Plate's list plugin\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport {\n  getListItemEntry,\n  removeFirstListItem,\n  removeListItem,\n  isListNested,\n} from '@udecode/plate-list';\nimport { onKeyDownResetNode, SIMULATE_BACKSPACE } from '@udecode/plate-reset-node';\n\nimport { withoutNormalizing } from '../../../internal';\nimport { mockPlugin } from '../../../internal/misc';\nimport { isSelectionAtBlockStart, isFirstChild } from '../../../internal/queries';\nimport { deleteFragment } from '../../../internal/transforms';\nimport { PlateEditor } from '../../../internal/types';\nimport { unwrapList } from './unwrapList';\n\nexport const deleteBackwardList = (\n  editor: PlateEditor,\n  unit: 'character' | 'word' | 'line' | 'block'\n) => {\n  const res = getListItemEntry(editor, {});\n\n  let moved: boolean | undefined = false;\n\n  if (res) {\n    const { list, listItem } = res;\n\n    if (\n      isSelectionAtBlockStart(editor, {\n        match: (node) => node.type === BLOCKS.LIST_ITEM,\n      })\n    ) {\n      withoutNormalizing(editor, () => {\n        moved = removeFirstListItem(editor, { list, listItem });\n        if (moved) return;\n\n        moved = removeListItem(editor, { list, listItem });\n        if (moved) return;\n\n        if (isFirstChild(listItem[1]) && !isListNested(editor, list[1])) {\n          onKeyDownResetNode(\n            editor,\n            // TODO look into this\n            // @ts-expect-error\n            mockPlugin({\n              options: {\n                rules: [\n                  {\n                    types: [BLOCKS.LIST_ITEM],\n                    defaultType: BLOCKS.PARAGRAPH,\n                    hotkey: 'backspace',\n                    predicate: () => isSelectionAtBlockStart(editor),\n                    onReset: (e: PlateEditor) => unwrapList(e),\n                  },\n                ],\n              },\n            })\n          )(SIMULATE_BACKSPACE);\n          moved = true;\n          return;\n        }\n\n        deleteFragment(editor, {\n          // FIXME: see if we can remove unit\n          // @ts-expect-error\n          unit: unit,\n          reverse: true,\n        });\n        moved = true;\n      });\n    }\n  }\n\n  return moved;\n};\n","/**\n * Credit: Copied & modified version from Plate's list plugin to support\n * list items with multiple children.\n *\n * See: https://github.com/udecode/plate/blob/main/packages/nodes/list\n */\nimport { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\nimport { ELEMENT_DEFAULT, getPluginType, isBlockAboveEmpty, mockPlugin } from '@udecode/plate-core';\nimport { getListItemEntry, moveListItemUp, unwrapList, ELEMENT_LI } from '@udecode/plate-list';\nimport { onKeyDownResetNode, ResetNodePlugin, SIMULATE_BACKSPACE } from '@udecode/plate-reset-node';\n\nimport { PlateEditor, Value } from '../../internal/types';\nimport { insertListItem } from './transforms/insertListItem';\n\nconst listBreak = (editor: PlateEditor): boolean => {\n  if (!editor.selection) return false;\n\n  const res = getListItemEntry(editor, {});\n  let moved: boolean | undefined;\n\n  // If selection is in a li\n  if (res) {\n    const { list, listItem } = res;\n\n    const childNode = listItem[0].children[0];\n\n    // If selected li is empty, move it up.\n    if (\n      isBlockAboveEmpty(editor) &&\n      listItem[0].children.length === 1 &&\n      TEXT_CONTAINERS.includes(childNode.type as BLOCKS)\n    ) {\n      moved = moveListItemUp(editor, {\n        list,\n        listItem,\n      });\n\n      if (moved) return true;\n    }\n  }\n\n  const didReset = onKeyDownResetNode(\n    editor,\n    mockPlugin<ResetNodePlugin, Value, PlateEditor>({\n      options: {\n        rules: [\n          {\n            types: [getPluginType(editor, ELEMENT_LI)],\n            defaultType: getPluginType(editor, ELEMENT_DEFAULT),\n            predicate: () => !moved && isBlockAboveEmpty(editor),\n            onReset: (_editor) => unwrapList(_editor),\n          },\n        ],\n      },\n    })\n  )(SIMULATE_BACKSPACE);\n  if (didReset) {\n    return true;\n  }\n\n  /**\n   * If selection is in li > p, insert li.\n   */\n  if (!moved) {\n    const inserted = insertListItem(editor);\n    if (inserted) return true;\n  }\n\n  return false;\n};\n\nexport const insertListBreak = (editor: PlateEditor) => {\n  const { insertBreak } = editor;\n\n  return () => {\n    if (listBreak(editor)) return;\n\n    insertBreak();\n  };\n};\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\n\nimport { withoutNormalizing } from '../../../internal';\nimport {\n  getAboveNode,\n  getParentNode,\n  isFirstChildPath,\n  isSelectionAtBlockEnd,\n  isSelectionAtBlockStart,\n  getMarks,\n  getNextPath,\n} from '../../../internal/queries';\nimport {\n  select,\n  insertNodes,\n  moveChildren,\n  splitNodes,\n  collapseSelection,\n} from '../../../internal/transforms';\nimport { Element, PlateEditor } from '../../../internal/types';\n\n/**\n * Build a new list item node while preserving marks\n */\nconst emptyListItemNode = (editor: PlateEditor, withChildren = false): Element => {\n  let children: Element[] = [];\n\n  if (withChildren) {\n    const marks = getMarks(editor) || {};\n\n    children = [\n      {\n        type: BLOCKS.PARAGRAPH,\n        data: {},\n        children: [{ text: '', ...marks }],\n      },\n    ];\n  }\n\n  return {\n    type: BLOCKS.LIST_ITEM,\n    data: {},\n    children,\n  };\n};\n\n/**\n * Insert list item if selection is in li>p.\n */\nexport const insertListItem = (editor: PlateEditor): boolean => {\n  if (!editor.selection) {\n    return false;\n  }\n\n  // Naming it paragraph for simplicity but can be a heading as well\n  const paragraph = getAboveNode(editor, { match: { type: TEXT_CONTAINERS } });\n  if (!paragraph) {\n    return false;\n  }\n\n  const [, paragraphPath] = paragraph;\n  const listItem = getParentNode(editor, paragraphPath);\n\n  if (!listItem) {\n    return false;\n  }\n\n  const [listItemNode, listItemPath] = listItem;\n\n  if (listItemNode.type !== BLOCKS.LIST_ITEM) {\n    return false;\n  }\n\n  // We are in a li>p (or heading)\n\n  withoutNormalizing(editor, () => {\n    if (!editor.selection) {\n      return;\n    }\n\n    // Check the cursor position in the current paragraph\n    const isAtStart = isSelectionAtBlockStart(editor);\n    const isAtEnd = isSelectionAtBlockEnd(editor);\n\n    const isAtStartOfListItem = isAtStart && isFirstChildPath(paragraphPath);\n    const shouldSplit = !isAtStart && !isAtEnd;\n\n    // Split the current paragraph content if necessary\n    if (shouldSplit) {\n      splitNodes(editor);\n    }\n\n    // Insert the new li\n    const newListItemPath = isAtStartOfListItem ? listItemPath : getNextPath(listItemPath);\n\n    insertNodes(\n      editor,\n      // Add an empty paragraph to the new li if We will not move some\n      // paragraphs over there.\n      emptyListItemNode(editor, !shouldSplit),\n      { at: newListItemPath }\n    );\n\n    // Move children *after* selection to the new li\n    const fromPath = isAtStart ? paragraphPath : getNextPath(paragraphPath);\n    const fromStartIndex = fromPath[fromPath.length - 1] || 0;\n\n    // On split we don't add paragraph to the new li so we move\n    // content to the very beginning. Otherwise, account for the empty\n    // paragraph at the beginning by moving the content after\n    const toPath = newListItemPath.concat([shouldSplit ? 0 : 1]);\n\n    if (!isAtStartOfListItem) {\n      moveChildren(editor, {\n        at: listItemPath,\n        to: toPath,\n        fromStartIndex,\n      });\n    }\n\n    // Move cursor to the start of the new li\n    select(editor, newListItemPath);\n    collapseSelection(editor, { edge: 'start' });\n  });\n\n  // Returning True skips processing other editor.insertBreak handlers\n  return true;\n};\n","import * as React from 'react';\n\nimport { ListBulletedIcon, ListNumberedIcon } from '@contentful/f36-icons';\nimport { BLOCKS } from '@contentful/rich-text-types';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { focus } from '../../../helpers/editor';\nimport { isNodeTypeEnabled } from '../../../helpers/validations';\nimport { useSdkContext } from '../../../SdkProvider';\nimport { ToolbarButton } from '../../shared/ToolbarButton';\nimport { toggleList } from '../transforms/toggleList';\nimport { isListTypeActive } from '../utils';\n\nexport interface ToolbarListButtonProps {\n  isDisabled?: boolean;\n}\n\nexport function ToolbarListButton(props: ToolbarListButtonProps) {\n  const sdk = useSdkContext();\n  const editor = useContentfulEditor();\n\n  function handleClick(type: BLOCKS): () => void {\n    return () => {\n      if (!editor?.selection) return;\n\n      toggleList(editor, { type });\n\n      focus(editor);\n    };\n  }\n\n  if (!editor) return null;\n\n  return (\n    <React.Fragment>\n      {isNodeTypeEnabled(sdk.field, BLOCKS.UL_LIST) && (\n        <ToolbarButton\n          title=\"UL\"\n          testId=\"ul-toolbar-button\"\n          onClick={handleClick(BLOCKS.UL_LIST)}\n          isActive={isListTypeActive(editor, BLOCKS.UL_LIST)}\n          isDisabled={props.isDisabled}\n        >\n          <ListBulletedIcon />\n        </ToolbarButton>\n      )}\n      {isNodeTypeEnabled(sdk.field, BLOCKS.OL_LIST) && (\n        <ToolbarButton\n          title=\"OL\"\n          testId=\"ol-toolbar-button\"\n          onClick={handleClick(BLOCKS.OL_LIST)}\n          isActive={isListTypeActive(editor, BLOCKS.OL_LIST)}\n          isDisabled={props.isDisabled}\n        >\n          <ListNumberedIcon />\n        </ToolbarButton>\n      )}\n    </React.Fragment>\n  );\n}\n","import { MARKS } from '@contentful/rich-text-types';\nimport isHotkey from 'is-hotkey';\n\nimport { isMarkActive } from '../../internal/queries';\nimport { toggleMark } from '../../internal/transforms';\nimport { PlateEditor, HotkeyPlugin, KeyboardHandler } from '../../internal/types';\n\nexport const toggleMarkAndDeactivateConflictingMarks = (editor: PlateEditor, mark: MARKS) => {\n  const subs = [MARKS.SUPERSCRIPT, MARKS.SUBSCRIPT];\n  const clear = subs.includes(mark) ? subs : [];\n  toggleMark(editor, { key: mark, clear });\n};\n\nexport const buildMarkEventHandler =\n  (type: MARKS): KeyboardHandler<HotkeyPlugin> =>\n  (editor, { options: { hotkey } }) =>\n  (event) => {\n    if (editor.selection && hotkey && isHotkey(hotkey, event)) {\n      event.preventDefault();\n\n      const isActive = isMarkActive(editor, type);\n      editor.tracking.onShortcutAction(isActive ? 'unmark' : 'mark', { markType: type });\n      toggleMarkAndDeactivateConflictingMarks(editor, type);\n    }\n  };\n","import * as React from 'react';\n\nimport { Menu } from '@contentful/f36-components';\nimport tokens from '@contentful/f36-tokens';\nimport { MARKS } from '@contentful/rich-text-types';\nimport { css, cx } from 'emotion';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { focus } from '../../../helpers/editor';\nimport { isMarkActive } from '../../../internal/queries';\nimport { ToolbarButton } from '../../shared/ToolbarButton';\nimport { toggleMarkAndDeactivateConflictingMarks } from '../helpers';\n\nexport interface MarkOptions {\n  mark: MARKS;\n  title: string;\n  icon?: React.ReactElement;\n}\n\nconst styles = {\n  isActive: css({\n    backgroundColor: tokens.blue100,\n    color: tokens.blue600,\n  }),\n};\n\nexport const createMarkToolbarButton = ({ mark, title, icon }: MarkOptions) => {\n  const Mark = ({ isDisabled }: { isDisabled?: boolean }) => {\n    const editor = useContentfulEditor();\n\n    const handleClick = React.useCallback(() => {\n      if (!editor?.selection) return;\n\n      const isActive = isMarkActive(editor, mark);\n      editor.tracking.onToolbarAction(isActive ? 'unmark' : 'mark', { markType: mark });\n\n      toggleMarkAndDeactivateConflictingMarks(editor, mark);\n      focus(editor);\n    }, [editor]);\n\n    if (!editor) return null;\n\n    if (!icon) {\n      return (\n        <Menu.Item\n          onClick={handleClick}\n          disabled={isDisabled}\n          className={cx({\n            [styles.isActive]: isMarkActive(editor, mark),\n          })}\n          testId={`${mark}-toolbar-button`}\n        >\n          {title}\n        </Menu.Item>\n      );\n    }\n\n    return (\n      <ToolbarButton\n        title={title}\n        testId={`${mark}-toolbar-button`}\n        onClick={handleClick}\n        isActive={isMarkActive(editor, mark)}\n        isDisabled={isDisabled}\n      >\n        {icon}\n      </ToolbarButton>\n    );\n  };\n\n  Mark.displayName = mark;\n\n  return Mark;\n};\n","import * as React from 'react';\n\nimport { FormatBoldIcon } from '@contentful/f36-icons';\nimport { MARKS } from '@contentful/rich-text-types';\nimport { createBoldPlugin as createDefaultBoldPlugin } from '@udecode/plate-basic-marks';\nimport { css } from 'emotion';\n\nimport { someHtmlElement } from '../../internal/queries';\nimport { PlatePlugin, RenderLeafProps } from '../../internal/types';\nimport { createMarkToolbarButton } from './components/MarkToolbarButton';\nimport { buildMarkEventHandler } from './helpers';\n\nexport const ToolbarBoldButton = createMarkToolbarButton({\n  title: 'Bold',\n  mark: MARKS.BOLD,\n  icon: <FormatBoldIcon />,\n});\n\nconst styles = {\n  bold: css({\n    fontWeight: 600,\n  }),\n};\n\nexport function Bold(props: RenderLeafProps) {\n  return (\n    <strong {...props.attributes} className={styles.bold}>\n      {props.children}\n    </strong>\n  );\n}\n\nconst isGoogleBoldWrapper = (el: HTMLElement) =>\n  el.id.startsWith('docs-internal-guid') && el.nodeName === 'B';\n\nexport const createBoldPlugin = (): PlatePlugin =>\n  createDefaultBoldPlugin({\n    type: MARKS.BOLD,\n    component: Bold,\n    options: {\n      hotkey: ['mod+b'],\n    },\n    handlers: {\n      onKeyDown: buildMarkEventHandler(MARKS.BOLD),\n    },\n    deserializeHtml: {\n      rules: [\n        { validNodeName: ['STRONG', 'B'] },\n        {\n          validStyle: {\n            fontWeight: ['600', '700', 'bold'],\n          },\n        },\n      ],\n      query: (el) => {\n        return (\n          !isGoogleBoldWrapper(el) &&\n          !someHtmlElement(el, (node) => node.style.fontWeight === 'normal')\n        );\n      },\n    },\n  });\n","import * as React from 'react';\n\nimport { CodeIcon } from '@contentful/f36-icons';\nimport { MARKS } from '@contentful/rich-text-types';\nimport { createCodePlugin as createDefaultCodePlugin } from '@udecode/plate-basic-marks';\nimport { css } from 'emotion';\n\nimport { PlatePlugin, RenderLeafProps } from '../../internal/types';\nimport { createMarkToolbarButton } from './components/MarkToolbarButton';\nimport { buildMarkEventHandler } from './helpers';\n\nexport const ToolbarCodeButton = createMarkToolbarButton({\n  title: 'Code',\n  mark: MARKS.CODE,\n  icon: <CodeIcon />,\n});\n\nexport const ToolbarDropdownCodeButton = createMarkToolbarButton({\n  title: 'Code',\n  mark: MARKS.CODE,\n});\n\nconst styles = {\n  code: css({\n    fontFamily: 'monospace',\n    fontSize: '.9em',\n  }),\n};\n\nexport function Code(props: RenderLeafProps) {\n  return (\n    <code {...props.attributes} className={styles.code}>\n      {props.children}\n    </code>\n  );\n}\n\nexport const createCodePlugin = (): PlatePlugin =>\n  createDefaultCodePlugin({\n    type: MARKS.CODE,\n    component: Code,\n    options: {\n      // We need to define multiple hotkeys here,\n      // - mod+/ -> QWERTY keyboard layout\n      // - mod+shift+7 -> QWERTZ keyboard layout\n      // The workaround like in packages/rich-text/src/plugins/CommandPalette/onKeyDown.ts is sadly not working here,\n      // as `shift+7` is not interpreted as `/` with the `mod` key by the OS.\n      // TODO: there are a lot more different keyboard layouts out there\n      hotkey: ['mod+/', 'mod+shift+7'],\n    },\n    handlers: {\n      onKeyDown: buildMarkEventHandler(MARKS.CODE),\n    },\n    deserializeHtml: {\n      rules: [\n        {\n          validNodeName: ['CODE', 'PRE'],\n        },\n        {\n          validStyle: {\n            fontFamily: ['Consolas', 'monospace'],\n          },\n        },\n      ],\n    },\n  });\n","import * as React from 'react';\n\nimport { FormatItalicIcon } from '@contentful/f36-icons';\nimport { MARKS } from '@contentful/rich-text-types';\nimport { createItalicPlugin as createDefaultItalicPlugin } from '@udecode/plate-basic-marks';\nimport { css } from 'emotion';\n\nimport { someHtmlElement } from '../../internal/queries';\nimport { PlatePlugin, RenderLeafProps } from '../../internal/types';\nimport { createMarkToolbarButton } from './components/MarkToolbarButton';\nimport { buildMarkEventHandler } from './helpers';\n\nexport const ToolbarItalicButton = createMarkToolbarButton({\n  title: 'Italic',\n  mark: MARKS.ITALIC,\n  icon: <FormatItalicIcon />,\n});\n\nconst styles = {\n  italic: css({\n    fontStyle: 'italic',\n  }),\n};\n\nexport function Italic(props: RenderLeafProps) {\n  return (\n    <em {...props.attributes} className={styles.italic}>\n      {props.children}\n    </em>\n  );\n}\n\nexport const createItalicPlugin = (): PlatePlugin =>\n  createDefaultItalicPlugin({\n    type: MARKS.ITALIC,\n    component: Italic,\n    options: {\n      hotkey: ['mod+i'],\n    },\n    handlers: {\n      onKeyDown: buildMarkEventHandler(MARKS.ITALIC),\n    },\n    deserializeHtml: {\n      rules: [\n        { validNodeName: ['I', 'EM'] },\n        {\n          validStyle: {\n            fontStyle: 'italic',\n          },\n        },\n      ],\n      query: (el) => {\n        return !someHtmlElement(el, (node) => node.style.fontStyle === 'normal');\n      },\n    },\n  });\n","import * as React from 'react';\n\nimport { SubscriptIcon } from '@contentful/f36-icons';\nimport { MARKS } from '@contentful/rich-text-types';\nimport { createSubscriptPlugin as createDefaultSubscriptPlugin } from '@udecode/plate-basic-marks';\nimport { css } from 'emotion';\n\nimport { PlatePlugin, RenderLeafProps } from '../../internal/types';\nimport { createMarkToolbarButton } from './components/MarkToolbarButton';\nimport { buildMarkEventHandler } from './helpers';\n\nconst styles = {\n  subscript: css({\n    verticalAlign: 'sub',\n    fontSize: 'smaller',\n  }),\n};\n\nexport const ToolbarSubscriptButton = createMarkToolbarButton({\n  title: 'Subscript',\n  mark: MARKS.SUBSCRIPT,\n  icon: <SubscriptIcon viewBox=\"0 0 23 18\" />,\n});\n\nexport const ToolbarDropdownSubscriptButton = createMarkToolbarButton({\n  title: 'Subscript',\n  mark: MARKS.SUBSCRIPT,\n});\n\nexport function Subscript(props: RenderLeafProps) {\n  return (\n    <sub {...props.attributes} className={styles.subscript}>\n      {props.children}\n    </sub>\n  );\n}\n\nexport const createSubscriptPlugin = (): PlatePlugin =>\n  createDefaultSubscriptPlugin({\n    type: MARKS.SUBSCRIPT,\n    component: Subscript,\n    handlers: {\n      onKeyDown: buildMarkEventHandler(MARKS.SUBSCRIPT),\n    },\n    deserializeHtml: {\n      rules: [\n        {\n          validNodeName: ['SUB'],\n        },\n      ],\n    },\n  });\n","import * as React from 'react';\n\nimport { SuperscriptIcon } from '@contentful/f36-icons';\nimport { MARKS } from '@contentful/rich-text-types';\nimport { createSuperscriptPlugin as createDefaultSuperscriptPlugin } from '@udecode/plate-basic-marks';\nimport { css } from 'emotion';\n\nimport { PlatePlugin, RenderLeafProps } from '../../internal/types';\nimport { createMarkToolbarButton } from './components/MarkToolbarButton';\nimport { buildMarkEventHandler } from './helpers';\n\nconst styles = {\n  superscript: css({\n    verticalAlign: 'super',\n    fontSize: 'smaller',\n  }),\n};\n\nexport const ToolbarSuperscriptButton = createMarkToolbarButton({\n  title: 'Superscript',\n  mark: MARKS.SUPERSCRIPT,\n  icon: <SuperscriptIcon />,\n});\n\nexport const ToolbarDropdownSuperscriptButton = createMarkToolbarButton({\n  title: 'Superscript',\n  mark: MARKS.SUPERSCRIPT,\n});\n\nexport function Superscript(props: RenderLeafProps) {\n  return (\n    <sup {...props.attributes} className={styles.superscript}>\n      {props.children}\n    </sup>\n  );\n}\n\nexport const createSuperscriptPlugin = (): PlatePlugin =>\n  createDefaultSuperscriptPlugin({\n    type: MARKS.SUPERSCRIPT,\n    component: Superscript,\n    handlers: {\n      onKeyDown: buildMarkEventHandler(MARKS.SUPERSCRIPT),\n    },\n    deserializeHtml: {\n      rules: [\n        {\n          validNodeName: ['SUP'],\n        },\n      ],\n    },\n  });\n","import * as React from 'react';\n\nimport { FormatUnderlinedIcon } from '@contentful/f36-icons';\nimport { MARKS } from '@contentful/rich-text-types';\nimport { createUnderlinePlugin as createDefaultUnderlinePlugin } from '@udecode/plate-basic-marks';\n\nimport { someHtmlElement } from '../../internal/queries';\nimport { PlatePlugin, RenderLeafProps } from '../../internal/types';\nimport { createMarkToolbarButton } from './components/MarkToolbarButton';\nimport { buildMarkEventHandler } from './helpers';\n\nexport const ToolbarUnderlineButton = createMarkToolbarButton({\n  title: 'Underline',\n  mark: MARKS.UNDERLINE,\n  icon: <FormatUnderlinedIcon />,\n});\n\nexport function Underline(props: RenderLeafProps) {\n  return <u {...props.attributes}>{props.children}</u>;\n}\n\nexport const createUnderlinePlugin = (): PlatePlugin =>\n  createDefaultUnderlinePlugin({\n    type: MARKS.UNDERLINE,\n    component: Underline,\n    options: {\n      hotkey: ['mod+u'],\n    },\n    handlers: {\n      onKeyDown: buildMarkEventHandler(MARKS.UNDERLINE),\n    },\n    deserializeHtml: {\n      rules: [\n        {\n          validNodeName: ['U'],\n        },\n        {\n          validStyle: {\n            textDecoration: ['underline'],\n          },\n        },\n      ],\n      query: (el) => {\n        return !someHtmlElement(el, (node) => node.style.textDecoration === 'none');\n      },\n    },\n  });\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\n\nimport { INLINE_TYPES } from '../../helpers/editor';\nimport { transformWrapIn } from '../../helpers/transformers';\nimport { getParentNode, isText } from '../../internal/queries';\nimport { Element } from '../../internal/types';\nimport { NormalizerRule } from './types';\n\nconst isInline = (node: Element) => INLINE_TYPES.includes(node.type);\nconst isTextContainer = (node: Element) => TEXT_CONTAINERS.includes(node.type as BLOCKS);\n\n// Base rules are rules that must be enforced at all times regardless\n// of which plugins are enabled.\nexport const baseRules: Required<NormalizerRule>[] = [\n  {\n    // Wrap orphaned text nodes in a paragraph\n    match: isText,\n    validNode: (editor, [, path]) => {\n      const parent = getParentNode(editor, path)?.[0] as Element;\n      return !!parent && (isTextContainer(parent) || isInline(parent) || editor.isVoid(parent));\n    },\n    transform: (editor, entry) => {\n      return transformWrapIn(BLOCKS.PARAGRAPH)(editor, entry);\n    },\n  },\n  {\n    // Wrap orphaned inline nodes in a paragraph,\n    match: {\n      type: INLINE_TYPES,\n    },\n    validNode: (editor, [, path]) => {\n      const parent = getParentNode(editor, path)?.[0] as Element;\n      return !!parent && isTextContainer(parent);\n    },\n    transform: transformWrapIn(BLOCKS.PARAGRAPH),\n  },\n];\n","import { isElement } from '../../internal/queries';\nimport { NodeValidator, NodeTransformer } from './types';\n\nexport class NormalizerError extends Error {}\n\nexport const createValidatorFromTypes =\n  (types: string[]): NodeValidator =>\n  (_, [node]) => {\n    return isElement(node) && types.includes(node.type);\n  };\n\nexport const createTransformerFromObject = (\n  transforms: Record<string, NodeTransformer>\n): NodeTransformer => {\n  // A default transformer must always be provided\n  const fallback = transforms['default'];\n\n  if (!fallback) {\n    throw new NormalizerError('A default transformer MUST be provided');\n  }\n\n  return (editor, entry) => {\n    const [node] = entry;\n    const key = isElement(node) ? node.type : 'default';\n\n    const transformer = transforms[key] || fallback;\n\n    return transformer(editor, entry);\n  };\n};\n","import isPlainObject from 'is-plain-obj';\n\nimport { transformRemove } from '../../helpers/transformers';\nimport { withoutNormalizing } from '../../internal';\nimport { getChildren, matchNode, getPluginType } from '../../internal/queries';\nimport { PlateEditor, PlatePlugin, NodeEntry } from '../../internal/types';\nimport { baseRules } from './baseRules';\nimport { NormalizerRule, NodeTransformer, NodeValidator } from './types';\nimport { NormalizerError, createValidatorFromTypes, createTransformerFromObject } from './utils';\n\nexport const withNormalizer = (editor: PlateEditor) => {\n  const rules: Required<NormalizerRule>[] = baseRules;\n\n  // Derive normalization rules from other plugin's configurations\n  for (const p of editor.plugins as PlatePlugin[]) {\n    const { normalizer: _rules } = p;\n\n    if (!_rules) {\n      continue;\n    }\n\n    for (const _rule of _rules) {\n      // Clone to avoid mutation bugs\n      const rule = { ..._rule };\n\n      if (!rule.match && !p.isElement) {\n        throw new NormalizerError('rule.match MUST be defined in a non-element plugin');\n      }\n\n      // By default we filter elements with given plugin type\n      if (!rule.match) {\n        rule.match = {\n          type: getPluginType(editor, p.key),\n        };\n      }\n\n      // Conditional transformation e.g.\n      // {\n      //   [BLOCKS.EMBEDDED_ASSET]: transformLift,\n      //   default?: transformRemove\n      // }\n      //\n      if (isPlainObject(rule.transform)) {\n        if ('validNode' in rule) {\n          // I can't think of a use case. Disabled to prevent misuse\n          throw new NormalizerError(\n            'conditional transformations are not supported in validNode rules'\n          );\n        }\n\n        rule.transform = createTransformerFromObject({\n          default: transformRemove,\n          ...rule.transform,\n        });\n      }\n\n      // By default all invalid nodes are removed.\n      if (!rule.transform) {\n        rule.transform = transformRemove;\n      }\n\n      // Convert Types array syntax to a validator function\n      if ('validChildren' in rule && Array.isArray(rule.validChildren)) {\n        rule.validChildren = createValidatorFromTypes(rule.validChildren);\n      }\n\n      rules.push(rule as Required<NormalizerRule>);\n    }\n  }\n\n  // Wrap transformer in a withoutNormalizing() call to avoid unnecessary\n  // normalization cycles.\n  const _transform = (tr: NodeTransformer, entry: NodeEntry) => {\n    withoutNormalizing(editor, () => {\n      tr(editor, entry);\n    });\n  };\n\n  const { normalizeNode } = editor;\n\n  // @ts-expect-error\n  editor.normalizeNode = (entry: NodeEntry) => {\n    const [node, path] = entry;\n    const children = getChildren(entry);\n\n    // The order of validNode rules Vs validChildren doesn't matter. Slate\n    // will always perform normalization in a depth-first fashion.\n    for (const rule of rules) {\n      if (!matchNode(node, path, rule.match)) {\n        continue;\n      }\n\n      // Normalize node\n      if ('validNode' in rule && !rule.validNode(editor, entry)) {\n        _transform(rule.transform as NodeTransformer, entry);\n        return;\n      }\n\n      // Normalize node.children\n      if ('validChildren' in rule) {\n        // It can not be an array since we enforced it earlier\n        const isValidChild = rule.validChildren as NodeValidator;\n\n        const invalidChildEntry = children.find((entry) => !isValidChild(editor, entry));\n\n        if (invalidChildEntry) {\n          _transform(rule.transform as NodeTransformer, invalidChildEntry);\n          return;\n        }\n      }\n    }\n\n    return normalizeNode(entry);\n  };\n\n  return editor;\n};\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\n\nimport { RenderElementProps } from '../../internal/types';\n\nconst styles = {\n  [BLOCKS.PARAGRAPH]: css`\n    line-height: ${tokens.lineHeightDefault};\n    margin-bottom: 1.5em;\n  `,\n};\n\nexport function Paragraph(props: RenderElementProps) {\n  return (\n    <div {...props.attributes} className={styles[BLOCKS.PARAGRAPH]}>\n      {props.children}\n    </div>\n  );\n}\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport { createParagraphPlugin as createDefaultParagraphPlugin } from '@udecode/plate-paragraph';\nimport isHotkey from 'is-hotkey';\n\nimport { isInlineOrText, toggleElement } from '../../helpers/editor';\nimport { transformUnwrap, transformLift } from '../../helpers/transformers';\nimport { PlatePlugin, KeyboardHandler, HotkeyPlugin } from '../../internal/types';\nimport { Paragraph } from './Paragraph';\nimport { isEmbedElement, isEmptyElement } from './utils';\n\nconst buildParagraphKeyDownHandler: KeyboardHandler<HotkeyPlugin> =\n  (editor, { options: { hotkey } }) =>\n  (event) => {\n    if (editor.selection && hotkey && isHotkey(hotkey, event)) {\n      toggleElement(editor, { activeType: BLOCKS.PARAGRAPH, inactiveType: BLOCKS.PARAGRAPH });\n    }\n  };\n\nexport const createParagraphPlugin = (): PlatePlugin => {\n  const config: Partial<PlatePlugin> = {\n    type: BLOCKS.PARAGRAPH,\n    component: Paragraph,\n    options: {\n      hotkey: ['mod+opt+0'],\n    },\n    handlers: {\n      onKeyDown: buildParagraphKeyDownHandler,\n    },\n    softBreak: [\n      // create a new line with SHIFT+Enter inside a paragraph\n      {\n        hotkey: 'shift+enter',\n        query: {\n          allow: BLOCKS.PARAGRAPH,\n        },\n      },\n    ],\n    deserializeHtml: {\n      rules: [\n        {\n          validNodeName: ['P', 'DIV'],\n        },\n      ],\n      query: (el) => !isEmptyElement(el) && !isEmbedElement(el),\n    },\n    normalizer: [\n      {\n        validChildren: (_, [node]) => isInlineOrText(node),\n        transform: {\n          [BLOCKS.PARAGRAPH]: transformUnwrap,\n          default: transformLift,\n        },\n      },\n    ],\n  };\n\n  return createDefaultParagraphPlugin(config);\n};\n","import { sanitizeSheets } from './sanitizeSheets';\n\n/**\n * Remove all <style> tags\n */\nconst stripStyleTags = (doc: Document): Document => {\n  doc.querySelectorAll('style').forEach((e) => {\n    e.remove();\n  });\n\n  return doc;\n};\n\nconst transformers = [stripStyleTags, sanitizeSheets];\n\nexport const sanitizeHTML = (html: string): string => {\n  // Parse the HTML string and pipe it through our transformers\n  const doc = transformers.reduce(\n    (value, cb) => cb(value),\n    new DOMParser().parseFromString(html, 'text/html')\n  );\n\n  return doc.body.innerHTML\n    .replace(/>\\s+</g, '><') // Remove whitespace between tags\n    .replace(/(.*)<div.*>(<table.*<\\/table>)<\\/div>(.*)/g, '$1$2$3'); // remove div containers from tables\n};\n","/**\n * Remove empty spreadsheets columns/rows for performance reasons.\n */\nexport const sanitizeSheets = (doc: Document): Document => {\n  // Ensure we are inside a spreadsheet i.e. not pasting\n  // a table from within the editor\n  const supported = [\n    // Google Sheets\n    'google-sheets-html-origin',\n    // MS Excel\n    'meta[content=\"Excel.Sheet\"]',\n    'meta[content*=\"Microsoft Excel\"]',\n  ];\n\n  if (!supported.some((selector) => !!doc.querySelector(selector))) {\n    return doc;\n  }\n\n  const isEmptyElement = (el: Element) => {\n    return (el.textContent ?? '').trim() === '';\n  };\n\n  const tables = Array.from(doc.querySelectorAll('table'));\n\n  for (const table of tables) {\n    // Remove empty columns first!\n    table.querySelectorAll('tr').forEach((row) => {\n      isEmptyElement(row) && row.remove();\n    });\n\n    const rows = Array.from(table.querySelectorAll('tr'));\n\n    // CSS :nth-of-type index starts from 1\n    let colIndex = 1;\n\n    // eslint-disable-next-line -- TODO: explain this disable\n    while (true) {\n      const cells = rows\n        .map((row) => row.querySelector(`th:nth-of-type(${colIndex}), td:nth-of-type(${colIndex})`))\n        .filter((cell): cell is Element => !!cell);\n\n      // No more columns\n      if (cells.length === 0) {\n        break;\n      }\n\n      const isEmpty = cells.every((cell) => isEmptyElement(cell));\n\n      // Don't increment on deletion because columns will be shifted\n      // left anyway. Incrementing may result in skipping\n      if (!isEmpty) {\n        colIndex += 1;\n        continue;\n      }\n\n      cells.forEach((cell) => cell.remove());\n    }\n  }\n\n  return doc;\n};\n","import { KEY_DESERIALIZE_HTML } from '@udecode/plate-core';\n\nimport { PlatePlugin } from '../../internal/types';\nimport { sanitizeHTML } from './utils/sanitizeHTML';\n\n/**\n * Get x-slate-fragment attribute from data-slate-fragment\n */\nconst catchSlateFragment = /data-slate-fragment=\"(.+?)\"/m;\nexport const getSlateFragmentAttribute = (dataTransfer: DataTransfer): string | void => {\n  const htmlData = dataTransfer.getData('text/html');\n  const [, fragment] = htmlData.match(catchSlateFragment) || [];\n  return fragment;\n};\n\n/**\n * Get the x-slate-fragment attribute that exist in text/html data\n * and append it to the DataTransfer object\n */\nexport const ensureXSlateFragment = (dataTransfer: DataTransfer): DataTransfer => {\n  if (!dataTransfer.getData('application/x-slate-fragment')) {\n    const fragment = getSlateFragmentAttribute(dataTransfer);\n    if (fragment) {\n      const clipboardData = new DataTransfer();\n      dataTransfer.types.forEach((type) => {\n        clipboardData.setData(type, dataTransfer.getData(type));\n      });\n      clipboardData.setData('application/x-slate-fragment', fragment);\n      return clipboardData;\n    }\n  }\n  return dataTransfer;\n};\n\nexport const createPasteHTMLPlugin = (): PlatePlugin => ({\n  key: 'PasteHTMLPlugin',\n  withOverrides: (editor) => {\n    const { insertData } = editor;\n    editor.insertData = (data) => insertData(ensureXSlateFragment(data));\n    return editor;\n  },\n  inject: {\n    pluginsByKey: {\n      [KEY_DESERIALIZE_HTML]: {\n        editor: {\n          insertData: {\n            format: 'text/html',\n            // Perform custom content transformation *before* pasting\n            transformData: sanitizeHTML,\n          },\n        },\n      },\n    },\n  },\n});\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { css } from 'emotion';\n\nimport { RenderElementProps } from '../../../internal/types';\n\nconst style = css({\n  margin: '0 0 1.3125rem',\n  borderLeft: `6px solid ${tokens.gray200}`,\n  paddingLeft: '0.875rem',\n  fontStyle: 'normal',\n});\n\nexport function Quote(props: RenderElementProps) {\n  return (\n    <blockquote {...props.attributes} className={style}>\n      {props.children}\n    </blockquote>\n  );\n}\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\nimport { isLastChild, hasSingleChild } from '@udecode/plate-core';\n\nimport { getAboveNode, getBlockAbove, isAncestorEmpty } from '../../internal/queries';\nimport { PlateEditor, Ancestor } from '../../internal/types';\n\n/**\n * Returns true if we are:\n * 1) Inside a blockquote\n * 2) With no only one child paragraph/heading and\n * 3) that child is empty\n */\nexport const shouldResetQuoteOnBackspace = (editor: PlateEditor) => {\n  const container = getAboveNode(editor, {\n    match: { type: TEXT_CONTAINERS },\n    mode: 'lowest',\n  });\n\n  if (!container) {\n    return false;\n  }\n\n  if (!isAncestorEmpty(editor, container[0] as Ancestor)) {\n    return false;\n  }\n\n  const quote = getBlockAbove(editor, {\n    match: { type: BLOCKS.QUOTE },\n    mode: 'lowest',\n  });\n\n  if (!quote) {\n    return false;\n  }\n\n  if (hasSingleChild(quote[0]) && isLastChild(quote, container[1])) {\n    return true;\n  }\n\n  return false;\n};\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport isHotkey from 'is-hotkey';\n\nimport { isBlockSelected } from '../../helpers/editor';\nimport { withoutNormalizing, wrapNodes, unwrapNodes, isElement } from '../../internal';\nimport { KeyboardHandler, HotkeyPlugin, PlateEditor } from '../../internal/types';\nimport { TrackingPluginActions } from '../../plugins/Tracking';\n\nexport function toggleQuote(\n  editor: PlateEditor,\n  logAction?: TrackingPluginActions['onShortcutAction'] | TrackingPluginActions['onToolbarAction']\n): void {\n  if (!editor.selection) return;\n\n  const isActive = isBlockSelected(editor, BLOCKS.QUOTE);\n\n  logAction?.(isActive ? 'remove' : 'insert', { nodeType: BLOCKS.QUOTE });\n\n  withoutNormalizing(editor, () => {\n    if (!editor.selection) return;\n\n    unwrapNodes(editor, {\n      match: (node) => isElement(node) && node.type === BLOCKS.QUOTE,\n      split: true,\n    });\n\n    if (!isActive) {\n      const quote = {\n        type: BLOCKS.QUOTE,\n        data: {},\n        children: [],\n      };\n\n      wrapNodes(editor, quote);\n    }\n  });\n}\n\nexport const onKeyDownToggleQuote: KeyboardHandler<HotkeyPlugin> = (editor, plugin) => (event) => {\n  const { hotkey } = plugin.options;\n\n  if (hotkey && isHotkey(hotkey, event)) {\n    event.preventDefault();\n    toggleQuote(editor, editor.tracking.onShortcutAction);\n  }\n};\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\nimport { BaseRange, BaseSelection, Element, Point } from 'slate';\n\nimport { getAboveNode, getText } from '../../internal/queries';\nimport { deleteText, insertNodes } from '../../internal/transforms';\nimport { WithOverride } from '../../internal/types';\n\nexport const withQuote: WithOverride = (editor) => {\n  const { insertFragment } = editor;\n\n  editor.insertFragment = (fragment) => {\n    const startingNode = fragment.length && fragment[0];\n    const startsWithBlockquote =\n      Element.isElement(startingNode) && startingNode.type === BLOCKS.QUOTE;\n\n    const containerEntry = getAboveNode(editor, {\n      match: {\n        type: TEXT_CONTAINERS,\n      },\n    });\n\n    const containerIsNotEmpty = containerEntry && getText(editor, containerEntry[1]) !== '';\n\n    if (startsWithBlockquote && containerIsNotEmpty) {\n      const { selection } = editor;\n      const isContentSelected = (selection: BaseSelection): selection is BaseRange =>\n        !!selection && Point.compare(selection.anchor, selection.focus) !== 0;\n      // if something is selected (highlighted) we replace the selection\n      if (isContentSelected(selection)) {\n        deleteText(editor, { at: selection });\n      }\n\n      // get the cursor entry again, it may be different after deletion\n      const containerEntry = getAboveNode(editor, {\n        match: {\n          type: TEXT_CONTAINERS,\n        },\n      });\n\n      const containerIsNotEmpty = containerEntry && getText(editor, containerEntry[1]) !== '';\n\n      if (containerIsNotEmpty) {\n        insertNodes(editor, fragment);\n        return;\n      }\n    }\n\n    insertFragment(fragment);\n  };\n\n  return editor;\n};\n","import { BLOCKS, CONTAINERS } from '@contentful/rich-text-types';\n\nimport { transformLift, transformUnwrap } from '../../helpers/transformers';\nimport { PlatePlugin } from '../../internal/types';\nimport { Quote } from './components/Quote';\nimport { shouldResetQuoteOnBackspace } from './shouldResetQuote';\nimport { onKeyDownToggleQuote, toggleQuote } from './toggleQuote';\nimport { withQuote } from './withQuote';\n\nexport function createQuotePlugin(): PlatePlugin {\n  return {\n    key: BLOCKS.QUOTE,\n    type: BLOCKS.QUOTE,\n    isElement: true,\n    component: Quote,\n    options: {\n      hotkey: 'mod+shift+1',\n    },\n    handlers: {\n      onKeyDown: onKeyDownToggleQuote,\n    },\n    deserializeHtml: {\n      rules: [\n        {\n          validNodeName: 'BLOCKQUOTE',\n        },\n      ],\n    },\n    resetNode: [\n      {\n        // toggle off blockquote on backspace when it's empty\n        hotkey: 'backspace',\n        types: [BLOCKS.QUOTE],\n        predicate: shouldResetQuoteOnBackspace,\n        onReset: toggleQuote,\n      },\n    ],\n    normalizer: [\n      {\n        validChildren: CONTAINERS[BLOCKS.QUOTE],\n        transform: {\n          [BLOCKS.QUOTE]: transformUnwrap,\n          default: transformLift,\n        },\n      },\n    ],\n    withOverrides: withQuote,\n  };\n}\n","import * as React from 'react';\n\nimport { QuoteIcon } from '@contentful/f36-icons';\nimport { BLOCKS } from '@contentful/rich-text-types';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { isBlockSelected, focus } from '../../../helpers/editor';\nimport { ToolbarButton } from '../../shared/ToolbarButton';\nimport { toggleQuote } from '../toggleQuote';\n\nexport interface ToolbarQuoteButtonProps {\n  isDisabled?: boolean;\n}\n\nexport function ToolbarQuoteButton(props: ToolbarQuoteButtonProps) {\n  const editor = useContentfulEditor();\n\n  function handleOnClick() {\n    if (!editor) return;\n\n    toggleQuote(editor, editor.tracking.onToolbarAction);\n    focus(editor);\n  }\n\n  if (!editor) return null;\n\n  return (\n    <ToolbarButton\n      title=\"Blockquote\"\n      onClick={handleOnClick}\n      testId=\"quote-toolbar-button\"\n      isDisabled={props.isDisabled}\n      isActive={isBlockSelected(editor, BLOCKS.QUOTE)}\n    >\n      <QuoteIcon />\n    </ToolbarButton>\n  );\n}\n","import { INLINES } from '@contentful/rich-text-types';\nimport { createSelectOnBackspacePlugin as createDefaultSelectPlugin } from '@udecode/plate-select';\n\nimport { PlatePlugin } from '../../internal/types';\n\nexport const createSelectOnBackspacePlugin = (): PlatePlugin =>\n  createDefaultSelectPlugin({\n    options: {\n      query: {\n        // `createTextPlugin` is taking care of block elements\n        allow: [INLINES.EMBEDDED_ENTRY],\n      },\n    },\n  });\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport { getEmptyRowNode } from '@udecode/plate-table';\n\nimport { getAboveNode, someNode, getStartPoint, getNextPath } from '../../../internal/queries';\nimport { select, insertNodes } from '../../../internal/transforms';\nimport { PlateEditor, NodeEntry, Element, Path, Location } from '../../../internal/types';\n\nconst addRow = (editor: PlateEditor, getNextRowPath: (currentRowPath: Path) => Path) => {\n  if (\n    someNode(editor, {\n      match: { type: BLOCKS.TABLE },\n    })\n  ) {\n    const currentRowItem = getAboveNode(editor, {\n      match: { type: BLOCKS.TABLE_ROW },\n    }) as NodeEntry<Element> | undefined;\n\n    if (currentRowItem) {\n      const [currentRowElem, currentRowPath] = currentRowItem;\n      const nextRowPath = getNextRowPath(currentRowPath);\n\n      insertNodes(\n        editor,\n        getEmptyRowNode(editor, {\n          header: false,\n          colCount: currentRowElem.children.length,\n        }),\n        {\n          at: nextRowPath,\n          // Note: this selects the last cell of the new row\n          select: true,\n        }\n      );\n\n      // Select the first cell in the current row\n      select(editor, getStartPoint(editor, nextRowPath as Location));\n    }\n  }\n};\n\nexport const addRowBelow = (editor: PlateEditor) => {\n  addRow(editor, (currentRowPath) => {\n    return getNextPath(currentRowPath);\n  });\n};\n\nexport const addRowAbove = (editor: PlateEditor) => {\n  addRow(editor, (currentRowPath) => {\n    // The new row will be in in-place of the old row\n    return currentRowPath;\n  });\n};\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport { getEmptyCellNode } from '@udecode/plate-table';\n\nimport { getAboveNode, getNextPath, someNode } from '../../../internal/queries';\nimport { insertNodes } from '../../../internal/transforms';\nimport { PlateEditor, Path, Element, NodeEntry } from '../../../internal/types';\n\ninterface AddColumnOptions {\n  header?: boolean;\n}\n\nconst addColumn = (\n  editor: PlateEditor,\n  { header }: AddColumnOptions,\n  getNextCellPath: (currentCellPath: Path) => Path\n) => {\n  if (\n    someNode(editor, {\n      match: { type: BLOCKS.TABLE },\n    })\n  ) {\n    const currentCellItem = getAboveNode(editor, {\n      match: {\n        type: [BLOCKS.TABLE_HEADER_CELL, BLOCKS.TABLE_CELL],\n      },\n    });\n\n    const currentTableItem = getAboveNode(editor, {\n      match: { type: BLOCKS.TABLE },\n    }) as NodeEntry<Element> | undefined;\n\n    if (currentCellItem && currentTableItem) {\n      const nextCellPath = getNextCellPath(currentCellItem[1]);\n      const newCellPath = nextCellPath.slice();\n      const replacePathPos = newCellPath.length - 2;\n\n      currentTableItem[0].children.forEach((_, rowIdx) => {\n        newCellPath[replacePathPos] = rowIdx;\n\n        insertNodes(\n          editor,\n\n          getEmptyCellNode(editor, { header: header && rowIdx === 0 }),\n          {\n            at: newCellPath,\n            // Select the first cell of the new column\n            select: rowIdx === 0,\n          }\n        );\n      });\n    }\n  }\n};\n\nexport const addColumnRight = (editor: PlateEditor, options: AddColumnOptions) => {\n  addColumn(editor, options, (currentCellPath) => getNextPath(currentCellPath));\n};\n\nexport const addColumnLeft = (editor: PlateEditor, options: AddColumnOptions) => {\n  addColumn(editor, options, (currentCellPath) => currentCellPath);\n};\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport {\n  ELEMENT_TABLE,\n  ELEMENT_TH,\n  ELEMENT_TD,\n  ELEMENT_TR,\n  getEmptyRowNode,\n} from '@udecode/plate-table';\n\nimport { isBlockSelected, getAncestorPathFromSelection } from '../../helpers/editor';\nimport { selectEditor } from '../../internal';\nimport {\n  getBlockAbove,\n  getStartPoint,\n  getAboveNode,\n  getChildren,\n  isFirstChildPath,\n  isAncestorEmpty,\n  getParentNode,\n  isElement,\n  getNodeEntries,\n  getPreviousPath,\n} from '../../internal/queries';\nimport { insertNodes, removeNodes, moveNodes } from '../../internal/transforms';\nimport { PlateEditor, NodeEntry, Ancestor, Node } from '../../internal/types';\n\nexport function insertTableAndFocusFirstCell(editor: PlateEditor): void {\n  const table = {\n    type: BLOCKS.TABLE,\n    data: {},\n    children: [\n      getEmptyRowNode(editor, { colCount: 2, header: true }),\n      getEmptyRowNode(editor, { colCount: 2 }),\n    ],\n  };\n\n  insertNodes(editor, table);\n\n  if (editor.selection) {\n    const tableEntry = getBlockAbove(editor, {\n      match: { type: BLOCKS.TABLE },\n    });\n    if (!tableEntry) return;\n\n    selectEditor(editor, { at: getStartPoint(editor, tableEntry[1]) });\n  }\n\n  replaceEmptyParagraphWithTable(editor);\n}\n\nexport function isTableActive(editor: PlateEditor) {\n  const tableElements = [ELEMENT_TABLE, ELEMENT_TH, ELEMENT_TR, ELEMENT_TD];\n  return tableElements.some((el) => isBlockSelected(editor, el));\n}\n\nexport function isTableHeaderEnabled(editor: PlateEditor) {\n  const tableItem = getAboveNode(editor, {\n    match: {\n      type: BLOCKS.TABLE,\n    },\n  });\n\n  if (!tableItem) {\n    return false;\n  }\n\n  const firstRow = getChildren(tableItem)[0];\n\n  if (!firstRow) {\n    return false;\n  }\n\n  return getChildren(firstRow).every(([node]) => {\n    return node.type === BLOCKS.TABLE_HEADER_CELL;\n  });\n}\n\nexport function replaceEmptyParagraphWithTable(editor: PlateEditor) {\n  const tablePath = getAncestorPathFromSelection(editor);\n  if (!tablePath || isFirstChildPath(tablePath)) return;\n\n  const previousPath = getPreviousPath(tablePath);\n  if (!previousPath) return;\n\n  const [nodes] = getNodeEntries(editor, {\n    at: previousPath,\n    match: (node) => node.type === BLOCKS.PARAGRAPH,\n  });\n  if (!nodes) return;\n\n  const [previousNode] = nodes;\n  const isPreviousNodeTextEmpty = isAncestorEmpty(editor, previousNode as Ancestor);\n  if (isPreviousNodeTextEmpty) {\n    // Switch table with previous empty paragraph\n    moveNodes(editor, { at: tablePath, to: previousPath });\n    // Remove previous paragraph that now is under the table\n    removeNodes(editor, { at: tablePath });\n  }\n}\n\n/**\n * Returns the number of cells in a given row vs the table width\n *\n * Note: We should only get different table rows cell counts in between\n * normalization cycles.\n */\nexport const getNoOfMissingTableCellsInRow = (editor: PlateEditor, rowEntry: NodeEntry) => {\n  const [, rowPath] = rowEntry;\n  const parent = getParentNode(editor, rowPath);\n\n  // This is ensured by normalization. The error is here just in case\n  if (!parent) {\n    throw new Error('table rows must be wrapped in a table node');\n  }\n\n  // The longest table row determines its width\n  const tableWidth = Math.max(...getChildren(parent).map((entry) => getChildren(entry).length));\n\n  const rowWidth = getChildren(rowEntry).length;\n\n  return tableWidth - rowWidth;\n};\n\nexport const createEmptyTableCells = (count: number): Node[] => {\n  const emptyTableCell = {\n    type: BLOCKS.TABLE_CELL,\n    data: {},\n    children: [\n      {\n        type: BLOCKS.PARAGRAPH,\n        data: {},\n        children: [{ text: '' }],\n      },\n    ],\n  };\n\n  return new Array(count).fill(emptyTableCell);\n};\n\nexport const isNotEmpty = (_: PlateEditor, entry: NodeEntry) => {\n  return getChildren(entry).length !== 0;\n};\n\nexport const isTable = (node: Node) => {\n  return isElement(node) && node.type === BLOCKS.TABLE;\n};\n","import React from 'react';\n\nimport { IconButton, Menu } from '@contentful/f36-components';\nimport { ChevronDownIcon } from '@contentful/f36-icons';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { deleteColumn, deleteRow, deleteTable } from '@udecode/plate-table';\nimport { css } from 'emotion';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { getNodeEntryFromSelection, getTableSize } from '../../../helpers/editor';\nimport { withoutNormalizing } from '../../../internal';\nimport { useReadOnly } from '../../../internal/hooks';\nimport { getAboveNode } from '../../../internal/queries';\nimport { PlateEditor } from '../../../internal/types';\nimport { RichTextTrackingActionName } from '../../../plugins/Tracking';\nimport { addRowAbove, addColumnLeft, addColumnRight, addRowBelow, setHeader } from '../actions';\nimport { isTableHeaderEnabled } from '../helpers';\n\nexport const styles = {\n  topRight: css({\n    position: 'absolute',\n    top: '6px',\n    right: '5px',\n  }),\n};\n\nconst getCurrentTableSize = (\n  editor: PlateEditor\n): Record<'numRows' | 'numColumns', number> | null => {\n  const [table] = getNodeEntryFromSelection(editor, BLOCKS.TABLE);\n  return table ? getTableSize(table) : null;\n};\n\n// FIXME: TablePluginOptions no longer exported so using any\ntype TableAction = (editor: PlateEditor, options: any) => void;\n\nexport const TableActions = () => {\n  const editor = useContentfulEditor();\n  const isDisabled = useReadOnly();\n  const [isOpen, setOpen] = React.useState(false);\n  const [isHeaderEnabled, setHeaderEnabled] = React.useState(false);\n\n  const close = React.useCallback(() => {\n    setOpen(false);\n  }, []);\n\n  React.useEffect(() => {\n    setHeaderEnabled(Boolean(editor && isTableHeaderEnabled(editor)));\n  }, [editor]);\n\n  const canInsertRowAbove = React.useMemo(() => {\n    if (!editor) {\n      return false;\n    }\n\n    const headerCell = getAboveNode(editor, {\n      match: {\n        type: BLOCKS.TABLE_HEADER_CELL,\n      },\n    });\n\n    return !headerCell;\n  }, [editor]);\n\n  const toggleHeader = React.useCallback(() => {\n    close();\n\n    if (!editor) {\n      return;\n    }\n\n    const value = !isHeaderEnabled;\n\n    setHeaderEnabled(value);\n    setHeader(editor, value);\n  }, [editor, close, isHeaderEnabled]);\n\n  const action = React.useCallback(\n    (cb: TableAction, type: 'insert' | 'remove', element: 'Table' | 'Row' | 'Column') => () => {\n      if (!editor?.selection) return;\n      close();\n\n      const tableSize = getCurrentTableSize(editor);\n\n      withoutNormalizing(editor, () => {\n        cb(editor, { header: isHeaderEnabled });\n      });\n      // Tracking\n      const actionName = `${type}Table${element === 'Table' ? '' : element}`;\n      editor.tracking.onViewportAction(actionName as RichTextTrackingActionName, { tableSize });\n    },\n    [editor, isHeaderEnabled, close]\n  );\n\n  if (isDisabled) {\n    return null;\n  }\n\n  return (\n    <Menu\n      placement=\"left\"\n      isOpen={isOpen}\n      onOpen={() => {\n        setOpen(true);\n      }}\n      onClose={close}\n    >\n      <Menu.Trigger>\n        <IconButton\n          size=\"small\"\n          variant=\"transparent\"\n          tabIndex={-1}\n          className={styles.topRight}\n          icon={<ChevronDownIcon />}\n          aria-label=\"Open table menu\"\n          testId=\"cf-table-actions-button\"\n        />\n      </Menu.Trigger>\n      <Menu.List>\n        <Menu.Item onClick={action(addRowAbove, 'insert', 'Row')} disabled={!canInsertRowAbove}>\n          Add row above\n        </Menu.Item>\n        <Menu.Item onClick={action(addRowBelow, 'insert', 'Row')}>Add row below</Menu.Item>\n        <Menu.Item onClick={action(addColumnLeft, 'insert', 'Column')}>Add column left</Menu.Item>\n        <Menu.Item onClick={action(addColumnRight, 'insert', 'Column')}>Add column right</Menu.Item>\n        <Menu.Divider />\n        <Menu.Item onClick={toggleHeader}>\n          {isHeaderEnabled ? 'Disable table header' : 'Enable table header'}\n        </Menu.Item>\n        <Menu.Divider />\n        <Menu.Item onClick={action(deleteRow, 'remove', 'Row')}>Delete row</Menu.Item>\n        <Menu.Item onClick={action(deleteColumn, 'remove', 'Column')}>Delete column</Menu.Item>\n        <Menu.Item onClick={action(deleteTable, 'remove', 'Table')}>Delete table</Menu.Item>\n      </Menu.List>\n    </Menu>\n  );\n};\n","import { BLOCKS } from '@contentful/rich-text-types';\n\nimport { getAboveNode, getChildren } from '../../../internal/queries';\nimport { setNodes } from '../../../internal/transforms';\nimport { PlateEditor } from '../../../internal/types';\n\nexport const setHeader = (editor: PlateEditor, enable?: boolean) => {\n  const tableItem = getAboveNode(editor, {\n    match: { type: BLOCKS.TABLE },\n  });\n\n  if (!tableItem) {\n    return;\n  }\n\n  const firstRow = getChildren(tableItem)[0];\n\n  if (!firstRow) {\n    return;\n  }\n\n  getChildren(firstRow).forEach(([, path]) => {\n    setNodes(\n      editor,\n      {\n        type: enable ? BLOCKS.TABLE_HEADER_CELL : BLOCKS.TABLE_CELL,\n      },\n      { at: path }\n    );\n  });\n};\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { TableCell } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\nimport { useSelected } from 'slate-react';\n\nimport { RenderElementProps } from '../../../internal/types';\nimport { TableActions } from './TableActions';\n\nconst style = css`\n  border: 1px solid ${tokens.gray400};\n  border-collapse: collapse;\n  padding: 10px 12px;\n  min-width: 48px;\n  position: relative;\n  vertical-align: top;\n\n  div:last-child {\n    margin-bottom: 0;\n  }\n`;\n\nexport const Cell = (props: RenderElementProps) => {\n  const isSelected = useSelected();\n  return (\n    <td\n      {...props.attributes}\n      // may include `colspan` and/or `rowspan`\n      // FIXME: figure out what is going wrong with type here\n      // @ts-expect-error\n      {...(props.element.data as TableCell['data'])}\n      className={style}\n    >\n      {isSelected && <TableActions />}\n      {props.children}\n    </td>\n  );\n};\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { TableHeaderCell } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\nimport { useSelected } from 'slate-react';\n\nimport { RenderElementProps } from '../../../internal/types';\nimport { TableActions } from './TableActions';\n\nconst style = css`\n  background-clip: padding-box;\n  background-color: ${tokens.gray200};\n  border: 1px solid ${tokens.gray400};\n  border-collapse: collapse;\n  padding: 10px 12px;\n  font-weight: ${tokens.fontWeightNormal};\n  text-align: left;\n  min-width: 48px;\n  position: relative;\n\n  div:last-child {\n    margin-bottom: 0;\n  }\n`;\n\nexport const HeaderCell = (props: RenderElementProps) => {\n  const isSelected = useSelected();\n\n  return (\n    <th\n      {...props.attributes}\n      // may include `colspan` and/or `rowspan`\n      // FIXME: figure out what is going wrong with type here\n      // @ts-expect-error\n      {...(props.element.data as TableHeaderCell['data'])}\n      className={style}\n    >\n      {isSelected && <TableActions />}\n      {props.children}\n    </th>\n  );\n};\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { css } from 'emotion';\nimport * as Slate from 'slate-react';\n\nconst style = css`\n  border: 1px solid ${tokens.gray400};\n  border-collapse: collapse;\n\n  &:hover td {\n    background-color: transparent !important;\n  }\n`;\n\nexport const Row = (props: Slate.RenderElementProps) => (\n  <tr {...props.attributes} className={style}>\n    {props.children}\n  </tr>\n);\n","import * as React from 'react';\n\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\nimport * as Slate from 'slate-react';\n\nconst style = css`\n  margin-bottom: 1.5em;\n  border-collapse: collapse;\n  border-radius: 5px;\n  border-style: hidden;\n  box-shadow: 0 0 0 1px ${tokens.gray400};\n  width: 100%;\n  table-layout: fixed;\n  overflow: hidden;\n`;\n\nexport const Table = (props: Slate.RenderElementProps) => {\n  return (\n    <div data-block-type={BLOCKS.TABLE}>\n      <table className={style} {...props.attributes}>\n        <tbody>{props.children}</tbody>\n      </table>\n    </div>\n  );\n};\n","import { BLOCKS } from '@contentful/rich-text-types';\n\nimport { insertEmptyParagraph } from '../../helpers/editor';\nimport { getText, isElement } from '../../internal/queries';\nimport { Node } from '../../internal/types';\nimport { Element, PlateEditor } from '../../internal/types';\nimport { isTable } from './helpers';\n\n/**\n * Removes table wrappers when pasting a single table cell\n *\n * In Plate/Slate, copying the content of a table cell wraps\n * it in a <table><tr><td>{content}</td></tr></table> even\n * when copying partial cell content.\n *\n * That's really annoying as there is no way to remove the table\n * wrappers in that case.\n */\nconst trimUnnecessaryTableWrapper = (node: Node): Node[] => {\n  if (!isElement(node)) {\n    return [node];\n  }\n\n  // must be a table with a single row\n  if (node.type !== BLOCKS.TABLE || node.children?.length !== 1) {\n    return [node];\n  }\n\n  const row = node.children[0] as Element;\n\n  // the row must contain a single cell\n  if (row?.children?.length !== 1) {\n    return [node];\n  }\n\n  const cell = row.children[0] as Element;\n\n  return cell.children;\n};\n\nexport const insertTableFragment = (editor: PlateEditor) => {\n  const { insertFragment } = editor;\n\n  return (fragments: Node[]) => {\n    if (!editor.selection) {\n      return;\n    }\n\n    fragments = fragments.flatMap(trimUnnecessaryTableWrapper);\n\n    // We need to make sure we have a new, empty and clean paragraph in order to paste tables as-is due to how Slate behaves\n    // More info: https://github.com/ianstormtaylor/slate/pull/4489 and https://github.com/ianstormtaylor/slate/issues/4542\n    const isInsertingTable = fragments.some((fragment) => isTable(fragment as Element));\n    const isTableFirstFragment =\n      fragments.findIndex((fragment) => isTable(fragment as Element)) === 0;\n    const currentLineHasText = getText(editor, editor.selection?.focus.path) !== '';\n\n    if (isInsertingTable && isTableFirstFragment && currentLineHasText) {\n      insertEmptyParagraph(editor);\n    }\n\n    return insertFragment(fragments);\n  };\n};\n","import { KeyboardEvent } from 'react';\n\nimport { BLOCKS } from '@contentful/rich-text-types';\nimport { getTableEntries, onKeyDownTable as defaultKeyDownTable } from '@udecode/plate-table';\n\nimport { insertEmptyParagraph } from '../../helpers/editor';\nimport { blurEditor } from '../../internal/misc';\nimport { getAboveNode, isLastChildPath } from '../../internal/queries';\nimport { KeyboardHandler, HotkeyPlugin, NodeEntry } from '../../internal/types';\nimport { addRowBelow } from './actions';\n\nexport const onKeyDownTable: KeyboardHandler<HotkeyPlugin> = (editor, plugin) => {\n  const defaultHandler = defaultKeyDownTable(editor, plugin);\n\n  return (event: KeyboardEvent) => {\n    // This fixes `Cannot resolve a Slate point from DOM point:\n    // [object HTMLDivElement]` when typing while the cursor is before table\n    const windowSelection = window.getSelection();\n    if (windowSelection) {\n      // @ts-expect-error\n      // this attribute comes from `plugins/Table/components/Table.tsx`\n      const blockType = windowSelection.anchorNode.attributes?.['data-block-type']?.value;\n      const isBeforeTable = blockType === BLOCKS.TABLE;\n\n      if (isBeforeTable) {\n        if (event.key === 'Enter') {\n          const above = getAboveNode(editor, { match: { type: BLOCKS.TABLE } });\n\n          if (!above) return;\n\n          const [, tablePath] = above;\n\n          insertEmptyParagraph(editor, { at: tablePath, select: true });\n        }\n\n        event.preventDefault();\n        event.stopPropagation();\n        return;\n      }\n    }\n\n    // Pressing Tab on the last cell creates a new row\n    // Otherwise, jumping between cells is handled in the defaultKeyDownTable\n    if (event.key === 'Tab' && !event.shiftKey) {\n      event.preventDefault();\n      const entry = getTableEntries(editor, {});\n\n      if (entry) {\n        const { table, row, cell } = entry;\n\n        const isLastCell = isLastChildPath(row as NodeEntry, cell[1]);\n        const isLastRow = isLastChildPath(table as NodeEntry, row[1]);\n\n        if (isLastRow && isLastCell) {\n          addRowBelow(editor);\n\n          // skip default handler\n          return;\n        } else {\n          defaultHandler(event);\n        }\n      }\n    }\n\n    if (event.key === 'Escape') {\n      blurEditor(editor);\n    }\n  };\n};\n","import {\n  BLOCKS,\n  INLINES,\n  TOP_LEVEL_BLOCKS,\n  VOID_BLOCKS,\n  CONTAINERS,\n} from '@contentful/rich-text-types';\n\nconst inlines = Object.values(INLINES).map((type) => ({ type }));\n\nexport default {\n  document: {\n    nodes: [\n      {\n        types: TOP_LEVEL_BLOCKS.map((type) => ({ type })),\n      },\n    ],\n  },\n\n  blocks: {\n    [BLOCKS.PARAGRAPH]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n    [BLOCKS.HEADING_1]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n    [BLOCKS.HEADING_2]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n    [BLOCKS.HEADING_3]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n    [BLOCKS.HEADING_4]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n    [BLOCKS.HEADING_5]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n    [BLOCKS.HEADING_6]: {\n      nodes: [\n        {\n          match: [...inlines, { object: 'text' }],\n        },\n      ],\n    },\n\n    ...VOID_BLOCKS.reduce(\n      (blocks, nodeType) => ({\n        ...blocks,\n        [nodeType]: { isVoid: true },\n      }),\n      {}\n    ),\n\n    // TODO: add list schema\n\n    [BLOCKS.QUOTE]: {\n      nodes: [\n        {\n          match: [CONTAINERS[BLOCKS.QUOTE].map((type) => ({ type }))],\n          min: 1,\n        },\n      ],\n      normalize: (editor, error) => {\n        if (error.code === 'child_type_invalid') {\n          return editor.unwrapBlockByKey(error.node.key, BLOCKS.QUOTE);\n        }\n      },\n    },\n  },\n\n  inlines: {\n    [INLINES.HYPERLINK]: {\n      nodes: [\n        {\n          match: [{ object: 'text' }],\n        },\n      ],\n    },\n    [INLINES.ENTRY_HYPERLINK]: {\n      nodes: [\n        {\n          match: [{ object: 'text' }],\n        },\n      ],\n    },\n    [INLINES.ASSET_HYPERLINK]: {\n      nodes: [\n        {\n          match: [{ object: 'text' }],\n        },\n      ],\n    },\n    [INLINES.EMBEDDED_ENTRY]: {\n      isVoid: true,\n    },\n  },\n};\n","import * as contentfulSlateJSAdapter from '@contentful/contentful-slatejs-adapter';\nimport { documentToPlainTextString } from '@contentful/rich-text-plain-text-renderer';\n\nimport Schema from '../../constants/Schema';\nimport { PlateEditor } from '../../internal/types';\n\nexport function getCharacterCount(editor: PlateEditor) {\n  const document = contentfulSlateJSAdapter.toContentfulDocument({\n    document: editor.children,\n    schema: Schema,\n  });\n\n  return documentToPlainTextString(document).length;\n}\n","import { PlatePlugin } from '../../internal/types';\nimport { getCharacterCount } from './utils';\n\nexport type RichTextTrackingActionName =\n  // Elements\n  | 'edit'\n  | 'insert'\n  | 'remove'\n  // Marks\n  | 'mark'\n  | 'unmark'\n  // Tables\n  | 'insertTable'\n  | 'insertTableRow'\n  | 'insertTableColumn'\n  | 'removeTable'\n  | 'removeTableRow'\n  | 'removeTableColumn'\n  // Copy & Paste\n  | 'paste'\n  | 'invalidTablePaste'\n  // Hyperlinks\n  | 'cancelCreateHyperlinkDialog'\n  | 'cancelEditHyperlinkDialog'\n  | 'linkRendered'\n  | 'openCreateHyperlinkDialog'\n  | 'openEditHyperlinkDialog'\n  | 'unlinkHyperlinks'\n  // Embeds\n  | 'openCreateEmbedDialog'\n  | 'cancelCreateEmbedDialog'\n  // CommandPalette\n  | 'openRichTextCommandPalette'\n  | 'cancelRichTextCommandPalette';\n\nexport type RichTextTrackingActionHandler = (\n  name: RichTextTrackingActionName,\n  data: Record<string, unknown>\n) => unknown;\n\nexport interface TrackingPluginActions {\n  onViewportAction: (\n    actionName: RichTextTrackingActionName,\n    data?: Record<string, unknown>\n  ) => ReturnType<RichTextTrackingActionHandler>;\n\n  onShortcutAction: (\n    actionName: RichTextTrackingActionName,\n    data?: Record<string, unknown>\n  ) => ReturnType<RichTextTrackingActionHandler>;\n\n  onToolbarAction: (\n    actionName: RichTextTrackingActionName,\n    data?: Record<string, unknown>\n  ) => ReturnType<RichTextTrackingActionHandler>;\n\n  onCommandPaletteAction: (\n    actionName: RichTextTrackingActionName,\n    data?: Record<string, unknown>\n  ) => ReturnType<RichTextTrackingActionHandler>;\n}\n\nconst actionOrigin = {\n  TOOLBAR: 'toolbar-icon',\n  SHORTCUT: 'shortcut',\n  VIEWPORT: 'viewport-interaction',\n  COMMAND_PALETTE: 'command-palette',\n};\n\nexport function getPastingSource(data: DataTransfer) {\n  const textHtml = data.getData('text/html');\n  const doc = new DOMParser().parseFromString(textHtml, 'text/html');\n\n  if (doc.querySelector('[id*=\"docs-internal-guid\"]')) {\n    return 'Google Docs';\n  }\n\n  if (doc.querySelector('google-sheets-html-origin') || doc.querySelector('[data-sheets-value]')) {\n    return 'Google Spreadsheets';\n  }\n\n  if (doc.querySelector('meta[content*=\"Microsoft Excel\"]')) {\n    return 'Microsoft Excel';\n  }\n\n  if (doc.querySelector('meta[content*=\"Microsoft Word\"]')) {\n    return 'Microsoft Word';\n  }\n\n  // TODO: MS Word Online doesn't give us specific tags, we might need to have a closer look at its tracking result since we are using generic values to identify it\n  if (\n    doc.querySelector('[style*=\"Arial_MSFontService\"]') &&\n    (doc.querySelector('.TextRun') || doc.querySelector('.OutlineElement'))\n  ) {\n    return 'Microsoft Word Online';\n  }\n\n  if (doc.querySelector('meta[content=\"Cocoa HTML Writer\"]')) {\n    return 'Apple Notes';\n  }\n\n  if (doc.querySelector('[style*=\"Slack-Lato, Slack-Fractions\"]')) {\n    return 'Slack';\n  }\n\n  return 'Unknown';\n}\n\nexport const createTrackingPlugin = (onAction: RichTextTrackingActionHandler): PlatePlugin => {\n  const trackingActions: TrackingPluginActions = {\n    onViewportAction: (actionName: RichTextTrackingActionName, data = {}) =>\n      onAction(actionName, { origin: actionOrigin.VIEWPORT, ...data }),\n\n    onShortcutAction: (actionName: RichTextTrackingActionName, data = {}) =>\n      onAction(actionName, { origin: actionOrigin.SHORTCUT, ...data }),\n\n    onToolbarAction: (actionName: RichTextTrackingActionName, data = {}) =>\n      onAction(actionName, { origin: actionOrigin.TOOLBAR, ...data }),\n\n    onCommandPaletteAction: (actionName: RichTextTrackingActionName, data = {}) =>\n      onAction(actionName, {\n        origin: actionOrigin.COMMAND_PALETTE,\n        ...data,\n      }),\n  };\n\n  return {\n    key: 'TrackingPlugin',\n    withOverrides: (editor) => {\n      const { insertData } = editor;\n\n      editor.tracking = trackingActions;\n\n      editor.insertData = (data) => {\n        const isCopyAndPaste = data.types.length !== 0;\n        if (isCopyAndPaste) {\n          const characterCountSelection = window.getSelection()?.toString().length;\n          const characterCountBefore = getCharacterCount(editor);\n\n          setTimeout(() => {\n            const characterCountAfter = getCharacterCount(editor);\n\n            trackingActions.onShortcutAction('paste', {\n              characterCountAfter,\n              characterCountBefore,\n              characterCountSelection,\n              source: getPastingSource(data),\n            });\n          });\n        }\n\n        insertData(data);\n      };\n\n      return editor;\n    },\n  };\n};\n","import { BLOCKS } from '@contentful/rich-text-types';\n\nimport { isElement } from '../../internal/queries';\nimport { Node, PlateEditor } from '../../internal/types';\nimport { getPastingSource } from '../../plugins/Tracking';\nimport type { NodeTransformer } from '../Normalizer';\n\nfunction hasTables(nodes: Node[]) {\n  return nodes.some(({ type }) => {\n    return type === BLOCKS.TABLE;\n  });\n}\n\nconst isTableHeaderCell = ({ type }: Node) => type === BLOCKS.TABLE_HEADER_CELL;\n\nfunction hasHeadersOutsideFirstRow(nodes: Node[]) {\n  return nodes\n    .filter(({ type }) => type === BLOCKS.TABLE)\n    .flatMap(({ children }) => (children as Node[]).slice(1) as Node[])\n    .some(({ children }) => (children as Node[]).some(isTableHeaderCell));\n}\n\nexport function addTableTrackingEvents(editor: PlateEditor) {\n  const { insertData } = editor;\n  editor.insertData = (data: DataTransfer) => {\n    const html = data.getData('text/html');\n\n    if (html) {\n      const { children: markupBefore } = editor;\n      insertData(data);\n      const { children: markupAfter } = editor;\n      setTimeout(() => {\n        if (hasTables(markupBefore)) return;\n        if (hasTables(markupAfter)) {\n          editor.tracking.onViewportAction('paste', {\n            tablePasted: true,\n            source: getPastingSource(data),\n            hasHeadersOutsideFirstRow: hasHeadersOutsideFirstRow(markupAfter),\n          });\n        }\n      }, 1);\n    } else {\n      insertData(data);\n    }\n  };\n}\n\nexport const withInvalidCellChildrenTracking = (transformer: NodeTransformer): NodeTransformer => {\n  return (editor, childEntry) => {\n    const [node] = childEntry;\n\n    if (isElement(node)) {\n      editor.tracking?.onViewportAction('invalidTablePaste', {\n        nodeType: node.type,\n      });\n    }\n\n    return transformer(editor, childEntry);\n  };\n};\n","import { BLOCKS, CONTAINERS } from '@contentful/rich-text-types';\nimport {\n  createTablePlugin as createDefaultTablePlugin,\n  ELEMENT_TABLE,\n  ELEMENT_TD,\n  ELEMENT_TH,\n  ELEMENT_TR,\n  withTable,\n  TablePlugin,\n} from '@udecode/plate-table';\n\nimport { isRootLevel } from '../../helpers/editor';\nimport { transformLift, transformParagraphs, transformWrapIn } from '../../helpers/transformers';\nimport {\n  getParentNode,\n  getBlockAbove,\n  getLastChildPath,\n  getNextPath,\n} from '../../internal/queries';\nimport { insertNodes } from '../../internal/transforms';\nimport { PlatePlugin, PlateEditor, Value } from '../../internal/types';\nimport { Cell } from './components/Cell';\nimport { HeaderCell } from './components/HeaderCell';\nimport { Row } from './components/Row';\nimport { Table } from './components/Table';\nimport { createEmptyTableCells, getNoOfMissingTableCellsInRow, isNotEmpty } from './helpers';\nimport { insertTableFragment } from './insertTableFragment';\nimport { onKeyDownTable } from './onKeyDownTable';\nimport { addTableTrackingEvents, withInvalidCellChildrenTracking } from './tableTracking';\n\nexport const createTablePlugin = (): PlatePlugin =>\n  createDefaultTablePlugin<TablePlugin<Value>, Value, PlateEditor>({\n    type: BLOCKS.TABLE,\n    handlers: {\n      // @ts-expect-error\n      onKeyDown: onKeyDownTable,\n    },\n    withOverrides: (editor, plugin) => {\n      const { normalizeNode } = editor;\n      // injects important fixes from plate's original table plugin\n      withTable(editor, plugin);\n\n      // Resets all normalization rules added by @udecode/plate-table as\n      // they conflict with our own\n      editor.normalizeNode = normalizeNode;\n\n      addTableTrackingEvents(editor);\n\n      editor.insertFragment = insertTableFragment(editor);\n\n      return editor;\n    },\n    overrideByKey: {\n      [ELEMENT_TABLE]: {\n        type: BLOCKS.TABLE,\n        component: Table,\n        normalizer: [\n          {\n            validNode: isNotEmpty,\n          },\n          {\n            // Move to root level unless nested\n            validNode: (editor, [, path]) => {\n              // Nested tables are handled by another normalization\n              // rule in a the table cell level\n              const isNestedTable = !!getBlockAbove(editor, {\n                at: path,\n                match: {\n                  type: [BLOCKS.TABLE_CELL, BLOCKS.TABLE_HEADER_CELL],\n                },\n              });\n\n              return isRootLevel(path) || isNestedTable;\n            },\n            transform: transformLift,\n          },\n          {\n            validChildren: CONTAINERS[BLOCKS.TABLE],\n          },\n        ],\n      },\n      [ELEMENT_TR]: {\n        type: BLOCKS.TABLE_ROW,\n        component: Row,\n        normalizer: [\n          {\n            validChildren: CONTAINERS[BLOCKS.TABLE_ROW],\n            transform: transformWrapIn(BLOCKS.TABLE_CELL),\n          },\n          {\n            // Remove empty rows\n            validNode: isNotEmpty,\n          },\n          {\n            // Parent must be a table\n            validNode: (editor, [, path]) => {\n              const parent = getParentNode(editor, path)?.[0];\n              return parent && parent.type === BLOCKS.TABLE;\n            },\n            transform: transformWrapIn(BLOCKS.TABLE),\n          },\n          {\n            // ensure consistent number of cells in each row\n            validNode: (editor, entry) => {\n              return getNoOfMissingTableCellsInRow(editor, entry) === 0;\n            },\n            transform: (editor, entry) => {\n              const howMany = getNoOfMissingTableCellsInRow(editor, entry);\n              const at = getNextPath(getLastChildPath(entry));\n\n              insertNodes(editor, createEmptyTableCells(howMany), {\n                at,\n              });\n            },\n          },\n        ],\n      },\n      [ELEMENT_TH]: {\n        type: BLOCKS.TABLE_HEADER_CELL,\n        component: HeaderCell,\n        normalizer: [\n          {\n            validChildren: CONTAINERS[BLOCKS.TABLE_HEADER_CELL],\n            transform: withInvalidCellChildrenTracking(transformParagraphs),\n          },\n        ],\n      },\n      [ELEMENT_TD]: {\n        type: BLOCKS.TABLE_CELL,\n        component: Cell,\n        normalizer: [\n          {\n            validChildren: CONTAINERS[BLOCKS.TABLE_CELL],\n            transform: withInvalidCellChildrenTracking(transformParagraphs),\n          },\n        ],\n      },\n    } as Record<string, Partial<PlatePlugin>>,\n  });\n","import * as React from 'react';\n\nimport { TableIcon } from '@contentful/f36-icons';\n\nimport { useContentfulEditor } from '../../../ContentfulEditorProvider';\nimport { focus } from '../../../helpers/editor';\nimport { ToolbarButton } from '../../shared/ToolbarButton';\nimport { insertTableAndFocusFirstCell, isTableActive } from './../helpers';\n\nexport interface ToolbarTableButtonProps {\n  isDisabled: boolean | undefined;\n}\n\nexport function ToolbarTableButton(props: ToolbarTableButtonProps) {\n  const editor = useContentfulEditor();\n  const isActive = editor && isTableActive(editor);\n\n  async function handleClick() {\n    if (!editor) return;\n\n    editor.tracking.onToolbarAction('insertTable');\n    insertTableAndFocusFirstCell(editor);\n    focus(editor);\n  }\n\n  if (!editor) return null;\n\n  return (\n    <ToolbarButton\n      title=\"Table\"\n      testId=\"table-toolbar-button\"\n      onClick={handleClick}\n      // TODO: active state looks off since the button will be disabled. Do we still need it?\n      isActive={!!isActive}\n      isDisabled={props.isDisabled}\n    >\n      <TableIcon />\n    </ToolbarButton>\n  );\n}\n","import { BLOCKS, TEXT_CONTAINERS } from '@contentful/rich-text-types';\n\nimport {\n  getAboveNode,\n  isAncestorEmpty,\n  getNodeEntries,\n  getPointBefore,\n  isInline,\n  isEndPoint,\n  getPointAfter,\n  isRangeCollapsed,\n  queryNode,\n  isText,\n} from '../../internal/queries';\nimport {\n  setSelection,\n  select,\n  removeNodes,\n  splitNodes,\n  unhangRange,\n  unsetNodes,\n} from '../../internal/transforms';\nimport {\n  PlatePlugin,\n  PlateEditor,\n  Ancestor,\n  Node,\n  Location,\n  BaseRange,\n} from '../../internal/types';\n\nexport function createTextPlugin(restrictedMarks: string[] = []): PlatePlugin {\n  return {\n    key: 'TextPlugin',\n    handlers: {\n      // Triple selection in a non-Firefox browser undesirably selects\n      // the start of the next block. Editor.unhangRange helps removing\n      // the extra block at the end.\n      onMouseUp: (editor) => () => {\n        if (!editor.selection) {\n          return;\n        }\n\n        setSelection(editor, unhangRange(editor, editor.selection) as Partial<BaseRange>);\n      },\n    },\n    withOverrides: (editor) => {\n      // Reverts the change made upstream that caused the cursor\n      // to be trapped inside inline elements.\n      //\n      // Reverts https://github.com/ianstormtaylor/slate/pull/4578/\n      // Related https://github.com/ianstormtaylor/slate/issues/4704\n      const { insertText } = editor;\n\n      editor.insertText = (text) => {\n        const { selection } = editor;\n\n        // If the cursor is at the end of an inline, move it outside\n        // before inserting\n        if (selection && isRangeCollapsed(selection)) {\n          const inlinePath = getAboveNode(editor, {\n            match: (n) => isInline(editor, n),\n            mode: 'highest',\n          })?.[1];\n\n          if (inlinePath && isEndPoint(editor, selection.anchor, inlinePath)) {\n            const point = getPointAfter(editor, inlinePath);\n            setSelection(editor, {\n              anchor: point,\n              focus: point,\n            });\n          }\n        }\n\n        return insertText(text);\n      };\n\n      // When pressing delete instead of backspace\n      const { deleteForward, deleteBackward } = editor;\n\n      editor.deleteBackward = (unit) => {\n        deleteEmptyParagraph(unit, editor, deleteBackward);\n      };\n\n      editor.deleteForward = (unit) => {\n        deleteEmptyParagraph(unit, editor, deleteForward);\n      };\n\n      fixPasteAsPlainText(editor);\n\n      return editor;\n    },\n    normalizer: [\n      {\n        match: isText,\n        transform: (editor, [, path]) => {\n          unsetNodes(editor, restrictedMarks, { at: path });\n        },\n        validNode: (_editor, [node]) => {\n          return !restrictedMarks.some((mark) => {\n            return mark in node;\n          });\n        },\n      },\n    ],\n  };\n}\n\nfunction deleteEmptyParagraph(\n  unit: 'character' | 'word' | 'line' | 'block',\n  editor: PlateEditor,\n  deleteFunction: Function\n) {\n  const entry = getAboveNode(editor, {\n    match: {\n      type: TEXT_CONTAINERS,\n    },\n  });\n\n  if (entry) {\n    const [paragraphOrHeading, path] = entry;\n    const isTextEmpty = isAncestorEmpty(editor, paragraphOrHeading as Ancestor);\n    // We ignore paragraphs/headings that are children of ul, ol, blockquote, tables, etc\n    const isRootLevel = path.length === 1;\n    const hasSiblings = editor.children.length > 1; // prevent editor from losing focus\n\n    if (isTextEmpty && isRootLevel && hasSiblings) {\n      removeNodes(editor, { at: path });\n\n      const prevNode = getPointBefore(editor, editor.selection as Location, {\n        unit,\n      });\n\n      if (prevNode) {\n        const [prevCell] = getNodeEntries(editor, {\n          match: (node: Node) =>\n            queryNode([node, prevNode.path], {\n              allow: [BLOCKS.EMBEDDED_ASSET, BLOCKS.EMBEDDED_ENTRY, BLOCKS.HR],\n            }),\n          at: prevNode,\n        });\n\n        if (prevCell) {\n          select(editor, prevNode);\n        }\n      }\n    } else {\n      deleteFunction(unit);\n    }\n  } else {\n    deleteFunction(unit);\n  }\n}\n\n/**\n * To be compatible with the old behavior we need to treat each 2 consecutive\n * line breaks as a new paragraph when pasting as plain text (also known as\n * paste and match style in macOS)\n */\nfunction fixPasteAsPlainText(editor: PlateEditor) {\n  editor.insertTextData = (data: DataTransfer): boolean => {\n    const text = data.getData('text/plain');\n\n    if (!text) {\n      return false;\n    }\n\n    const lines = text.split(/\\n{2}/);\n    let split = false;\n\n    for (const line of lines) {\n      // empty lines\n      if (/^(\\r\\n?|\\n)$/.test(line)) {\n        continue;\n      }\n\n      if (split) {\n        splitNodes(editor, { always: true });\n      }\n\n      editor.insertText(line);\n      split = true;\n    }\n\n    return true;\n  };\n}\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport { createTrailingBlockPlugin } from '@udecode/plate-trailing-block';\n\nimport { PlatePlugin } from '../../internal/types';\n\nexport const createTrailingParagraphPlugin = (): PlatePlugin => {\n  return createTrailingBlockPlugin({\n    options: {\n      type: BLOCKS.PARAGRAPH,\n      level: 0,\n    },\n  });\n};\n","import { FieldExtensionSDK } from '@contentful/app-sdk';\nimport {\n  createDeserializeAstPlugin,\n  createDeserializeHtmlPlugin,\n  PlateProps,\n} from '@udecode/plate-core';\nimport { createDeserializeDocxPlugin } from '@udecode/plate-serializer-docx';\n\nimport { PlatePlugin } from '../internal/types';\nimport { createSoftBreakPlugin, createExitBreakPlugin, createResetNodePlugin } from './Break';\nimport { createCommandPalettePlugin } from './CommandPalette';\nimport { isCommandPromptPluginEnabled } from './CommandPalette/useCommands';\nimport { createDragAndDropPlugin } from './DragAndDrop';\nimport {\n  createEmbeddedAssetBlockPlugin,\n  createEmbeddedEntryBlockPlugin,\n} from './EmbeddedEntityBlock';\nimport { createEmbeddedEntityInlinePlugin } from './EmbeddedEntityInline';\nimport { createHeadingPlugin } from './Heading';\nimport { createHrPlugin } from './Hr';\nimport { createHyperlinkPlugin } from './Hyperlink';\nimport { createListPlugin } from './List';\nimport { createMarksPlugin } from './Marks';\nimport { createNormalizerPlugin } from './Normalizer';\nimport { createParagraphPlugin } from './Paragraph';\nimport { createPasteHTMLPlugin } from './PasteHTML';\nimport { createQuotePlugin } from './Quote';\nimport { createSelectOnBackspacePlugin } from './SelectOnBackspace';\nimport { createTablePlugin } from './Table';\nimport { createTextPlugin } from './Text';\nimport { createTrackingPlugin, RichTextTrackingActionHandler } from './Tracking';\nimport { createTrailingParagraphPlugin } from './TrailingParagraph';\nimport { createVoidsPlugin } from './Voids';\n\nexport const getPlugins = (\n  sdk: FieldExtensionSDK,\n  onAction: RichTextTrackingActionHandler,\n  restrictedMarks?: string[]\n): PlatePlugin[] => [\n  // AST must come after the HTML deserializer\n  createDeserializeHtmlPlugin(),\n  createDeserializeAstPlugin(),\n  createDeserializeDocxPlugin(),\n\n  // Tracking - This should come first so all plugins below will have access to `editor.tracking`\n  createTrackingPlugin(onAction),\n\n  // Global / Global shortcuts\n  createDragAndDropPlugin(),\n  // Enable command palette plugin only, if at least action type is allowed\n  ...(Object.values(isCommandPromptPluginEnabled(sdk)).some(Boolean)\n    ? [createCommandPalettePlugin()]\n    : []),\n\n  // Block Elements\n  createParagraphPlugin(),\n  createListPlugin(),\n  createHrPlugin(),\n  createHeadingPlugin(),\n  createQuotePlugin(),\n  createTablePlugin(),\n  createEmbeddedEntryBlockPlugin(sdk),\n  createEmbeddedAssetBlockPlugin(sdk),\n\n  // Inline elements\n  createHyperlinkPlugin(sdk),\n  createEmbeddedEntityInlinePlugin(sdk),\n\n  // Marks\n  createMarksPlugin(),\n\n  // Other\n  createTrailingParagraphPlugin(),\n  createTextPlugin(restrictedMarks),\n  createVoidsPlugin(),\n  createSelectOnBackspacePlugin(),\n\n  // Pasting content from other sources\n  createPasteHTMLPlugin(),\n\n  // These plugins drive their configurations from the list of plugins\n  // above. They MUST come last.\n  createSoftBreakPlugin(),\n  createExitBreakPlugin(),\n  createResetNodePlugin(),\n  createNormalizerPlugin(),\n];\n\nexport const disableCorePlugins: PlateProps['disableCorePlugins'] = {\n  // Temporarily until the upstream issue is fixed.\n  // See: https://github.com/udecode/plate/issues/1329#issuecomment-1005935946\n  deserializeAst: true,\n  deserializeHtml: true,\n\n  // Note: Enabled by default since v9.0.0 but it causes Cypress's\n  // .click() command to fail\n  eventEditor: true,\n};\n","import { toSlatejsDocument } from '@contentful/contentful-slatejs-adapter';\nimport { EMPTY_DOCUMENT, Document } from '@contentful/rich-text-types';\n\nimport schema from './constants/Schema';\nimport { sanitizeIncomingSlateDoc } from './helpers/sanitizeIncomingSlateDoc';\nimport { createPlateEditor, CreatePlateEditorOptions, withoutNormalizing } from './internal';\nimport { getEndPoint, isNode } from './internal/queries';\nimport { normalize, select } from './internal/transforms';\nimport { Value, PlateEditor, Node } from './internal/types';\n\n/**\n * For legacy reasons, a document may not have any content at all\n * e.g:\n *\n * {nodeType: document, data: {}, content: []}\n *\n * Rendering such document will break the Slate editor\n */\nexport const hasContent = (doc?: Document) => {\n  return (doc?.content || []).length > 0;\n};\n\n/*\n Plate api doesn't allow to modify (easily) the editor value programmatically\n after the editor instance is created \n\n This function is inspired to https://github.com/udecode/plate/issues/1269#issuecomment-1057643622\n */\nexport const setEditorContent = (editor: PlateEditor, nodes?: Node[]): void => {\n  // Replaces editor content while keeping change history\n  withoutNormalizing(editor, () => {\n    const children = [...editor.children];\n    children.forEach((node) => editor.apply({ type: 'remove_node', path: [0], node }));\n\n    if (nodes) {\n      const nodesArray = isNode(nodes) ? [nodes] : nodes;\n      nodesArray.forEach((node, i) => {\n        editor.apply({ type: 'insert_node', path: [i], node });\n      });\n    }\n\n    const point = getEndPoint(editor, []);\n    if (point) {\n      select(editor, point);\n    }\n  });\n};\n\n/**\n * Converts a Contentful rich text document to the corresponding slate editor\n * value\n */\nexport const documentToEditorValue = (doc?: Document) => {\n  const slateDoc = toSlatejsDocument({\n    document: hasContent(doc) ? doc : EMPTY_DOCUMENT,\n    // TODO: get rid of schema, https://github.com/contentful/field-editors/pull/1065#discussion_r826723248\n    schema,\n  });\n\n  return sanitizeIncomingSlateDoc(slateDoc);\n};\n\nexport const normalizeEditorValue = (\n  value: Value,\n  options?: Omit<CreatePlateEditorOptions, 'id' | 'editor'>\n) => {\n  const editor = createPlateEditor(options);\n  editor.children = value;\n  normalize(editor, { force: true });\n  return editor.children;\n};\n","import { Text, Node } from '../internal/types';\n\nconst isTextElement = (node: Node): node is Text => 'text' in node;\n\n/**\n * Ensures all nodes have a child leaf text element. This should be handled by\n * Slate but its behavior has proven to be buggy and unpredictable.\n */\nexport function sanitizeIncomingSlateDoc(nodes: Node[] = []): Node[] {\n  return nodes.map((node: Node): Node => {\n    if (isTextElement(node)) {\n      return node;\n    }\n    if ((node.children as Node[])?.length === 0) {\n      return {\n        ...node,\n        children: [{ text: '', data: {} }],\n      };\n    }\n    return {\n      ...node,\n      children: sanitizeIncomingSlateDoc(node?.children as Node[]),\n    };\n  });\n}\n","import tokens from '@contentful/f36-tokens';\nimport { css } from 'emotion';\n\nconst STYLE_EDITOR_BORDER = `1px solid ${tokens.gray400}`;\n\nexport const styles = {\n  root: css({\n    position: 'relative',\n  }),\n  editor: css({\n    borderRadius: `0 0 ${tokens.borderRadiusMedium} ${tokens.borderRadiusMedium}`,\n    border: STYLE_EDITOR_BORDER,\n    borderTop: 0,\n    padding: '20px',\n    fontSize: tokens.spacingM,\n    fontFamily: tokens.fontStackPrimary,\n    minHeight: '400px',\n    background: tokens.colorWhite,\n    outline: 'none',\n    whiteSpace: 'pre-wrap',\n    overflowWrap: 'break-word',\n    webkitUserModify: 'read-write-plaintext-only',\n    a: {\n      span: {\n        cursor: 'not-allowed',\n        '&:hover': {\n          cursor: 'not-allowed',\n        },\n      },\n    },\n    // We need to reset LIC style due to conflicts between PARAGRAPH styles\n    'ul > li > div': {\n      margin: 0,\n    },\n  }),\n  hiddenToolbar: css({\n    borderTop: STYLE_EDITOR_BORDER,\n  }),\n  enabled: css({\n    background: tokens.colorWhite,\n    a: {\n      span: {\n        cursor: 'pointer',\n        '&:hover': {\n          cursor: 'pointer',\n        },\n      },\n    },\n  }),\n  disabled: css({\n    background: tokens.gray100,\n    cursor: 'not-allowed',\n  }),\n};\n","import * as React from 'react';\n\nimport { Button, Menu } from '@contentful/f36-components';\nimport { PlusIcon, ChevronDownIcon } from '@contentful/f36-icons';\n\nexport interface EmbeddedEntityDropdownButtonProps {\n  children: React.ReactNode;\n  isDisabled: boolean | undefined;\n  isOpen: boolean;\n  onClose: () => void;\n  onToggle: () => void;\n}\n\nexport function EmbeddedEntityDropdownButton({\n  children,\n  isDisabled,\n  isOpen,\n  onClose,\n  onToggle,\n}: EmbeddedEntityDropdownButtonProps) {\n  return (\n    <Menu placement=\"bottom-end\" isOpen={isOpen} onClose={onClose} onOpen={onToggle}>\n      <Menu.Trigger>\n        <Button\n          endIcon={<ChevronDownIcon />}\n          testId=\"toolbar-entity-dropdown-toggle\"\n          variant=\"secondary\"\n          size=\"small\"\n          startIcon={<PlusIcon />}\n          isDisabled={isDisabled}>\n          Embed\n        </Button>\n      </Menu.Trigger>\n      <Menu.List className=\"toolbar-entity-dropdown-list\">{children}</Menu.List>\n    </Menu>\n  );\n}\n","import React, { useState } from 'react';\n\nimport { BLOCKS, INLINES } from '@contentful/rich-text-types';\n\nimport { useContentfulEditor } from '../../ContentfulEditorProvider';\nimport { isLinkActive } from '../../helpers/editor';\nimport { isNodeTypeEnabled } from '../../helpers/validations';\nimport { ToolbarIcon as EmbeddedEntityBlockToolbarIcon } from '../../plugins/EmbeddedEntityBlock';\nimport { ToolbarEmbeddedEntityInlineButton } from '../../plugins/EmbeddedEntityInline';\nimport { useSdkContext } from '../../SdkProvider';\nimport { EmbeddedEntityDropdownButton } from './EmbeddedEntityDropdownButton';\n\nexport interface EmbedEntityWidgetProps {\n  isDisabled?: boolean;\n  canInsertBlocks?: boolean;\n}\n\nexport const EmbedEntityWidget = ({ isDisabled, canInsertBlocks }: EmbedEntityWidgetProps) => {\n  const sdk = useSdkContext();\n  const editor = useContentfulEditor();\n\n  const [isEmbedDropdownOpen, setEmbedDropdownOpen] = useState(false);\n  const onCloseEntityDropdown = () => setEmbedDropdownOpen(false);\n  const onToggleEntityDropdown = () => setEmbedDropdownOpen(!isEmbedDropdownOpen);\n\n  const inlineEntryEmbedEnabled = isNodeTypeEnabled(sdk.field, INLINES.EMBEDDED_ENTRY);\n  const blockEntryEmbedEnabled =\n    isNodeTypeEnabled(sdk.field, BLOCKS.EMBEDDED_ENTRY) && canInsertBlocks;\n  // Removed access check following https://contentful.atlassian.net/browse/DANTE-486\n  // TODO: refine permissions check in order to account for tags in rules and then readd access.can('read', 'Asset')\n  const blockAssetEmbedEnabled =\n    isNodeTypeEnabled(sdk.field, BLOCKS.EMBEDDED_ASSET) && canInsertBlocks;\n\n  const actions = (\n    <>\n      {blockEntryEmbedEnabled && (\n        <EmbeddedEntityBlockToolbarIcon\n          isDisabled={!!isDisabled}\n          nodeType={BLOCKS.EMBEDDED_ENTRY}\n          onClose={onCloseEntityDropdown}\n        />\n      )}\n      {inlineEntryEmbedEnabled && (\n        <ToolbarEmbeddedEntityInlineButton\n          isDisabled={!!isDisabled || isLinkActive(editor)}\n          onClose={onCloseEntityDropdown}\n        />\n      )}\n      {blockAssetEmbedEnabled && (\n        <EmbeddedEntityBlockToolbarIcon\n          isDisabled={!!isDisabled}\n          nodeType={BLOCKS.EMBEDDED_ASSET}\n          onClose={onCloseEntityDropdown}\n        />\n      )}\n    </>\n  );\n\n  const showEmbedButton =\n    blockEntryEmbedEnabled || inlineEntryEmbedEnabled || blockAssetEmbedEnabled;\n\n  return showEmbedButton ? (\n    <EmbeddedEntityDropdownButton\n      isDisabled={isDisabled}\n      onClose={onCloseEntityDropdown}\n      onToggle={onToggleEntityDropdown}\n      isOpen={isEmbedDropdownOpen}\n    >\n      {actions}\n    </EmbeddedEntityDropdownButton>\n  ) : null;\n};\n","import React from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { Flex, IconButton, Menu } from '@contentful/f36-components';\nimport { MoreHorizontalIcon } from '@contentful/f36-icons';\nimport tokens from '@contentful/f36-tokens';\nimport { BLOCKS, INLINES, MARKS } from '@contentful/rich-text-types';\nimport { css } from 'emotion';\n\nimport { useContentfulEditor } from '../ContentfulEditorProvider';\nimport { isNodeTypeSelected } from '../helpers/editor';\nimport { isNodeTypeEnabled, isMarkEnabled } from '../helpers/validations';\nimport { isMarkActive } from '../internal/queries';\nimport { ToolbarHeadingButton } from '../plugins/Heading';\nimport { ToolbarHrButton } from '../plugins/Hr';\nimport { ToolbarHyperlinkButton } from '../plugins/Hyperlink';\nimport { ToolbarListButton } from '../plugins/List';\nimport { ToolbarBoldButton } from '../plugins/Marks/Bold';\nimport { ToolbarCodeButton, ToolbarDropdownCodeButton } from '../plugins/Marks/Code';\nimport { ToolbarItalicButton } from '../plugins/Marks/Italic';\nimport { ToolbarDropdownSubscriptButton, ToolbarSubscriptButton } from '../plugins/Marks/Subscript';\nimport {\n  ToolbarDropdownSuperscriptButton,\n  ToolbarSuperscriptButton,\n} from '../plugins/Marks/Superscript';\nimport { ToolbarUnderlineButton } from '../plugins/Marks/Underline';\nimport { ToolbarQuoteButton } from '../plugins/Quote';\nimport { ToolbarTableButton } from '../plugins/Table';\nimport { useSdkContext } from '../SdkProvider';\nimport { EmbedEntityWidget } from './components/EmbedEntityWidget';\n\ntype ToolbarProps = {\n  isDisabled?: boolean;\n};\n\nconst styles = {\n  toolbar: css({\n    border: `1px solid ${tokens.gray400}`,\n    backgroundColor: tokens.gray100,\n    padding: tokens.spacingXs,\n    borderRadius: `${tokens.borderRadiusMedium} ${tokens.borderRadiusMedium} 0 0`,\n  }),\n  toolbarBtn: css({\n    height: '30px',\n    width: '30px',\n    marginLeft: tokens.spacing2Xs,\n    marginRight: tokens.spacing2Xs,\n  }),\n  divider: css({\n    display: 'inline-block',\n    height: '21px',\n    width: '1px',\n    background: tokens.gray300,\n    margin: `0 ${tokens.spacing2Xs}`,\n  }),\n  embedActionsWrapper: css({\n    display: ['-webkit-box', '-ms-flexbox', 'flex'],\n    webkitAlignSelf: 'flex-start',\n    alignSelf: 'flex-start',\n    msFlexItemAlign: 'start',\n    marginLeft: 'auto',\n  }),\n  formattingOptionsWrapper: css({\n    display: ['-webkit-box', '-ms-flexbox', 'flex'],\n    msFlexAlign: 'center',\n    webkitBoxAlign: 'center',\n    alignItems: 'center',\n    msFlexWrap: 'wrap',\n    flexWrap: 'wrap',\n    marginRight: '20px',\n  }),\n};\n\nconst Dropdown = ({ sdk, isDisabled }: { sdk: FieldExtensionSDK; isDisabled?: boolean }) => {\n  const editor = useContentfulEditor();\n  const isActive =\n    editor &&\n    (isMarkActive(editor, MARKS.SUPERSCRIPT) ||\n      isMarkActive(editor, MARKS.SUBSCRIPT) ||\n      isMarkActive(editor, MARKS.CODE));\n\n  return (\n    <Menu>\n      <Menu.Trigger>\n        <span>\n          <IconButton\n            size=\"small\"\n            className={styles.toolbarBtn}\n            variant={isActive ? 'secondary' : 'transparent'}\n            icon={<MoreHorizontalIcon />}\n            aria-label=\"toggle menu\"\n            isDisabled={isDisabled}\n            testId=\"dropdown-toolbar-button\"\n          />\n        </span>\n      </Menu.Trigger>\n      <Menu.List>\n        {isMarkEnabled(sdk.field, MARKS.SUPERSCRIPT) && (\n          <ToolbarDropdownSuperscriptButton isDisabled={isDisabled} />\n        )}\n        {isMarkEnabled(sdk.field, MARKS.SUBSCRIPT) && (\n          <ToolbarDropdownSubscriptButton isDisabled={isDisabled} />\n        )}\n        {isMarkEnabled(sdk.field, MARKS.CODE) && (\n          <ToolbarDropdownCodeButton isDisabled={isDisabled} />\n        )}\n      </Menu.List>\n    </Menu>\n  );\n};\n\nconst Toolbar = ({ isDisabled }: ToolbarProps) => {\n  const sdk = useSdkContext();\n  const editor = useContentfulEditor();\n  const canInsertBlocks = !isNodeTypeSelected(editor, BLOCKS.TABLE);\n  const validationInfo = React.useMemo(() => getValidationInfo(sdk.field), [sdk.field]);\n  const isListSelected =\n    isNodeTypeSelected(editor, BLOCKS.UL_LIST) || isNodeTypeSelected(editor, BLOCKS.OL_LIST);\n  const isBlockquoteSelected = isNodeTypeSelected(editor, BLOCKS.QUOTE);\n  const shouldDisableTables =\n    isDisabled || !canInsertBlocks || isListSelected || isBlockquoteSelected;\n\n  // We only show the dropdown when: whenever at least bold , italic and underline are available; If nothing that would go inside the dropdown is available, we hide it\n  const boldItalicUnderlineAvailable =\n    isMarkEnabled(sdk.field, MARKS.BOLD) ||\n    isMarkEnabled(sdk.field, MARKS.ITALIC) ||\n    isMarkEnabled(sdk.field, MARKS.UNDERLINE);\n  const dropdownItemsAvailable =\n    isMarkEnabled(sdk.field, MARKS.SUPERSCRIPT) ||\n    isMarkEnabled(sdk.field, MARKS.SUBSCRIPT) ||\n    isMarkEnabled(sdk.field, MARKS.CODE);\n  const shouldShowDropdown = boldItalicUnderlineAvailable && dropdownItemsAvailable;\n\n  return (\n    <Flex testId=\"toolbar\" className={styles.toolbar} alignItems=\"center\">\n      <div className={styles.formattingOptionsWrapper}>\n        <ToolbarHeadingButton isDisabled={isDisabled || !canInsertBlocks} />\n\n        {validationInfo.isAnyMarkEnabled && <span className={styles.divider} />}\n\n        {isMarkEnabled(sdk.field, MARKS.BOLD) && <ToolbarBoldButton isDisabled={isDisabled} />}\n        {isMarkEnabled(sdk.field, MARKS.ITALIC) && <ToolbarItalicButton isDisabled={isDisabled} />}\n\n        {isMarkEnabled(sdk.field, MARKS.UNDERLINE) && (\n          <ToolbarUnderlineButton isDisabled={isDisabled} />\n        )}\n\n        {!boldItalicUnderlineAvailable && isMarkEnabled(sdk.field, MARKS.SUPERSCRIPT) && (\n          <ToolbarSuperscriptButton isDisabled={isDisabled} />\n        )}\n        {!boldItalicUnderlineAvailable && isMarkEnabled(sdk.field, MARKS.SUBSCRIPT) && (\n          <ToolbarSubscriptButton isDisabled={isDisabled} />\n        )}\n        {!boldItalicUnderlineAvailable && isMarkEnabled(sdk.field, MARKS.CODE) && (\n          <ToolbarCodeButton isDisabled={isDisabled} />\n        )}\n\n        {shouldShowDropdown && <Dropdown sdk={sdk} isDisabled={isDisabled} />}\n\n        {validationInfo.isAnyHyperlinkEnabled && (\n          <>\n            <span className={styles.divider} />\n            <ToolbarHyperlinkButton isDisabled={isDisabled} />\n          </>\n        )}\n\n        {validationInfo.isAnyBlockFormattingEnabled && <span className={styles.divider} />}\n\n        <ToolbarListButton isDisabled={isDisabled || !canInsertBlocks} />\n\n        {isNodeTypeEnabled(sdk.field, BLOCKS.QUOTE) && (\n          <ToolbarQuoteButton isDisabled={isDisabled || !canInsertBlocks} />\n        )}\n        {isNodeTypeEnabled(sdk.field, BLOCKS.HR) && (\n          <ToolbarHrButton isDisabled={isDisabled || !canInsertBlocks} />\n        )}\n        {isNodeTypeEnabled(sdk.field, BLOCKS.TABLE) && (\n          <ToolbarTableButton isDisabled={shouldDisableTables} />\n        )}\n      </div>\n      <div className={styles.embedActionsWrapper}>\n        <EmbedEntityWidget isDisabled={isDisabled} canInsertBlocks={canInsertBlocks} />\n      </div>\n    </Flex>\n  );\n};\n\nfunction getValidationInfo(field: FieldExtensionSDK['field']): {\n  isAnyMarkEnabled: boolean;\n  isAnyHyperlinkEnabled: boolean;\n  isAnyBlockFormattingEnabled: boolean;\n} {\n  const someWithValidation = (vals, validation) => vals.some((val) => validation(field, val));\n\n  const isAnyMarkEnabled = someWithValidation(Object.values(MARKS), isMarkEnabled);\n\n  const isAnyHyperlinkEnabled = someWithValidation(\n    [INLINES.HYPERLINK, INLINES.ASSET_HYPERLINK, INLINES.ENTRY_HYPERLINK],\n    isNodeTypeEnabled\n  );\n\n  const isAnyBlockFormattingEnabled = someWithValidation(\n    [BLOCKS.UL_LIST, BLOCKS.OL_LIST, BLOCKS.QUOTE, BLOCKS.HR],\n    isNodeTypeEnabled\n  );\n\n  return {\n    isAnyMarkEnabled,\n    isAnyHyperlinkEnabled,\n    isAnyBlockFormattingEnabled,\n  };\n}\n\nexport default Toolbar;\n","import React, { ReactNode } from 'react';\n\nimport { css } from 'emotion';\n\nconst styles = {\n  nativeSticky: css`\n    position: -webkit-sticky;\n    position: sticky;\n    top: -1px;\n    z-index: 2;\n  `,\n};\n\ntype StickyToolbarProps = {\n  isDisabled?: boolean;\n  children: ReactNode;\n};\n\nconst StickyToolbarWrapper = ({ isDisabled, children }: StickyToolbarProps) => (\n  <div className={isDisabled ? '' : styles.nativeSticky}>{children}</div>\n);\n\nexport default StickyToolbarWrapper;\n","import { COMMAND_PROMPT } from '../plugins/CommandPalette/constants';\n\nconst internalMarks = [COMMAND_PROMPT];\n\nexport const removeInternalMarks = (document: Record<string, unknown>) => {\n  return {\n    ...document,\n    content: (document.content as Record<string, unknown>[]).map((node) => {\n      if (node.nodeType === 'text') {\n        node.marks = (node.marks as Record<string, unknown>[]).filter(\n          (mark) => !internalMarks.includes(mark.type as string)\n        );\n        return node;\n      }\n      return removeInternalMarks(node);\n    }),\n  };\n};\n","import { useCallback, useMemo } from 'react';\n\nimport { toContentfulDocument } from '@contentful/contentful-slatejs-adapter';\nimport { Document } from '@contentful/rich-text-types';\nimport { getPlateSelectors } from '@udecode/plate-core';\nimport debounce from 'lodash/debounce';\n\nimport schema from './constants/Schema';\nimport { removeInternalMarks } from './helpers/removeInternalMarks';\nimport { Operation } from './internal/types';\n\n/**\n * Returns whether a given operation is relevant enough to trigger a save.\n */\nconst isRelevantOperation = (op: Operation) => {\n  if (op.type === 'set_selection') {\n    return false;\n  }\n\n  return true;\n};\n\nexport type OnValueChangedProps = {\n  editorId: string;\n  handler?: (value: Document) => unknown;\n  skip?: boolean;\n  onSkip?: VoidFunction;\n};\n\nexport const useOnValueChanged = ({ editorId, handler, skip, onSkip }: OnValueChangedProps) => {\n  const onChange = useMemo(\n    () =>\n      debounce((document: unknown) => {\n        const contentfulDocument = toContentfulDocument({ document, schema });\n        const cleanedDocument = removeInternalMarks(contentfulDocument);\n        handler?.(cleanedDocument);\n      }, 500),\n    [handler]\n  );\n\n  return useCallback(\n    (value: unknown) => {\n      const editor = getPlateSelectors(editorId).editor();\n      if (!editor) {\n        throw new Error(\n          'Editor change callback called but editor not defined. Editor id: ' + editorId\n        );\n      }\n      const operations = editor?.operations.filter(isRelevantOperation);\n\n      if (operations.length > 0) {\n        if (skip) {\n          onSkip?.();\n          return;\n        }\n        onChange(value);\n      }\n    },\n    [editorId, onChange, skip, onSkip]\n  );\n};\n","import React, { useCallback, useState, useEffect } from 'react';\n\nimport { FieldExtensionSDK } from '@contentful/app-sdk';\nimport { EntityProvider } from '@contentful/field-editor-reference';\nimport { FieldConnector } from '@contentful/field-editor-shared';\nimport * as Contentful from '@contentful/rich-text-types';\nimport { Plate, getPlateActions } from '@udecode/plate-core';\nimport { css, cx } from 'emotion';\nimport deepEquals from 'fast-deep-equal';\nimport noop from 'lodash/noop';\n\nimport { ContentfulEditorIdProvider, getContentfulEditorId } from './ContentfulEditorProvider';\nimport { getPlateSelectors } from './internal/misc';\nimport { Value } from './internal/types';\nimport { getPlugins, disableCorePlugins } from './plugins';\nimport { RichTextTrackingActionHandler } from './plugins/Tracking';\nimport { documentToEditorValue, normalizeEditorValue, setEditorContent } from './prepareDocument';\nimport { styles } from './RichTextEditor.styles';\nimport { SdkProvider } from './SdkProvider';\nimport Toolbar from './Toolbar';\nimport StickyToolbarWrapper from './Toolbar/components/StickyToolbarWrapper';\nimport { useOnValueChanged } from './useOnValueChanged';\n\ntype ConnectedProps = {\n  sdk: FieldExtensionSDK;\n  onAction?: RichTextTrackingActionHandler;\n  minHeight?: string | number;\n  value?: object;\n  isDisabled?: boolean;\n  onChange?: (doc: Contentful.Document) => unknown;\n  isToolbarHidden?: boolean;\n  actionsDisabled?: boolean;\n  restrictedMarks?: string[];\n};\n\nexport const ConnectedRichTextEditor = (props: ConnectedProps) => {\n  const id = getContentfulEditorId(props.sdk);\n  const plugins = React.useMemo(\n    () => getPlugins(props.sdk, props.onAction ?? noop, props.restrictedMarks),\n    [props.sdk, props.onAction, props.restrictedMarks]\n  );\n  const [isFirstRender, setIsFirstRender] = useState(true);\n  const [pendingExternalUpdate, setPendingExternalUpdate] = useState(false);\n\n  const onValueChanged = useOnValueChanged({\n    editorId: id,\n    handler: props.onChange,\n    skip: pendingExternalUpdate || isFirstRender,\n    onSkip: () => setPendingExternalUpdate(false),\n  });\n\n  useEffect(() => {\n    /*\n      This effect is called when the value prop changes. Normally\n      this happens when the value is changed outside of the editor,\n      like in snapshots restoration or remote updates\n      Plate won't update the displayed value on its own, see:\n       - https://github.com/ianstormtaylor/slate/pull/4540\n       - https://github.com/udecode/plate/issues/1169\n\n       The content is forcefully set to the new value and it's ensured\n       the change listener isn't invoked\n    */\n    setIsFirstRender(false);\n    const editor = getPlateSelectors(id).editor();\n    if (!editor) {\n      return;\n    }\n    setPendingExternalUpdate(true);\n    setEditorContent(editor, documentToEditorValue(props.value as Contentful.Document));\n  }, [props.value, id]);\n\n  const classNames = cx(\n    styles.editor,\n    props.minHeight !== undefined ? css({ minHeight: props.minHeight }) : undefined,\n    props.isDisabled ? styles.disabled : styles.enabled,\n    props.isToolbarHidden && styles.hiddenToolbar\n  );\n\n  useEffect(() => {\n    if (!isFirstRender) {\n      return;\n    }\n\n    getPlateActions(id).value(\n      normalizeEditorValue(documentToEditorValue(props.value as Contentful.Document) as Value, {\n        plugins,\n        disableCorePlugins,\n      })\n    );\n  }, [isFirstRender, plugins, id, props.value]);\n\n  return (\n    <SdkProvider sdk={props.sdk}>\n      <ContentfulEditorIdProvider value={id}>\n        <div className={styles.root} data-test-id=\"rich-text-editor\">\n          <Plate\n            id={id}\n            plugins={plugins}\n            disableCorePlugins={disableCorePlugins}\n            editableProps={{\n              className: classNames,\n              readOnly: props.isDisabled,\n            }}\n            onChange={onValueChanged}\n            firstChildren={\n              !props.isToolbarHidden && (\n                <StickyToolbarWrapper isDisabled={props.isDisabled}>\n                  <Toolbar isDisabled={props.isDisabled} />\n                </StickyToolbarWrapper>\n              )\n            }\n          />\n        </div>\n      </ContentfulEditorIdProvider>\n    </SdkProvider>\n  );\n};\n\ntype Props = ConnectedProps & { isInitiallyDisabled: boolean };\n\nconst RichTextEditor = (props: Props) => {\n  const { sdk, isInitiallyDisabled, onAction, restrictedMarks, ...otherProps } = props;\n  const isEmptyValue = useCallback(\n    (value) => !value || deepEquals(value, Contentful.EMPTY_DOCUMENT),\n    []\n  );\n\n  const id = getContentfulEditorId(props.sdk);\n  return (\n    <EntityProvider sdk={sdk}>\n      <FieldConnector\n        throttle={0}\n        field={sdk.field}\n        isInitiallyDisabled={isInitiallyDisabled}\n        isEmptyValue={isEmptyValue}\n        isEqualValues={deepEquals}\n      >\n        {({ lastRemoteValue, disabled, setValue }) => (\n          <ConnectedRichTextEditor\n            {...otherProps}\n            key={`rich-text-editor-${id}`}\n            value={lastRemoteValue}\n            sdk={sdk}\n            onAction={onAction}\n            isDisabled={disabled}\n            onChange={setValue}\n            restrictedMarks={restrictedMarks}\n          />\n        )}\n      </FieldConnector>\n    </EntityProvider>\n  );\n};\n\nexport default RichTextEditor;\n","import { BLOCKS, INLINES } from '@contentful/rich-text-types';\n\nimport { getNodeEntries } from '../../internal/queries';\nimport { PlatePlugin } from '../../internal/types';\n\nexport function createDragAndDropPlugin(): PlatePlugin {\n  const DRAGGABLE_TYPES: string[] = [\n    BLOCKS.EMBEDDED_ENTRY,\n    BLOCKS.EMBEDDED_ASSET,\n    BLOCKS.HR,\n    INLINES.EMBEDDED_ENTRY,\n  ];\n\n  /**\n   * HTML node names where dropping should be allowed\n   * Usually for elements where `Transforms.removeNodes` is needed\n   * TODO: looking up for html nodes is not the best solution and it won't scale but it works fine for our current cases/elements\n   */\n  const ON_DROP_ALLOWED_TYPES = {\n    TABLE: [INLINES.EMBEDDED_ENTRY],\n  };\n\n  return {\n    key: 'DragAndDropPlugin',\n    handlers: {\n      // If true, the next handlers will be skipped.\n      onDrop: (editor) => (event) => {\n        const [draggingBlock] = Array.from(\n          getNodeEntries(editor, {\n            match: (node) => DRAGGABLE_TYPES.includes(node.type as string),\n          })\n        );\n        if (!draggingBlock) return false;\n\n        const [draggingNode] = draggingBlock;\n\n        if (!event.nativeEvent.target) return false;\n\n        // TODO: looking up for html nodes is not the best solution and it won't scale, we need to find a way to know the dropping target slate element\n        const dropDisallowed = getParents(event.nativeEvent.target as Node).some((node) => {\n          return ON_DROP_ALLOWED_TYPES[node.nodeName]\n            ? !ON_DROP_ALLOWED_TYPES[node.nodeName]?.includes(draggingNode.type)\n            : false;\n        });\n\n        if (!dropDisallowed) {\n          // Move the drop event to a new undo batch mitigating the bug where undo not only moves it back,\n          // but also undoes a previous action: https://github.com/ianstormtaylor/slate/issues/4694\n          editor.history.undos.push([]);\n        }\n\n        return dropDisallowed;\n      },\n    },\n  };\n}\n\nfunction getParents(el: Node): Node[] {\n  const parents: Node[] = [];\n\n  parents.push(el);\n  while (el.parentNode) {\n    parents.unshift(el.parentNode);\n    el = el.parentNode;\n  }\n\n  return parents;\n}\n","import { PlatePlugin } from '../../internal/types';\nimport { CommandPrompt } from './components/CommandPrompt';\nimport { COMMAND_PROMPT } from './constants';\nimport { createOnKeyDown } from './onKeyDown';\n\n/**\n * A command palette plugin (aka slash commands)\n *\n * How does it work?\n * * When the user presses the slash key, the editor will show a command palette\n * * When the user presses a key, the command palette will show the command suggestions\n * * When the user presses enter, the command palette will execute the command\n * * When the user presses escape, the command palette will hide\n * * When the user presses a letter, number, or space, the command palette will show the command suggestions\n * * When the user presses backspace, the command palette will remove the last character from the command string\n */\nexport const createCommandPalettePlugin = (): PlatePlugin => {\n  return {\n    key: COMMAND_PROMPT,\n    type: COMMAND_PROMPT,\n    isLeaf: true,\n    component: CommandPrompt,\n    handlers: {\n      onKeyDown: createOnKeyDown(),\n    },\n  };\n};\n","import isHotkey from 'is-hotkey';\n\nimport { getRange, getAboveNode, isMarkActive, addMark, removeMark } from '../../internal';\nimport { focusEditor } from '../../internal/misc';\nimport { KeyboardHandler, NodeEntry } from '../../internal/types';\nimport { COMMAND_PROMPT } from './constants';\n\nexport const createOnKeyDown = (): KeyboardHandler => {\n  return (editor) => {\n    return (event) => {\n      // Support for different keyboard layouts:\n      // `isHotKey` uses by default `event.which`, which will never generates a match for all layouts (QWERTY: `/`, QWERTZ: `shift+7`)\n      // with `byKey: true` `isHotKey` uses `event.key` which will return the interpreted key '/'\n      // It would still fail without the the optional `shift?` param, as it first checks the modKeys (`shiftKey` would be true on QWERTZ)\n      if (isHotkey('shift?+/', { byKey: true }, event)) {\n        addMark(editor, COMMAND_PROMPT);\n        editor.tracking.onCommandPaletteAction('openRichTextCommandPalette');\n      }\n\n      const isActive = isMarkActive(editor, COMMAND_PROMPT);\n\n      if (!isActive) {\n        return;\n      }\n\n      if (isHotkey('enter', event)) {\n        return event.preventDefault();\n      }\n\n      const [, path] = getAboveNode(editor) as NodeEntry;\n      const range = getRange(editor, path);\n\n      if (isHotkey('backspace', event)) {\n        // if it is the last character in the command string\n        if (range.focus.offset - range.anchor.offset === 1) {\n          removeMark(editor, COMMAND_PROMPT, range);\n        }\n      }\n\n      if (isHotkey('escape', event)) {\n        event.stopPropagation();\n        removeMark(editor, COMMAND_PROMPT, range);\n        editor.tracking.onCommandPaletteAction('cancelRichTextCommandPalette');\n        focusEditor(editor);\n      }\n    };\n  };\n};\n","export function isEmbedElement(element: HTMLElement) {\n  return (\n    element.hasAttribute('data-embedded-entity-inline-id') ||\n    element.hasAttribute('data-entity-type')\n  );\n}\n\nexport function isEmptyElement(element: HTMLElement) {\n  return element.textContent === '';\n}\n","import { BLOCKS, LIST_ITEM_BLOCKS } from '@contentful/rich-text-types';\nimport {\n  createListPlugin as createPlateListPlugin,\n  ELEMENT_LI,\n  ELEMENT_UL,\n  ELEMENT_OL,\n  ELEMENT_LIC,\n} from '@udecode/plate-list';\n\nimport { transformParagraphs, transformWrapIn } from '../../helpers/transformers';\nimport { PlatePlugin, PlateEditor, Value } from '../../internal/types';\nimport { ListOL, ListUL } from './components/List';\nimport { ListItem } from './components/ListItem';\nimport { onKeyDownList } from './onKeyDownList';\nimport {\n  isNonEmptyListItem,\n  hasListAsDirectParent,\n  insertParagraphAsChild,\n  normalizeOrphanedListItem,\n  firstNodeIsNotList,\n  replaceNodeWithListItems,\n} from './utils';\nimport { withList } from './withList';\n\nexport const createListPlugin = (): PlatePlugin =>\n  createPlateListPlugin<any, Value, PlateEditor>({\n    normalizer: [\n      {\n        match: {\n          type: [BLOCKS.UL_LIST, BLOCKS.OL_LIST],\n        },\n        validChildren: [BLOCKS.LIST_ITEM],\n        transform: transformWrapIn(BLOCKS.LIST_ITEM),\n      },\n    ],\n    overrideByKey: {\n      [ELEMENT_UL]: {\n        type: BLOCKS.UL_LIST,\n        component: ListUL,\n        handlers: {\n          onKeyDown: onKeyDownList,\n        },\n        // The withList is added on ELEMENT_UL plugin in upstream code\n        // so we need to override it here\n        withOverrides: withList,\n      },\n      [ELEMENT_OL]: {\n        type: BLOCKS.OL_LIST,\n        component: ListOL,\n        handlers: {\n          onKeyDown: onKeyDownList,\n        },\n      },\n      // ELEMENT_LIC is a child of li, Slate does ul > li > lic + ul\n      [ELEMENT_LIC]: {\n        type: BLOCKS.PARAGRAPH,\n      },\n      [ELEMENT_LI]: {\n        type: BLOCKS.LIST_ITEM,\n        component: ListItem,\n        // @ts-expect-error\n        normalizer: [\n          {\n            validNode: hasListAsDirectParent,\n            transform: normalizeOrphanedListItem,\n          },\n          {\n            validNode: isNonEmptyListItem,\n            transform: insertParagraphAsChild,\n          },\n          {\n            validChildren: LIST_ITEM_BLOCKS,\n            transform: transformParagraphs,\n          },\n          {\n            validNode: firstNodeIsNotList,\n            transform: replaceNodeWithListItems,\n          },\n        ],\n      },\n    },\n  });\n","import { PlatePlugin } from '../../internal/types';\nimport { createBoldPlugin } from './Bold';\nimport { createCodePlugin } from './Code';\nimport { createItalicPlugin } from './Italic';\nimport { createSubscriptPlugin } from './Subscript';\nimport { createSuperscriptPlugin } from './Superscript';\nimport { createUnderlinePlugin } from './Underline';\n\nexport const createMarksPlugin = (): PlatePlugin => ({\n  key: 'Marks',\n  plugins: [\n    createBoldPlugin(),\n    createCodePlugin(),\n    createItalicPlugin(),\n    createUnderlinePlugin(),\n    createSuperscriptPlugin(),\n    createSubscriptPlugin(),\n  ],\n});\n","import { isRootLevel } from '../../helpers/editor';\nimport { isFirstChildPath } from '../../internal/queries';\nimport { PlatePlugin } from '../../internal/types';\n\nexport const createVoidsPlugin = (): PlatePlugin => ({\n  key: 'VoidsPlugin',\n  exitBreak: [\n    {\n      // Inserts a new paragraph *before* a void element if it's the very first\n      // node on the editor\n      hotkey: 'enter',\n      before: true,\n      query: {\n        filter: ([node, path]) => isRootLevel(path) && isFirstChildPath(path) && !!node.isVoid,\n      },\n    },\n    {\n      // Inserts a new paragraph on enter when a void element is focused\n      hotkey: 'enter',\n      // exploit the internal use of Array.slice(0, level + 1) by the exitBreak plugin\n      // to stay in the parent element\n      level: -2,\n      query: {\n        filter: ([node, path]) => !(isRootLevel(path) && isFirstChildPath(path)) && !!node.isVoid,\n      },\n    },\n  ],\n});\n","import {\n  createSoftBreakPlugin as createDefaultSoftBreakPlugin,\n  SoftBreakRule,\n} from '@udecode/plate-break';\n\nimport { PlatePlugin } from '../../internal/types';\n\nexport const createSoftBreakPlugin = (): PlatePlugin =>\n  createDefaultSoftBreakPlugin({\n    then: (editor) => {\n      const rules: SoftBreakRule[] = editor.plugins.flatMap((p) => {\n        return (p as PlatePlugin).softBreak || [];\n      });\n\n      return {\n        options: { rules },\n      };\n    },\n  });\n","import {\n  createExitBreakPlugin as createDefaultExitBreakPlugin,\n  ExitBreakRule,\n} from '@udecode/plate-break';\n\nimport { PlatePlugin } from '../../internal/types';\n\nexport const createExitBreakPlugin = (): PlatePlugin =>\n  createDefaultExitBreakPlugin({\n    options: {\n      rules: [],\n    },\n    then: (editor) => {\n      const rules: ExitBreakRule[] = editor.plugins.flatMap((p) => {\n        return (p as PlatePlugin).exitBreak || [];\n      });\n\n      return {\n        options: { rules },\n      };\n    },\n  });\n","import { BLOCKS } from '@contentful/rich-text-types';\nimport {\n  createResetNodePlugin as createDefaultResetNodePlugin,\n  ResetNodePlugin,\n} from '@udecode/plate-reset-node';\n\nimport { PlatePlugin, Value, PlateEditor } from '../../internal/types';\n\nexport const createResetNodePlugin = (): PlatePlugin =>\n  createDefaultResetNodePlugin<ResetNodePlugin<Value, PlateEditor>, Value, PlateEditor>({\n    options: {\n      rules: [],\n    },\n    then: (editor) => {\n      const rules = editor.plugins.flatMap((p) => {\n        return (p as PlatePlugin).resetNode || [];\n      });\n\n      // set defaultType to Paragraph if not set\n      for (const rule of rules) {\n        if (!rule.defaultType) {\n          rule.defaultType = BLOCKS.PARAGRAPH;\n        }\n      }\n\n      return {\n        options: { rules },\n      };\n    },\n  });\n","import { PlatePlugin } from '../../internal/types';\nimport { withNormalizer } from './withNormalizer';\n\nexport const createNormalizerPlugin = (): PlatePlugin => ({\n  key: 'NormalizerPlugin',\n  withOverrides: withNormalizer,\n});\n","import React from 'react';\n\nimport {\n  TextLink,\n  Button,\n  FormControl,\n  FormLabel,\n  Select,\n  TextInput,\n  Form,\n  ModalContent,\n  ModalControls,\n} from '@contentful/f36-components';\nimport tokens from '@contentful/f36-tokens';\nimport { EntityProvider } from '@contentful/field-editor-reference';\nimport { css } from 'emotion';\nimport PropTypes from 'prop-types';\n\nimport { FetchingWrappedAssetCard } from '../../plugins/shared/FetchingWrappedAssetCard';\nimport { FetchingWrappedEntryCard } from '../../plugins/shared/FetchingWrappedEntryCard';\n\nexport const LINK_TYPES = {\n  URI: 'uri',\n  ENTRY: 'Entry',\n  ASSET: 'Asset',\n};\n\nfunction isFeaturingEntitySelector(entitySelectorConfigs = {}) {\n  return !!entitySelectorConfigs.Entry || !!entitySelectorConfigs.Asset;\n}\n\nfunction entityToLink(entity) {\n  const { id, type } = entity.sys;\n  return { sys: { id, type: 'Link', linkType: type } };\n}\n\nexport class HyperlinkDialog extends React.Component {\n  static propTypes = {\n    sdk: PropTypes.object.isRequired,\n    labels: PropTypes.shape({\n      title: PropTypes.string,\n      confirm: PropTypes.string,\n    }),\n    value: PropTypes.shape({\n      text: PropTypes.string,\n      uri: PropTypes.string,\n      target: PropTypes.object,\n      // Will be overwritten accordingly if `uri` or `target.sys.linkType` are set.\n      type: PropTypes.oneOf(['uri', 'Entry', 'Asset']),\n    }),\n    entitySelectorConfigs: PropTypes.object,\n    allowedHyperlinkTypes: PropTypes.arrayOf(\n      PropTypes.oneOf([LINK_TYPES.ENTRY, LINK_TYPES.ASSET, LINK_TYPES.URI])\n    ),\n    hideText: PropTypes.bool,\n    onClose: PropTypes.func.isRequired,\n  };\n\n  static defaultProps = {\n    labels: {\n      title: 'Insert link',\n      confirm: 'Insert link',\n    },\n    value: {},\n    hideText: false,\n    entitySelectorConfigs: {},\n    allowedHyperlinkTypes: [LINK_TYPES.ENTRY, LINK_TYPES.ASSET, LINK_TYPES.URI],\n  };\n\n  constructor(props) {\n    super(props);\n\n    const { text, type, uri, target } = props.value;\n    const isEntityLink = Boolean(target);\n    const entityLinks = {\n      [LINK_TYPES.ENTRY]: null,\n      [LINK_TYPES.ASSET]: null,\n    };\n    let linkType = type;\n\n    if (isEntityLink) {\n      linkType = target.sys.linkType;\n      entityLinks[linkType] = target;\n    } else if (props.allowedHyperlinkTypes.includes(LINK_TYPES.URI)) {\n      linkType = LINK_TYPES.URI;\n    } else {\n      linkType = props.allowedHyperlinkTypes[0];\n    }\n\n    this.state = { text, uri, entityLinks, type: linkType };\n  }\n\n  setTargetEntity(type, entity) {\n    this.setState((state) => ({\n      entityLinks: {\n        ...state.entityLinks,\n        [type]: entity ? entityToLink(entity) : undefined,\n      },\n    }));\n  }\n\n  getValue() {\n    const { text, type, uri } = this.state;\n    const value = { type };\n    if (text) {\n      value.text = text;\n    }\n    if (type === LINK_TYPES.URI) {\n      value.uri = uri;\n    } else {\n      value.target = this.state.entityLinks[type];\n    }\n    return value;\n  }\n\n  isLinkComplete() {\n    const { text, type, uri, target } = this.getValue();\n    const requiresText = !this.props.hideText;\n    if (requiresText && !text) {\n      return false;\n    }\n    return (type === LINK_TYPES.URI && uri) || target;\n  }\n\n  handleSubmit = (event) => {\n    event.preventDefault();\n    this.props.onClose(this.getValue());\n  };\n\n  selectEntry = async () => {\n    const { locale, contentTypes } = this.props.entitySelectorConfigs.Entry;\n    const entry = await this.props.sdk.dialogs.selectSingleEntry({ locale, contentTypes });\n    this.setTargetEntity(LINK_TYPES.ENTRY, entry);\n  };\n\n  selectAsset = async () => {\n    const { locale } = this.props.entitySelectorConfigs.Asset;\n    const asset = await this.props.sdk.dialogs.selectSingleAsset({ locale });\n    this.setTargetEntity(LINK_TYPES.ASSET, asset);\n  };\n\n  render() {\n    const { labels } = this.props;\n    return (\n      <EntityProvider sdk={this.props.sdk}>\n        <React.Fragment>\n          <ModalContent>{this.renderFields()}</ModalContent>\n          <ModalControls>\n            <Button\n              type=\"button\"\n              onClick={() => this.props.onClose(null)}\n              variant=\"secondary\"\n              testId=\"cancel-cta\"\n              size=\"small\">\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              variant=\"positive\"\n              onClick={this.handleSubmit}\n              isDisabled={!this.isLinkComplete()}\n              testId=\"confirm-cta\"\n              size=\"small\">\n              {labels.confirm}\n            </Button>\n          </ModalControls>\n        </React.Fragment>\n      </EntityProvider>\n    );\n  }\n\n  renderFields() {\n    const { hideText, allowedHyperlinkTypes, entitySelectorConfigs } = this.props;\n    const { uri, text, type } = this.state;\n    const isUriInputAutoFocused = type === LINK_TYPES.URI && (hideText || !!text);\n\n    return (\n      <Form>\n        {hideText ? null : (\n          <FormControl id=\"link-text\" isRequired>\n            <FormControl.Label>Link text</FormControl.Label>\n            <TextInput\n              testId=\"link-text-input\"\n              name=\"link-text\"\n              value={text || ''}\n              onChange={(e) => this.setState({ text: e.target.value })}\n              // eslint-disable-next-line -- TODO: describe this disable  jsx-a11y/no-autofocus\n              autoFocus={!isUriInputAutoFocused}\n            />\n          </FormControl>\n        )}\n        {isFeaturingEntitySelector(entitySelectorConfigs) && (\n          <FormControl id=\"link-type\" name=\"link-type\">\n            <FormControl.Label>Link type</FormControl.Label>\n            <Select\n              value={type}\n              onChange={(e) => this.setState({ type: e.target.value })}\n              testId=\"link-type-select\">\n              {/* Show the option if the link type is allowed or the current link is of type that is no longer valid */}\n              {allowedHyperlinkTypes.includes(LINK_TYPES.URI) || type === LINK_TYPES.URI ? (\n                <Select.Option value={LINK_TYPES.URI}>URL</Select.Option>\n              ) : null}\n              {allowedHyperlinkTypes.includes(LINK_TYPES.ENTRY) || type === LINK_TYPES.ENTRY ? (\n                <Select.Option value={LINK_TYPES.ENTRY}>Entry</Select.Option>\n              ) : null}\n              {allowedHyperlinkTypes.includes(LINK_TYPES.ASSET) || type === LINK_TYPES.ASSET ? (\n                <Select.Option value={LINK_TYPES.ASSET}>Asset</Select.Option>\n              ) : null}\n            </Select>\n          </FormControl>\n        )}\n        {type === LINK_TYPES.URI ? (\n          <FormControl id=\"link-uri\" isRequired>\n            <FormControl.Label>Link target</FormControl.Label>\n            <TextInput\n              testId=\"link-target-input\"\n              name=\"link-uri\"\n              value={uri || ''}\n              placeholder=\"https://\"\n              onChange={(e) => this.setState({ uri: e.target.value })}\n              // eslint-disable-next-line -- TODO: describe this disable  jsx-a11y/no-autofocus\n              autoFocus={isUriInputAutoFocused}\n            />\n            <FormControl.HelpText>A protocol may be required, e.g. https://</FormControl.HelpText>\n          </FormControl>\n        ) : (\n          this.renderEntityField()\n        )}\n      </Form>\n    );\n  }\n\n  renderEntityField() {\n    const { type, entityLinks } = this.state;\n    const resetEntity = () => this.setTargetEntity(type, null);\n    const entityLink = entityLinks[type];\n    const isEntitySelectorVisible = !entityLink;\n    return (\n      <div>\n        <FormLabel required htmlFor=\"\">\n          Link target\n        </FormLabel>\n        {!isEntitySelectorVisible && (\n          <TextLink\n            as=\"button\"\n            className={css({ marginLeft: tokens.spacingS })}\n            onClick={resetEntity}>\n            Remove selection\n          </TextLink>\n        )}\n        {entityLink && (\n          <div>\n            {type === LINK_TYPES.ENTRY && (\n              <FetchingWrappedEntryCard\n                sdk={this.props.sdk}\n                locale={this.props.entitySelectorConfigs.Entry.locale}\n                entryId={entityLink.sys.id}\n                isDisabled\n                isSelected={false}\n              />\n            )}\n            {type == LINK_TYPES.ASSET && (\n              <FetchingWrappedAssetCard\n                sdk={this.props.sdk}\n                locale={this.props.entitySelectorConfigs.Asset.locale}\n                assetId={entityLink.sys.id}\n                isDisabled\n                isSelected={false}\n              />\n            )}\n          </div>\n        )}\n        {/* Keep all entity selectors in the DOM for super fast types switching ux.*/}\n        {isEntitySelectorVisible && this.renderEntitySelector(type, isEntitySelectorVisible)}\n      </div>\n    );\n  }\n\n  renderEntitySelector(type) {\n    return (\n      <div className={css({ marginTop: tokens.spacingS })}>\n        {type === LINK_TYPES.ENTRY && (\n          <TextLink as=\"button\" onClick={this.selectEntry}>\n            Select entry\n          </TextLink>\n        )}\n        {type === LINK_TYPES.ASSET && (\n          <TextLink as=\"button\" onClick={this.selectAsset}>\n            Select asset\n          </TextLink>\n        )}\n      </div>\n    );\n  }\n}\n\nexport const openHyperlinkDialog = (\n  dialogs,\n  { value, showTextInput, allowedHyperlinkTypes, entitySelectorConfigs }\n) => {\n  const isNew = !(value.uri || value.target);\n  const props = {\n    labels: {\n      title: isNew ? 'Insert hyperlink' : 'Edit hyperlink',\n      confirm: isNew ? 'Insert' : 'Update',\n    },\n    value,\n    hideText: !showTextInput,\n    allowedHyperlinkTypes,\n    entitySelectorConfigs,\n  };\n\n  return dialogs.openCurrent({\n    title: props.labels.title,\n    width: 'large',\n    shouldCloseOnEscapePress: true,\n    shouldCloseOnOverlayClick: true,\n    allowHeightOverflow: true,\n    parameters: {\n      type: 'rich-text-hyperlink-dialog',\n      ...props,\n    },\n  });\n};\n","import React from 'react';\n\nimport { DialogExtensionSDK } from '@contentful/app-sdk';\nimport { ModalDialogLauncher } from '@contentful/field-editor-shared';\n\nimport { HyperlinkDialog } from './HypelinkDialog/HyperlinkDialog';\n\nexport const openRichTextDialog = (sdk: DialogExtensionSDK) => (options) => {\n  if (options.parameters?.type === 'rich-text-hyperlink-dialog') {\n    return ModalDialogLauncher.openDialog(options, ({ onClose }) => {\n      return <HyperlinkDialog {...options.parameters} onClose={onClose} sdk={sdk} />;\n    });\n  }\n  return Promise.reject();\n};\n","import React from 'react';\n\nimport { DialogExtensionSDK } from '@contentful/app-sdk';\n\nimport { HyperlinkDialog } from './HypelinkDialog/HyperlinkDialog';\n\nexport const renderRichTextDialog = (sdk: DialogExtensionSDK) => {\n  const parameters = sdk.parameters.invocation as Record<string, unknown>;\n  if (parameters?.type === 'rich-text-hyperlink-dialog') {\n    sdk.window.startAutoResizer();\n    return <HyperlinkDialog {...sdk.parameters.invocation} onClose={sdk.close} sdk={sdk} />;\n  }\n  return <div />;\n};\n"],"names":["useReadOnly","sr","usePlateEditorRef","p","usePlateEditorState","getContentfulEditorId","sdk","field","entry","getSys","id","locale","editorContext","createContext","ContentfulEditorIdProvider","Provider","useContentfulEditorId","contextId","useContext","Error","useContentfulEditor","editorId","withoutNormalizing","editor","fn","focusEditor","target","fromDOMPoint","domPoint","opts","exactMatch","suppressThrow","useSdk","React","constate","SdkProvider","useSdkContext","getText","at","isText","value","getStartPoint","isSelectionAtBlockStart","options","getBlockAbove","getNodeEntry","getNodeEntries","getParentNode","someNode","getChildren","s","getDescendantNodeByPath","root","path","get","isRangeCollapsed","range","getRange","to","getRangeEdges","edges","getRangeEnd","end","getAboveNode","getCommonNode","another","findNode","isMarkActive","type","isEditor","isEditorReadOnly","isElement","findNodePath","node","isAncestorPath","isAncestor","isAncestorEmpty","getParentPath","parent","getNextPath","next","getPreviousPath","previous","getLastChildPath","nodeEntry","isFirstChildPath","isLastChildPath","childPath","matchNode","someHtmlElement","rootNode","predicate","getPluginType","key","setSelection","props","select","location","moveSelection","collapseSelection","setNodes","attrs","insertNodes","nodes","splitNodes","liftNodes","unwrapNodes","wrapNodes","element","removeMark","insertText","text","deleteText","removeNodes","moveNodes","IS_SAFARI","navigator","test","userAgent","IS_CHROME","LINK_TYPES","INLINES","HYPERLINK","ENTRY_HYPERLINK","ASSET_HYPERLINK","isBlockSelected","Array","from","match","isRootLevel","length","getNodeEntryFromSelection","nodeTypeOrTypes","selection","_editor$selection","focus","nodeTypes","isArray","i","slice","includes","isNodeTypeSelected","nodeType","moveToTheNextChar","distance","unit","insertEmptyParagraph","BLOCKS","PARAGRAPH","children","data","isVoid","insertLink","url","isLinkActive","unwrapLink","isCollapsed","isSelectionCollapsed","link","uri","split","edge","wrapLink","INLINE_TYPES","Object","values","isInlineOrText","x","window","scrollX","y","scrollY","setTimeout","scrollTo","toggleElement","editorOptions","toggleNodeType","DEFAULT_ENABLED_NODE_TYPES","DOCUMENT","isFormattingOptionEnabled","validationType","nodeTypeOrMark","enabledFormattings","flow","v","find","validations","getRichTextValidation","undefined","concat","isNodeTypeEnabled","isMarkEnabled","mark","runtime","exports","Op","prototype","hasOwn","hasOwnProperty","$Symbol","Symbol","iteratorSymbol","iterator","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","obj","defineProperty","enumerable","configurable","writable","err","wrap","innerFn","outerFn","self","tryLocsList","generator","create","Generator","context","Context","_invoke","state","method","arg","done","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","record","tryCatch","makeInvokeMethod","call","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","this","getProto","getPrototypeOf","NativeIteratorPrototype","Gp","defineIteratorMethods","forEach","AsyncIterator","PromiseImpl","previousPromise","callInvokeWithMethodAndArg","resolve","reject","invoke","result","__await","then","unwrapped","error","TypeError","info","resultName","nextLoc","pushTryEntry","locs","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","iterable","iteratorMethod","isNaN","doneResult","displayName","isGeneratorFunction","genFun","ctor","constructor","name","setPrototypeOf","__proto__","awrap","async","Promise","iter","keys","object","reverse","pop","skipTempReset","prev","charAt","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","module","regeneratorRuntime","accidentalStrictMode","globalThis","Function","query","space","getAssets","items","map","asset","contentTypeName","displayTitle","entityHelpers","getAssetTitle","localeCode","defaultLocaleCode","locales","defaultTitle","sys","entity","thumbnail","fields","file","fetchEntries","contentType","getEntries","content_type","description","getEntityDescription","getEntryTitle","insertBlock","linkedEntityBlock","linkType","createNode","removeCommand","removeQuery","offset","anchor","isCommandPromptPluginEnabled","inlineAllowed","EMBEDDED_ENTRY","entriesAllowed","assetsAllowed","EMBEDDED_ASSET","styles","container","css","position","zIndex","tokens","zIndexNotification","fontWeight","fontWeightNormal","fontStyle","fontFamily","fontStackPrimary","listStyle","marginLeft","menuPoper","zIndexModal","menuContent","width","maxHeight","menuList","overflow","menuItem","display","background","border","margin","outline","fontSize","fontSizeM","lineHeight","lineHeightM","textAlign","padding","spacingXs","spacingM","wordBreak","whiteSpace","cursor","hyphens","minWidth","textDecoration","color","gray800","backgroundColor","gray100","opacity","menuItemSelected","boxShadow","glowPrimary","borderRadius","borderRadiusMedium","menuDivider","height","gray300","menuHeader","zIndexDefault","top","menuFooter","bottom","footerList","gray600","objectFit","Group","commandGroup","selectedItem","group","SectionHeading","as","marginBottom","marginTop","marginRight","commands","command","className","cx","onClick","callback","label","Asset","Flex","alignItems","gap","src","alt","Item","CommandListItems","commandItems","CommandList","textContainer","popoverContainer","popper","usePopper","current","placement","contentTypes","getCachedContentTypes","canInsertBlocks","TABLE","getCommandPermissions","useState","getEmbedEntry","entries","setCommands","replace","toLowerCase","insertSoftBreak","tracking","onCommandPaletteAction","getEmbedInline","inlineNode","contentTypeCommands","fetchAssets","assets","reduce","list","nextItem","filter","useCommands","setSelectedItem","isOpen","setIsOpen","buttons","querySelectorAll","currBtn","btn","currIndex","indexOf","scrollIntoView","block","inline","addEventListener","handleKeyDown","removeEventListener","event","isHotkey","preventDefault","click","handleMousedown","contains","document","useCommandList","tabIndex","contentEditable","role","ScreenReaderOnly","Portal","ref","style","attributes","Popover","usePortal","autoFocus","Trigger","Content","testId","Stack","spacing","CommandPrompt","startsWith","textElement","setTextElement","e","withLinkTracking","Component","onEntityFetchComplete","useCallback","onViewportAction","InternalAssetCard","AssetCard","size","isLoading","MissingEntityCard","entityType","isDisabled","onRemove","WrappedAssetCard","getEntityScheduledActions","loadEntityScheduledActions","isSelected","onEdit","isClickable","areEqual","FetchingWrappedAssetCard","useEntity","assetId","status","useEntityLoader","InternalEntryCard","EntryCard","WrappedEntryCard","getAsset","FetchingWrappedEntryCard","entryId","verticalAlign","LinkedEntityBlock","useSelected","entityId","handleEditClick","openAsset","openEntry","slideIn","handleRemoveClick","pathToElement","draggable","getLinkedContentTypeIdsForNodeType","newEntitySelectorConfigFromRichTextField","getEntityTypeFromRichTextNode","words","selectEntityAndInsert","logAction","dialogs","baseConfig","selectEntity","selectSingleAsset","selectSingleEntry","config","withCreate","ensureFollowingParagraph","entityBlock","level","lastNode","getLastNodeByLevel","isTextContainer","TEXT_CONTAINERS","EmbeddedEntityBlockToolbarIcon","onClose","handleClick","onToolbarAction","getEntityTypeFromNodeType","Menu","disabled","flexDirection","Icon","AssetIcon","EmbeddedEntryBlockIcon","variant","entityTypes","getWithEmbeddedEntityEvents","hotkey","pathToSelectedElement","onShortcutAction","createEmbeddedEntityPlugin","component","handlers","onKeyDown","deserializeHtml","rules","validAttribute","withoutChildren","getNode","el","getAttribute","createEmbeddedEntryBlockPlugin","createEmbeddedAssetBlockPlugin","getEntryStatus","scheduledIcon","spacing2Xs","FetchingWrappedInlineEntryCard","requestStatus","allContentTypes","useMemo","useEffect","title","InlineEntryCard","entryStatus","actions","MenuItem","ScheduledIconWithTooltip","ClockIcon","Text","createInlineEntryNode","icon","span","userSelect","EmbeddedEntityInline","inlineEntryNode","ToolbarEmbeddedEntityInlineButton","EmbeddedEntryInlineIcon","createEmbeddedEntityInlinePlugin","isInline","getWithEmbeddedEntryInlineEvents","dropdown","fontWeightDemiBold","fontSizeL","HEADING_1","HEADING_2","HEADING_3","HEADING_4","HEADING_5","HEADING_6","LABELS","ToolbarHeadingButton","setOpen","selected","setSelected","flat","getElementFromCurrentSelection","operations","nodeTypesByEnablement","fromEntries","Boolean","someHeadingsEnabled","Button","endIcon","ChevronDownIcon","List","isInitiallyFocused","prevOnChange","onChange","isActive","activeType","inactiveType","transformRemove","transformParagraphs","mode","extractNodes","extractParagraphs","transformUnwrap","transformWrapIn","transformLift","headings","fontWeightMedium","spacingS","createHeading","Tag","HeadingComponents","createHeadingPlugin","softBreak","allow","HEADINGS","normalizer","validChildren","_","transform","exitBreak","start","LIST_ITEM","plugins","idx","validNodeName","toUpperCase","button","tooltip","Number","zIndexTooltip","ToolbarButton","startIcon","Tooltip","content","spacingL","hr","hrSelected","colorPrimary","withHrEvents","pathToSelectedHr","HR","ToolbarHrButton","moveToTheNextLine","HorizontalRuleIcon","Hr","Slate","isFocused","removeSelectionLabel","SYS_LINK_TYPES","LINK_TYPE_SELECTION_VALUES","HyperlinkModal","enabledLinkTypes","defaultLinkType","linkText","setLinkText","setLinkType","linkTarget","setLinkTarget","linkEntity","setLinkEntity","entityToLink","EntityProvider","ModalContent","Form","FormControl","isRequired","Label","TextInput","Select","readonly","Option","HelpText","FormLabel","htmlFor","TextLink","ModalControls","addOrEditLink","targetPath","isReadOnly","selectionBeforeBlur","selectionAfterFocus","currentLinkText","isEditing","ModalDialogLauncher","openDialog","shouldCloseOnEscapePress","shouldCloseOnOverlayClick","allowHeightOverflow","ToolbarHyperlinkButton","LinkIcon","hasText","trim","getEntity","getEntry","contentTypeId","ct","entityTitle","entityDescription","jobs","entityStatus","hyperlinkWrapper","a","hyperlink","fill","gray900","EntityHyperlink","tooltipContent","setRequestStatus","fetchAllData","_target$sys","_target$sys2","entityInfo","console","log","str","substr","getScheduleTooltipContent","job","jobsCount","getEntityInfo","useEntityInfo","targetWrapperClassName","maxWidth","stopPropagation","UrlHyperlink","href","rel","isEntryAnchor","nodeName","isAssetAnchor","buildHyperlinkEventHandler","getNodeOfType","createHyperlinkPlugin","common","validNode","baseStyle","lineHeightDefault","UL_LIST","OL_LIST","createList","ListUL","ListOL","ListItem","ELEMENT_DEFAULT","hasUnliftedListItems","unwrapList","listTypes","toggleList","isRangeAcrossBlocks","res","getListItemEntry","n","listItem","commonEntry","listType","_getParentNode","_getParentNode$","startList","endList","rangeLength","Math","min","rootPathLength","ELEMENT_LIC","onKeyDownList","increase","_nodes","lics","highestLicPaths","highestLicPathRefs","lic","licPath","liPath","some","highestLiPath","createPathRef","licPathRefsToMove","licPathRef","unref","liEntry","previousListItemPath","listNode","listItemPath","previousSiblingItem","subList","getListTypes","newPath","moveListItemDown","isListNested","moveListItemUp","moveListItems","shiftKey","castArray","isList","hasListAsDirectParent","normalizeOrphanedListItem","parentList","getNearestListAncestor","isNonEmptyListItem","firstNodeIsNotList","_editor","firstNode","insertParagraphAsChild","replaceNodeWithListItems","isListTypeActive","isListRoot","validLiChildrenTypes","LIST_ITEM_BLOCKS","withList","deleteBackward","deleteForward","deleteFragment","moved","removeFirstListItem","removeListItem","onKeyDownResetNode","types","defaultType","onReset","SIMULATE_BACKSPACE","deleteBackwardList","deleteForwardList","deleteFragmentList","insertBreak","childNode","isBlockAboveEmpty","mockPlugin","ELEMENT_LI","paragraph","paragraphPath","isAtStart","isAtEnd","isSelectionAtBlockEnd","isAtStartOfListItem","shouldSplit","newListItemPath","withChildren","marks","getMarks","emptyListItemNode","fromPath","fromStartIndex","toPath","moveChildren","insertListItem","listBreak","insertListBreak","insertFragment","fragment","unwrapTextContainerAtStart","trimLiWrapper","flatMap","listRoot","textEntries","commonAncestorEntry","commonAncestor","textEntry","ancestor","getFirstAncestorOfType","trimList","firstBlockIndex","findIndex","isBlockNode","inlines","blocks","filtered","insertListFragment","normalizeNode","normalizeList","ToolbarListButton","ListBulletedIcon","ListNumberedIcon","toggleMarkAndDeactivateConflictingMarks","subs","MARKS","SUPERSCRIPT","SUBSCRIPT","toggleMark","clear","buildMarkEventHandler","markType","blue100","blue600","createMarkToolbarButton","Mark","ToolbarBoldButton","BOLD","FormatBoldIcon","bold","Bold","ToolbarCodeButton","CODE","CodeIcon","ToolbarDropdownCodeButton","code","Code","ToolbarItalicButton","ITALIC","FormatItalicIcon","italic","Italic","subscript","ToolbarSubscriptButton","SubscriptIcon","viewBox","ToolbarDropdownSubscriptButton","Subscript","superscript","ToolbarSuperscriptButton","SuperscriptIcon","ToolbarDropdownSuperscriptButton","Superscript","ToolbarUnderlineButton","UNDERLINE","FormatUnderlinedIcon","Underline","baseRules","_getParentNode2","NormalizerError","createValidatorFromTypes","createTransformerFromObject","transforms","fallback","withNormalizer","_rules","rule","isPlainObject","_transform","tr","isValidChild","invalidChildEntry","Paragraph","buildParagraphKeyDownHandler","transformers","doc","remove","selector","querySelector","isEmptyElement","textContent","tables","table","row","rows","colIndex","cells","cell","every","sanitizeHTML","html","cb","DOMParser","parseFromString","body","innerHTML","catchSlateFragment","borderLeft","gray200","paddingLeft","Quote","shouldResetQuoteOnBackspace","quote","QUOTE","hasSingleChild","isLastChild","toggleQuote","onKeyDownToggleQuote","plugin","withQuote","startingNode","startsWithBlockquote","Element","containerEntry","containerIsNotEmpty","Point","compare","isContentSelected","createQuotePlugin","resetNode","CONTAINERS","withOverrides","ToolbarQuoteButton","QuoteIcon","addRow","getNextRowPath","currentRowItem","TABLE_ROW","currentRowElem","nextRowPath","getEmptyRowNode","header","colCount","addRowBelow","currentRowPath","addRowAbove","addColumn","getNextCellPath","currentCellItem","TABLE_HEADER_CELL","TABLE_CELL","currentTableItem","newCellPath","replacePathPos","rowIdx","getEmptyCellNode","addColumnRight","currentCellPath","addColumnLeft","insertTableAndFocusFirstCell","tableEntry","selectEditor","tablePath","levels","getAncestorPathFromSelection","previousPath","replaceEmptyParagraphWithTable","getNoOfMissingTableCellsInRow","rowEntry","max","isNotEmpty","isTable","topRight","right","TableActions","isHeaderEnabled","setHeaderEnabled","close","tableItem","firstRow","isTableHeaderEnabled","canInsertRowAbove","toggleHeader","enable","setHeader","action","tableSize","numRows","numColumns","_firstRow$children","getTableSize","getCurrentTableSize","onOpen","IconButton","Divider","deleteRow","deleteColumn","deleteTable","gray400","Cell","HeaderCell","Row","Table","trimUnnecessaryTableWrapper","onKeyDownTable","defaultHandler","defaultKeyDownTable","windowSelection","getSelection","anchorNode","_windowSelection$anch","_windowSelection$anch2","above","getTableEntries","isLastCell","blurEditor","TOP_LEVEL_BLOCKS","VOID_BLOCKS","normalize","unwrapBlockByKey","getCharacterCount","contentfulSlateJSAdapter","schema","Schema","documentToPlainTextString","getPastingSource","textHtml","getData","createTrackingPlugin","onAction","trackingActions","actionName","origin","insertData","characterCountSelection","_window$getSelection","toString","characterCountBefore","characterCountAfter","source","hasTables","isTableHeaderCell","withInvalidCellChildrenTracking","transformer","childEntry","createTablePlugin","createDefaultTablePlugin","withTable","markupBefore","markupAfter","tablePasted","hasHeadersOutsideFirstRow","addTableTrackingEvents","fragments","isInsertingTable","isTableFirstFragment","currentLineHasText","insertTableFragment","overrideByKey","ELEMENT_TABLE","isNestedTable","ELEMENT_TR","emptyTableCell","howMany","ELEMENT_TH","ELEMENT_TD","ToolbarTableButton","isTableActive","TableIcon","createTextPlugin","restrictedMarks","onMouseUp","unhangRange","inlinePath","_getAboveNode","point","isEndPoint","getPointAfter","deleteEmptyParagraph","insertTextData","line","always","fixPasteAsPlainText","unsetNodes","deleteFunction","prevNode","getPointBefore","queryNode","disableCorePlugins","deserializeAst","eventEditor","hasContent","documentToEditorValue","sanitizeIncomingSlateDoc","isTextElement","toSlatejsDocument","EMPTY_DOCUMENT","STYLE_EDITOR_BORDER","borderTop","minHeight","colorWhite","overflowWrap","webkitUserModify","hiddenToolbar","enabled","EmbeddedEntityDropdownButton","onToggle","PlusIcon","EmbedEntityWidget","isEmbedDropdownOpen","setEmbedDropdownOpen","onCloseEntityDropdown","inlineEntryEmbedEnabled","blockEntryEmbedEnabled","blockAssetEmbedEnabled","toolbar","toolbarBtn","divider","embedActionsWrapper","webkitAlignSelf","alignSelf","msFlexItemAlign","formattingOptionsWrapper","msFlexAlign","webkitBoxAlign","msFlexWrap","flexWrap","Dropdown","MoreHorizontalIcon","Toolbar","validationInfo","isAnyMarkEnabled","someWithValidation","vals","validation","val","isAnyHyperlinkEnabled","isAnyBlockFormattingEnabled","isListSelected","isBlockquoteSelected","shouldDisableTables","boldItalicUnderlineAvailable","dropdownItemsAvailable","shouldShowDropdown","nativeSticky","StickyToolbarWrapper","internalMarks","isRelevantOperation","op","ConnectedRichTextEditor","handler","skip","onSkip","DRAGGABLE_TYPES","ON_DROP_ALLOWED_TYPES","noop","createDeserializeHtmlPlugin","createDeserializeAstPlugin","createDeserializeDocxPlugin","onDrop","draggingBlock","draggingNode","nativeEvent","dropDisallowed","parents","parentNode","unshift","getParents","_ON_DROP_ALLOWED_TYPE","history","undos","isLeaf","byKey","addMark","hasAttribute","createDefaultParagraphPlugin","createPlateListPlugin","ELEMENT_UL","ELEMENT_OL","createDefaultBoldPlugin","validStyle","isGoogleBoldWrapper","createDefaultCodePlugin","createDefaultItalicPlugin","createDefaultUnderlinePlugin","createDefaultSuperscriptPlugin","createDefaultSubscriptPlugin","createTrailingBlockPlugin","before","createDefaultSelectPlugin","dataTransfer","getSlateFragmentAttribute","clipboardData","DataTransfer","setData","ensureXSlateFragment","inject","pluginsByKey","KEY_DESERIALIZE_HTML","format","transformData","createDefaultSoftBreakPlugin","createDefaultExitBreakPlugin","createDefaultResetNodePlugin","isFirstRender","setIsFirstRender","setPendingExternalUpdate","onValueChanged","debounce","cleanedDocument","removeInternalMarks","toContentfulDocument","getPlateSelectors","apply","getEndPoint","setEditorContent","classNames","isToolbarHidden","getPlateActions","createPlateEditor","force","Plate","editableProps","readOnly","firstChildren","HyperlinkDialog","handleSubmit","_this","getValue","selectEntry","entitySelectorConfigs","Entry","setTargetEntity","selectAsset","isEntityLink","entityLinks","allowedHyperlinkTypes","setState","isLinkComplete","hideText","render","labels","Fragment","renderFields","_this2","confirm","isUriInputAutoFocused","_this3","isFeaturingEntitySelector","placeholder","renderEntityField","entityLink","isEntitySelectorVisible","required","_this4","renderEntitySelector","propTypes","PropTypes","shape","string","oneOf","arrayOf","bool","func","defaultProps","isInitiallyDisabled","otherProps","isEmptyValue","deepEquals","Contentful","FieldConnector","throttle","isEqualValues","lastRemoteValue","setValue","parameters","invocation","startAutoResizer"],"mappings":"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"}