"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(t),r=require("@contentful/field-editor-reference"),i=require("@contentful/field-editor-shared"),o=require("@contentful/rich-text-types"),a=require("@udecode/plate-core"),l=require("emotion"),c=e(require("fast-deep-equal")),s=e(require("lodash/noop")),u=require("slate-react"),d=require("@udecode/plate-serializer-docx"),f=require("@udecode/plate-break"),p=require("@udecode/plate-reset-node"),m=require("react-popper"),E=require("@contentful/f36-components"),y=require("@contentful/f36-utils"),h=e(require("constate")),v=e(require("is-hotkey")),g=require("slate"),S=e(require("lodash/find")),L=e(require("lodash/flow")),b=e(require("lodash/get")),C=e(require("@contentful/f36-tokens")),T=require("@contentful/f36-icons"),k=require("@udecode/plate-list"),I=e(require("lodash/castArray")),A=require("@udecode/plate-basic-marks"),N=e(require("is-plain-obj")),D=require("@udecode/plate-paragraph"),B=require("@udecode/plate-select"),O=require("@udecode/plate-table"),R=require("@contentful/contentful-slatejs-adapter"),x=require("@contentful/rich-text-plain-text-renderer"),K=require("@udecode/plate-trailing-block"),w=e(require("lodash/debounce")),_=e(require("prop-types"));function P(e,t,n,r,i,o,a){try{var l=e[o](a),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,i)}function M(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){P(o,r,i,a,l,"next",e)}function l(e){P(o,r,i,a,l,"throw",e)}a(void 0)}))}}function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function z(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,U(e,t)}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function G(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function q(e,t,n){return(q=G()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&U(i,n.prototype),i}).apply(null,arguments)}function Y(e){var t="function"==typeof Map?new Map:void 0;return(Y=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return q(e,arguments,F(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),U(n,e)})(e)}function j(e,t){return t||(t=e.slice(0)),e.raw=t,e}function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function V(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return W(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?W(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var X=u.useReadOnly,Q=a.usePlateEditorRef,$=a.usePlateEditorState;function Z(e){var t=e.field;return"rich-text-editor-"+e.entry.getSys().id+"-"+t.id+"-"+t.locale}var J=t.createContext(""),ee=J.Provider;function te(e){var n=t.useContext(J);if(e)return e;if(!n)throw new Error("could not find editor id. Please ensure the component is wrapped in <ContentfulEditorIdProvider> ");return n}function ne(e){var t=te(e);return $(t)}var re=function(e,t){return a.withoutNormalizing(e,t)},ie=function(e,t){a.focusEditor(e,t)},oe=function(e,t,n){return void 0===n&&(n={exactMatch:!1,suppressThrow:!1}),a.toSlatePoint(e,t,n)};function ae(e){var n=e.sdk;return t.useMemo((function(){return n}),[])}var le=h(ae),ce=le[0],se=le[1],ue=function(e,t){return a.getEditorString(e,t)},de=function(e){return a.isText(e)},fe=function(e,t){return a.getStartPoint(e,t)},pe=function(e,t){return a.isSelectionAtBlockStart(e,t)},me=function(e,t){return a.getBlockAbove(e,t)},Ee=function(e,t,n){return a.getNodeEntry(e,t,n)},ye=function(e,t){return a.getNodeEntries(e,t)},he=function(e,t,n){return a.getParentNode(e,t,n)},ve=function(e,t){return a.someNode(e,t)},ge=function(e){return g.Text.isText(e[0])?[]:a.getChildren(e)},Se=function(e,t){return g.Node.get(e,t)},Le=function(e){return a.isCollapsed(e)},be=function(e,t,n){return a.getRange(e,t,n)},Ce=function(e){return g.Range.edges(e)},Te=function(e){return g.Range.end(e)},ke=function(e,t){return a.getAboveNode(e,t)},Ie=function(e,t,n){return a.getCommonNode(e,t,n)},Ae=function(e,t){return a.findNode(e,t)},Ne=function(e,t){return a.isMarkActive(e,t)},De=function(e){return a.isEditor(e)},Be=function(e){return a.isEditorReadOnly(e)},Oe=function(e){return a.isElement(e)},Re=function(e,t){return a.findNodePath(e,t)},xe=function(e,t){return g.Path.isAncestor(e,t)},Ke=function(e,t){return a.isAncestorEmpty(e,t)},we=function(e){return g.Path.parent(e)},_e=function(e){return g.Path.next(e)},Pe=function(e){return g.Path.previous(e)},Me=function(e){return a.getLastChildPath(e)},He=function(e){return a.isFirstChild(e)},ze=function(e,t){return a.isLastChild(e,t)},Fe=function(e,t,n){return a.match(e,t,n)},Ue=function(e,t){return a.someHtmlElement(e,t)},Ge=function(e,t){return a.getPluginType(e,t)},qe=function(e,t){return a.setSelection(e,t)},Ye=function(e,t){return a.select(e,t)},je=function(e,t){return a.moveSelection(e,t)},We=function(e,t){return a.collapseSelection(e,t)},Ve=function(e,t,n){a.setNodes(e,t,n)},Xe=function(e,t,n){return a.insertNodes(e,t,n)},Qe=function(e,t){return a.splitNodes(e,t)},$e=function(e,t){return a.liftNodes(e,t)},Ze=function(e,t){return a.unwrapNodes(e,t)},Je=function(e,t,n){return a.wrapNodes(e,t,n)},et=function(e,t,n){a.removeMark(e,{key:t,at:n})},tt=function(e,t,n){return a.insertText(e,t,n)},nt=function(e,t){a.deleteText(e,t)},rt=function(e,t){a.removeNodes(e,t)},it=function(e,t){a.moveNodes(e,t)},ot="undefined"!=typeof navigator&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),at=/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9.]+)(:?\s|$)/.test(navigator.userAgent),lt=[o.INLINES.HYPERLINK,o.INLINES.ENTRY_HYPERLINK,o.INLINES.ASSET_HYPERLINK];function ct(e,t){return!!Array.from(ye(e,{match:function(e){return Oe(e)&&e.type===t}}))[0]}function st(e){return 1===e.length}function ut(e,t,n){var r,i;if(!(n=null!=(r=n)?r:null==(i=e.selection)?void 0:i.focus.path))return[];for(var o=Array.isArray(t)?t:[t],a=0;a<n.length;a++){var l=Ee(e,n.slice(0,a+1));if(o.includes(l[0].type))return l}return[]}function dt(e,t){return!!e&&!!ut(e,t)[0]}function ft(e){je(e,{distance:1,unit:"offset"})}function pt(e,t){Xe(e,{type:o.BLOCKS.PARAGRAPH,children:[{text:""}],data:{},isVoid:!1},t)}function mt(e,t){e.selection&&function(e,t){var n=t.text,r=t.url,i=t.target,o=t.type,a=t.path;Et(e)&&!a&&yt(e);var l=e.selection,c=l&&Le(l),s={type:o,data:{},children:c?[{text:n}]:[]};r&&(s.data={uri:r}),i&&(s.data={target:i}),a?(Ve(e,s,{at:a}),tt(e,n,{at:a}),Ye(e,a)):c?Xe(e,s):(Je(e,s,{split:!0}),nt(e),tt(e,n),We(e,{edge:"end"}))}(e,t)}function Et(e){return!!e&&!!Array.from(ye(e,{match:function(e){return!De(e)&&Oe(e)&&lt.includes(e.type)}}))[0]}function yt(e){Ze(e,{match:function(e){return!De(e)&&Oe(e)&&lt.includes(e.type)}})}var ht=Object.values(o.INLINES),vt=function(e){return de(e)||Oe(e)&&ht.includes(e.type)},gt=function(e){var t=window.scrollX,n=window.scrollY;ie(e),ot&&setTimeout((function(){window.scrollTo(t,n)}),0)};function St(e,t,n){!function(e,t,n){a.toggleNodeType(e,t,n)}(e,t,n),Ve(e,{data:{}})}var Lt=[o.BLOCKS.DOCUMENT,o.BLOCKS.PARAGRAPH,"text"],bt=function(e,t,n){var r=function(e,t){return L((function(e){return S(e,t)}),(function(e){return b(e,t)}))(e.validations)}(e,t);return void 0===r||Lt.concat(r).includes(n)},Ct=function(e,t){return bt(e,"enabledNodeTypes",t)},Tt=function(e,t){return bt(e,"enabledMarks",t)};function kt(e,t){return e(t={exports:{}},t.exports),t.exports}var It=kt((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=Object.create((t&&t.prototype instanceof d?t:d).prototype),o=new C(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var l=S(a,n);if(l){if(l===u)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=s(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,o),i}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function d(){}function f(){}function p(){}var m={};l(m,i,(function(){return this}));var E=Object.getPrototypeOf,y=E&&E(E(T([])));y&&y!==t&&n.call(y,i)&&(m=y);var h=p.prototype=d.prototype=Object.create(m);function v(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function g(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,l){var c=s(e[i],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,l)}),(function(e){r("throw",e,a,l)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,l)}))}l(c.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function S(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=s(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function b(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,l(h,"constructor",p),l(p,"constructor",f),f.displayName=l(p,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,a,"GeneratorFunction")),e.prototype=Object.create(h),e},e.awrap=function(e){return{__await:e}},v(g.prototype),l(g.prototype,o,(function(){return this})),e.AsyncIterator=g,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new g(c(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},v(h),l(h,a,"Generator"),l(h,i,(function(){return this})),l(h,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=T,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var l=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),b(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;b(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}));function At(){return(At=M(It.mark((function e(t,n){return It.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.space.getAssets({query:n});case 2:return e.abrupt("return",e.sent.items.map((function(e){return{contentTypeName:"Asset",displayTitle:i.entityHelpers.getAssetTitle({asset:e,localeCode:t.field.locale,defaultLocaleCode:t.locales.default,defaultTitle:"Untitled"}),id:e.sys.id,entity:e,thumbnail:e.fields.file&&e.fields.file[t.field.locale]&&e.fields.file[t.field.locale].url+"?h=30"}})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nt(e,t,n){return Dt.apply(this,arguments)}function Dt(){return(Dt=M(It.mark((function e(t,n,r){return It.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.space.getEntries({content_type:n.sys.id,query:r});case 2:return e.abrupt("return",e.sent.items.map((function(e){var r=i.entityHelpers.getEntityDescription({contentType:n,entity:e,localeCode:t.field.locale,defaultLocaleCode:t.locales.default}),o=i.entityHelpers.getEntryTitle({entry:e,contentType:n,localeCode:t.field.locale,defaultLocaleCode:t.locales.default,defaultTitle:"Untitled"});return{contentTypeName:n.name,displayTitle:o,id:e.sys.contentType.sys.id,description:r,entry:e}})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Bt(e,t,n){if(null!=e&&e.selection){var r=function(e,t){return{type:e,data:{target:{sys:{id:t.sys.id,type:"Link",linkType:t.sys.type}}},children:[{text:""}],isVoid:!0}}(t,n);e.selection&&ue(e,e.selection.focus.path)?Xe(e,r):Ve(e,r),gt(e)}}var Ot=function(e){var t=ke(e),n=be(e,t[1]);Ye(e,n.focus.path),et(e,"command-prompt",n),nt(e)},Rt=function(e){var t=ke(e),n=be(e,t[1]);n.focus.offset-n.anchor.offset>1&&nt(e,{at:n.focus,distance:n.focus.offset-1,reverse:!0})};function xt(e){return{inlineAllowed:Ct(e.field,o.INLINES.EMBEDDED_ENTRY),entriesAllowed:Ct(e.field,o.BLOCKS.EMBEDDED_ENTRY),assetsAllowed:Ct(e.field,o.BLOCKS.EMBEDDED_ASSET)}}var Kt={container:l.css({position:"absolute",zIndex:C.zIndexNotification,fontWeight:C.fontWeightNormal,fontStyle:"normal",fontFamily:C.fontStackPrimary,"ul, ol, dl":{listStyle:"none",marginLeft:0}}),menuPoper:l.css({zIndex:C.zIndexModal}),menuContent:l.css({width:"400px",maxHeight:"300px"}),menuList:l.css({overflow:"auto",maxHeight:"200px"}),menuItem:l.css({display:"block",width:"100%",background:"none",border:0,margin:0,outline:"none",fontSize:C.fontSizeM,lineHeight:C.lineHeightM,fontWeight:C.fontWeightNormal,position:"relative",textAlign:"left",padding:C.spacingXs+" "+C.spacingM,wordBreak:"break-word",whiteSpace:"break-spaces",cursor:"pointer",hyphens:"auto",minWidth:"150px",textDecoration:"none",color:C.gray800,"&:hover":{backgroundColor:C.gray100},"&:disabled":{opacity:.5,cursor:"auto"}}),menuItemSelected:l.css({boxShadow:"inset "+C.glowPrimary,borderRadius:C.borderRadiusMedium}),menuDivider:l.css({border:"none",width:"100%",height:"1px",background:C.gray300,margin:C.spacingXs+" 0"}),menuHeader:l.css({zIndex:C.zIndexDefault,top:0,backgroundColor:C.gray100,padding:C.spacingM}),menuFooter:l.css({position:"sticky",bottom:0,backgroundColor:C.gray100,padding:C.spacingM}),footerList:l.css({listStyle:"none",color:C.gray600,fontSize:C.fontSizeM}),thumbnail:l.css({width:"30px",height:"30px",objectFit:"cover"})},wt=function(e){var n=e.commandGroup,r=e.selectedItem;return t.createElement("section",{key:n.group},t.createElement(E.SectionHeading,{as:"h3",marginBottom:"spacingS",marginTop:"spacingS",marginLeft:"spacingM",marginRight:"spacingM"},n.group),n.commands.map((function(e){var n;return t.createElement("button",{key:e.id,id:e.id,className:l.cx(Kt.menuItem,(n={},n[Kt.menuItemSelected]=e.id===r,n)),onClick:e.callback},e.label)})),t.createElement("hr",{className:Kt.menuDivider,"aria-orientation":"horizontal"}))},_t=function(e){var n,r=e.command;return t.createElement("button",{key:r.id,id:r.id,className:l.cx(Kt.menuItem,(n={},n[Kt.menuItemSelected]=r.id===e.selectedItem,n)),onClick:r.callback},t.createElement(E.Flex,{alignItems:"center",gap:"spacingS"},r.thumbnail&&t.createElement("img",{width:"30",height:"30",src:r.thumbnail,alt:"",className:Kt.thumbnail}),t.createElement("span",null,r.label)))},Pt=function(e){var n=e.command;return t.createElement("button",{key:n.id,id:n.id,className:Kt.menuItem},n.label)},Mt=function(e){var n=e.selectedItem;return t.createElement(t.Fragment,null,e.commandItems.map((function(e){return"group"in e?t.createElement(wt,{commandGroup:e,selectedItem:n}):e.callback?t.createElement(_t,{command:e,selectedItem:n}):t.createElement(Pt,{command:e})})))},Ht=function(e){var n=e.query,r=e.editor,i=e.textContainer,a=se(),l=t.useRef(null),c=m.usePopper(i,null==l?void 0:l.current,{placement:"bottom-start"}),s=function(e,n,r){var i=e.space.getCachedContentTypes(),a=function(e,t){var n=!dt(t,o.BLOCKS.TABLE),r=xt(e);return{inlineAllowed:r.inlineAllowed,entriesAllowed:r.entriesAllowed&&n,assetsAllowed:r.assetsAllowed&&n}}(e,r),l=a.inlineAllowed,c=a.entriesAllowed,s=a.assetsAllowed,u=t.useState((function(){var t=function(t){return{id:t.sys.id,label:"Embed "+t.name,callback:function(){Nt(e,t,n).then((function(e){Rt(r),f(e.length?e.map((function(e){return{id:e.id+"-"+e.displayTitle.replace(/\W+/g,"-").toLowerCase(),label:e.displayTitle,callback:function(){if(Ot(r),r.selection){var t=r.selection;r.insertSoftBreak(),Bt(r,o.BLOCKS.EMBEDDED_ENTRY,e.entry),Ye(r,t),r.tracking.onCommandPaletteAction("insert",{nodeType:o.BLOCKS.EMBEDDED_ENTRY})}}}})):[{id:"no-results",label:"No results"}])}))}}},a=function(t){return{id:t.sys.id+"-inline",label:"Embed "+t.name+" - Inline",callback:function(){Nt(e,t,n).then((function(e){Rt(r),f(e.length?e.map((function(e){return{id:e.id+"-"+e.displayTitle.replace(/\W+/g,"-").toLowerCase(),label:e.displayTitle,callback:function(){var t={type:o.INLINES.EMBEDDED_ENTRY,children:[{text:""}],data:{target:{sys:{id:e.id,type:"Link",linkType:"Entry"}}}};Ot(r),Xe(r,t),r.insertText(""),r.tracking.onCommandPaletteAction("insert",{nodeType:o.INLINES.EMBEDDED_ENTRY})}}})):[{id:"no-results",label:"No results"}])}))}}},u=c||l?i.map((function(e){return{group:e.name,commands:c&&l?[t(e),a(e)]:c?[t(e)]:[a(e)]}})):[];return s?[].concat(u,[{group:"Assets",commands:[{id:"embed-asset",label:"Embed Asset",callback:function(){(function(e,t){return At.apply(this,arguments)})(e,n).then((function(e){Rt(r),f(e.length?e.map((function(e){return{id:e.id+"-"+e.displayTitle.replace(/\W+/g,"-").toLowerCase(),label:e.displayTitle,thumbnail:e.thumbnail,callback:function(){if(Ot(r),r.selection){var t=r.selection;r.insertSoftBreak(),Bt(r,o.BLOCKS.EMBEDDED_ASSET,e.entity),Ye(r,t),r.tracking.onCommandPaletteAction("insert",{nodeType:o.BLOCKS.EMBEDDED_ASSET})}}}})):[{id:"no-results",label:"No results"}])}))}}]}]):u})),d=u[0],f=u[1];return n?d.reduce((function(e,t){return"group"in t?t.commands.filter((function(e){return e.label.toLowerCase().includes(n.toLowerCase())})).length>0&&e.push(t):t.label.toLowerCase().includes(n.toLowerCase())&&e.push(t),e}),[]):d}(a,n,r),u=function(e,n){var r=t.useState((function(){return e.length?"group"in e[0]?e[0].commands[0].id:e[0].id:""})),i=r[0],o=r[1],a=t.useState(e.length>0),l=a[0],c=a[1];return t.useEffect((function(){if(n.current){var t=Array.from(n.current.querySelectorAll("button")),r=t.find((function(e){return e.id===i})),a=r?t.indexOf(r):0;return!r&&t.length&&(o(t[0].id),t[0].scrollIntoView({block:"nearest",inline:"start"})),e.length&&window.addEventListener("keydown",l),function(){return window.removeEventListener("keydown",l)}}function l(e){if(v("up",e)){if(e.preventDefault(),0===a)return;o(t[a-1].id),t[a-1].scrollIntoView({block:"nearest",inline:"start"})}else if(v("down",e)){if(e.preventDefault(),a===t.length-1)return;o(t[a+1].id),t[a+1].scrollIntoView({block:"nearest",inline:"start"})}else v("enter",e)&&(e.preventDefault(),r&&(o(""),r.click()))}}),[e,n,i]),t.useEffect((function(){var e=function(e){n.current&&!n.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[n]),{selectedItem:i,isOpen:l}}(s,l),d=u.selectedItem,f=u.isOpen;return s.length?t.createElement("div",{className:Kt.container,tabIndex:-1,contentEditable:!1},t.createElement("div",{role:"alert"},t.createElement(E.ScreenReaderOnly,null,"Richtext commands. Currently focused item: ",d,". Press ",t.createElement("kbd",null,"enter")," to select, ",t.createElement("kbd",null,"arrows")," to navigate, ",t.createElement("kbd",null,"escape")," to close.")),t.createElement(y.Portal,null,t.createElement("div",H({"aria-hidden":!0,ref:l,className:Kt.menuPoper,style:c.styles.popper},c.attributes.popper),t.createElement(E.Popover,{isOpen:f,usePortal:!1,autoFocus:!1},t.createElement(E.Popover.Trigger,null,t.createElement("span",null)),t.createElement(E.Popover.Content,{className:Kt.menuContent,testId:"rich-text-commands"},t.createElement("header",{className:Kt.menuHeader},t.createElement(E.SectionHeading,{marginBottom:"none"},"Richtext commands")),t.createElement("div",{className:Kt.menuList,"data-test-id":"rich-text-commands-list"},t.createElement(Mt,{commandItems:s,selectedItem:d})),t.createElement("footer",{className:Kt.menuFooter},t.createElement(E.Stack,{as:"ul",margin:"none",padding:"none",spacing:"spacingS",className:Kt.footerList},t.createElement("li",null,t.createElement("kbd",null,"↑"),t.createElement("kbd",null,"↓")," to navigate"),t.createElement("li",null,t.createElement("kbd",null,"↵")," to confirm"),t.createElement("li",null,t.createElement("kbd",null,"esc")," to close")))))))):null},zt=function(e){var n=t.useMemo((function(){return(t=e.text.text).startsWith("/")?t.slice(1):t;var t}),[e.text.text]),r=e.editor,i=t.useState(),o=i[0],a=i[1];return t.createElement("span",H({ref:function(e){a(e)}},e.attributes),e.children,t.createElement(Ht,{query:n,editor:r,textContainer:o}))};function Ft(e){return function(t){var r,i=(r=te(void 0),Q(r)),o=n.useCallback((function(){return null==i?void 0:i.tracking.onViewportAction("linkRendered")}),[i]);return n.createElement(e,H({},t,{onEntityFetchComplete:o}))}}var Ut=t.memo((function(e){return void 0===e.asset?t.createElement(E.AssetCard,{size:"default",isLoading:!0}):"failed"===e.asset?t.createElement(r.MissingEntityCard,{entityType:"Asset",isDisabled:e.isDisabled,onRemove:e.onRemove}):t.createElement(r.WrappedAssetCard,{getEntityScheduledActions:e.loadEntityScheduledActions,size:"small",isSelected:e.isSelected,isDisabled:e.isDisabled,localeCode:e.locale,defaultLocaleCode:e.sdk.locales.default,asset:e.asset,onEdit:e.onEdit,onRemove:e.isDisabled?void 0:e.onRemove,isClickable:!1})}),c);function Gt(e){var n=e.onEntityFetchComplete,i=r.useEntity("Asset",e.assetId),o=i.data,a=i.status,l=r.useEntityLoader().getEntityScheduledActions,c=t.useCallback((function(){return l("Asset",e.assetId)}),[l,e.assetId]);return t.useEffect((function(){"success"===a&&(null==n||n())}),[n,a]),t.createElement(Ut,{asset:o,sdk:e.sdk,isDisabled:e.isDisabled,isSelected:e.isSelected,loadEntityScheduledActions:c,locale:e.locale,onEdit:e.onEdit,onRemove:e.onRemove})}Ut.displayName="InternalAssetCard";var qt=t.memo((function(e){var n=e.entry,i=e.sdk,o=e.loadEntityScheduledActions;if(void 0===n)return t.createElement(E.EntryCard,{isLoading:!0});if("failed"===n)return t.createElement(r.MissingEntityCard,{entityType:"Entry",isDisabled:e.isDisabled,onRemove:e.onRemove});var a=i.space.getCachedContentTypes().find((function(e){return e.sys.id===n.sys.contentType.sys.id}));return t.createElement(r.WrappedEntryCard,{size:"default",getAsset:e.sdk.space.getAsset,getEntityScheduledActions:o,isSelected:e.isSelected,isDisabled:e.isDisabled,localeCode:e.locale,defaultLocaleCode:e.sdk.locales.default,contentType:a,entry:n,onEdit:e.onEdit,onRemove:e.isDisabled?void 0:e.onRemove,isClickable:!1})}),c);qt.displayName="ReferenceCard";var Yt=function(e){var n=e.entryId,i=e.onEntityFetchComplete,o=r.useEntity("Entry",n),a=o.data,l=o.status,c=r.useEntityLoader().getEntityScheduledActions,s=t.useCallback((function(){return c("Entry",n)}),[c,n]);return t.useEffect((function(){"success"===l&&(null==i||i())}),[i,l]),t.createElement(qt,{entry:a,sdk:e.sdk,locale:e.locale,isDisabled:e.isDisabled,isSelected:e.isSelected,onEdit:e.onEdit,onRemove:e.onRemove,loadEntityScheduledActions:s})},jt={root:l.css({marginBottom:"1.25rem !important",display:"block"}),container:l.css({display:"inline-block",verticalAlign:"text-top",width:"100%"})};function Wt(e){var t=e.attributes,r=e.children,i=e.element,o=e.onEntityFetchComplete,a=u.useSelected(),l=ne(),c=se(),s=u.useReadOnly(),d=i.data.target.sys,f=d.id,p=d.linkType,m=n.useCallback((function(){return("Asset"===p?c.navigator.openAsset:c.navigator.openEntry)(f,{slideIn:!0})}),[c,f,p]),E=n.useCallback((function(){if(l){var e=Re(l,i);rt(l,{at:e})}}),[l,i]);return n.createElement("div",H({},t,{className:jt.root,"data-entity-type":p,"data-entity-id":f,contentEditable:!!at&&void 0,draggable:!!at||void 0}),n.createElement("div",{contentEditable:!at&&void 0,draggable:!!at||void 0,className:jt.container},"Entry"===p&&n.createElement(Yt,{sdk:c,entryId:f,locale:c.field.locale,isDisabled:s,isSelected:a,onRemove:E,onEdit:m,onEntityFetchComplete:o}),"Asset"===p&&n.createElement(Gt,{sdk:c,assetId:f,locale:c.field.locale,isDisabled:s,isSelected:a,onRemove:E,onEdit:m,onEntityFetchComplete:o})),r)}function Vt(e,t){return L((function(e){return S(e,"nodes")}),(function(e){return b(e,["nodes",t])}),(function(e){return S(e,"linkContentType")}),(function(e){return b(e,"linkContentType",[])}))(e.validations)}function Xt(e,t){return{entityType:Qt(t),locale:e.locale||null,contentTypes:Vt(e,t)}}function Qt(e){var t=e.split("-");if(-1!==t.indexOf("entry"))return"Entry";if(-1!==t.indexOf("asset"))return"Asset";throw new Error("RichText node type `"+e+"` has no associated `entityType`")}function $t(e,t,n,r){return Zt.apply(this,arguments)}function Zt(){return(Zt=M(It.mark((function e(t,n,r,i){var o,a,l,c,s,u;return It.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i("openCreateEmbedDialog",{nodeType:t}),o=n.dialogs,a=Xt(n.field,t),l="Asset"===a.entityType?o.selectSingleAsset:o.selectSingleEntry,c=H({},a,{withCreate:!0}),s=r.selection,e.next=8,l(c);case 8:if(u=e.sent){e.next=12;break}return i("cancelCreateEmbedDialog",{nodeType:t}),e.abrupt("return");case 12:Ye(r,s),en(r,t,u),Jt(r),i("insert",{nodeType:t});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jt(e){var t,n=ke(e,{match:{type:[o.BLOCKS.EMBEDDED_ASSET,o.BLOCKS.EMBEDDED_ENTRY]}});if(n){var r=n[1].length-1,i=function(e,t){return a.getLastNodeByLevel(e,t)}(e,r),l=o.TEXT_CONTAINERS.includes(null!=(t=null==i?void 0:i[0].type)?t:"");0===r||l||pt(e),ft(e)}}function en(e,t,n){if(null!=e&&e.selection){var r=function(e,t){return{type:e,data:{target:{sys:{id:t.sys.id,type:"Link",linkType:t.sys.type}}},children:[{text:""}],isVoid:!0}}(t,n);e.selection&&ue(e,e.selection.focus.path)?Xe(e,r):Ve(e,r),gt(e)}}var tn,nn=l.css({marginRight:"10px"});function rn(e){var t=e.isDisabled,r=e.nodeType,i=e.onClose,o=ne(),a=se(),l=function(){var e=M(It.mark((function e(t){return It.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),o){e.next=3;break}return e.abrupt("return");case 3:return i(),e.next=6,$t(r,a,o,o.tracking.onToolbarAction);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=function(e){var t=e.toLowerCase().split("-");if(t.includes("entry"))return"Entry";if(t.includes("asset"))return"Asset";throw new Error("Node type `"+e+"` has no associated `entityType`")}(r);return n.createElement(E.Menu.Item,{disabled:t,className:"rich-text__"+r+"-list-item",onClick:l,testId:"toolbar-toggle-"+r},n.createElement(E.Flex,{alignItems:"center",flexDirection:"row"},n.createElement(E.Icon,{as:"Asset"===c?T.AssetIcon:T.EmbeddedEntryBlockIcon,className:"rich-text__embedded-entry-list-icon "+nn,variant:"secondary"}),n.createElement("span",null,c)))}var on=((tn={})[o.BLOCKS.EMBEDDED_ENTRY]="Entry",tn[o.BLOCKS.EMBEDDED_ASSET]="Asset",tn);function an(e,t){return function(n,r){var i=r.options.hotkey;return function(r){var o=ut(n,e)[1];o?("Delete"===r.key||"Backspace"===r.key)&&(r.preventDefault(),rt(n,{at:o})):i&&v(i,r)&&$t(e,t,n,n.tracking.onShortcutAction)}}}var ln=function(e,t){return function(n){return{key:e,type:e,isElement:!0,isVoid:!0,component:Ft(Wt),options:{hotkey:t},handlers:{onKeyDown:an(e,n)},deserializeHtml:{rules:[{validAttribute:{"data-entity-type":on[e]}}],withoutChildren:!0,getNode:function(t){return{type:e,children:[{text:""}],isVoid:!0,data:{target:{sys:{id:t.getAttribute("data-entity-id"),linkType:t.getAttribute("data-entity-type"),type:"Link"}}}}}}}}},cn=ln(o.BLOCKS.EMBEDDED_ENTRY,"mod+shift+e"),sn=ln(o.BLOCKS.EMBEDDED_ASSET,"mod+shift+a"),un=i.entityHelpers.getEntryTitle,dn=i.entityHelpers.getEntryStatus,fn={scheduledIcon:l.css({verticalAlign:"text-bottom",marginRight:C.spacing2Xs})};function pn(e){var t=r.useEntity("Entry",e.entryId),i=t.data,a=t.status,l=r.useEntityLoader().getEntityScheduledActions,c=e.sdk.space.getCachedContentTypes(),s=e.onEntityFetchComplete,u=n.useMemo((function(){if(i&&c)return c.find((function(e){return e.sys.id===i.sys.contentType.sys.id}))}),[c,i]);n.useEffect((function(){"success"===a&&(null==s||s())}),[a,s]);var d=u?u.name:"",f=n.useMemo((function(){return un({entry:i,contentType:u,localeCode:e.sdk.field.locale,defaultLocaleCode:e.sdk.locales.default,defaultTitle:"Untitled"})}),[i,u,e.sdk.field.locale,e.sdk.locales.default]);if("error"===a)return n.createElement(E.InlineEntryCard,{title:"Entry missing or inaccessible",testId:o.INLINES.EMBEDDED_ENTRY,isSelected:e.isSelected});if("loading"===a)return n.createElement(E.InlineEntryCard,{isLoading:!0});var p=dn(i.sys);return"deleted"===p?n.createElement(E.InlineEntryCard,{title:"Entry missing or inaccessible",testId:o.INLINES.EMBEDDED_ENTRY,isSelected:e.isSelected,actions:[n.createElement(E.MenuItem,{key:"remove",onClick:e.onRemove,testId:"delete"},"Remove")]}):n.createElement(E.InlineEntryCard,{testId:o.INLINES.EMBEDDED_ENTRY,isSelected:e.isSelected,title:d+": "+f,status:p,actions:[n.createElement(E.MenuItem,{key:"edit",onClick:e.onEdit},"Edit"),n.createElement(E.MenuItem,{key:"remove",onClick:e.onRemove,disabled:e.isDisabled,testId:"delete"},"Remove")]},n.createElement(r.ScheduledIconWithTooltip,{getEntityScheduledActions:function(){return l("Entry",e.entryId)},entityType:"Entry",entityId:i.sys.id},n.createElement(T.ClockIcon,{className:fn.scheduledIcon,variant:"muted",testId:"scheduled-icon"})),n.createElement(E.Text,null,f))}function mn(e){return{type:o.INLINES.EMBEDDED_ENTRY,children:[{text:""}],data:{target:{sys:{id:e,type:"Link",linkType:"Entry"}}}}}var En,yn,hn,vn,gn,Sn,Ln,bn,Cn,Tn,kn={icon:l.css({marginRight:"10px"}),root:l.css({display:"inline-block",margin:"0 "+C.spacing2Xs,fontSize:"inherit",span:{userSelect:"none"}})};function In(e){var n=ne(),r=se(),i=u.useSelected(),o=e.element.data.target.sys.id,a=u.useReadOnly();return t.createElement("span",H({},e.attributes,{className:kn.root,"data-embedded-entity-inline-id":o,contentEditable:!!at&&void 0,draggable:!!at||void 0}),t.createElement("span",{contentEditable:!at&&void 0,draggable:!!at||void 0},t.createElement(pn,{sdk:r,entryId:o,isSelected:i,isDisabled:a,onRemove:function(){if(n){var t=Re(n,e.element);rt(n,{at:t})}},onEdit:function(){return r.navigator.openEntry(o,{slideIn:!0})},onEntityFetchComplete:e.onEntityFetchComplete})),e.children)}function An(e,t,n){return Nn.apply(this,arguments)}function Nn(){return(Nn=M(It.mark((function e(t,n,r){var i,a,l,c;return It.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r("openCreateEmbedDialog",{nodeType:o.INLINES.EMBEDDED_ENTRY}),i=H({},Xt(n.field,o.INLINES.EMBEDDED_ENTRY),{withCreate:!0}),a=t.selection,e.next=5,n.dialogs.selectSingleEntry(i);case 5:if(l=e.sent,gt(t),l){e.next=10;break}return r("cancelCreateEmbedDialog",{nodeType:o.INLINES.EMBEDDED_ENTRY}),e.abrupt("return");case 10:return c=mn(l.sys.id),r("insert",{nodeType:o.INLINES.EMBEDDED_ENTRY}),e.abrupt("return",new Promise((function(e){setTimeout((function(){qe(t,a),Xe(t,c),e()}),0)})));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dn(e){var n=ne(),r=se();function i(){return(i=M(It.mark((function t(i){return It.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i.preventDefault(),n){t.next=3;break}return t.abrupt("return");case 3:return e.onClose(),t.next=6,An(n,r,n.tracking.onToolbarAction);case 6:ft(n);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return t.createElement(E.Menu.Item,{disabled:e.isDisabled,className:"rich-text__entry-link-block-button",testId:"toolbar-toggle-"+o.INLINES.EMBEDDED_ENTRY,onClick:function(e){return i.apply(this,arguments)}},t.createElement(E.Flex,{alignItems:"center",flexDirection:"row"},t.createElement(T.EmbeddedEntryInlineIcon,{variant:"secondary",className:"rich-text__embedded-entry-list-icon "+kn.icon}),t.createElement("span",null,"Inline entry")))}function Bn(e){return{key:o.INLINES.EMBEDDED_ENTRY,type:o.INLINES.EMBEDDED_ENTRY,isElement:!0,isInline:!0,isVoid:!0,component:Ft(In),options:{hotkey:"mod+shift+2"},handlers:{onKeyDown:On(e)},deserializeHtml:{rules:[{validAttribute:"data-embedded-entity-inline-id"}],withoutChildren:!0,getNode:function(e){return mn(e.getAttribute("data-embedded-entity-inline-id"))}}}}function On(e){return function(t,n){var r=n.options.hotkey;return function(n){t&&r&&v(r,n)&&An(t,e,t.tracking.onShortcutAction)}}}var Rn={dropdown:(Cn={root:l.css(En||(En=j(["\n      font-weight: ",";\n    "])),C.fontWeightDemiBold)},Cn[o.BLOCKS.PARAGRAPH]=l.css(yn||(yn=j(["\n      font-size: ",";\n    "])),C.fontSizeL),Cn[o.BLOCKS.HEADING_1]=l.css(hn||(hn=j(["\n      font-size: 1.625rem;\n    "]))),Cn[o.BLOCKS.HEADING_2]=l.css(vn||(vn=j(["\n      font-size: 1.4375rem;\n    "]))),Cn[o.BLOCKS.HEADING_3]=l.css(gn||(gn=j(["\n      font-size: 1.25rem;\n    "]))),Cn[o.BLOCKS.HEADING_4]=l.css(Sn||(Sn=j(["\n      font-size: 1.125rem;\n    "]))),Cn[o.BLOCKS.HEADING_5]=l.css(Ln||(Ln=j(["\n      font-size: 1rem;\n    "]))),Cn[o.BLOCKS.HEADING_6]=l.css(bn||(bn=j(["\n      font-size: 0.875rem;\n    "]))),Cn)},xn=((Tn={})[o.BLOCKS.PARAGRAPH]="Normal text",Tn[o.BLOCKS.HEADING_1]="Heading 1",Tn[o.BLOCKS.HEADING_2]="Heading 2",Tn[o.BLOCKS.HEADING_3]="Heading 3",Tn[o.BLOCKS.HEADING_4]="Heading 4",Tn[o.BLOCKS.HEADING_5]="Heading 5",Tn[o.BLOCKS.HEADING_6]="Heading 6",Tn);function Kn(e){var n=se(),r=ne(),i=t.useState(!1),a=i[0],c=i[1],s=t.useState(o.BLOCKS.PARAGRAPH),u=s[0],d=s[1];t.useEffect((function(){if(null!=r&&r.selection){var e=function(e){return e.selection?Array.from(ye(e,{at:e.selection,match:function(e){return Oe(e)}})).flat():[]}(r)[0].type;d(xn[e]?e:o.BLOCKS.PARAGRAPH)}}),[null==r?void 0:r.operations,null==r?void 0:r.selection]);var f=t.useMemo((function(){var e=Object.fromEntries(Object.keys(xn).map((function(e){return[e,Ct(n.field,e)]})));return[e,Object.values(e).filter(Boolean).length>0]}),[n.field]),p=f[0],m=f[1];return r?t.createElement(E.Menu,{isOpen:a,onClose:function(){return c(!1)}},t.createElement(E.Menu.Trigger,null,t.createElement(E.Button,{size:"small",testId:"toolbar-heading-toggle",variant:"transparent",endIcon:t.createElement(T.ChevronDownIcon,null),isDisabled:e.isDisabled,onClick:function(){return m&&c(!a)}},xn[u])),t.createElement(E.Menu.List,{testId:"dropdown-heading-list"}," ",Object.keys(xn).map((function(n){return p[n]&&t.createElement(E.Menu.Item,{key:n,isInitiallyFocused:u===n,onClick:(i=n,function(e){if(e.preventDefault(),null!=r&&r.selection){d(i),c(!1);var t=r.onChange;r.onChange=function(){gt(r),r.onChange=t,t.apply(void 0,arguments)};var n=ct(r,i);r.tracking.onToolbarAction(n?"remove":"insert",{nodeType:i}),St(r,{activeType:i,inactiveType:i})}}),testId:"dropdown-option-"+n,disabled:e.isDisabled},t.createElement("span",{className:l.cx(Rn.dropdown.root,Rn.dropdown[n])},xn[n]));var i})).filter(Boolean))):null}var wn,_n,Pn,Mn,Hn,zn,Fn,Un,Gn,qn,Yn,jn,Wn,Vn,Xn,Qn,$n,Zn,Jn=function(e,t){rt(e,{at:t[1]})},er=function(e,t){var n=t[1],r=function(e,t){return function(e,t,n){return Array.from(ye(e,{match:{type:o.TEXT_CONTAINERS},at:t,mode:"lowest"})).map((function(e){return e[0]}))}(e,t).map((function(e){return H({},e,{type:o.BLOCKS.PARAGRAPH})}))}(e,n);Jn(e,t),Xe(e,r,{at:n})},tr=function(e,t){Ze(e,{at:t[1]})},nr=function(e){return function(t,n){Je(t,{type:e,data:{},children:[]},{at:n[1]})}},rr=function(e,t){$e(e,{at:t[1]})},ir={dropdown:(Gn={root:l.css(wn||(wn=j(["\n      font-weight: ",";\n    "])),C.fontWeightDemiBold)},Gn[o.BLOCKS.PARAGRAPH]=l.css(_n||(_n=j(["\n      font-size: ",";\n    "])),C.fontSizeL),Gn[o.BLOCKS.HEADING_1]=l.css(Pn||(Pn=j(["\n      font-size: 1.625rem;\n    "]))),Gn[o.BLOCKS.HEADING_2]=l.css(Mn||(Mn=j(["\n      font-size: 1.4375rem;\n    "]))),Gn[o.BLOCKS.HEADING_3]=l.css(Hn||(Hn=j(["\n      font-size: 1.25rem;\n    "]))),Gn[o.BLOCKS.HEADING_4]=l.css(zn||(zn=j(["\n      font-size: 1.125rem;\n    "]))),Gn[o.BLOCKS.HEADING_5]=l.css(Fn||(Fn=j(["\n      font-size: 1rem;\n    "]))),Gn[o.BLOCKS.HEADING_6]=l.css(Un||(Un=j(["\n      font-size: 0.875rem;\n    "]))),Gn),headings:($n={root:l.css(qn||(qn=j(["\n      font-weight: ",";\n      line-height: 1.3;\n      margin: 0 0 ",";\n    "])),C.fontWeightMedium,C.spacingS)},$n[o.BLOCKS.HEADING_1]=l.css(Yn||(Yn=j(["\n      font-size: 1.875rem;\n    "]))),$n[o.BLOCKS.HEADING_2]=l.css(jn||(jn=j(["\n      font-size: 1.5625rem;\n    "]))),$n[o.BLOCKS.HEADING_3]=l.css(Wn||(Wn=j(["\n      font-size: 1.375rem;\n    "]))),$n[o.BLOCKS.HEADING_4]=l.css(Vn||(Vn=j(["\n      font-size: 1.25rem;\n    "]))),$n[o.BLOCKS.HEADING_5]=l.css(Xn||(Xn=j(["\n      font-size: 1.125rem;\n    "]))),$n[o.BLOCKS.HEADING_6]=l.css(Qn||(Qn=j(["\n      font-size: 1rem;\n    "]))),$n)};function or(e,n){return function(r){return t.createElement(e,H({},r.attributes,{className:l.cx(ir.headings.root,ir.headings[n])}),r.children)}}var ar,lr,cr,sr=((Zn={})[o.BLOCKS.HEADING_1]=t.memo(or("h1",o.BLOCKS.HEADING_1)),Zn[o.BLOCKS.HEADING_2]=t.memo(or("h2",o.BLOCKS.HEADING_2)),Zn[o.BLOCKS.HEADING_3]=t.memo(or("h3",o.BLOCKS.HEADING_3)),Zn[o.BLOCKS.HEADING_4]=t.memo(or("h4",o.BLOCKS.HEADING_4)),Zn[o.BLOCKS.HEADING_5]=t.memo(or("h5",o.BLOCKS.HEADING_5)),Zn[o.BLOCKS.HEADING_6]=t.memo(or("h6",o.BLOCKS.HEADING_6)),Zn),ur=function(){var e;return{key:"HeadingPlugin",softBreak:[{hotkey:"shift+enter",query:{allow:o.HEADINGS}}],normalizer:[{match:{type:o.HEADINGS},validChildren:function(e,t){return vt(t[0])},transform:(e={},e[o.BLOCKS.PARAGRAPH]=tr,e.default=rr,e)}],then:function(e){return{exitBreak:[{hotkey:"enter",query:{allow:o.HEADINGS,end:!0,start:!0,filter:function(t){return!ke(e,{at:t[1],match:{type:o.BLOCKS.LIST_ITEM}})&&!Ne(e,"command-prompt")}}}]}},plugins:o.HEADINGS.map((function(e,t){var n,r=t+1;return{key:e,type:e,isElement:!0,component:sr[e],options:{hotkey:["mod+alt+"+r]},handlers:{onKeyDown:(n=e,function(e,t){var r=t.options.hotkey;return function(t){if(e.selection&&r&&v(r,t)){var i=ct(e,n);e.tracking.onShortcutAction(i?"remove":"insert",{nodeType:n}),St(e,{activeType:n,inactiveType:o.BLOCKS.PARAGRAPH})}}})},deserializeHtml:{rules:[{validNodeName:("h"+r).toUpperCase()}]}}}))}},dr={button:l.css({height:"30px",width:"30px",marginLeft:C.spacing2Xs,marginRight:C.spacing2Xs}),tooltip:l.css({zIndex:Number(C.zIndexTooltip)})};function fr(e){var t=e.title,r=e.testId,i=e.isActive,o=e.children,a=e.isDisabled,c=void 0!==a&&a,s=n.createElement(E.Button,{className:l.cx(dr.button,e.className),isDisabled:c,startIcon:o,onClick:function(t){t.preventDefault(),e.onClick()},testId:r,variant:i?"secondary":"transparent",size:"small"});return t?n.createElement(E.Tooltip,{className:dr.tooltip,placement:"bottom",content:t},s):s}var pr={container:l.css(ar||(ar=j(["\n    margin: 0 0 ",";\n  "])),C.spacingL),hr:l.css(lr||(lr=j(["\n    margin: 0;\n    height: ",";\n    background: transparent;\n    position: relative;\n    border: 0;\n    user-select: none;\n    &:hover {\n      cursor: pointer;\n    }\n    &::after {\n      content: '';\n      position: absolute;\n      width: 100%;\n      height: 1px;\n      background: ",";\n      top: 50%;\n    }\n  "])),C.spacingM,C.gray300),hrSelected:l.css(cr||(cr=j(["\n    &::after {\n      background: ",";\n      -webkit-box-shadow: 0px 0px 5px ",";\n      box-shadow: 0px 0px 5px ",";\n    }\n  "])),C.colorPrimary,C.colorPrimary,C.colorPrimary)};function mr(e){return function(t){if(e){var n=ut(e,o.BLOCKS.HR)[1];n&&("Backspace"===t.key||"Delete"===t.key)&&(t.preventDefault(),rt(e,{at:n}))}}}function Er(e){var n=ne();return n?t.createElement(fr,{title:"HR",isDisabled:e.isDisabled,onClick:function(){if(null!=n&&n.selection){var e={type:o.BLOCKS.HR,data:{},children:[{text:""}],isVoid:!0};ue(n,n.selection.focus.path)?Xe(n,e):Ve(n,e),function(e){je(e,{distance:1,unit:"line"})}(n),gt(n)}},testId:"hr-toolbar-button",isActive:ct(n,o.BLOCKS.HR)},t.createElement(T.HorizontalRuleIcon,null)):null}function yr(e){var n=u.useSelected(),r=u.useFocused();return t.createElement("div",H({},e.attributes,{className:pr.container,"data-void-element":o.BLOCKS.HR}),t.createElement("div",{draggable:!0,contentEditable:!1},t.createElement("hr",{className:l.cx(pr.hr,n&&r?pr.hrSelected:void 0)})),e.children)}var hr,vr,gr,Sr={removeSelectionLabel:l.css(hr||(hr=j(["\n    margin-left: ",";\n  "])),C.spacingS)},Lr=((vr={})[o.INLINES.ENTRY_HYPERLINK]="Entry",vr[o.INLINES.ASSET_HYPERLINK]="Asset",vr),br=((gr={})[o.INLINES.HYPERLINK]="URL",gr[o.INLINES.ENTRY_HYPERLINK]="Entry",gr[o.INLINES.ASSET_HYPERLINK]="Asset",gr);function Cr(e){var n,i,a,l,c=lt.filter((function(t){return Ct(e.sdk.field,t)})),s=c[0],u=t.useState(null!=(n=e.linkText)?n:""),d=u[0],f=u[1],p=t.useState(null!=(i=e.linkType)?i:s),m=p[0],y=p[1],h=t.useState(null!=(a=e.linkTarget)?a:""),v=h[0],g=h[1],S=t.useState(null!=(l=e.linkEntity)?l:null),L=S[0],b=S[1];function C(e){var t=e.sys;return{sys:{id:t.id,type:"Link",linkType:t.type}}}function T(){return(T=M(It.mark((function t(){var n,r;return It.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={locale:e.sdk.field.locale,contentTypes:Vt(e.sdk.field,o.INLINES.ENTRY_HYPERLINK)},t.next=3,e.sdk.dialogs.selectSingleEntry(n);case 3:r=t.sent,g(""),b(C(r));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function k(){return(k=M(It.mark((function t(){var n,r;return It.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={locale:e.sdk.field.locale},t.next=3,e.sdk.dialogs.selectSingleAsset(n);case 3:r=t.sent,g(""),b(C(r));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return t.createElement(r.EntityProvider,{sdk:e.sdk},t.createElement(t.Fragment,null,t.createElement(E.ModalContent,null,t.createElement(E.Form,null,!e.linkType&&t.createElement(E.FormControl,{id:"link-text",isRequired:!0},t.createElement(E.FormControl.Label,null,"Link text"),t.createElement(E.TextInput,{testId:"link-text-input",name:"link-text",value:d,onChange:function(e){return f(e.target.value)}})),c.length>1&&t.createElement(E.FormControl,{id:"link-type"},t.createElement(E.FormControl.Label,null,"Link type"),t.createElement(E.Select,{value:m,onChange:function(e){return y(e.target.value)},testId:"link-type-input",isDisabled:e.readonly},c.map((function(e){return t.createElement(E.Select.Option,{key:e,value:e},br[e])})))),m===o.INLINES.HYPERLINK&&t.createElement(E.FormControl,{id:"linkTarget",isRequired:!0},t.createElement(E.FormControl.Label,null,"Link target"),t.createElement(E.TextInput,{name:"linkTarget",value:v,onChange:function(e){b(null),g(e.target.value)},testId:"link-target-input",isDisabled:e.readonly}),t.createElement(E.FormControl.HelpText,null,"A protocol may be required, e.g. https://")),m!==o.INLINES.HYPERLINK&&t.createElement("div",null,t.createElement(E.FormLabel,{isRequired:!0,htmlFor:""},"Link target"," "),L&&L.sys.linkType===Lr[m]?t.createElement(t.Fragment,null,!e.readonly&&t.createElement(E.TextLink,{testId:"entity-selection-link",onClick:function(e){e.preventDefault(),b(null)},className:Sr.removeSelectionLabel},"Remove selection"),t.createElement("div",null,m===o.INLINES.ENTRY_HYPERLINK&&t.createElement(Yt,{sdk:e.sdk,locale:e.sdk.field.locale,entryId:L.sys.id,isDisabled:!0,isSelected:!1}),m===o.INLINES.ASSET_HYPERLINK&&t.createElement(Gt,{sdk:e.sdk,locale:e.sdk.field.locale,assetId:L.sys.id,isDisabled:!0,isSelected:!1}))):t.createElement("div",null,m===o.INLINES.ENTRY_HYPERLINK&&t.createElement(E.TextLink,{testId:"entity-selection-link",onClick:function(){return T.apply(this,arguments)}},"Select entry"),m===o.INLINES.ASSET_HYPERLINK&&t.createElement(E.TextLink,{testId:"entity-selection-link",onClick:function(){return k.apply(this,arguments)}},"Select asset"))))),t.createElement(E.ModalControls,null,t.createElement(E.Button,{type:"button",onClick:function(){return e.onClose(null)},variant:"secondary",testId:"cancel-cta",size:"small"},"Cancel"),t.createElement(E.Button,{type:"submit",variant:"positive",size:"small",isDisabled:e.readonly||!(m===o.INLINES.HYPERLINK?d&&v:Object.keys(Lr).includes(m)&&d&&L),onClick:function(t){t.preventDefault(),e.onClose({linkText:d,linkType:m,linkTarget:v,linkEntity:L})},testId:"confirm-cta"},e.linkType?"Update":"Insert"))))}function Tr(e,t,n,r){return kr.apply(this,arguments)}function kr(){return(kr=M(It.mark((function e(n,r,o,a){var l,c,s,u,d,f,p,m,E,y,h,v,g,S,L,b,C,T;return It.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=Be(n),s=n.selection?H({},n.selection):void 0,a||s){e.next=4;break}return e.abrupt("return");case 4:return m=ut(n,lt,a),y=m[1],(E=m[0])&&y&&(u=E.type,d=ue(n,y),f=E.data.uri||"",p=E.data.target),h=null!=a?a:s,v=d||(n.selection?ue(n,n.selection):""),g=Boolean(E&&y),o(g?"openEditHyperlinkDialog":"openCreateHyperlinkDialog"),e.next=12,i.ModalDialogLauncher.openDialog({title:g?"Edit hyperlink":"Insert hyperlink",width:"large",shouldCloseOnEscapePress:!0,shouldCloseOnOverlayClick:!0,allowHeightOverflow:!0},(function(e){return t.createElement(Cr,{linkTarget:f,linkText:v,linkType:u,linkEntity:p,onClose:e.onClose,sdk:r,readonly:c})}));case 12:if(S=e.sent,Ye(n,h),S){e.next=18;break}return gt(n),o(g?"cancelEditHyperlinkDialog":"cancelCreateHyperlinkDialog"),e.abrupt("return");case 18:L=S.linkText,b=S.linkTarget,C=S.linkType,T=S.linkEntity,re(n,(function(){mt(n,{text:L,url:b,type:C,target:T,path:y})})),o(g?"edit":"insert",{nodeType:C,linkType:null!=(l=null==T?void 0:T.sys.linkType)?l:"uri"}),gt(n);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ir(e){var n=ne(),r=!(!n||!Et(n)),i=se();function o(){return(o=M(It.mark((function e(){return It.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:r?(yt(n),n.tracking.onToolbarAction("unlinkHyperlinks")):Tr(n,i,n.tracking.onToolbarAction);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return n?t.createElement(fr,{title:"Hyperlink",testId:"hyperlink-toolbar-button",onClick:function(){return o.apply(this,arguments)},isActive:r,isDisabled:e.isDisabled},t.createElement(T.LinkIcon,null)):null}var Ar=function(e,t){var n=t[1];return!a.isAncestorEmpty(e,t[0])&&""!==ue(e,n).trim()};function Nr(){return(Nr=M(It.mark((function e(t){var n,r,o,a,l,c,s,u,d,f,p,m,E;return It.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sdk,r=t.entityId,a=t.localeCode,l=t.defaultLocaleCode,s="Entry"===(o=t.entityType)?n.space.getEntry:n.space.getAsset,e.next=4,s(r);case 4:return(u=e.sent).sys.contentType&&(d=u.sys.contentType.sys.id,c=n.space.getCachedContentTypes().find((function(e){return e.sys.id===d}))),f="Entry"===o?i.entityHelpers.getEntryTitle({entry:u,contentType:c,localeCode:a,defaultLocaleCode:l,defaultTitle:"Untitled"}):i.entityHelpers.getAssetTitle({asset:u,localeCode:a,defaultLocaleCode:l,defaultTitle:"Untitled"}),p=i.entityHelpers.getEntityDescription({entity:u,contentType:c,localeCode:a,defaultLocaleCode:l}),e.next=10,n.space.getEntityScheduledActions(o,r);case 10:return m=e.sent,E=i.entityHelpers.getEntryStatus(u.sys),e.abrupt("return",{jobs:m,entity:u,entityTitle:f,entityDescription:p,entityStatus:E,contentTypeName:c?c.name:""});case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Dr={hyperlinkWrapper:l.css({display:"inline",position:"static",a:{fontSize:"inherit !important"}}),hyperlink:l.css({fontSize:"inherit !important",display:"inline !important","&:hover":{fill:C.gray900},"&:focus":{fill:C.gray900}})};function Br(e){var n=ne(),i=se(),o=e.element.data.target,a=function(e){var n,i,o,a,l,c,s,u=(i=(n=e).sdk,o=n.target,a=n.onEntityFetchComplete,c=(l=t.useState({type:"loading"}))[0],s=l[1],t.useEffect((function(){var e,t;o&&function(e){return Nr.apply(this,arguments)}({sdk:i,entityId:null==o||null==(e=o.sys)?void 0:e.id,entityType:null==o||null==(t=o.sys)?void 0:t.linkType,localeCode:i.field.locale,defaultLocaleCode:i.locales.default}).then((function(e){s({type:"success",data:e})})).catch((function(e){console.log(e),s({type:"error",error:e})})).finally((function(){null==a||a()}))}),[i,o,a]),c),d=e.target.sys.linkType;return"loading"===u.type?"Loading "+d.toLowerCase()+"...":"error"===u.type?d+" missing or inaccessible":function(e){if(!e)return"";var t,n=e.entityStatus,i=e.jobs;return(e.contentTypeName||"Asset")+' "'+(("string"==typeof(t=e.entityTitle)&&t.length>60?t&&t.substr(0,61).replace(/(\s+\S(?=\S)|\s*)\.?.$/,"…"):t)||"Untitled")+'", '+n+" "+(i.length>0?r.getScheduleTooltipContent({job:i[0],jobsCount:i.length}):"")}(u.data)}({target:o,sdk:i,onEntityFetchComplete:e.onEntityFetchComplete});return o?t.createElement(E.Tooltip,{content:a,targetWrapperClassName:Dr.hyperlinkWrapper,placement:"bottom",maxWidth:"auto"},t.createElement(E.TextLink,{as:"a",onClick:function(e){if(e.preventDefault(),e.stopPropagation(),n){var t=oe(n,[e.target,0]);t&&Tr(n,i,n.tracking.onViewportAction,t.path)}},className:Dr.hyperlink,"data-link-type":o.sys.linkType,"data-link-id":o.sys.id},e.children)):null}function Or(e){var n=ne(),r=se(),i=e.element.data.uri;return t.createElement(E.Tooltip,{content:i,targetWrapperClassName:Dr.hyperlinkWrapper,placement:"bottom",maxWidth:"auto"},t.createElement(E.TextLink,{as:"a",href:i,rel:"noopener noreferrer",onClick:function(e){if(e.preventDefault(),e.stopPropagation(),n){var t=oe(n,[e.target,0],{exactMatch:!1,suppressThrow:!1});Tr(n,r,n.tracking.onViewportAction,null==t?void 0:t.path)}},className:Dr.hyperlink},e.children))}var Rr,xr,Kr,wr,_r=function(e){return"A"===e.nodeName&&"Entry"===e.getAttribute("data-link-type")},Pr=function(e){return"A"===e.nodeName&&"Asset"===e.getAttribute("data-link-type")},Mr=function(e){return function(t,n){var r=n.options.hotkey;return function(n){t.selection&&(r&&!v(r,n)||(Et(t)?(yt(t),t.tracking.onShortcutAction("unlinkHyperlinks")):Tr(t,e,t.tracking.onShortcutAction)))}}},Hr=function(e){return function(t,n){return{type:e,children:n.children,data:e===o.INLINES.HYPERLINK?{uri:t.getAttribute("href")}:{target:{sys:{id:t.getAttribute("data-link-id"),linkType:t.getAttribute("data-link-type"),type:"Link"}}}}}},zr=function(e){var t={isElement:!0,isInline:!0};return{key:"HyperlinkPlugin",options:{hotkey:"mod+k"},handlers:{onKeyDown:Mr(e)},plugins:[H({},t,{key:o.INLINES.HYPERLINK,type:o.INLINES.HYPERLINK,component:Or,deserializeHtml:{rules:[{validNodeName:["A"]}],query:function(e){return!("A"!==(t=e).nodeName||!t.getAttribute("href")||"#"===t.getAttribute("href")||_r(e)||Pr(e));var t},getNode:Hr(o.INLINES.HYPERLINK)}}),H({},t,{key:o.INLINES.ENTRY_HYPERLINK,type:o.INLINES.ENTRY_HYPERLINK,component:Ft(Br),deserializeHtml:{rules:[{validNodeName:["A"]}],query:function(e){return _r(e)},getNode:Hr(o.INLINES.ENTRY_HYPERLINK)}}),H({},t,{key:o.INLINES.ASSET_HYPERLINK,type:o.INLINES.ASSET_HYPERLINK,component:Ft(Br),deserializeHtml:{rules:[{validNodeName:["A"]}],query:function(e){return Pr(e)},getNode:Hr(o.INLINES.ASSET_HYPERLINK)}})],normalizer:[{match:{type:[o.INLINES.HYPERLINK,o.INLINES.ASSET_HYPERLINK,o.INLINES.ENTRY_HYPERLINK]},validNode:Ar,transform:Jn}]}},Fr=l.css(Rr||(Rr=j(["\n  padding: 0;\n  margin: 0 0 1.25rem 1.25rem;\n\n  div:first-child {\n    margin: 0;\n    line-height: ",";\n  }\n"])),C.lineHeightDefault),Ur=((wr={})[o.BLOCKS.UL_LIST]=l.css(xr||(xr=j(["\n    list-style-type: disc;\n    ul {\n      list-style-type: circle;\n      ul {\n        list-style-type: square;\n      }\n    }\n  "]))),wr[o.BLOCKS.OL_LIST]=l.css(Kr||(Kr=j(["\n    list-style-type: decimal;\n    ol {\n      list-style-type: upper-alpha;\n      ol {\n        list-style-type: lower-roman;\n        ol {\n          list-style-type: lower-alpha;\n        }\n      }\n    }\n  "]))),wr);function Gr(e,n){return function(r){return t.createElement(e,H({},r.attributes,{className:l.cx(Fr,Ur[n])}),r.children)}}var qr,Yr=Gr("ul",o.BLOCKS.UL_LIST),jr=Gr("ol",o.BLOCKS.OL_LIST),Wr=l.css(qr||(qr=j(["\n  margin: 0;\n  list-style: inherit;\n  margin-top: ",";\n\n  ol,\n  ul {\n    margin: 0 0 0 ",";\n  }\n"])),C.spacingXs,C.spacingL);function Vr(e){return t.createElement("li",H({},e.attributes,{className:Wr}),e.children)}var Xr=a.ELEMENT_DEFAULT;function Qr(e,t){return ye(e,{at:t,match:function(e,t){return Oe(e)&&e.type===o.BLOCKS.LIST_ITEM&&t.length>=2}}).next().done}var $r=function(e,t){var n=(void 0===t?{}:t).at;re(e,(function(){do{$e(e,{at:n,match:function(e){return Oe(e)&&e.type===o.BLOCKS.LIST_ITEM},mode:"lowest"})}while(!Qr(e,n));Ze(e,{at:n,match:{type:o.BLOCKS.LIST_ITEM},split:!1})}))},Zr=[o.BLOCKS.UL_LIST,o.BLOCKS.OL_LIST],Jr=function(e,t){var n=t.type;return re(e,(function(){var t;if(e.selection)if(Le(e.selection)||!function(e,t){return a.isRangeAcrossBlocks(e,void 0)}(e)){var r=k.getListItemEntry(e);if(r)r.list[0].type!==n?Ve(e,{type:n},{at:e.selection,match:function(e){return Zr.includes(e.type)},mode:"lowest"}):$r(e);else{Je(e,{type:n,children:[],data:{}});for(var i,l=[].concat(ye(e,{match:{type:Ge(e,Xr)}})),c={type:o.BLOCKS.LIST_ITEM,children:[],data:{}},s=V(l);!(i=s()).done;)Je(e,c,{at:i.value[1]})}}else{var u=Ce(e.selection),d=Ie(e,u[0].path,u[1].path);if(Zr.includes(d[0].type)||d[0].type===o.BLOCKS.LIST_ITEM){var f,p,m=d[0].type;if(d[0].type===o.BLOCKS.LIST_ITEM&&(m=null==(f=he(e,d[1]))||null==(p=f[0])?void 0:p.type),m!==n){var E=Ae(e,{at:(t=e.selection,g.Range.start(t)),match:{type:Zr},mode:"lowest"}),y=Ae(e,{at:Te(e.selection),match:{type:Zr},mode:"lowest"});if(!E||!y)return;var h=Math.min(E[1].length,y[1].length);Ve(e,{type:n},{at:e.selection,match:function(e,t){return Zr.includes(e.type)&&t.length>=h},mode:"all"})}else $r(e)}else{var v=d[1].length;Array.from(ye(e,{mode:"all"})).filter((function(e){return e[1].length===v+1})).reverse().forEach((function(t){Zr.includes(t[0].type)?Ve(e,{type:n},{at:t[1]}):(Ve(e,{type:Ge(e,k.ELEMENT_LIC)},{at:t[1]}),Je(e,{type:o.BLOCKS.LIST_ITEM,children:[],data:{}},{at:t[1]}),Je(e,{type:n,children:[],data:{}},{at:t[1]}))}))}}}))},ei=function(e,t){var n=t.type,r=t.options.hotkey;return function(t){if("Tab"===t.key&&e.selection&&ke(e,{at:e.selection,match:{type:n}}))return t.preventDefault(),void function(e,t){var n,r=void 0===t?{}:t,i=r.increase,o=void 0===i||i,l=r.at,c=void 0===l?null!=(n=e.selection)?n:void 0:l,s=ye(e,{at:c,match:{type:Ge(e,k.ELEMENT_LIC)}}),u=Array.from(s);if(u.length){var d=[],f=[];u.forEach((function(t){var n=t[1],r=we(n);d.some((function(e){var t=we(e);return xe(t,r)}))||(d.push(n),f.push(function(e,t){return a.createPathRef(e,t)}(e,n)))}));var p=o?f:f.reverse();re(e,(function(){p.forEach((function(t){var n=t.unref();if(n){var r=k.getListItemEntry(e,{at:n});r&&(o?function(e,t){var n,r=t.list[0],i=t.listItem[1];try{n=Pe(i)}catch(e){return}var o,l,c=Ee(e,n);if(c){var s=Array.from((o=e,l=c[1],a.getNodeChildren(o,l,void 0))).find((function(t){return function(e,t,n){return a.match(e,t,n)}(t[0],t[1],{type:k.getListTypes(e)})})),u=_e(Me(null!=s?s:c));re(e,(function(){s||Je(e,{type:r.type,children:[],data:{}},{at:i}),it(e,{at:i,to:u})}))}}(e,r):k.isListNested(e,r.list[1])&&k.moveListItemUp(e,r))}}))}))}}(e,{increase:!t.shiftKey});if(r)for(var i,o=V(I(r));!(i=o()).done;)v(i.value)(t)&&Jr(e,{type:n})}},ti=function(e){return[o.BLOCKS.OL_LIST,o.BLOCKS.UL_LIST].includes(e.type)},ni=function(e,t){var n=he(e,t[1])||[];return ti(n[0])},ri=function(e,t){var n=t[1],r=function(e,t){return ke(e,{at:t,mode:"lowest",match:ti})||[]}(e,n)[0];Je(e,{type:(null==r?void 0:r.type)||o.BLOCKS.UL_LIST,children:[],data:{}},{at:n})},ii=function(e,t){return 0!==ge(t).length},oi=function(e,t){var n=t[0];if(1===n.children.length){var r=n.children[0];return!de(r)&&!ti(r)}return!0},ai=function(e,t){Xe(e,[{type:o.BLOCKS.PARAGRAPH,data:{},children:[{text:""}]}],{at:t[1].concat([0])})},li=function(e,t){var n=t[0],r=t[1];rt(e,{at:r}),Xe(e,n.children[0].children,{at:r})},ci=function(e,t){var n=e.selection;if(!n)return!1;if(a.isExpanded(n)){var r=Ce(n);if(Ie(e,r[0].path,r[1].path)[0].type===t)return!0}var i=me(e,{match:{type:[o.BLOCKS.OL_LIST,o.BLOCKS.UL_LIST]},mode:"lowest"});return(null==i?void 0:i[0].type)===t},si=function(e){return[o.BLOCKS.UL_LIST,o.BLOCKS.OL_LIST].includes(e.type)},ui=o.LIST_ITEM_BLOCKS,di=function(e){var t=e.deleteBackward,n=e.deleteForward,r=e.deleteFragment;return e.deleteBackward=function(n){(function(e,t){var n=k.getListItemEntry(e,{}),r=!1;if(n){var i=n.list,l=n.listItem;pe(e,{match:function(e){return e.type===o.BLOCKS.LIST_ITEM}})&&re(e,(function(){if(!(r=k.removeFirstListItem(e,{list:i,listItem:l}))&&!(r=k.removeListItem(e,{list:i,listItem:l}))){if(a.isFirstChild(l[1])&&!k.isListNested(e,i[1]))return p.onKeyDownResetNode(e,a.mockPlugin({options:{rules:[{types:[o.BLOCKS.LIST_ITEM],defaultType:o.BLOCKS.PARAGRAPH,hotkey:"backspace",predicate:function(){return pe(e)},onReset:function(e){return $r(e)}}]}}))(p.SIMULATE_BACKSPACE),void(r=!0);!function(e,t){a.deleteFragment(e,t)}(e,{unit:t,reverse:!0}),r=!0}}))}return r})(e,n)||t(n)},e.deleteForward=function(t){k.deleteForwardList(e)||n(t)},e.deleteFragment=function(){k.deleteFragmentList(e)||r()},e.insertBreak=function(e){var t=e.insertBreak;return function(){(function(e){if(!e.selection)return!1;var t,n=k.getListItemEntry(e,{});if(n){var r=n.list,i=n.listItem,l=i[0].children[0];if(a.isBlockAboveEmpty(e)&&1===i[0].children.length&&o.TEXT_CONTAINERS.includes(l.type)&&(t=k.moveListItemUp(e,{list:r,listItem:i})))return!0}return!!p.onKeyDownResetNode(e,a.mockPlugin({options:{rules:[{types:[a.getPluginType(e,k.ELEMENT_LI)],defaultType:a.getPluginType(e,a.ELEMENT_DEFAULT),predicate:function(){return!t&&a.isBlockAboveEmpty(e)},onReset:function(e){return k.unwrapList(e)}}]}}))(p.SIMULATE_BACKSPACE)||!(t||!function(e){if(!e.selection)return!1;var t=ke(e,{match:{type:o.TEXT_CONTAINERS}});if(!t)return!1;var n=t[1],r=he(e,n);if(!r)return!1;var i=r[1];return r[0].type===o.BLOCKS.LIST_ITEM&&(re(e,(function(){if(e.selection){var t=pe(e),r=function(e,t){return a.isSelectionAtBlockEnd(e,void 0)}(e),l=t&&He(n),c=!t&&!r;c&&Qe(e);var s=l?i:_e(i);Xe(e,function(e,t){void 0===t&&(t=!1);var n=[];if(t){var r=function(e){return a.getMarks(e)}(e)||{};n=[{type:o.BLOCKS.PARAGRAPH,data:{},children:[H({text:""},r)]}]}return{type:o.BLOCKS.LIST_ITEM,data:{},children:n}}(e,!c),{at:s});var u=t?n:_e(n),d=u[u.length-1]||0,f=s.concat([c?0:1]);l||function(e,t){a.moveChildren(e,t)}(e,{at:i,to:f,fromStartIndex:d}),Ye(e,s),We(e,{edge:"start"})}})),!0)}(e))})(e)||t()}}(e),e.insertFragment=function(e){var t=e.insertFragment;return function(n){if(e.selection){if(a.findNode(e,{match:{type:o.BLOCKS.LIST_ITEM},mode:"lowest"})){var r=function(e){var t=e[0];return o.TEXT_CONTAINERS.includes(t.type)?[].concat(t.children,e.slice(1)):e}(function(e){if(1!==e.length)return e;var t=e[0];return t.type!==o.BLOCKS.LIST_ITEM||1!==t.children.length?e:t.children}(n.flatMap((function(e){return function(e){if(!si(e))return[e];var t=Array.from(a.getNodeTexts(e,void 0)),n=t.reduce((function(t,n){return xe(t[1],n[1])?t:Ie(e,n[1],t[1])}),function(e,t){for(var n=we(t[1]);Se(e,n).type!==o.BLOCKS.LIST_ITEM;)n=we(n);return[Se(e,n),n]}(e,t[0]));return si(n[0])?n[0].children:[n[0]]}(e)})))),i=r.findIndex((function(t){return function(e,t){return a.isBlock(e,t)}(e,t)}));i<0&&(i=r.length);var l=r.slice(0,i),c=r.slice(i);return Xe(e,l,{at:e.selection,select:!0}),Xe(e,c,{at:e.selection,select:!0})}var s=si(n[0])?[{text:""}].concat(n):n;return t(s)}}}(e),e.normalizeNode=k.normalizeList(e,{validLiChildrenTypes:ui}),e};function fi(e){var n=se(),r=ne();function i(e){return function(){null!=r&&r.selection&&(Jr(r,{type:e}),gt(r))}}return r?t.createElement(t.Fragment,null,Ct(n.field,o.BLOCKS.UL_LIST)&&t.createElement(fr,{title:"UL",testId:"ul-toolbar-button",onClick:i(o.BLOCKS.UL_LIST),isActive:ci(r,o.BLOCKS.UL_LIST),isDisabled:e.isDisabled},t.createElement(T.ListBulletedIcon,null)),Ct(n.field,o.BLOCKS.OL_LIST)&&t.createElement(fr,{title:"OL",testId:"ol-toolbar-button",onClick:i(o.BLOCKS.OL_LIST),isActive:ci(r,o.BLOCKS.OL_LIST),isDisabled:e.isDisabled},t.createElement(T.ListNumberedIcon,null))):null}var pi=function(e,t){var n=[o.MARKS.SUPERSCRIPT,o.MARKS.SUBSCRIPT];!function(e,t){a.toggleMark(e,t)}(e,{key:t,clear:n.includes(t)?n:[]})},mi=function(e){return function(t,n){var r=n.options.hotkey;return function(n){if(t.selection&&r&&v(r,n)){n.preventDefault();var i=Ne(t,e);t.tracking.onShortcutAction(i?"unmark":"mark",{markType:e}),pi(t,e)}}}},Ei=l.css({backgroundColor:C.blue100,color:C.blue600}),yi=function(e){var n=e.mark,r=e.title,i=e.icon,o=function(e){var o,a=e.isDisabled,c=ne(),s=t.useCallback((function(){if(null!=c&&c.selection){var e=Ne(c,n);c.tracking.onToolbarAction(e?"unmark":"mark",{markType:n}),pi(c,n),gt(c)}}),[c]);return c?i?t.createElement(fr,{title:r,testId:n+"-toolbar-button",onClick:s,isActive:Ne(c,n),isDisabled:a},i):t.createElement(E.Menu.Item,{onClick:s,disabled:a,className:l.cx((o={},o[Ei]=Ne(c,n),o)),testId:n+"-toolbar-button"},r):null};return o.displayName=n,o},hi=yi({title:"Bold",mark:o.MARKS.BOLD,icon:t.createElement(T.FormatBoldIcon,null)}),vi={bold:l.css({fontWeight:600})};function gi(e){return t.createElement("strong",H({},e.attributes,{className:vi.bold}),e.children)}var Si=yi({title:"Code",mark:o.MARKS.CODE,icon:t.createElement(T.CodeIcon,null)}),Li=yi({title:"Code",mark:o.MARKS.CODE}),bi={code:l.css({fontFamily:"monospace",fontSize:".9em"})};function Ci(e){return t.createElement("code",H({},e.attributes,{className:bi.code}),e.children)}var Ti=yi({title:"Italic",mark:o.MARKS.ITALIC,icon:t.createElement(T.FormatItalicIcon,null)}),ki={italic:l.css({fontStyle:"italic"})};function Ii(e){return t.createElement("em",H({},e.attributes,{className:ki.italic}),e.children)}var Ai={subscript:l.css({verticalAlign:"sub",fontSize:"smaller"})},Ni=yi({title:"Subscript",mark:o.MARKS.SUBSCRIPT,icon:t.createElement(T.SubscriptIcon,{viewBox:"0 0 23 18"})}),Di=yi({title:"Subscript",mark:o.MARKS.SUBSCRIPT});function Bi(e){return t.createElement("sub",H({},e.attributes,{className:Ai.subscript}),e.children)}var Oi={superscript:l.css({verticalAlign:"super",fontSize:"smaller"})},Ri=yi({title:"Superscript",mark:o.MARKS.SUPERSCRIPT,icon:t.createElement(T.SuperscriptIcon,null)}),xi=yi({title:"Superscript",mark:o.MARKS.SUPERSCRIPT});function Ki(e){return t.createElement("sup",H({},e.attributes,{className:Oi.superscript}),e.children)}var wi=yi({title:"Underline",mark:o.MARKS.UNDERLINE,icon:t.createElement(T.FormatUnderlinedIcon,null)});function _i(e){return t.createElement("u",H({},e.attributes),e.children)}var Pi,Mi,Hi=function(e){return o.TEXT_CONTAINERS.includes(e.type)},zi=[{match:de,validNode:function(e,t){var n,r=null==(n=he(e,t[1]))?void 0:n[0];return!!r&&(Hi(r)||ht.includes(r.type)||e.isVoid(r))},transform:function(e,t){return nr(o.BLOCKS.PARAGRAPH)(e,t)}},{match:{type:ht},validNode:function(e,t){var n,r=null==(n=he(e,t[1]))?void 0:n[0];return!!r&&Hi(r)},transform:nr(o.BLOCKS.PARAGRAPH)}],Fi=function(e){function t(){return e.apply(this,arguments)||this}return z(t,e),t}(Y(Error)),Ui=function(e){return function(t,n){var r=n[0];return Oe(r)&&e.includes(r.type)}},Gi=function(e){var t=e.default;if(!t)throw new Fi("A default transformer MUST be provided");return function(n,r){var i=r[0],o=Oe(i)?i.type:"default";return(e[o]||t)(n,r)}},qi=function(e){for(var t,n=zi,r=V(e.plugins);!(t=r()).done;){var i=t.value,o=i.normalizer;if(o)for(var a,l=V(o);!(a=l()).done;){var c=H({},a.value);if(!c.match&&!i.isElement)throw new Fi("rule.match MUST be defined in a non-element plugin");if(c.match||(c.match={type:Ge(e,i.key)}),N(c.transform)){if("validNode"in c)throw new Fi("conditional transformations are not supported in validNode rules");c.transform=Gi(H({default:Jn},c.transform))}c.transform||(c.transform=Jn),"validChildren"in c&&Array.isArray(c.validChildren)&&(c.validChildren=Ui(c.validChildren)),n.push(c)}}var s=function(t,n){re(e,(function(){t(e,n)}))},u=e.normalizeNode;return e.normalizeNode=function(t){for(var r,i=t[0],o=t[1],a=ge(t),l=V(n);!(r=l()).done;){var c=r.value;if(Fe(i,o,c.match)){if("validNode"in c&&!c.validNode(e,t))return void s(c.transform,t);if("validChildren"in c){var d=function(){var t=c.validChildren,n=a.find((function(n){return!t(e,n)}));if(n)return s(c.transform,n),{v:void 0}}();if("object"==typeof d)return d.v}}}return u(t)},e},Yi=((Mi={})[o.BLOCKS.PARAGRAPH]=l.css(Pi||(Pi=j(["\n    line-height: ",";\n    margin-bottom: 1.5em;\n  "])),C.lineHeightDefault),Mi);function ji(e){return t.createElement("div",H({},e.attributes,{className:Yi[o.BLOCKS.PARAGRAPH]}),e.children)}var Wi=function(e,t){var n=t.options.hotkey;return function(t){e.selection&&n&&v(n,t)&&St(e,{activeType:o.BLOCKS.PARAGRAPH,inactiveType:o.BLOCKS.PARAGRAPH})}},Vi=[function(e){return e.querySelectorAll("style").forEach((function(e){e.remove()})),e},function(e){if(!["google-sheets-html-origin",'meta[content="Excel.Sheet"]','meta[content*="Microsoft Excel"]'].some((function(t){return!!e.querySelector(t)})))return e;for(var t=function(e){var t;return""===(null!=(t=e.textContent)?t:"").trim()},n=Array.from(e.querySelectorAll("table")),r=function(){var e=o[i];e.querySelectorAll("tr").forEach((function(e){t(e)&&e.remove()}));for(var n=Array.from(e.querySelectorAll("tr")),r=1;;){var a=n.map((function(e){return e.querySelector("th:nth-of-type("+r+"), td:nth-of-type("+r+")")})).filter((function(e){return!!e}));if(0===a.length)break;a.every((function(e){return t(e)}))?a.forEach((function(e){return e.remove()})):r+=1}},i=0,o=n;i<o.length;i++)r();return e}],Xi=function(e){return Vi.reduce((function(e,t){return t(e)}),(new DOMParser).parseFromString(e,"text/html")).body.innerHTML.replace(/>\s+</g,"><").replace(/(.*)<div.*>(<table.*<\/table>)<\/div>(.*)/g,"$1$2$3")},Qi=/data-slate-fragment="(.+?)"/m,$i=l.css({margin:"0 0 1.3125rem",borderLeft:"6px solid "+C.gray200,paddingLeft:"0.875rem",fontStyle:"normal"});function Zi(e){return t.createElement("blockquote",H({},e.attributes,{className:$i}),e.children)}var Ji=function(e){var t=ke(e,{match:{type:o.TEXT_CONTAINERS},mode:"lowest"});if(!t)return!1;if(!Ke(e,t[0]))return!1;var n=me(e,{match:{type:o.BLOCKS.QUOTE},mode:"lowest"});return!!n&&!(!a.hasSingleChild(n[0])||!a.isLastChild(n,t[1]))};function eo(e,t){if(e.selection){var n=ct(e,o.BLOCKS.QUOTE);null==t||t(n?"remove":"insert",{nodeType:o.BLOCKS.QUOTE}),re(e,(function(){e.selection&&(Ze(e,{match:function(e){return Oe(e)&&e.type===o.BLOCKS.QUOTE},split:!0}),n||Je(e,{type:o.BLOCKS.QUOTE,data:{},children:[]}))}))}}var to=function(e,t){return function(n){var r=t.options.hotkey;r&&v(r,n)&&(n.preventDefault(),eo(e,e.tracking.onShortcutAction))}},no=function(e){var t=e.insertFragment;return e.insertFragment=function(n){var r=n.length&&n[0],i=g.Element.isElement(r)&&r.type===o.BLOCKS.QUOTE,a=ke(e,{match:{type:o.TEXT_CONTAINERS}}),l=a&&""!==ue(e,a[1]);if(i&&l){var c=e.selection;(function(e){return!!e&&0!==g.Point.compare(e.anchor,e.focus)})(c)&&nt(e,{at:c});var s=ke(e,{match:{type:o.TEXT_CONTAINERS}});if(s&&""!==ue(e,s[1]))return void Xe(e,n)}t(n)},e};function ro(){var e;return{key:o.BLOCKS.QUOTE,type:o.BLOCKS.QUOTE,isElement:!0,component:Zi,options:{hotkey:"mod+shift+1"},handlers:{onKeyDown:to},deserializeHtml:{rules:[{validNodeName:"BLOCKQUOTE"}]},resetNode:[{hotkey:"backspace",types:[o.BLOCKS.QUOTE],predicate:Ji,onReset:eo}],normalizer:[{validChildren:o.CONTAINERS[o.BLOCKS.QUOTE],transform:(e={},e[o.BLOCKS.QUOTE]=tr,e.default=rr,e)}],withOverrides:no}}function io(e){var n=ne();return n?t.createElement(fr,{title:"Blockquote",onClick:function(){n&&(eo(n,n.tracking.onToolbarAction),gt(n))},testId:"quote-toolbar-button",isDisabled:e.isDisabled,isActive:ct(n,o.BLOCKS.QUOTE)},t.createElement(T.QuoteIcon,null)):null}var oo=function(e,t){if(ve(e,{match:{type:o.BLOCKS.TABLE}})){var n=ke(e,{match:{type:o.BLOCKS.TABLE_ROW}});if(n){var r=n[0],i=t(n[1]);Xe(e,O.getEmptyRowNode(e,{header:!1,colCount:r.children.length}),{at:i,select:!0}),Ye(e,fe(e,i))}}},ao=function(e){oo(e,(function(e){return _e(e)}))},lo=function(e){oo(e,(function(e){return e}))},co=function(e,t,n){var r=t.header;if(ve(e,{match:{type:o.BLOCKS.TABLE}})){var i=ke(e,{match:{type:[o.BLOCKS.TABLE_HEADER_CELL,o.BLOCKS.TABLE_CELL]}}),a=ke(e,{match:{type:o.BLOCKS.TABLE}});if(i&&a){var l=n(i[1]).slice(),c=l.length-2;a[0].children.forEach((function(t,n){l[c]=n,Xe(e,O.getEmptyCellNode(e,{header:r&&0===n}),{at:l,select:0===n})}))}}},so=function(e,t){co(e,t,(function(e){return _e(e)}))},uo=function(e,t){co(e,t,(function(e){return e}))};function fo(e){var t={type:o.BLOCKS.TABLE,data:{},children:[O.getEmptyRowNode(e,{colCount:2,header:!0}),O.getEmptyRowNode(e,{colCount:2})]};if(Xe(e,t),e.selection){var n=me(e,{match:{type:o.BLOCKS.TABLE}});if(!n)return;!function(e,t){a.selectEditor(e,t)}(e,{at:fe(e,n[1])})}!function(e){var t=function(e){var t;if(e.selection)return(t=e.selection.focus.path,g.Path.levels(t,void 0)).find((function(e){return 1===e.length}))}(e);if(t&&!He(t)){var n=Pe(t);if(n){var r=ye(e,{at:n,match:function(e){return e.type===o.BLOCKS.PARAGRAPH}})[0];r&&Ke(e,r[0])&&(it(e,{at:t,to:n}),rt(e,{at:t}))}}}(e)}var po,mo,Eo,yo,ho,vo,go,So=function(e,t){var n=he(e,t[1]);if(!n)throw new Error("table rows must be wrapped in a table node");return Math.max.apply(Math,ge(n).map((function(e){return ge(e).length})))-ge(t).length},Lo=function(e,t){return 0!==ge(t).length},bo=function(e){return Oe(e)&&e.type===o.BLOCKS.TABLE},Co={topRight:l.css({position:"absolute",top:"6px",right:"5px"})},To=function(){var e=ne(),t=X(),r=n.useState(!1),i=r[0],a=r[1],l=n.useState(!1),c=l[0],s=l[1],u=n.useCallback((function(){a(!1)}),[]);n.useEffect((function(){s(Boolean(e&&function(e){var t=ke(e,{match:{type:o.BLOCKS.TABLE}});if(!t)return!1;var n=ge(t)[0];return!!n&&ge(n).every((function(e){return e[0].type===o.BLOCKS.TABLE_HEADER_CELL}))}(e)))}),[e]);var d=n.useMemo((function(){return!!e&&!ke(e,{match:{type:o.BLOCKS.TABLE_HEADER_CELL}})}),[e]),f=n.useCallback((function(){if(u(),e){var t=!c;s(t),function(e,t){var n=ke(e,{match:{type:o.BLOCKS.TABLE}});if(n){var r=ge(n)[0];r&&ge(r).forEach((function(n){Ve(e,{type:t?o.BLOCKS.TABLE_HEADER_CELL:o.BLOCKS.TABLE_CELL},{at:n[1]})}))}}(e,t)}}),[e,u,c]),p=n.useCallback((function(t,n,r){return function(){if(null!=e&&e.selection){u();var i=function(e){var t=ut(e,o.BLOCKS.TABLE)[0];return t?function(e){var t,n=e.children.length;return n?{numRows:n,numColumns:null==(t=e.children[0].children)?void 0:t.length}:null}(t):null}(e);re(e,(function(){t(e,{header:c})})),e.tracking.onViewportAction(n+"Table"+("Table"===r?"":r),{tableSize:i})}}}),[e,c,u]);return t?null:n.createElement(E.Menu,{placement:"left",isOpen:i,onOpen:function(){a(!0)},onClose:u},n.createElement(E.Menu.Trigger,null,n.createElement(E.IconButton,{size:"small",variant:"transparent",tabIndex:-1,className:Co.topRight,icon:n.createElement(T.ChevronDownIcon,null),"aria-label":"Open table menu",testId:"cf-table-actions-button"})),n.createElement(E.Menu.List,null,n.createElement(E.Menu.Item,{onClick:p(lo,"insert","Row"),disabled:!d},"Add row above"),n.createElement(E.Menu.Item,{onClick:p(ao,"insert","Row")},"Add row below"),n.createElement(E.Menu.Item,{onClick:p(uo,"insert","Column")},"Add column left"),n.createElement(E.Menu.Item,{onClick:p(so,"insert","Column")},"Add column right"),n.createElement(E.Menu.Divider,null),n.createElement(E.Menu.Item,{onClick:f},c?"Disable table header":"Enable table header"),n.createElement(E.Menu.Divider,null),n.createElement(E.Menu.Item,{onClick:p(O.deleteRow,"remove","Row")},"Delete row"),n.createElement(E.Menu.Item,{onClick:p(O.deleteColumn,"remove","Column")},"Delete column"),n.createElement(E.Menu.Item,{onClick:p(O.deleteTable,"remove","Table")},"Delete table")))},ko=l.css(po||(po=j(["\n  border: 1px solid ",";\n  border-collapse: collapse;\n  padding: 10px 12px;\n  min-width: 48px;\n  position: relative;\n  vertical-align: top;\n\n  div:last-child {\n    margin-bottom: 0;\n  }\n"])),C.gray400),Io=function(e){var n=u.useSelected();return t.createElement("td",H({},e.attributes,e.element.data,{className:ko}),n&&t.createElement(To,null),e.children)},Ao=l.css(mo||(mo=j(["\n  background-clip: padding-box;\n  background-color: ",";\n  border: 1px solid ",";\n  border-collapse: collapse;\n  padding: 10px 12px;\n  font-weight: ",";\n  text-align: left;\n  min-width: 48px;\n  position: relative;\n\n  div:last-child {\n    margin-bottom: 0;\n  }\n"])),C.gray200,C.gray400,C.fontWeightNormal),No=function(e){var n=u.useSelected();return t.createElement("th",H({},e.attributes,e.element.data,{className:Ao}),n&&t.createElement(To,null),e.children)},Do=l.css(Eo||(Eo=j(["\n  border: 1px solid ",";\n  border-collapse: collapse;\n\n  &:hover td {\n    background-color: transparent !important;\n  }\n"])),C.gray400),Bo=function(e){return t.createElement("tr",H({},e.attributes,{className:Do}),e.children)},Oo=l.css(yo||(yo=j(["\n  margin-bottom: 1.5em;\n  border-collapse: collapse;\n  border-radius: 5px;\n  border-style: hidden;\n  box-shadow: 0 0 0 1px ",";\n  width: 100%;\n  table-layout: fixed;\n  overflow: hidden;\n"])),C.gray400),Ro=function(e){return t.createElement("div",{"data-block-type":o.BLOCKS.TABLE},t.createElement("table",H({className:Oo},e.attributes),t.createElement("tbody",null,e.children)))},xo=function(e){var t,n;if(!Oe(e))return[e];if(e.type!==o.BLOCKS.TABLE||1!==(null==(t=e.children)?void 0:t.length))return[e];var r=e.children[0];return 1!==(null==r||null==(n=r.children)?void 0:n.length)?[e]:r.children[0].children},Ko=function(e,t){var n=O.onKeyDownTable(e,t);return function(t){var r,i,l=window.getSelection();if(l&&(null==(r=l.anchorNode.attributes)||null==(i=r["data-block-type"])?void 0:i.value)===o.BLOCKS.TABLE){if("Enter"===t.key){var c=ke(e,{match:{type:o.BLOCKS.TABLE}});if(!c)return;pt(e,{at:c[1],select:!0})}return t.preventDefault(),void t.stopPropagation()}if("Tab"===t.key&&!t.shiftKey){t.preventDefault();var s=O.getTableEntries(e,{});if(s){var u=s.table,d=s.row,f=ze(d,s.cell[1]);if(ze(u,d[1])&&f)return void ao(e);n(t)}}"Escape"===t.key&&function(e){a.blurEditor(e)}(e)}},wo=Object.values(o.INLINES).map((function(e){return{type:e}})),_o={document:{nodes:[{types:o.TOP_LEVEL_BLOCKS.map((function(e){return{type:e}}))}]},blocks:H((ho={},ho[o.BLOCKS.PARAGRAPH]={nodes:[{match:[].concat(wo,[{object:"text"}])}]},ho[o.BLOCKS.HEADING_1]={nodes:[{match:[].concat(wo,[{object:"text"}])}]},ho[o.BLOCKS.HEADING_2]={nodes:[{match:[].concat(wo,[{object:"text"}])}]},ho[o.BLOCKS.HEADING_3]={nodes:[{match:[].concat(wo,[{object:"text"}])}]},ho[o.BLOCKS.HEADING_4]={nodes:[{match:[].concat(wo,[{object:"text"}])}]},ho[o.BLOCKS.HEADING_5]={nodes:[{match:[].concat(wo,[{object:"text"}])}]},ho[o.BLOCKS.HEADING_6]={nodes:[{match:[].concat(wo,[{object:"text"}])}]},ho),o.VOID_BLOCKS.reduce((function(e,t){var n;return H({},e,((n={})[t]={isVoid:!0},n))}),{}),(vo={},vo[o.BLOCKS.QUOTE]={nodes:[{match:[o.CONTAINERS[o.BLOCKS.QUOTE].map((function(e){return{type:e}}))],min:1}],normalize:function(e,t){if("child_type_invalid"===t.code)return e.unwrapBlockByKey(t.node.key,o.BLOCKS.QUOTE)}},vo)),inlines:(go={},go[o.INLINES.HYPERLINK]={nodes:[{match:[{object:"text"}]}]},go[o.INLINES.ENTRY_HYPERLINK]={nodes:[{match:[{object:"text"}]}]},go[o.INLINES.ASSET_HYPERLINK]={nodes:[{match:[{object:"text"}]}]},go[o.INLINES.EMBEDDED_ENTRY]={isVoid:!0},go)};function Po(e){var t=R.toContentfulDocument({document:e.children,schema:_o});return x.documentToPlainTextString(t).length}function Mo(e){var t=e.getData("text/html"),n=(new DOMParser).parseFromString(t,"text/html");return n.querySelector('[id*="docs-internal-guid"]')?"Google Docs":n.querySelector("google-sheets-html-origin")||n.querySelector("[data-sheets-value]")?"Google Spreadsheets":n.querySelector('meta[content*="Microsoft Excel"]')?"Microsoft Excel":n.querySelector('meta[content*="Microsoft Word"]')?"Microsoft Word":n.querySelector('[style*="Arial_MSFontService"]')&&(n.querySelector(".TextRun")||n.querySelector(".OutlineElement"))?"Microsoft Word Online":n.querySelector('meta[content="Cocoa HTML Writer"]')?"Apple Notes":n.querySelector('[style*="Slack-Lato, Slack-Fractions"]')?"Slack":"Unknown"}var Ho=function(e){var t={onViewportAction:function(t,n){return void 0===n&&(n={}),e(t,H({origin:"viewport-interaction"},n))},onShortcutAction:function(t,n){return void 0===n&&(n={}),e(t,H({origin:"shortcut"},n))},onToolbarAction:function(t,n){return void 0===n&&(n={}),e(t,H({origin:"toolbar-icon"},n))},onCommandPaletteAction:function(t,n){return void 0===n&&(n={}),e(t,H({origin:"command-palette"},n))}};return{key:"TrackingPlugin",withOverrides:function(e){var n=e.insertData;return e.tracking=t,e.insertData=function(r){if(0!==r.types.length){var i,o=null==(i=window.getSelection())?void 0:i.toString().length,a=Po(e);setTimeout((function(){var n=Po(e);t.onShortcutAction("paste",{characterCountAfter:n,characterCountBefore:a,characterCountSelection:o,source:Mo(r)})}))}n(r)},e}}};function zo(e){return e.some((function(e){return e.type===o.BLOCKS.TABLE}))}var Fo=function(e){return e.type===o.BLOCKS.TABLE_HEADER_CELL},Uo=function(e){return function(t,n){var r,i=n[0];return Oe(i)&&(null==(r=t.tracking)||r.onViewportAction("invalidTablePaste",{nodeType:i.type})),e(t,n)}},Go=function(){var e;return O.createTablePlugin({type:o.BLOCKS.TABLE,handlers:{onKeyDown:Ko},withOverrides:function(e,t){var n=e.normalizeNode;return O.withTable(e,t),e.normalizeNode=n,function(e){var t=e.insertData;e.insertData=function(n){if(n.getData("text/html")){var r=e.children;t(n);var i=e.children;setTimeout((function(){var t;zo(r)||zo(i)&&e.tracking.onViewportAction("paste",{tablePasted:!0,source:Mo(n),hasHeadersOutsideFirstRow:(t=i,t.filter((function(e){return e.type===o.BLOCKS.TABLE})).flatMap((function(e){return e.children.slice(1)})).some((function(e){return e.children.some(Fo)})))})}),1)}else t(n)}}(e),e.insertFragment=function(e){var t=e.insertFragment;return function(n){var r;if(e.selection){var i=(n=n.flatMap(xo)).some((function(e){return bo(e)})),o=0===n.findIndex((function(e){return bo(e)})),a=""!==ue(e,null==(r=e.selection)?void 0:r.focus.path);return i&&o&&a&&pt(e),t(n)}}}(e),e},overrideByKey:(e={},e[O.ELEMENT_TABLE]={type:o.BLOCKS.TABLE,component:Ro,normalizer:[{validNode:Lo},{validNode:function(e,t){var n=t[1],r=!!me(e,{at:n,match:{type:[o.BLOCKS.TABLE_CELL,o.BLOCKS.TABLE_HEADER_CELL]}});return st(n)||r},transform:rr},{validChildren:o.CONTAINERS[o.BLOCKS.TABLE]}]},e[O.ELEMENT_TR]={type:o.BLOCKS.TABLE_ROW,component:Bo,normalizer:[{validChildren:o.CONTAINERS[o.BLOCKS.TABLE_ROW],transform:nr(o.BLOCKS.TABLE_CELL)},{validNode:Lo},{validNode:function(e,t){var n,r=null==(n=he(e,t[1]))?void 0:n[0];return r&&r.type===o.BLOCKS.TABLE},transform:nr(o.BLOCKS.TABLE)},{validNode:function(e,t){return 0===So(e,t)},transform:function(e,t){var n,r=So(e,t),i=_e(Me(t));Xe(e,(n={type:o.BLOCKS.TABLE_CELL,data:{},children:[{type:o.BLOCKS.PARAGRAPH,data:{},children:[{text:""}]}]},new Array(r).fill(n)),{at:i})}}]},e[O.ELEMENT_TH]={type:o.BLOCKS.TABLE_HEADER_CELL,component:No,normalizer:[{validChildren:o.CONTAINERS[o.BLOCKS.TABLE_HEADER_CELL],transform:Uo(er)}]},e[O.ELEMENT_TD]={type:o.BLOCKS.TABLE_CELL,component:Io,normalizer:[{validChildren:o.CONTAINERS[o.BLOCKS.TABLE_CELL],transform:Uo(er)}]},e)})};function qo(e){var n=ne(),r=n&&function(e){return[O.ELEMENT_TABLE,O.ELEMENT_TH,O.ELEMENT_TR,O.ELEMENT_TD].some((function(t){return ct(e,t)}))}(n);function i(){return(i=M(It.mark((function e(){return It.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:n.tracking.onToolbarAction("insertTable"),fo(n),gt(n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return n?t.createElement(fr,{title:"Table",testId:"table-toolbar-button",onClick:function(){return i.apply(this,arguments)},isActive:!!r,isDisabled:e.isDisabled},t.createElement(T.TableIcon,null)):null}function Yo(e){return void 0===e&&(e=[]),{key:"TextPlugin",handlers:{onMouseUp:function(e){return function(){e.selection&&qe(e,function(e,t,n){return a.unhangRange(e,t,void 0)}(e,e.selection))}}},withOverrides:function(e){var t=e.insertText;e.insertText=function(n){var r=e.selection;if(r&&Le(r)){var i,o=null==(i=ke(e,{match:function(t){return function(e,t){return a.isInline(e,t)}(e,t)},mode:"highest"}))?void 0:i[1];if(o&&function(e,t,n){return a.isEndPoint(e,t,n)}(e,r.anchor,o)){var l=function(e,t,n){return a.getPointAfter(e,t,void 0)}(e,o);qe(e,{anchor:l,focus:l})}}return t(n)};var n=e.deleteForward,r=e.deleteBackward;return e.deleteBackward=function(t){jo(t,e,r)},e.deleteForward=function(t){jo(t,e,n)},function(e){e.insertTextData=function(t){var n=t.getData("text/plain");if(!n)return!1;for(var r,i=!1,o=V(n.split(/\n{2}/));!(r=o()).done;){var a=r.value;/^(\r\n?|\n)$/.test(a)||(i&&Qe(e,{always:!0}),e.insertText(a),i=!0)}return!0}}(e),e},normalizer:[{match:de,transform:function(t,n){!function(e,t,n){a.unsetNodes(e,t,n)}(t,e,{at:n[1]})},validNode:function(t,n){var r=n[0];return!e.some((function(e){return e in r}))}}]}}function jo(e,t,n){var r=ke(t,{match:{type:o.TEXT_CONTAINERS}});if(r){var i=r[1];if(Ke(t,r[0])&&1===i.length&&t.children.length>1){rt(t,{at:i});var l=function(e,t,n){return a.getPointBefore(e,t,n)}(t,t.selection,{unit:e});l&&ye(t,{match:function(e){return function(e,t){return a.queryNode(e,{allow:[o.BLOCKS.EMBEDDED_ASSET,o.BLOCKS.EMBEDDED_ENTRY,o.BLOCKS.HR]})}([e,l.path])},at:l})[0]&&Ye(t,l)}else n(e)}else n(e)}var Wo={deserializeAst:!0,deserializeHtml:!0,eventEditor:!0},Vo=function(e){return((null==e?void 0:e.content)||[]).length>0},Xo=function(e){return function e(t){return void 0===t&&(t=[]),t.map((function(t){var n;return function(e){return"text"in e}(t)?t:0===(null==(n=t.children)?void 0:n.length)?H({},t,{children:[{text:"",data:{}}]}):H({},t,{children:e(null==t?void 0:t.children)})}))}(R.toSlatejsDocument({document:Vo(e)?e:o.EMPTY_DOCUMENT,schema:_o}))},Qo="1px solid "+C.gray400,$o={root:l.css({position:"relative"}),editor:l.css({borderRadius:"0 0 "+C.borderRadiusMedium+" "+C.borderRadiusMedium,border:Qo,borderTop:0,padding:"20px",fontSize:C.spacingM,fontFamily:C.fontStackPrimary,minHeight:"400px",background:C.colorWhite,outline:"none",whiteSpace:"pre-wrap",overflowWrap:"break-word",webkitUserModify:"read-write-plaintext-only",a:{span:{cursor:"not-allowed","&:hover":{cursor:"not-allowed"}}},"ul > li > div":{margin:0}}),hiddenToolbar:l.css({borderTop:Qo}),enabled:l.css({background:C.colorWhite,a:{span:{cursor:"pointer","&:hover":{cursor:"pointer"}}}}),disabled:l.css({background:C.gray100,cursor:"not-allowed"})};function Zo(e){var n=e.children,r=e.isDisabled;return t.createElement(E.Menu,{placement:"bottom-end",isOpen:e.isOpen,onClose:e.onClose,onOpen:e.onToggle},t.createElement(E.Menu.Trigger,null,t.createElement(E.Button,{endIcon:t.createElement(T.ChevronDownIcon,null),testId:"toolbar-entity-dropdown-toggle",variant:"secondary",size:"small",startIcon:t.createElement(T.PlusIcon,null),isDisabled:r},"Embed")),t.createElement(E.Menu.List,{className:"toolbar-entity-dropdown-list"},n))}var Jo,ea=function(e){var r=e.isDisabled,i=e.canInsertBlocks,a=se(),l=ne(),c=t.useState(!1),s=c[0],u=c[1],d=function(){return u(!1)},f=Ct(a.field,o.INLINES.EMBEDDED_ENTRY),p=Ct(a.field,o.BLOCKS.EMBEDDED_ENTRY)&&i,m=Ct(a.field,o.BLOCKS.EMBEDDED_ASSET)&&i,E=n.createElement(n.Fragment,null,p&&n.createElement(rn,{isDisabled:!!r,nodeType:o.BLOCKS.EMBEDDED_ENTRY,onClose:d}),f&&n.createElement(Dn,{isDisabled:!!r||Et(l),onClose:d}),m&&n.createElement(rn,{isDisabled:!!r,nodeType:o.BLOCKS.EMBEDDED_ASSET,onClose:d}));return p||f||m?n.createElement(Zo,{isDisabled:r,onClose:d,onToggle:function(){return u(!s)},isOpen:s},E):null},ta={toolbar:l.css({border:"1px solid "+C.gray400,backgroundColor:C.gray100,padding:C.spacingXs,borderRadius:C.borderRadiusMedium+" "+C.borderRadiusMedium+" 0 0"}),toolbarBtn:l.css({height:"30px",width:"30px",marginLeft:C.spacing2Xs,marginRight:C.spacing2Xs}),divider:l.css({display:"inline-block",height:"21px",width:"1px",background:C.gray300,margin:"0 "+C.spacing2Xs}),embedActionsWrapper:l.css({display:["-webkit-box","-ms-flexbox","flex"],webkitAlignSelf:"flex-start",alignSelf:"flex-start",msFlexItemAlign:"start",marginLeft:"auto"}),formattingOptionsWrapper:l.css({display:["-webkit-box","-ms-flexbox","flex"],msFlexAlign:"center",webkitBoxAlign:"center",alignItems:"center",msFlexWrap:"wrap",flexWrap:"wrap",marginRight:"20px"})},na=function(e){var t=e.sdk,r=e.isDisabled,i=ne(),a=i&&(Ne(i,o.MARKS.SUPERSCRIPT)||Ne(i,o.MARKS.SUBSCRIPT)||Ne(i,o.MARKS.CODE));return n.createElement(E.Menu,null,n.createElement(E.Menu.Trigger,null,n.createElement("span",null,n.createElement(E.IconButton,{size:"small",className:ta.toolbarBtn,variant:a?"secondary":"transparent",icon:n.createElement(T.MoreHorizontalIcon,null),"aria-label":"toggle menu",isDisabled:r,testId:"dropdown-toolbar-button"}))),n.createElement(E.Menu.List,null,Tt(t.field,o.MARKS.SUPERSCRIPT)&&n.createElement(xi,{isDisabled:r}),Tt(t.field,o.MARKS.SUBSCRIPT)&&n.createElement(Di,{isDisabled:r}),Tt(t.field,o.MARKS.CODE)&&n.createElement(Li,{isDisabled:r})))},ra=function(e){var t=e.isDisabled,r=se(),i=ne(),a=!dt(i,o.BLOCKS.TABLE),l=n.useMemo((function(){return e=r.field,{isAnyMarkEnabled:(t=function(t,n){return t.some((function(t){return n(e,t)}))})(Object.values(o.MARKS),Tt),isAnyHyperlinkEnabled:t([o.INLINES.HYPERLINK,o.INLINES.ASSET_HYPERLINK,o.INLINES.ENTRY_HYPERLINK],Ct),isAnyBlockFormattingEnabled:t([o.BLOCKS.UL_LIST,o.BLOCKS.OL_LIST,o.BLOCKS.QUOTE,o.BLOCKS.HR],Ct)};var e,t}),[r.field]),c=dt(i,o.BLOCKS.UL_LIST)||dt(i,o.BLOCKS.OL_LIST),s=dt(i,o.BLOCKS.QUOTE),u=t||!a||c||s,d=Tt(r.field,o.MARKS.BOLD)||Tt(r.field,o.MARKS.ITALIC)||Tt(r.field,o.MARKS.UNDERLINE),f=Tt(r.field,o.MARKS.SUPERSCRIPT)||Tt(r.field,o.MARKS.SUBSCRIPT)||Tt(r.field,o.MARKS.CODE),p=d&&f;return n.createElement(E.Flex,{testId:"toolbar",className:ta.toolbar,alignItems:"center"},n.createElement("div",{className:ta.formattingOptionsWrapper},n.createElement(Kn,{isDisabled:t||!a}),l.isAnyMarkEnabled&&n.createElement("span",{className:ta.divider}),Tt(r.field,o.MARKS.BOLD)&&n.createElement(hi,{isDisabled:t}),Tt(r.field,o.MARKS.ITALIC)&&n.createElement(Ti,{isDisabled:t}),Tt(r.field,o.MARKS.UNDERLINE)&&n.createElement(wi,{isDisabled:t}),!d&&Tt(r.field,o.MARKS.SUPERSCRIPT)&&n.createElement(Ri,{isDisabled:t}),!d&&Tt(r.field,o.MARKS.SUBSCRIPT)&&n.createElement(Ni,{isDisabled:t}),!d&&Tt(r.field,o.MARKS.CODE)&&n.createElement(Si,{isDisabled:t}),p&&n.createElement(na,{sdk:r,isDisabled:t}),l.isAnyHyperlinkEnabled&&n.createElement(n.Fragment,null,n.createElement("span",{className:ta.divider}),n.createElement(Ir,{isDisabled:t})),l.isAnyBlockFormattingEnabled&&n.createElement("span",{className:ta.divider}),n.createElement(fi,{isDisabled:t||!a}),Ct(r.field,o.BLOCKS.QUOTE)&&n.createElement(io,{isDisabled:t||!a}),Ct(r.field,o.BLOCKS.HR)&&n.createElement(Er,{isDisabled:t||!a}),Ct(r.field,o.BLOCKS.TABLE)&&n.createElement(qo,{isDisabled:u})),n.createElement("div",{className:ta.embedActionsWrapper},n.createElement(ea,{isDisabled:t,canInsertBlocks:a})))},ia={nativeSticky:l.css(Jo||(Jo=j(["\n    position: -webkit-sticky;\n    position: sticky;\n    top: -1px;\n    z-index: 2;\n  "])))},oa=function(e){return n.createElement("div",{className:e.isDisabled?"":ia.nativeSticky},e.children)},aa=["command-prompt"],la=function(e){return"set_selection"!==e.type},ca=["sdk","isInitiallyDisabled","onAction","restrictedMarks"],sa=function(e){var r,i,c,u,m,E,y=Z(e.sdk),h=n.useMemo((function(){var t,n,r,i,l,c,u,m,E,y;return n=e.sdk,r=null!=(t=e.onAction)?t:s,i=e.restrictedMarks,[a.createDeserializeHtmlPlugin(),a.createDeserializeAstPlugin(),d.createDeserializeDocxPlugin(),Ho(r),(E=[o.BLOCKS.EMBEDDED_ENTRY,o.BLOCKS.EMBEDDED_ASSET,o.BLOCKS.HR,o.INLINES.EMBEDDED_ENTRY],y={TABLE:[o.INLINES.EMBEDDED_ENTRY]},{key:"DragAndDropPlugin",handlers:{onDrop:function(e){return function(t){var n=Array.from(ye(e,{match:function(e){return E.includes(e.type)}}))[0];if(!n)return!1;var r=n[0];if(!t.nativeEvent.target)return!1;var i=function(e){var t=[];for(t.push(e);e.parentNode;)t.unshift(e.parentNode),e=e.parentNode;return t}(t.nativeEvent.target).some((function(e){var t;return!(!y[e.nodeName]||null!=(t=y[e.nodeName])&&t.includes(r.type))}));return i||e.history.undos.push([]),i}}}})].concat(Object.values(xt(n)).some(Boolean)?[{key:"command-prompt",type:"command-prompt",isLeaf:!0,component:zt,handlers:{onKeyDown:function(e){return function(t){if(v("shift?+/",{byKey:!0},t)&&(function(e,t,n){void 0===n&&(n=!0),a.addMark(e,"command-prompt",n)}(e),e.tracking.onCommandPaletteAction("openRichTextCommandPalette")),Ne(e,"command-prompt")){if(v("enter",t))return t.preventDefault();var n=ke(e),r=be(e,n[1]);v("backspace",t)&&r.focus.offset-r.anchor.offset==1&&et(e,"command-prompt",r),v("escape",t)&&(t.stopPropagation(),et(e,"command-prompt",r),e.tracking.onCommandPaletteAction("cancelRichTextCommandPalette"),ie(e))}}}}}]:[],[(m={type:o.BLOCKS.PARAGRAPH,component:ji,options:{hotkey:["mod+opt+0"]},handlers:{onKeyDown:Wi},softBreak:[{hotkey:"shift+enter",query:{allow:o.BLOCKS.PARAGRAPH}}],deserializeHtml:{rules:[{validNodeName:["P","DIV"]}],query:function(e){return!(""===e.textContent||(t=e,t.hasAttribute("data-embedded-entity-inline-id")||t.hasAttribute("data-entity-type")));var t}},normalizer:[{validChildren:function(e,t){return vt(t[0])},transform:(u={},u[o.BLOCKS.PARAGRAPH]=tr,u.default=rr,u)}]},D.createParagraphPlugin(m)),k.createListPlugin({normalizer:[{match:{type:[o.BLOCKS.UL_LIST,o.BLOCKS.OL_LIST]},validChildren:[o.BLOCKS.LIST_ITEM],transform:nr(o.BLOCKS.LIST_ITEM)}],overrideByKey:(c={},c[k.ELEMENT_UL]={type:o.BLOCKS.UL_LIST,component:Yr,handlers:{onKeyDown:ei},withOverrides:di},c[k.ELEMENT_OL]={type:o.BLOCKS.OL_LIST,component:jr,handlers:{onKeyDown:ei}},c[k.ELEMENT_LIC]={type:o.BLOCKS.PARAGRAPH},c[k.ELEMENT_LI]={type:o.BLOCKS.LIST_ITEM,component:Vr,normalizer:[{validNode:ni,transform:ri},{validNode:ii,transform:ai},{validChildren:o.LIST_ITEM_BLOCKS,transform:er},{validNode:oi,transform:li}]},c)}),{key:o.BLOCKS.HR,type:o.BLOCKS.HR,isVoid:!0,isElement:!0,component:yr,handlers:{onKeyDown:mr},deserializeHtml:{rules:[{validNodeName:["HR"]},{validAttribute:{"data-void-element":o.BLOCKS.HR}}],withoutChildren:!0}},ur(),ro(),Go(),cn(n),sn(n),zr(n),Bn(n),{key:"Marks",plugins:[A.createBoldPlugin({type:o.MARKS.BOLD,component:gi,options:{hotkey:["mod+b"]},handlers:{onKeyDown:mi(o.MARKS.BOLD)},deserializeHtml:{rules:[{validNodeName:["STRONG","B"]},{validStyle:{fontWeight:["600","700","bold"]}}],query:function(e){return!function(e){return e.id.startsWith("docs-internal-guid")&&"B"===e.nodeName}(e)&&!Ue(e,(function(e){return"normal"===e.style.fontWeight}))}}}),A.createCodePlugin({type:o.MARKS.CODE,component:Ci,options:{hotkey:["mod+/","mod+shift+7"]},handlers:{onKeyDown:mi(o.MARKS.CODE)},deserializeHtml:{rules:[{validNodeName:["CODE","PRE"]},{validStyle:{fontFamily:["Consolas","monospace"]}}]}}),A.createItalicPlugin({type:o.MARKS.ITALIC,component:Ii,options:{hotkey:["mod+i"]},handlers:{onKeyDown:mi(o.MARKS.ITALIC)},deserializeHtml:{rules:[{validNodeName:["I","EM"]},{validStyle:{fontStyle:"italic"}}],query:function(e){return!Ue(e,(function(e){return"normal"===e.style.fontStyle}))}}}),A.createUnderlinePlugin({type:o.MARKS.UNDERLINE,component:_i,options:{hotkey:["mod+u"]},handlers:{onKeyDown:mi(o.MARKS.UNDERLINE)},deserializeHtml:{rules:[{validNodeName:["U"]},{validStyle:{textDecoration:["underline"]}}],query:function(e){return!Ue(e,(function(e){return"none"===e.style.textDecoration}))}}}),A.createSuperscriptPlugin({type:o.MARKS.SUPERSCRIPT,component:Ki,handlers:{onKeyDown:mi(o.MARKS.SUPERSCRIPT)},deserializeHtml:{rules:[{validNodeName:["SUP"]}]}}),A.createSubscriptPlugin({type:o.MARKS.SUBSCRIPT,component:Bi,handlers:{onKeyDown:mi(o.MARKS.SUBSCRIPT)},deserializeHtml:{rules:[{validNodeName:["SUB"]}]}})]},K.createTrailingBlockPlugin({options:{type:o.BLOCKS.PARAGRAPH,level:0}}),Yo(i),{key:"VoidsPlugin",exitBreak:[{hotkey:"enter",before:!0,query:{filter:function(e){var t=e[0],n=e[1];return st(n)&&He(n)&&!!t.isVoid}}},{hotkey:"enter",level:-2,query:{filter:function(e){var t=e[0],n=e[1];return!(st(n)&&He(n)||!t.isVoid)}}}]},B.createSelectOnBackspacePlugin({options:{query:{allow:[o.INLINES.EMBEDDED_ENTRY]}}}),{key:"PasteHTMLPlugin",withOverrides:function(e){var t=e.insertData;return e.insertData=function(e){return t(function(e){if(!e.getData("application/x-slate-fragment")){var t=function(e){return(e.getData("text/html").match(Qi)||[])[1]}(e);if(t){var n=new DataTransfer;return e.types.forEach((function(t){n.setData(t,e.getData(t))})),n.setData("application/x-slate-fragment",t),n}}return e}(e))},e},inject:{pluginsByKey:(l={},l[a.KEY_DESERIALIZE_HTML]={editor:{insertData:{format:"text/html",transformData:Xi}}},l)}},f.createSoftBreakPlugin({then:function(e){return{options:{rules:e.plugins.flatMap((function(e){return e.softBreak||[]}))}}}}),f.createExitBreakPlugin({options:{rules:[]},then:function(e){return{options:{rules:e.plugins.flatMap((function(e){return e.exitBreak||[]}))}}}}),p.createResetNodePlugin({options:{rules:[]},then:function(e){for(var t,n=e.plugins.flatMap((function(e){return e.resetNode||[]})),r=V(n);!(t=r()).done;){var i=t.value;i.defaultType||(i.defaultType=o.BLOCKS.PARAGRAPH)}return{options:{rules:n}}}}),{key:"NormalizerPlugin",withOverrides:qi}])}),[e.sdk,e.onAction,e.restrictedMarks]),g=t.useState(!0),S=g[0],L=g[1],b=t.useState(!1),C=b[1],T=(i=(r={editorId:y,handler:e.onChange,skip:b[0]||S,onSkip:function(){return C(!1)}}).editorId,u=r.skip,m=r.onSkip,E=t.useMemo((function(){return w((function(e){var t=function e(t){return H({},t,{content:t.content.map((function(t){return"text"===t.nodeType?(t.marks=t.marks.filter((function(e){return!aa.includes(e.type)})),t):e(t)}))})}(R.toContentfulDocument({document:e,schema:_o}));null==c||c(t)}),500)}),[c=r.handler]),t.useCallback((function(e){var t=a.getPlateSelectors(i).editor();if(!t)throw new Error("Editor change callback called but editor not defined. Editor id: "+i);if((null==t?void 0:t.operations.filter(la)).length>0){if(u)return void(null==m||m());E(e)}}),[i,E,u,m]));t.useEffect((function(){L(!1);var t=function(e){return a.getPlateSelectors(e)}(y).editor();t&&(C(!0),function(e,t){re(e,(function(){[].concat(e.children).forEach((function(t){return e.apply({type:"remove_node",path:[0],node:t})})),t&&(a.isNode(t)?[t]:t).forEach((function(t,n){e.apply({type:"insert_node",path:[n],node:t})}));var n=function(e,t){return a.getEndPoint(e,[])}(e);n&&Ye(e,n)}))}(t,Xo(e.value)))}),[e.value,y]);var I=l.cx($o.editor,void 0!==e.minHeight?l.css({minHeight:e.minHeight}):void 0,e.isDisabled?$o.disabled:$o.enabled,e.isToolbarHidden&&$o.hiddenToolbar);return t.useEffect((function(){var t,n;S&&a.getPlateActions(y).value((t=Xo(e.value),(n=function(e){return void 0===e&&(e={}),a.createPlateEditor(e)}({plugins:h,disableCorePlugins:Wo})).children=t,function(e,t){void 0===t&&(t={force:!0}),a.normalizeEditor(e,t)}(n,{force:!0}),n.children))}),[S,h,y,e.value]),n.createElement(ce,{sdk:e.sdk},n.createElement(ee,{value:y},n.createElement("div",{className:$o.root,"data-test-id":"rich-text-editor"},n.createElement(a.Plate,{id:y,plugins:h,disableCorePlugins:Wo,editableProps:{className:I,readOnly:e.isDisabled},onChange:T,firstChildren:!e.isToolbarHidden&&n.createElement(oa,{isDisabled:e.isDisabled},n.createElement(ra,{isDisabled:e.isDisabled}))}))))};function ua(e){var t=e.sys;return{sys:{id:t.id,type:"Link",linkType:t.type}}}var da=function(e){function t(t){var n,r;(r=e.call(this,t)||this).handleSubmit=function(e){e.preventDefault(),r.props.onClose(r.getValue())},r.selectEntry=M(It.mark((function e(){var t,n,i;return It.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t=r.props.entitySelectorConfigs.Entry).locale,i=t.contentTypes,e.next=3,r.props.sdk.dialogs.selectSingleEntry({locale:n,contentTypes:i});case 3:r.setTargetEntity("Entry",e.sent);case 5:case"end":return e.stop()}}),e)}))),r.selectAsset=M(It.mark((function e(){var t;return It.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.props.entitySelectorConfigs.Asset.locale,e.next=3,r.props.sdk.dialogs.selectSingleAsset({locale:t});case 3:r.setTargetEntity("Asset",e.sent);case 5:case"end":return e.stop()}}),e)})));var i=t.value,o=i.text,a=i.type,l=i.uri,c=i.target,s=Boolean(c),u=((n={}).Entry=null,n.Asset=null,n),d=a;return s?u[d=c.sys.linkType]=c:d=t.allowedHyperlinkTypes.includes("uri")?"uri":t.allowedHyperlinkTypes[0],r.state={text:o,uri:l,entityLinks:u,type:d},r}z(t,e);var i=t.prototype;return i.setTargetEntity=function(e,t){this.setState((function(n){var r;return{entityLinks:H({},n.entityLinks,(r={},r[e]=t?ua(t):void 0,r))}}))},i.getValue=function(){var e=this.state,t=e.text,n=e.type,r=e.uri,i={type:n};return t&&(i.text=t),"uri"===n?i.uri=r:i.target=this.state.entityLinks[n],i},i.isLinkComplete=function(){var e=this.getValue();return!(!this.props.hideText&&!e.text)&&("uri"===e.type&&e.uri||e.target)},i.render=function(){var e=this,t=this.props.labels;return n.createElement(r.EntityProvider,{sdk:this.props.sdk},n.createElement(n.Fragment,null,n.createElement(E.ModalContent,null,this.renderFields()),n.createElement(E.ModalControls,null,n.createElement(E.Button,{type:"button",onClick:function(){return e.props.onClose(null)},variant:"secondary",testId:"cancel-cta",size:"small"},"Cancel"),n.createElement(E.Button,{type:"submit",variant:"positive",onClick:this.handleSubmit,isDisabled:!this.isLinkComplete(),testId:"confirm-cta",size:"small"},t.confirm))))},i.renderFields=function(){var e=this,t=this.props,r=t.hideText,i=t.allowedHyperlinkTypes,o=t.entitySelectorConfigs,a=this.state,l=a.uri,c=a.text,s=a.type,u="uri"===s&&(r||!!c);return n.createElement(E.Form,null,r?null:n.createElement(E.FormControl,{id:"link-text",isRequired:!0},n.createElement(E.FormControl.Label,null,"Link text"),n.createElement(E.TextInput,{testId:"link-text-input",name:"link-text",value:c||"",onChange:function(t){return e.setState({text:t.target.value})},autoFocus:!u})),function(e){return void 0===e&&(e={}),!!e.Entry||!!e.Asset}(o)&&n.createElement(E.FormControl,{id:"link-type",name:"link-type"},n.createElement(E.FormControl.Label,null,"Link type"),n.createElement(E.Select,{value:s,onChange:function(t){return e.setState({type:t.target.value})},testId:"link-type-select"},i.includes("uri")||"uri"===s?n.createElement(E.Select.Option,{value:"uri"},"URL"):null,i.includes("Entry")||"Entry"===s?n.createElement(E.Select.Option,{value:"Entry"},"Entry"):null,i.includes("Asset")||"Asset"===s?n.createElement(E.Select.Option,{value:"Asset"},"Asset"):null)),"uri"===s?n.createElement(E.FormControl,{id:"link-uri",isRequired:!0},n.createElement(E.FormControl.Label,null,"Link target"),n.createElement(E.TextInput,{testId:"link-target-input",name:"link-uri",value:l||"",placeholder:"https://",onChange:function(t){return e.setState({uri:t.target.value})},autoFocus:u}),n.createElement(E.FormControl.HelpText,null,"A protocol may be required, e.g. https://")):this.renderEntityField())},i.renderEntityField=function(){var e=this,t=this.state,r=t.type,i=t.entityLinks[r],o=!i;return n.createElement("div",null,n.createElement(E.FormLabel,{required:!0,htmlFor:""},"Link target"),!o&&n.createElement(E.TextLink,{as:"button",className:l.css({marginLeft:C.spacingS}),onClick:function(){return e.setTargetEntity(r,null)}},"Remove selection"),i&&n.createElement("div",null,"Entry"===r&&n.createElement(Yt,{sdk:this.props.sdk,locale:this.props.entitySelectorConfigs.Entry.locale,entryId:i.sys.id,isDisabled:!0,isSelected:!1}),"Asset"==r&&n.createElement(Gt,{sdk:this.props.sdk,locale:this.props.entitySelectorConfigs.Asset.locale,assetId:i.sys.id,isDisabled:!0,isSelected:!1})),o&&this.renderEntitySelector(r,o))},i.renderEntitySelector=function(e){return n.createElement("div",{className:l.css({marginTop:C.spacingS})},"Entry"===e&&n.createElement(E.TextLink,{as:"button",onClick:this.selectEntry},"Select entry"),"Asset"===e&&n.createElement(E.TextLink,{as:"button",onClick:this.selectAsset},"Select asset"))},t}(n.Component);da.propTypes={sdk:_.object.isRequired,labels:_.shape({title:_.string,confirm:_.string}),value:_.shape({text:_.string,uri:_.string,target:_.object,type:_.oneOf(["uri","Entry","Asset"])}),entitySelectorConfigs:_.object,allowedHyperlinkTypes:_.arrayOf(_.oneOf(["Entry","Asset","uri"])),hideText:_.bool,onClose:_.func.isRequired},da.defaultProps={labels:{title:"Insert link",confirm:"Insert link"},value:{},hideText:!1,entitySelectorConfigs:{},allowedHyperlinkTypes:["Entry","Asset","uri"]},exports.ConnectedRichTextEditor=sa,exports.RichTextEditor=function(e){var a=e.sdk,l=e.isInitiallyDisabled,s=e.onAction,u=e.restrictedMarks,d=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(i[n]=e[n]);return i}(e,ca),f=t.useCallback((function(e){return!e||c(e,o.EMPTY_DOCUMENT)}),[]),p=Z(e.sdk);return n.createElement(r.EntityProvider,{sdk:a},n.createElement(i.FieldConnector,{throttle:0,field:a.field,isInitiallyDisabled:l,isEmptyValue:f,isEqualValues:c},(function(e){return n.createElement(sa,H({},d,{key:"rich-text-editor-"+p,value:e.lastRemoteValue,sdk:a,onAction:s,isDisabled:e.disabled,onChange:e.setValue,restrictedMarks:u}))})))},exports.openRichTextDialog=function(e){return function(t){var r;return"rich-text-hyperlink-dialog"===(null==(r=t.parameters)?void 0:r.type)?i.ModalDialogLauncher.openDialog(t,(function(r){return n.createElement(da,H({},t.parameters,{onClose:r.onClose,sdk:e}))})):Promise.reject()}},exports.renderRichTextDialog=function(e){var t=e.parameters.invocation;return"rich-text-hyperlink-dialog"===(null==t?void 0:t.type)?(e.window.startAutoResizer(),n.createElement(da,H({},e.parameters.invocation,{onClose:e.close,sdk:e}))):n.createElement("div",null)};
//# sourceMappingURL=field-editor-rich-text.cjs.production.min.js.map
