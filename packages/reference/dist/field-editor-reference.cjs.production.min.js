"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(t),r=require("emotion"),i=e(require("@contentful/f36-tokens")),o=require("@contentful/f36-components"),a=require("@contentful/f36-icons"),s=e(require("lodash/get")),c=e(require("moment")),l=require("@contentful/field-editor-shared"),u=e(require("deep-equal")),d=require("@tanstack/react-query"),f=e(require("constate")),p=require("contentful-management"),y=e(require("p-queue")),m=e(require("lodash/isNumber")),v=e(require("array-move")),h=require("react-sortable-hoc"),E=e(require("@contentful/mimetype")),g=require("react-intersection-observer");function C(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function k(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){C(o,r,i,a,s,"next",e)}function s(e){C(o,r,i,a,s,"throw",e)}a(void 0)}))}}function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function w(e,t,n){return(w=T()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&I(i,n.prototype),i}).apply(null,arguments)}function A(e){var t="function"==typeof Map?new Map:void 0;return(A=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return w(e,arguments,x(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),I(n,e)})(e)}function L(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(i[n]=e[n]);return i}var M=r.css({display:"flex",border:"1px dashed "+i.gray500,borderRadius:i.borderRadiusMedium,justifyContent:"center",padding:i.spacingXl}),D=r.css({textDecoration:"none",fontWeight:"bold"}),S={"bottom-left":"bottom-start","bottom-right":"bottom-end"},R={wrapper:r.css({position:"relative"}),inputWrapper:r.css({position:"relative",padding:"0 "+i.spacing2Xs}),searchInput:r.css({paddingRight:i.spacingXl,textOverflow:"ellipsis"}),searchIcon:r.css({position:"absolute",right:i.spacingM,top:i.spacingS,zIndex:Number(i.zIndexDefault),fill:i.gray600}),separator:r.css({background:i.gray200,margin:"10px 0"}),dropdownList:r.css({borderColor:i.gray200})},N=function(e){var r=e.contentTypes,i=e.suggestedContentTypeId,c=e.contentTypesLabel,l=e.onSelect,u=e.testId,d=e.dropdownSettings,f=void 0===d?{position:"bottom-left"}:d,p=e.customDropdownItems,y=e.children,m=t.useState(!1),v=m[0],h=m[1],E=t.useState(!1),g=E[0],C=E[1],k=t.useState(""),b=k[0],x=k[1],I=t.useRef(null),T=t.useRef(null),w=t.useRef(null),A=t.useState(),L=A[0],M=A[1],D=r.length>1||!!p,N=function(){return h(!1)};t.useEffect((function(){v&&setTimeout((function(){var e,t;null==(e=T.current)||null==(t=e.querySelector("input"))||t.focus({preventScroll:!0})}),200)}),[v]),t.useEffect((function(){var e;v&&!L&&M(null==(e=w.current)?void 0:e.clientWidth)}),[v,L]);var P=function(e){N();var t=l(e.sys.id);t&&"function"==typeof t.then&&(C(!0),t.then((function(){return C(!1)}),(function(){return C(!1)})))};t.useEffect((function(){v||x("")}),[v]);var O,H=r.length>5,q=i?300:250,j=r.find((function(e){return e.sys.id===i})),B=r.filter((function(e){return!b||s(e,"name","Untitled").toLowerCase().includes(b.toLowerCase())}));return n.createElement("span",{className:R.wrapper,ref:I,"data-test-id":u},n.createElement(o.Menu,{placement:S[f.position],isAutoalignmentEnabled:f.isAutoalignmentEnabled,isOpen:v,onClose:N,onOpen:function(){D?h(!0):P(r[0])}},n.createElement(o.Menu.Trigger,null,y({isOpen:v,isSelecting:g})),v&&n.createElement(o.Menu.List,{className:R.dropdownList,style:{width:null!=L?L+"px":void 0,maxHeight:q+"px"},ref:w,testId:"add-entry-menu"},Boolean(p)&&n.createElement(n.Fragment,null,p,n.createElement(o.Menu.Divider,null)),H&&n.createElement(n.Fragment,null,n.createElement("div",{ref:T,className:R.inputWrapper},n.createElement(o.TextInput,{className:R.searchInput,placeholder:"Search all content types",testId:"add-entry-menu-search",value:b,onChange:function(e){return x(e.target.value)}}),n.createElement(a.SearchIcon,{className:R.searchIcon})),n.createElement(o.Menu.Divider,null)),b&&((O=B.length)?n.createElement(o.Menu.SectionTitle,{testId:"add-entru-menu-search-results"},O," result",O>1?"s":""):null),j&&!b&&n.createElement(n.Fragment,null,n.createElement(o.Menu.SectionTitle,null,"Suggested Content Type"),n.createElement(o.Menu.Item,{testId:"suggested",onClick:function(){return P(j)}},s(j,"name")),n.createElement(o.Menu.Divider,null)),!b&&n.createElement(o.Menu.SectionTitle,null,c),B.length?B.map((function(e,t){return n.createElement(o.Menu.Item,{testId:"contentType",key:s(e,"name")+"-"+t,onClick:function(){return P(e)}},s(e,"name","Untitled"))})):n.createElement(o.Menu.Item,{testId:"add-entru-menu-search-results"},"No results found"))))};N.defaultProps={testId:"create-entry-button-menu-trigger",contentTypesLabel:"All Content Types"};var P={spinnerMargin:r.css({marginRight:i.spacingXs}),action:void 0},O=b({},P,{action:r.css({textDecoration:"none",fontWeight:"bold",maxWidth:"300px"})}),H=function(e){var t=e.contentTypes,r=e.onSelect,i=e.customDropdownItems,c=e.text,l=e.testId,u=e.hasPlusIcon,d=void 0!==u&&u,f=e.useExperimentalStyles,p=e.suggestedContentTypeId,y=e.dropdownSettings,m=e.disabled,v=void 0!==m&&m,h=(t=t.sort((function(e,t){return e.name.localeCompare(t.name)}))).find((function(e){return e.sys.id===p})),E=c||"Add "+s(h||(1===t.length?t[0]:{}),"name","entry"),g=t.length>1||i,C=d?n.createElement(a.PlusIcon,null):void 0,k=f?O:P;return n.createElement(N,{contentTypes:t,suggestedContentTypeId:p,contentTypesLabel:f?"New content":void 0,onSelect:r,testId:l,dropdownSettings:y,customDropdownItems:i},(function(e){var t=e.isSelecting;return n.createElement(o.Button,{endIcon:g?n.createElement(a.ChevronDownIcon,null):void 0,variant:"secondary",className:k.action,isDisabled:v||t,startIcon:t?void 0:C,size:"small",testId:"create-entry-link-button",isLoading:t},E)}))};function q(){return n.createElement(o.Paragraph,null,"You don't have permission to view this content or this field is not correctly configured. Contact your administrator for help.")}var j=r.css({display:"flex",width:"100%",marginTop:i.spacingS}),B=r.css({marginRight:i.spacingXl}),F={createNew:function(e){return null!=e&&e.contentType?"Create new "+e.contentType+" and link":"Create new entry and link"},linkExisting:function(e){return null!=e&&e.canLinkMultiple?"Link existing entries":"Link existing entry"}},z={createNew:function(){return"Create new asset and link"},linkExisting:function(e){return null!=e&&e.canLinkMultiple?"Link existing assets":"Link existing asset"}},_={dropdown:"linkEditor.dropdown",createAndLink:"linkEditor.createAndLink",createAndLinkWrapper:"create-entry-button-menu-trigger",linkExisting:"linkEditor.linkExisting"};function U(e){if(e.isFull)return null;var n=b({},"Entry"===e.entityType?F:z,e.actionLabels);return t.createElement("div",{className:j},e.canCreateEntity&&t.createElement(t.Fragment,null,"Entry"===e.entityType&&t.createElement(H,{testId:_.createAndLink,disabled:e.isDisabled,text:n.createNew({contentType:1===e.contentTypes.length?e.contentTypes[0].name:void 0}),contentTypes:e.contentTypes,hasPlusIcon:!0,onSelect:function(t){return t?e.onCreate(t,e.itemsLength):Promise.resolve()}}),"Asset"===e.entityType&&t.createElement(o.Button,{isDisabled:e.isDisabled,testId:_.createAndLink,onClick:function(){e.onCreate(void 0,e.itemsLength)},variant:"secondary",startIcon:t.createElement(a.PlusIcon,null),size:"small"},n.createNew()),t.createElement("span",{className:B})),e.canLinkEntity&&t.createElement(o.Button,{isDisabled:e.isDisabled,testId:_.linkExisting,onClick:function(){e.onLinkExisting()},variant:"secondary",startIcon:t.createElement(a.LinkIcon,null),size:"small"},n.linkExisting({canLinkMultiple:e.canLinkMultiple})),!e.canCreateEntity&&!e.canLinkEntity&&t.createElement(q,null))}var V=b({},_,{actionsWrapper:"link-actions-menu-trigger"});function Y(e){return e.isFull?null:t.createElement("div",{className:"Asset"!==e.entityType||e.isEmpty?M:""},!e.canCreateEntity&&!e.canLinkEntity&&t.createElement(q,null),"Entry"===e.entityType&&t.createElement(W,b({},e)),"Asset"===e.entityType&&t.createElement(G,b({},e)))}function W(e){return e.canCreateEntity?t.createElement(H,{testId:V.actionsWrapper,disabled:e.isDisabled,text:e.combinedActionsLabel||"Add content",contentTypes:e.contentTypes,hasPlusIcon:!0,useExperimentalStyles:!0,dropdownSettings:{position:"bottom-left"},onSelect:function(t){return t?e.onCreate(t):Promise.resolve()},customDropdownItems:e.canLinkEntity?t.createElement(o.Menu.Item,{testId:V.linkExisting,onClick:function(){e.onLinkExisting()}},"Add existing content"):void 0}):e.canLinkEntity?t.createElement(o.Button,{isDisabled:e.isDisabled,testId:V.linkExisting,className:D,onClick:function(){e.onLinkExisting()},variant:"secondary",startIcon:t.createElement(a.LinkIcon,null),size:"small"},"Add existing content"):null}function G(e){var n=t.useState(!1),r=n[0],i=n[1];return e.canLinkEntity&&e.canCreateEntity?t.createElement(o.Menu,{isOpen:r,onClose:function(){i(!1)},onOpen:function(){i(!0)}},t.createElement(o.Menu.Trigger,null,t.createElement(o.Button,{endIcon:t.createElement(a.ChevronDownIcon,null),isDisabled:e.isDisabled,testId:V.actionsWrapper,className:D,variant:"secondary",startIcon:t.createElement(a.PlusIcon,null),size:"small"},"Add media")),r&&t.createElement(o.Menu.List,{testId:V.dropdown},t.createElement(o.Menu.Item,{testId:V.linkExisting,onClick:function(){e.onLinkExisting()}},"Add existing media"),t.createElement(o.Menu.Item,{testId:V.createAndLink,onClick:function(){e.onCreate()}},"Add new media"))):e.canLinkEntity?t.createElement(o.Button,{isDisabled:e.isDisabled,testId:V.linkExisting,className:D,onClick:function(){e.onLinkExisting()},variant:"secondary",startIcon:t.createElement(a.PlusIcon,null),size:"small"},"Add existing media"):e.canCreateEntity?t.createElement(o.Button,{isDisabled:e.isDisabled,testId:V.createAndLink,className:D,onClick:function(){e.onCreate()},variant:"secondary",startIcon:t.createElement(a.PlusIcon,null),size:"small"},"Add media"):null}var Q=r.css({position:"relative"}),X=r.css({display:"flex",alignItems:"center",width:"135px",height:"160px",textAlign:"center"});function K(e){return n.createElement(o.Card,{className:Q,testId:"cf-ui-missing-entry-card"},n.createElement(o.Flex,{alignItems:"center",justifyContent:"space-between"},n.createElement("div",{className:e.asSquare?X:""},n.createElement(o.SectionHeading,{marginBottom:"none"},e.entityType," is missing or inaccessible")),!e.isDisabled&&e.onRemove&&n.createElement(o.IconButton,{variant:"transparent",icon:n.createElement(a.CloseIcon,{variant:"muted"}),"aria-label":"Delete",onClick:function(){e.onRemove&&e.onRemove()}})))}function J(e,t){return e(t={exports:{}},t.exports),t.exports}var Z=J((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=Object.create((t&&t.prototype instanceof d?t:d).prototype),o=new x(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=C(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,o),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function d(){}function f(){}function p(){}var y={};s(y,i,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(I([])));v&&v!==t&&n.call(v,i)&&(y=v);var h=p.prototype=d.prototype=Object.create(y);function E(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function g(e,t){var r;this._invoke=function(i,o){function a(){return new t((function(r,a){!function r(i,o,a,s){var c=l(e[i],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function C(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function b(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function I(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=p,s(h,"constructor",p),s(p,"constructor",f),f.displayName=s(p,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,s(e,a,"GeneratorFunction")),e.prototype=Object.create(h),e},e.awrap=function(e){return{__await:e}},E(g.prototype),s(g.prototype,o,(function(){return this})),e.AsyncIterator=g,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new g(c(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(h),s(h,a,"Generator"),s(h,i,(function(){return this})),s(h,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=I,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),b(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;b(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:I(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})),$=function(e){return e.map((function(e){return e.sys.id}))};function ee(e){return te.apply(this,arguments)}function te(){return(te=k(Z.mark((function e(t){var n,r;return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Entry"!==t.entityType){e.next=11;break}if(t.contentTypeId){e.next=3;break}return e.abrupt("return",{});case 3:return e.next=5,t.sdk.navigator.openNewEntry(t.contentTypeId,{slideIn:!0});case 5:return e.abrupt("return",{entity:(n=e.sent).entity,slide:n.slide});case 11:return e.next=13,t.sdk.navigator.openNewAsset({slideIn:!0});case 13:return e.abrupt("return",{entity:(r=e.sent).entity,slide:r.slide});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e){return re.apply(this,arguments)}function re(){return(re=k(Z.mark((function e(t){return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Entry"!==t.entityType){e.next=6;break}return e.next=3,t.sdk.dialogs.selectSingleEntry({locale:t.sdk.field.locale,contentTypes:$(t.editorPermissions.readableContentTypes)});case 3:return e.abrupt("return",e.sent);case 6:return e.abrupt("return",t.sdk.dialogs.selectSingleAsset({locale:t.sdk.field.locale,mimetypeGroups:t.editorPermissions.validations.mimetypeGroups}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(e){return oe.apply(this,arguments)}function oe(){return(oe=k(Z.mark((function e(t){var n,r,i,o,a,s;return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.sdk.field.getValue(),o=Array.isArray(i)?i.length:i?1:0,a=Math.max(((null==(n=t.editorPermissions.validations.numberOfLinks)?void 0:n.min)||1)-o,1),s=((null==(r=t.editorPermissions.validations.numberOfLinks)?void 0:r.max)||Infinity)-o,"Entry"!==t.entityType){e.next=10;break}return e.next=7,t.sdk.dialogs.selectMultipleEntries({locale:t.sdk.field.locale,contentTypes:$(t.editorPermissions.readableContentTypes),min:a,max:s});case 7:return e.abrupt("return",e.sent);case 10:return e.abrupt("return",t.sdk.dialogs.selectMultipleAssets({locale:t.sdk.field.locale,mimetypeGroups:t.editorPermissions.validations.mimetypeGroups,min:a,max:s}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ae=["renderCustomActions"],se=["renderCustomActions"];function ce(e){var n,r=e.sdk,i=e.editorPermissions,o=e.entityType,a=e.canLinkMultiple,s=e.isDisabled,c=e.actionLabels,l=e.itemsLength,u=null==(n=i.validations.numberOfLinks)?void 0:n.max,d=r.field.getValue(),f=Array.isArray(d)?d.length:d?1:0,p=!!u&&u<=f,y=0===f,m=t.useCallback((function(t,n,r){void 0===n&&(n=l),e.onCreate(t.sys.id,n),e.onAction&&e.onAction({type:"create_and_link",entity:o,entityData:t,slide:r,index:n})}),[o,e.onCreate,e.onAction]),v=t.useCallback((function(t,n){void 0===n&&(n=l),e.onLink(t.map((function(e){return e.sys.id})),n),t.forEach((function(t,r){e.onAction&&e.onAction({type:"select_and_link",entity:o,entityData:t,index:void 0===n?void 0:n+r})}))}),[o,e.onLink,e.onAction]),h=t.useCallback(function(){var e=k(Z.mark((function e(t,n){var i,a,s;return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee({sdk:r,entityType:o,contentTypeId:t});case 2:if(s=(i=e.sent).slide,a=i.entity){e.next=7;break}return e.abrupt("return");case 7:m(a,n,s);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[r,o,m]),E=t.useCallback(function(){var e=k(Z.mark((function e(t){var n;return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne({sdk:r,entityType:o,editorPermissions:i});case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:v([n],t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[r,o,v]),g=t.useCallback(function(){var e=k(Z.mark((function e(t){var n;return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ie({sdk:r,entityType:o,editorPermissions:i});case 2:if((n=e.sent)&&0!==n.length){e.next=5;break}return e.abrupt("return");case 5:v(n,t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[r,o,v]);return t.useMemo((function(){return{entityType:o,canLinkMultiple:a,isDisabled:s,isEmpty:y,isFull:p,canCreateEntity:i.canCreateEntity,canLinkEntity:i.canLinkEntity,contentTypes:i.creatableContentTypes,onCreate:h,onLinkExisting:a?g:E,actionLabels:c,onCreated:m,onLinkedExisting:v,itemsLength:l}}),[o,a,s,y,p,i.canCreateEntity,i.canLinkEntity,c,i.creatableContentTypes.map((function(e){return e.sys.id})).join(":"),h,E,g,m,v,l])}function le(e){var n=e.renderCustomActions,r=L(e,ae);return n?n(r):t.createElement(U,b({},r))}function ue(e){var n=e.renderCustomActions,r=L(e,se);return n?n(r):t.createElement(Y,b({},r))}var de=function(e){var t,n=e.job,r=e.jobsCount;return"Will "+n.action.toLowerCase()+" "+(t=n.scheduledFor.datetime,function(e,t){switch(c().startOf("day").diff(c(e).startOf("day"),"days")){case 0:return"Today, "+c(e).format("DD MMM YYYY");case-1:return"Tomorrow, "+c(e).format("DD MMM YYYY");case 1:return"Yesterday, "+c(e).format("DD MMM YYYY");default:return c(e).format("ddd, DD MMM YYYY")}}(t)+" at "+function(e){return c.utc(e).local().format("h:mm A")}(t)).toLowerCase()+"\n  "+(r>1?"+ "+(r-1)+" more":"")},fe=function(e){var t=e.job,r=e.children;return n.createElement(o.Tooltip,{placement:"top",testId:t.sys.id,as:"div",content:de({job:t,jobsCount:e.jobsCount})},r)},pe=function(e){var t,r=e.entityType,i=e.entityId,o=e.getEntityScheduledActions,a=e.children,s=n.useState({type:"loading"}),c=s[0],l=s[1];if(n.useEffect((function(){o(r,i).then((function(e){l({type:"loaded",jobs:e})})).catch((function(e){l({type:"error",error:e})}))}),[]),"loading"===c.type||"error"===c.type)return null;var u=null!=(t=c.jobs)?t:[];return 0===u.length?null:n.createElement(fe,{job:u[0],jobsCount:u.length},a)};function ye(e){return n.createElement("img",{alt:e.file.fileName,src:e.file.url+"?w=70&h=70&fit=thumb",height:70,width:70})}var me=["priority"],ve=["children"],he=new y({concurrency:50}),Ee=function(e){var t,n;function r(t){var n;return(n=e.call(this,t)||this).isUnsupportedError=void 0,n.isUnsupportedError=!0,n}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,I(t,n),r}(A(Error));function ge(){return(ge=k(Z.mark((function e(t){var n,r,i,o,a,s,c,l,u,d,f,p;return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fetch,r=t.options,i=t.urn.split(":",6)[5],o=i.split("/"),a=o[1],s=o[3],c="master",e.next=6,Promise.all([n(["space",a],(function(e){return e.cmaClient.space.get({spaceId:a})}),r),n(["entry",a,c,s],(function(e){return e.cmaClient.entry.get({spaceId:a,environmentId:c,entryId:s})}),r)]);case 6:return u=(l=e.sent)[0],f=(d=l[1]).sys.contentType.sys.id,e.next=12,Promise.all([n(["contentType",a,c,f],(function(e){return e.cmaClient.contentType.get({contentTypeId:f,spaceId:a,environmentId:c})}),r),n(["defaultLocale",a,c],function(){var e=k(Z.mark((function e(t){var n,r,i;return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.cmaClient,e.next=3,r.locale.getMany({spaceId:a,environmentId:c,query:{limit:100}});case 3:return i=null==(n=e.sent.items.find((function(e){return e.default})))?void 0:n.code,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r)]);case 12:return e.abrupt("return",{defaultLocaleCode:(p=e.sent)[1],resource:d,space:u,contentType:p[0]});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ce=f((function(e){var n,r=e.sdk.ids.space,i=null!=(n=e.sdk.ids.environmentAlias)?n:e.sdk.ids.environment,o=t.useMemo((function(){return[e.sdk.ids.environmentAlias,e.sdk.ids.environment]}),[e.sdk.ids.environmentAlias,e.sdk.ids.environment]),a=d.useQueryClient(),s=a.getQueryCache(),c=t.useRef({}),l=t.useMemo((function(){return p.createClient({apiAdapter:e.sdk.cmaAdapter},{type:"plain"})}),[e.sdk.cmaAdapter]),u=t.useMemo((function(){return e.queryConcurrency?new y({concurrency:e.queryConcurrency}):he}),[e.queryConcurrency]),f=t.useCallback((function(e,t,n){void 0===n&&(n={});var r=n.priority,i=L(n,me);return a.fetchQuery(e,(function(){return u.add((function(){return t({cmaClient:l})}),{priority:r})}),i)}),[a,u,l]),m=t.useCallback((function(e,t,n){var o,a,s=null!=(o=null==n?void 0:n.spaceId)?o:r,c=null!=(a=null==n?void 0:n.environmentId)?a:i;return f([e,t,s,c],(function(n){var r=n.cmaClient;if("Entry"===e)return r.entry.get({entryId:t,spaceId:s,environmentId:c});if("Asset"===e)return r.asset.get({assetId:t,spaceId:s,environmentId:c});throw new Ee("Unsupported entity type")}),n)}),[f,r,i]),v=t.useCallback((function(e,t,n){var o,a,s=null!=(o=null==n?void 0:n.spaceId)?o:r,c=null!=(a=null==n?void 0:n.environmentId)?a:i;return f(["scheduled-actions",e,"scheduledActionEntityId",s,c],function(){var e=k(Z.mark((function e(t){var n;return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.cmaClient,e.next=3,n.scheduledActions.getMany({spaceId:s,query:{"environment.sys.id":c,"sys.status[in]":"scheduled",order:"scheduledFor.datetime",limit:500}});case 3:return e.abrupt("return",e.sent.items);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n).then((function(e){return e.filter((function(e){return e.entity.sys.id===t}))}))}),[f,r,i]),h=t.useCallback((function(e,t,n){return f(["Resource",e,t],(function(){if("Contentful:Entry"===e)return function(e){return ge.apply(this,arguments)}({fetch:f,urn:t,options:n});throw new Ee("Unsupported resource type")}),n)}),[f]),E=t.useCallback((function(e){return function(e){return Array.isArray(e)&&("Entry"===e[0]||"Asset"===e[0])&&4===e.length}(e)&&e[2]===r&&o.includes(e[3])}),[r,o]),g=e.sdk.space.onEntityChanged,C=e.sdk.navigator.onSlideInNavigation;return t.useEffect((function(){function e(){return s.findAll({type:"active",predicate:function(e){return E(e.queryKey)}})}if("function"!=typeof g)return C((function(t){t.oldSlideLevel>t.newSlideLevel&&e().forEach((function(e){a.invalidateQueries(e.queryKey)}))}));var t=function(e){var t=e.queryKey;c.current[e.queryHash]=g(t[0],t[1],(function(e){a.setQueryData(t,e)}))};e().forEach(t);var n=s.subscribe((function(e){if(e){var n,r,i=e.type,o=e.query,a=o.queryHash;E(o.queryKey)&&("added"===i&&t(o),"removed"===i&&(null==(n=(r=c.current)[a])||n.call(r)))}}));return function(){n(),Object.values(c.current).forEach((function(e){return e()})),c.current={}}}),[g,s,E,a,m,C]),{ids:e.sdk.ids,cmaClient:l,fetch:f,getResource:h,getEntity:m,getEntityScheduledActions:v}}),(function(e){return e.fetch}),(function(e){return{getResource:e.getResource,getEntity:e.getEntity,getEntityScheduledActions:e.getEntityScheduledActions}}),(function(e){var t,n=e.ids;return{environment:null!=(t=n.environmentAlias)?t:n.environment,space:n.space}})),ke=Ce[0],be=Ce[2],xe=Ce[3];function Ie(e,t,n){var r,i,o=xe(),a=o.space,s=o.environment,c=be().getEntity,l=[e,t,null!=(r=null==n?void 0:n.spaceId)?r:a,null!=(i=null==n?void 0:n.environmentId)?i:s],u=d.useQuery(l,(function(){return c(e,t,n)}),{enabled:null==n?void 0:n.enabled});return{status:u.status,data:u.data}}function Te(e,t,n){var r=["Resource",e,t],i=be().getResource,o=d.useQuery(r,(function(){return i(e,t,n)}),{enabled:null==n?void 0:n.enabled});return{status:o.status,data:o.data,error:o.error}}function we(e){var r=e.children,i=L(e,ve),o=t.useMemo((function(){var e=new d.QueryCache;return new d.QueryClient({queryCache:e,defaultOptions:{queries:{useErrorBoundary:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!0,refetchOnMount:!1,staleTime:Infinity,retry:!1}}})}),[]);return n.createElement(d.QueryClientProvider,{client:o},n.createElement(ke,b({},i),r))}function Ae(e){return t.createElement(we,{sdk:e.sdk},t.createElement(l.FieldConnector,{throttle:0,field:e.sdk.field,isInitiallyDisabled:e.isInitiallyDisabled,isEqualValues:function(e,t){return u(e,t)}},e.children))}Ae.defaultProps={isInitiallyDisabled:!0,hasCardEditActions:!0};var Le=function(){return Promise.resolve(!0)};function Me(e){var t;return{canPerformAction:e.can,canPerformActionOnEntryOfType:null!=(t=e.canPerformActionOnEntryOfType)?t:Le}}function De(){return(De=k(Z.mark((function e(t,n){var r;return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Symbol(),e.next=3,Promise.all(t.map(function(){var e=k(Z.mark((function e(t){return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(t);case 2:if(!e.sent){e.next=6;break}e.t0=t,e.next=7;break;case 6:e.t0=r;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.abrupt("return",e.sent.filter((function(e){return e!==r})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Se(e){var n=e.sdk,r=e.entityType,i=e.parameters,o=t.useMemo((function(){return function(e){var t,n,r,i,o=[].concat(e.validations,null!=(t=null==(n=e.items)?void 0:n.validations)?t:[]),a=o.find((function(e){return"linkContentType"in e})),s=o.find((function(e){return"linkMimetypeGroup"in e})),c=o.find((function(e){return"size"in e})),l=c&&c.size||{},u=l.min,d=l.max,f=void 0;return m(u)&&m(d)?f={type:"min-max",min:u,max:d}:m(u)?f={type:"min",min:u,max:void 0}:m(d)&&(f={type:"max",max:d,min:void 0}),{contentTypes:null!=(r=null==a?void 0:a.linkContentType)?r:void 0,mimetypeGroups:null!=(i=null==s?void 0:s.linkMimetypeGroup)?i:void 0,numberOfLinks:f}}(e.sdk.field)}),[e.sdk.field]),a=t.useState(!0),s=a[0],c=a[1],l=t.useState(!0),u=l[0],d=l[1],f=function(e){var n=t.useMemo((function(){return"Asset"===e.entityType?[]:e.validations.contentTypes?e.allContentTypes.filter((function(t){var n;return null==(n=e.validations.contentTypes)?void 0:n.includes(t.sys.id)})):e.allContentTypes}),[e.allContentTypes,e.validations.contentTypes,e.entityType]),r=t.useState(n),i=r[0],o=r[1],a=t.useState(n),s=a[0],c=a[1],l=Me(e.sdk.access).canPerformActionOnEntryOfType;return t.useEffect((function(){function e(e){return function(e,t){return De.apply(this,arguments)}(n,(function(t){return l(e,t.sys.id)}))}function t(){return(t=k(Z.mark((function t(){var n,r;return Z.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e("create");case 2:return n=t.sent,t.next=5,e("read");case 5:r=t.sent,o(n),c(r);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[n]),{creatableContentTypes:i,readableContentTypes:s,availableContentTypes:n}}(b({},e,{validations:o})),p=f.creatableContentTypes,y=f.readableContentTypes,v=f.availableContentTypes,h=Me(n.access).canPerformAction;return t.useEffect((function(){function e(){return(e=k(Z.mark((function e(){return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Asset"!==r){e.next=8;break}return e.next=3,h("create","Asset");case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=!0;case 6:c(e.t0);case 8:"Entry"===r&&c(p.length>0||!0);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!1!==i.instance.showCreateEntityAction?function(){e.apply(this,arguments)}():c(!1)}),[r,i.instance,p]),t.useEffect((function(){function e(){return(e=k(Z.mark((function e(){return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Asset"!==r){e.next=8;break}return e.next=3,h("read","Asset");case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=!0;case 6:d(e.t0);case 8:"Entry"===r&&d(!0);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!1!==i.instance.showLinkEntityAction?function(){e.apply(this,arguments)}():d(!1)}),[r,i.instance,y]),{canCreateEntity:s,canLinkEntity:u,creatableContentTypes:p,readableContentTypes:y,availableContentTypes:v,validations:o}}function Re(e){var n=e.setValue,r=e.entityType,i=Se(e),o=t.useCallback((function(e){n({sys:{type:"Link",linkType:r,id:e}})}),[n,r]),a=t.useCallback((function(e){n({sys:{type:"Link",linkType:r,id:e[0]}})}),[n,r]),s=ce(b({},e,{canLinkMultiple:!1,editorPermissions:i,onCreate:o,onLink:a})),c=t.useCallback((function(t,n,r){return!!e.renderCustomCard&&e.renderCustomCard(t,s,r)}),[s]);return e.entityId?e.children(b({},e,{renderCustomCard:e.renderCustomCard&&c})):t.createElement(le,b({renderCustomActions:e.renderCustomActions},s))}function Ne(e){var n=e.sdk.space.getCachedContentTypes();return t.createElement(Ae,b({},e),(function(r){var i,o=r.value;return t.createElement(Re,b({},e,{key:r.externalReset+"-reference",entityId:o?null==o||null==(i=o.sys)?void 0:i.id:"",isDisabled:r.disabled,setValue:r.setValue,allContentTypes:n}))}))}Ne.defaultProps={hasCardEditActions:!0,hasCardRemoveActions:!0};var Pe={spaceIcon:r.css({flexShrink:0,fill:i.purple600}),spaceName:r.css({color:i.gray700,fontSize:i.fontSizeS,fontWeight:i.fontWeightDemiBold,maxWidth:"80px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"})};function Oe(e){return t.createElement(o.Tooltip,{placement:"top",as:"div",content:"Space: "+e.spaceName},t.createElement(o.Flex,{alignItems:"center",gap:"spacingXs",marginRight:"spacingS"},t.createElement(a.FolderOpenTrimmedIcon,{className:Pe.spaceIcon,size:"tiny","aria-label":"Source space"}),t.createElement(o.Text,{className:Pe.spaceName},e.spaceName)))}var He=l.entityHelpers.getEntryTitle,qe=l.entityHelpers.getEntityDescription,je=l.entityHelpers.getEntryStatus,Be=l.entityHelpers.getEntryImage,Fe={scheduleIcon:r.css({marginRight:i.spacing2Xs})};function ze(e){var n,r=t.useState(null),i=r[0],s=r[1],c=e.contentType;t.useEffect((function(){e.entry&&Be({entry:e.entry,contentType:c,localeCode:e.localeCode,defaultLocaleCode:e.defaultLocaleCode},e.getAsset).then((function(e){s(e)})).catch((function(){s(null)}))}),[e.entry,e.getAsset,c,e.localeCode,e.defaultLocaleCode]);var u=je(null==(n=e.entry)?void 0:n.sys);if("deleted"===u)return t.createElement(K,{entityType:"Entry",isDisabled:e.isDisabled,onRemove:e.onRemove});var d=He({entry:e.entry,contentType:c,localeCode:e.localeCode,defaultLocaleCode:e.defaultLocaleCode,defaultTitle:"Untitled"}),f=qe({entity:e.entry,contentType:c,localeCode:e.localeCode,defaultLocaleCode:e.defaultLocaleCode});return t.createElement(o.EntryCard,{as:e.entryUrl?"a":"article",href:e.entryUrl,title:d,description:f,contentType:null==c?void 0:c.name,size:e.size,isSelected:e.isSelected,status:u,icon:e.spaceName?t.createElement(Oe,{spaceName:e.spaceName}):t.createElement(pe,{getEntityScheduledActions:e.getEntityScheduledActions,entityType:"Entry",entityId:e.entry.sys.id},t.createElement(a.ClockIcon,{className:Fe.scheduleIcon,size:"small",variant:"muted",testId:"schedule-icon"})),thumbnailElement:i&&l.isValidImage(i)?t.createElement(ye,{file:i}):void 0,dragHandleRender:e.renderDragHandle,withDragHandle:!!e.renderDragHandle,actions:e.onEdit||e.onRemove?[e.hasCardEditActions&&e.onEdit?t.createElement(o.MenuItem,{key:"edit",testId:"edit",onClick:function(){e.onEdit&&e.onEdit()}},"Edit"):null,e.hasCardRemoveActions&&e.onRemove?t.createElement(o.MenuItem,{key:"delete",testId:"delete",onClick:function(){e.onRemove&&e.onRemove()}},"Remove"):null,e.hasCardMoveActions&&(e.onMoveTop||e.onMoveBottom)?t.createElement(o.MenuDivider,{key:"divider"}):null,e.hasCardMoveActions&&e.onMoveTop?t.createElement(o.MenuItem,{key:"move-top",onClick:function(){return e.onMoveTop&&e.onMoveTop()},testId:"move-top"},"Move to top"):null,e.hasCardMoveActions&&e.onMoveBottom?t.createElement(o.MenuItem,{key:"move-bottom",onClick:function(){return e.onMoveBottom&&e.onMoveBottom()},testId:"move-bottom"},"Move to bottom"):null].filter((function(e){return e})):[],onClick:e.isClickable?function(t){if(t.preventDefault(),e.onClick)return e.onClick(t);e.onEdit&&e.onEdit()}:void 0})}function _e(e,t,n){return Ue.apply(this,arguments)}function Ue(){return(Ue=k(Z.mark((function e(t,n,r){var i;return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.bulkEditing){e.next=11;break}return e.prev=1,e.next=4,t.navigator.openBulkEditor(t.entry.getSys().id,{fieldId:t.field.id,locale:t.field.locale,index:null!=(i=r.index)?i:0});case 4:return e.abrupt("return",e.sent.slide);case 9:e.prev=9,e.t0=e.catch(1);case 11:return e.next=13,t.navigator.openEntry(n,{slideIn:!0});case 13:return e.abrupt("return",e.sent.slide);case 16:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function Ve(e){var n=Ie("Entry",e.entryId),r=n.data,i=n.status,a=be().getEntityScheduledActions,c=t.useCallback((function(){return a("Entry",e.entryId)}),[a,e.entryId]),l="link"===e.viewType?"small":"default",u=be().getEntity,d=function(e){return u("Asset",e)},f=function(){var t=k(Z.mark((function t(){var n;return Z.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_e(e.sdk,e.entryId,{bulkEditing:e.parameters.instance.bulkEditing,index:e.index});case 2:n=t.sent,e.onAction&&e.onAction({entity:"Entry",type:"edit",id:e.entryId,contentTypeId:s(r,"sys.contentType.sys.id"),slide:n});case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),p=function(){e.onRemove(),e.onAction&&e.onAction({entity:"Entry",type:"delete",id:e.entryId,contentTypeId:s(r,"sys.contentType.sys.id")})};return t.useEffect((function(){r&&e.onAction&&e.onAction({type:"rendered",entity:"Entry"})}),[r]),t.useMemo((function(){if("error"===i){var n=t.createElement(K,{entityType:"Entry",isDisabled:e.isDisabled,onRemove:p});return e.renderCustomMissingEntityCard?e.renderCustomMissingEntityCard({defaultCard:n,entity:{id:e.entryId,type:"Entry"}}):n}if("loading"===i)return t.createElement(o.EntryCard,{size:l,isLoading:!0});var a={index:e.index,entity:r,entityUrl:e.getEntityUrl&&e.getEntityUrl(r.sys.id),contentType:e.allContentTypes.find((function(e){return e.sys.id===r.sys.contentType.sys.id})),isDisabled:e.isDisabled,size:l,localeCode:e.sdk.field.locale,defaultLocaleCode:e.sdk.locales.default,renderDragHandle:e.renderDragHandle,onEdit:f,onRemove:p,onMoveTop:e.onMoveTop,onMoveBottom:e.onMoveBottom,isBeingDragged:e.isBeingDragged},s=e.hasCardEditActions,u=e.hasCardMoveActions,y=e.hasCardRemoveActions;function m(e){var n=b({},a,e,{hasCardEditActions:s,hasCardMoveActions:u,hasCardRemoveActions:y,getAsset:d,getEntityScheduledActions:c,entry:(null==e?void 0:e.entity)||a.entity,entryUrl:(null==e?void 0:e.entityUrl)||a.entityUrl});return t.createElement(ze,b({},n))}if(e.renderCustomCard){var v=e.renderCustomCard(a,{},m);if(!1!==v)return v}return m()}),[e,i,r])}function Ye(e){return t.createElement(Ne,b({},e,{entityType:"Entry"}),(function(n){var r=n.setValue;return t.createElement(Ve,b({},e,{allContentTypes:n.allContentTypes,isDisabled:n.isDisabled,entryId:n.entityId,renderCustomCard:n.renderCustomCard,hasCardEditActions:n.hasCardEditActions,hasCardRemoveActions:n.hasCardRemoveActions,onRemove:function(){r(null)}}))}))}function We(e,t,n,r,i){void 0===i&&(i=n.length);var o=r.map((function(e){return{sys:{type:"Link",linkType:t,id:e}}})),a=Array.from(n);a.splice.apply(a,[i,0].concat(o)),e(a)}ze.defaultProps={isClickable:!0,hasCardEditActions:!0,hasCardMoveActions:!0,hasCardRemoveActions:!0},Ye.defaultProps={isInitiallyDisabled:!0};var Ge=[],Qe={sys:{id:"null-value"}};function Xe(e){var n=e.setValue,r=e.entityType,i=e.setIndexToUpdate,o=Se(e),a=t.useMemo((function(){return(e.items||[]).map((function(e){return e||Qe}))}),[e.items]),s=t.useCallback((function(e,t){t instanceof MouseEvent&&document.body.classList.add("grabbing"),t.preventDefault()}),[]),c=t.useCallback((function(t){var r=t.oldIndex,o=t.newIndex;e.onSortingEnd&&e.onSortingEnd({oldIndex:r,newIndex:o});var s=v(a,r,o);n(s),i&&i(void 0),document.body.classList.remove("grabbing")}),[a,e,i,n]),l=t.useCallback((function(e,t){var r=v(a,e,t);n(r)}),[a,n]),u=t.useCallback((function(e,t){return We(n,r,a,[e],t)}),[n,a,r]),d=t.useCallback((function(e,t){return We(n,r,a,e,t)}),[n,a,r]),f=ce(b({},e,{canLinkMultiple:!0,editorPermissions:o,onCreate:u,onLink:d,itemsLength:a.length})),p=t.useCallback((function(t,n,r){return!!e.renderCustomCard&&e.renderCustomCard(t,f,r)}),[f]);return t.createElement(t.Fragment,null,e.children(b({},e,{onSortStart:s,onSortEnd:c,onMove:l,renderCustomCard:e.renderCustomCard&&p})),t.createElement(le,b({renderCustomActions:e.renderCustomActions},f)))}function Ke(e){var n=e.sdk.space.getCachedContentTypes();return t.createElement(Ae,b({},e),(function(r){return t.createElement(Xe,b({},e,{items:r.value||Ge,isDisabled:r.disabled,setValue:r.setValue,key:r.externalReset+"-list",allContentTypes:n}))}))}Ke.defaultProps={hasCardEditActions:!0};var Je={container:r.css({position:"relative"}),item:r.css({marginBottom:i.spacingM,zIndex:i.zIndexModal})},Ze=function(e){var t=h.SortableHandle((function(){return e.drag}));return n.createElement(t,null)},$e=h.SortableElement((function(e){return n.createElement("div",{className:Je.item},e.children)})),et=h.SortableContainer((function(e){return n.createElement("div",{className:r.cx(Je.container,e.className)},e.items.map((function(t,r){var i;return n.createElement($e,{disabled:e.isDisabled,key:(null!=(i=t.sys.urn)?i:t.sys.id)+"-"+r,index:r},e.children({items:e.items,isDisabled:e.isDisabled,item:t,index:r,DragHandle:e.isDisabled?void 0:Ze}))})))}));function tt(e){return n.createElement(et,b({distance:1},e),e.children)}function nt(e){var t=e.entityFile,r=s(t,"fileName"),i=s(t,"contentType"),a=s(t,"details.size"),c=s(t,"details.image");return[n.createElement(o.Menu.SectionTitle,{key:"file-section"},"File info"),r&&n.createElement(o.Menu.Item,{key:"file-name"},n.createElement(o.Text,{isTruncated:!0},r)),i&&n.createElement(o.Menu.Item,{key:"file-type"},n.createElement(o.Text,{isTruncated:!0},i)),a&&n.createElement(o.Menu.Item,{key:"file-size"},l.shortenStorageUnit(a,"B")),c&&n.createElement(o.Menu.Item,{key:"file-dimentions"},c.width+" Ã— "+c.height)].filter((function(e){return e}))}function rt(e){var t=e.entityFile,r=e.isDisabled,i=e.onEdit,a=e.onRemove;return[n.createElement(o.Menu.SectionTitle,{key:"section-title"},"Actions"),i?n.createElement(o.Menu.Item,{key:"edit",onClick:i,testId:"card-action-edit"},"Edit"):null,t?n.createElement(o.Menu.Item,{key:"download",onClick:function(){"string"==typeof t.url&&window.open(t.url,"_blank","noopener,noreferrer")},testId:"card-action-download"},"Download"):null,a?n.createElement(o.Menu.Item,{key:"remove",disabled:r,onClick:a,testId:"card-action-remove"},"Remove"):null].filter((function(e){return e}))}var it={image:"image",video:"video",audio:"audio",richtext:"richtext",presentation:"presentation",spreadsheet:"spreadsheet",pdfdocument:"pdf",archive:"archive",plaintext:"plaintext",code:"code",markup:"markup"},ot={scheduleIcon:r.css({marginRight:i.spacing2Xs})};function at(e){if(!e)return"archive";var t=E.getGroupLabel({type:e.contentType,fallbackFileName:e.fileName});return it[t]||"archive"}var st=function(e){var t=e.className,r=e.onEdit,i=e.getAssetUrl,s=e.onRemove,c=e.size,u=e.isDisabled,d=e.isSelected,f=e.isClickable,p=l.entityHelpers.getEntryStatus(e.asset.sys);if("deleted"===p)return n.createElement(K,{entityType:"Asset",asSquare:!0,isDisabled:e.isDisabled,onRemove:e.onRemove});var y=l.entityHelpers.getAssetTitle({asset:e.asset,localeCode:e.localeCode,defaultLocaleCode:e.defaultLocaleCode,defaultTitle:"Untitled"}),m=e.asset.fields.file?e.asset.fields.file[e.localeCode]||e.asset.fields.file[e.defaultLocaleCode]:void 0,v=i?i(e.asset.sys.id):void 0;return n.createElement(o.AssetCard,{as:v?"a":"article",type:at(m),title:y,className:t,isSelected:d,href:v,status:p,icon:n.createElement(pe,{getEntityScheduledActions:e.getEntityScheduledActions,entityType:"Asset",entityId:e.asset.sys.id},n.createElement(a.ClockIcon,{className:ot.scheduleIcon,size:"small",variant:"muted",testId:"schedule-icon"})),src:m&&m.url?"small"===c?m.url+"?w=150&h=150&fit=thumb":m.url+"?h=300":"",onClick:f?function(e){e.preventDefault(),r&&r()}:void 0,onKeyDown:f?function(e){"Enter"===e.key&&r&&(e.preventDefault(),r())}:void 0,dragHandleRender:e.renderDragHandle,withDragHandle:!!e.renderDragHandle,actions:[].concat(rt({entityFile:m,isDisabled:u,onEdit:r,onRemove:s}),m?nt({entityFile:m}):[]).filter((function(e){return e})),size:c})};st.defaultProps={isClickable:!0};var ct={scheduleIcon:r.css({marginRight:i.spacing2Xs})},lt=function(e){var t=e.className,r=e.href,i=e.onEdit,s=e.onRemove,c=e.isDisabled,u=l.entityHelpers.getEntryStatus(e.asset.sys);if("deleted"===u)return n.createElement(K,{entityType:"Asset",isDisabled:e.isDisabled,onRemove:e.onRemove});var d=l.entityHelpers.getAssetTitle({asset:e.asset,localeCode:e.localeCode,defaultLocaleCode:e.defaultLocaleCode,defaultTitle:"Untitled"}),f=e.asset.fields.file?e.asset.fields.file[e.localeCode]||e.asset.fields.file[e.defaultLocaleCode]:void 0;return n.createElement(o.EntryCard,{as:r?"a":"article",contentType:"Asset",title:d,className:t,href:r,size:"small",status:u,thumbnailElement:f&&l.isValidImage(f)?n.createElement(ye,{file:f}):void 0,icon:n.createElement(pe,{getEntityScheduledActions:e.getEntityScheduledActions,entityType:"Asset",entityId:e.asset.sys.id},n.createElement(a.ClockIcon,{className:ct.scheduleIcon,size:"small",variant:"muted",testId:"schedule-icon"})),onClick:function(e){e.preventDefault(),i()},onKeyDown:function(e){"Enter"===e.key&&i&&(e.preventDefault(),i())},dragHandleRender:e.renderDragHandle,withDragHandle:!!e.renderDragHandle,actions:[rt({entityFile:f,isDisabled:c,onEdit:i,onRemove:s}),f?nt({entityFile:f}):null].filter((function(e){return e}))})};function ut(e){var n=Ie("Asset",e.assetId),r=n.data,i=n.status,a=be().getEntityScheduledActions,s=t.useCallback((function(){return a("Asset",e.assetId)}),[a,e.assetId]);t.useEffect((function(){r&&e.onAction&&e.onAction({type:"rendered",entity:"Asset"})}),[r]);var c=function(){var t=k(Z.mark((function t(){var n;return Z.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sdk.navigator.openAsset(e.assetId,{slideIn:!0});case 2:n=t.sent.slide,e.onAction&&e.onAction({entity:"Asset",type:"edit",id:e.assetId,contentTypeId:"",slide:n});case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),l=function(){e.onRemove(),e.onAction&&e.onAction({entity:"Asset",type:"delete",id:e.assetId,contentTypeId:""})};return t.useMemo((function(){if("error"===i){var n=t.createElement(K,{entityType:"Asset",asSquare:"link"!==e.viewType,isDisabled:e.isDisabled,onRemove:l});return e.renderCustomMissingEntityCard?e.renderCustomMissingEntityCard({defaultCard:n,entity:{id:e.assetId,type:"Asset"}}):n}var a=e.getEntityUrl,u="big_card"===e.viewType?"default":"small",d={asset:r,entityUrl:a&&a(e.assetId),size:u,isDisabled:e.isDisabled,localeCode:e.sdk.field.locale,defaultLocaleCode:e.sdk.locales.default,renderDragHandle:e.renderDragHandle,onEdit:c,onRemove:l};if("link"===e.viewType)return"loading"===i?t.createElement(o.EntryCard,{size:"small",isLoading:!0}):t.createElement(lt,b({},d,{href:d.entityUrl,getEntityScheduledActions:s}));if("loading"===i)return t.createElement(o.AssetCard,{size:u,isLoading:!0});function f(e){var n=b({},d,e,{getEntityScheduledActions:s,asset:(null==e?void 0:e.entity)||d.asset,getAssetUrl:a});return t.createElement(st,b({},n))}if(e.renderCustomCard){var p=b({},d,{entity:d.asset}),y=e.renderCustomCard(p,{},f);if(!1!==y)return y}return f()}),[e,i,r])}function dt(e){return t.createElement(Ne,b({},e,{entityType:"Asset"}),(function(n){var r=n.setValue;return t.createElement(ut,b({},e,{viewType:"big_card",assetId:n.entityId,isDisabled:n.isDisabled,onRemove:function(){r(null)}}))}))}dt.defaultProps={isInitiallyDisabled:!0};var ft=r.css({position:"relative",display:"flex",flexWrap:"wrap"});function pt(e){return t.createElement(Ke,b({},e,{entityType:"Asset"}),(function(e){var n;return t.createElement(tt,b({},e,{className:r.cx((n={},n[ft]="card"===e.viewType,n)),axis:"card"===e.viewType?"xy":"y",useDragHandle:!0}),(function(n){var r=n.items,i=n.item,o=n.index;return t.createElement(ut,b({},e,{isDisabled:n.isDisabled,key:i.sys.id+"-"+o,assetId:i.sys.id,onRemove:function(){e.setValue(r.filter((function(e,t){return t!==o})))},renderDragHandle:n.DragHandle}))}))}))}pt.defaultProps={isInitiallyDisabled:!0};var yt=function(){return Promise.resolve()},mt=function(){return Promise.resolve([])};function vt(e){var n=e.info,r=e.isDisabled,i=e.renderDragHandle,o=e.onRemove,a=e.onMoveTop,s=e.onMoveBottom,c=n.resource.sys,l=(0,e.getEntryRouteHref)({spaceId:c.space.sys.id,environmentId:c.environment.sys.id,entryId:c.id});return t.createElement(ze,{entry:n.resource,isDisabled:r,hasCardEditActions:!1,contentType:n.contentType,localeCode:n.defaultLocaleCode,defaultLocaleCode:n.defaultLocaleCode,size:"small",getAsset:yt,getEntityScheduledActions:mt,spaceName:n.space.name,renderDragHandle:i,isClickable:!0,onEdit:function(){window.open(l,"_blank","noopener,noreferrer")},hasCardRemoveActions:Boolean(o),onRemove:o,onMoveBottom:s,onMoveTop:a,entryUrl:l})}var ht={card:r.css({position:"relative"})};function Et(e){return n.createElement(o.Card,{className:ht.card},n.createElement(o.SectionHeading,{marginBottom:"none"},"Resource type ",e.entityType," is currently not supported"))}function gt(){return t.createElement(o.EntryCard,{size:"small",isLoading:!0})}function Ct(e){var n,r=e.resourceLink,i=e.index,o=Te(r.sys.linkType,r.sys.urn,{priority:-1*(void 0===i?0:i),enabled:e.inView}),a=o.data,s=o.error;return a||s?a?t.createElement(vt,b({info:a},e)):"object"==typeof(n=s)&&!0===(null==n?void 0:n.isUnsupportedError)?t.createElement(Et,{entityType:r.sys.linkType}):t.createElement(K,{entityType:"Entry",isDisabled:e.isDisabled,onRemove:e.onRemove}):t.createElement(gt,null)}function kt(e){return e.resourceLink?t.createElement(Ct,b({},e,{resourceLink:e.resourceLink,getEntryRouteHref:e.getEntryRouteHref})):null}function bt(e){var n=g.useInView({triggerOnce:!0,rootMargin:"300px 0px 0px 300px"});return t.createElement("div",{ref:n.ref},t.createElement(kt,b({},e,{inView:n.inView})))}var xt=function(e,t){var n;return{sys:{type:"ResourceLink",linkType:"Contentful:Entry",urn:null!=(n=e.sys.urn)?n:"crn:"+t+":::content:spaces/"+e.sys.space.sys.id+"/entries/"+e.sys.id}}};function It(e){var n,r=e.dialogs,i=e.field,o=e.onAfterLink,a=e.apiUrl,s=t.useCallback((function(e){o&&e.forEach(o)}),[o]),c=t.useMemo((function(){return function(e){var t=function(e,t,n){if("Array"===e.type){var r=t.map((function(e){return xt(e,n)})),i=e.getValue()||[];return[].concat(i,r)}return xt(t[0],n)}(i,e,a);i.setValue(t),s(e)}}),[i,s,a]),l="Array"===i.type;return{onLinkExisting:t.useMemo((function(){var e=k(Z.mark(l?function e(){return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.selectMultipleResourceEntries({allowedResources:i.allowedResources});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}:function e(){return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.selectSingleResourceEntry({allowedResources:i.allowedResources});case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e)}));return k(Z.mark((function t(){var n;return Z.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return");case 5:c(n);case 6:case"end":return t.stop()}}),t)})))}),[r,i.allowedResources,l,c]),onLinkedExisting:c,entityType:"Entry",contentTypes:[],canCreateEntity:!1,canLinkMultiple:l,canLinkEntity:!0,isDisabled:!1,isEmpty:!1,isFull:!1,onCreate:(n=k(Z.mark((function e(){return Z.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)}),onCreated:function(){}}}function Tt(e){var n=e.setValue,r=e.items,i=e.apiUrl,o=t.useCallback((function(e,t){return t.preventDefault()}),[]),a=t.useCallback((function(e){var t=v(r,e.oldIndex,e.newIndex);n(t)}),[r,n]),s=t.useCallback((function(e,t){var i=v(r,e,t);n(i)}),[r,n]),c=t.useCallback((function(e){n(r.filter((function(t,n){return n!==e})))}),[r,n]),l=e.sdk,u=It({dialogs:l.dialogs,field:l.field,apiUrl:i});return t.createElement(t.Fragment,null,e.children(b({},e,{onSortStart:o,onSortEnd:a,onMove:s,onRemoteItemAtIndex:c})),t.createElement(ue,b({},u,{renderCustomActions:e.renderCustomActions})))}function wt(e){var n=e.listLength,r=e.index,i=e.onMove,o=e.onRemoteItemAtIndex,a=e.children,s=t.useMemo((function(){return r>0?function(){return i(r,0)}:void 0}),[r,i]),c=t.useMemo((function(){return r<n-1?function(){return i(r,n-1)}:void 0}),[r,i,n]),l=t.useCallback((function(){return o(r)}),[r,o]);return t.createElement(t.Fragment,null,a({onMoveBottom:c,onMoveTop:s,onRemove:l}))}var At=[];exports.AssetThumbnail=ye,exports.CombinedLinkActions=Y,exports.CreateEntryLinkButton=H,exports.CreateEntryMenuTrigger=N,exports.EntityProvider=we,exports.MissingEntityCard=K,exports.MultipleEntryReferenceEditor=function(e){var n=t.useState(void 0),r=n[0],i=n[1],o=function(e){i(e.index)};return t.createElement(Ke,b({},e,{entityType:"Entry",setIndexToUpdate:i}),(function(e){return t.createElement(tt,b({},e,{axis:"y",useDragHandle:!0,updateBeforeSortStart:o}),(function(n){var i=n.items,o=n.item,a=n.index,s=i.length-1;return t.createElement(Ve,b({},e,{key:o.sys.id+"-"+a,index:a,allContentTypes:e.allContentTypes,isDisabled:n.isDisabled,entryId:o.sys.id,onRemove:function(){e.setValue(i.filter((function(e,t){return t!==a})))},onMoveTop:0!==a?function(){return e.onMove(a,0)}:void 0,onMoveBottom:a!==s?function(){return e.onMove(a,s)}:void 0,renderDragHandle:n.DragHandle,isBeingDragged:a===r}))}))}))},exports.MultipleMediaEditor=pt,exports.MultipleResourceReferenceEditor=function(e){return t.createElement(we,{sdk:e.sdk},t.createElement(l.FieldConnector,{throttle:0,field:e.sdk.field,isInitiallyDisabled:e.isInitiallyDisabled,isEqualValues:u},(function(n){var r=n.value;return t.createElement(Tt,b({},e,{items:r||At,isDisabled:n.disabled,setValue:n.setValue,renderCustomActions:e.renderCustomActions,key:n.externalReset+"-list"}),(function(n){return t.createElement(tt,b({},n),(function(i){var o=i.item,a=i.isDisabled,s=i.DragHandle,c=i.index;return t.createElement(wt,{index:c,onMove:n.onMove,onRemoteItemAtIndex:n.onRemoteItemAtIndex,listLength:(null==r?void 0:r.length)||0},(function(n){return t.createElement(bt,{index:c,resourceLink:o,isDisabled:a,renderDragHandle:s,onMoveTop:n.onMoveTop,onMoveBottom:n.onMoveBottom,onRemove:n.onRemove,getEntryRouteHref:e.getEntryRouteHref})}))}))}))})))},exports.ScheduledIconWithTooltip=pe,exports.SingleEntryReferenceEditor=Ye,exports.SingleMediaEditor=dt,exports.SingleResourceReferenceEditor=function(e){var n=e.sdk,r=It({dialogs:n.dialogs,field:n.field,apiUrl:e.apiUrl});return t.createElement(we,{sdk:e.sdk},t.createElement(l.FieldConnector,{throttle:0,field:e.sdk.field,isInitiallyDisabled:e.isInitiallyDisabled,isEqualValues:u},(function(n){var i=n.value;return i?t.createElement(bt,{onRemove:function(){return e.sdk.field.removeValue()},resourceLink:i,isDisabled:n.disabled,getEntryRouteHref:e.getEntryRouteHref}):t.createElement(ue,b({},r,{renderCustomActions:e.renderCustomActions}))})))},exports.SortableLinkList=tt,exports.WrappedAssetCard=st,exports.WrappedEntryCard=ze,exports.getScheduleTooltipContent=de,exports.useEntity=Ie,exports.useEntityLoader=be,exports.useResource=Te;
//# sourceMappingURL=field-editor-reference.cjs.production.min.js.map
