"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,a=require("react"),o=e(a),n=e(require("lodash/isNumber")),s=e(require("lodash/throttle")),i=require("@contentful/field-editor-shared"),r=e(require("deep-equal")),l=require("emotion"),d=e(require("@contentful/f36-tokens")),c=require("@contentful/f36-components"),u=e(require("google-map-react"));function p(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(e){e.Address="Address",e.Coordinates="Coordinates"}(t||(t={}));var m={root:l.css({width:"100%"}),input:l.css({position:"relative",width:"100%"}),spinner:l.css({position:"absolute",right:10,top:10,zIndex:99}),validationMessage:l.css({marginTop:d.spacingS}),suggestion:l.css({position:"absolute",transform:"translateY(100%)",bottom:0,left:0,zIndex:1})};function g(e){var t=o.useState(!1),a=t[0],n=t[1],s=o.useState(""),i=s[0],r=s[1],l=o.useState(!1),d=l[0],u=l[1],p=o.useState(null),g=p[0],f=p[1];return o.useEffect((function(){n(!0),e.onGetAddressFromLocation(e.value,i).then((function(e){r(e),n(!1)}))}),[e.value,e.disabled]),o.createElement("div",{className:m.root},o.createElement("div",{className:m.input},o.createElement(c.TextInput,{testId:"location-editor-search",isInvalid:d,placeholder:"Start typing to find location",value:i,onChange:function(t){r(t.target.value),u(!1),f(null),""!==t.target.value?(n(!0),e.onSearchAddress(t.target.value).then((function(e){n(!1),null===e?u(!1):0===e.length?u(!0):(u(!1),f({address:e[0].formatted_address,location:{lat:Number(e[0].geometry.location.lat().toString().slice(0,8)),lng:Number(e[0].geometry.location.lng().toString().slice(0,8))}}))}))):e.onChangeLocation(void 0)},isDisabled:e.disabled}),a&&o.createElement(c.Spinner,{className:m.spinner}),g&&o.createElement(c.Card,{padding:"none",className:m.suggestion},o.createElement(c.Button,{variant:"transparent",testId:"location-editor-suggestion",onClick:function(){r(g.address),e.onChangeLocation(g.location),f(null)}},g.address)),d&&o.createElement(c.ValidationMessage,{testId:"location-editor-not-found",className:m.validationMessage},"No results found for ",o.createElement("strong",null,i),". Please make sure that address is spelled correctly.")))}var f={root:l.css({display:"flex",flexDirection:"row",marginTop:d.spacingS,alignItems:"flex-end"}),main:l.css({flexGrow:1}),secondary:l.css({minWidth:"70px",textAlign:"right"}),inputsRow:l.css({display:"flex",marginTop:d.spacingS,fontSize:d.fontSizeM,color:d.gray900,fontFamily:d.fontStackPrimary,alignItems:"center"}),splitter:l.css({width:d.spacingL}),clearBtn:l.css({marginBottom:d.spacingS})};function v(e){return o.createElement("div",{className:f.root},o.createElement("div",{className:f.main},o.createElement(c.Flex,{flexDirection:"row"},o.createElement(c.Radio,{className:l.css({flexBasis:"100%"}),id:t.Address,testId:"location-editor-address-radio",isDisabled:e.disabled,value:t.Address,isChecked:e.view===t.Address,onChange:function(){e.onChangeView(t.Address)}},"Address"),o.createElement(c.Radio,{className:l.css({flexBasis:"100%"}),id:t.Coordinates,testId:"location-editor-coordinates-radio",isDisabled:e.disabled,value:t.Coordinates,isChecked:e.view===t.Coordinates,onChange:function(){e.onChangeView(t.Coordinates)}},"Coordinates")),e.view===t.Address&&o.createElement("div",{className:f.inputsRow},o.createElement(g,{onSearchAddress:e.onSearchAddress,onGetAddressFromLocation:e.onGetAddressFromLocation,disabled:e.disabled,value:e.value,onChangeLocation:e.onChangeLocation})),e.view===t.Coordinates&&o.createElement("div",{className:f.inputsRow},o.createElement("label",{htmlFor:"latitude"},"Latitude"),o.createElement("div",{className:f.splitter}),o.createElement(c.TextInput,{id:"latitude",testId:"location-editor-latitude",placeholder:"Between -90 and 90",isDisabled:e.disabled,value:e.value?String(e.value.lat):"",onChange:function(t){e.onChangeLocation({lng:e.value&&void 0!==e.value.lng?e.value.lng:0,lat:Number(t.target.value)||0})},type:"number",max:"90",min:"-90",step:"0.1"}),o.createElement("div",{className:f.splitter}),o.createElement("label",{htmlFor:"longitude"},"Longitude"),o.createElement("div",{className:f.splitter}),o.createElement(c.TextInput,{id:"longitude",testId:"location-editor-longitude",placeholder:"Between -180 and 180",isDisabled:e.disabled,value:e.value?String(e.value.lng):"",onChange:function(t){e.onChangeLocation({lat:e.value&&void 0!==e.value.lat?e.value.lat:0,lng:Number(t.target.value)||0})},type:"number",max:"180",min:"-180",step:"0.1"}))),o.createElement("div",{className:f.secondary},o.createElement(c.TextLink,{as:"button",isDisabled:e.disabled,testId:"location-editor-clear",className:f.clearBtn,onClick:function(){e.onChangeLocation(void 0)}},"Clear")))}var h={root:l.css({height:"300px",width:"100%"})},b={lat:52.5018,lng:13.41115439},C=function(e){function t(t){var a;return(a=e.call(this,t)||this).onGoogleApiLoaded=function(e){var t=e.maps,o=e.map,n=new t.Marker({map:o,position:o.getCenter(),cursor:a.props.disabled?"not-allowed":"auto",draggable:!a.props.disabled,visible:Boolean(a.props.location)});t.event.addListener(o,"click",(function(e){!a.props.disabled&&a.state.marker&&a.state.maps&&(a.state.marker.setPosition(e.latLng),a.state.marker.setVisible(!0),a.props.onChangeLocation({lat:e.latLng.lat(),lng:e.latLng.lng()}))})),t.event.addListener(n,"dragend",(function(e){a.props.onChangeLocation({lat:e.latLng.lat(),lng:e.latLng.lng()})})),a.setState({marker:n,maps:t},(function(){a.props.onGoogleApiLoaded({maps:t})}))},a.state={marker:void 0,maps:void 0},a}p(t,e);var a=t.prototype;return a.componentDidUpdate=function(){if(this.state.marker&&this.state.maps){if(this.props.location){var e=new this.state.maps.LatLng(this.props.location.lat,this.props.location.lng);this.state.marker.setPosition(e),this.state.marker.setVisible(!0)}else this.state.marker.setVisible(!1);this.state.marker.setDraggable(!this.props.disabled),this.state.marker.setCursor(this.props.disabled?"not-allowed":"auto")}},a.render=function(){return o.createElement("div",{className:h.root},o.createElement(u,{draggable:!this.props.disabled,bootstrapURLKeys:this.props.googleMapsKey?{key:this.props.googleMapsKey}:void 0,defaultCenter:b,center:this.props.location,options:{scrollwheel:!1,mapTypeId:"roadmap"},defaultZoom:6,yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:this.onGoogleApiLoaded}))},t}(o.Component);function L(e){return e&&n(e.lat)&&n(e.lng)?{lat:e.lat,lon:e.lng}:null}var y=function(e){function t(t){var a;return(a=e.call(this,t)||this).onSearchAddress=s((function(e){if(!a.state.mapsObject)return Promise.resolve(null);var t=a.state.mapsObject;return e?new Promise((function(a){(new t.Geocoder).geocode({address:e},a,(function(){a(null)}))})):Promise.resolve(null)}),300),a.onGetAddressFromLocation=function(e,t){if(!a.state.mapsObject||!e)return Promise.resolve("");var o=a.state.mapsObject;return new Promise((function(a){(new o.Geocoder).geocode({location:e},(function(e){if(e&&e.length>0){var o=e.map((function(e){return e.formatted_address}));a(o.find((function(e){return e===t}))||o[0])}else a("")}),(function(){a("")}))}))},a.state={localValue:t.value?{lng:t.value.lon,lat:t.value.lat}:void 0,mapsObject:null},a}return p(t,e),t.prototype.render=function(){var e=this,t=this.state,o=t.mapsObject,n=t.localValue;return a.createElement("div",{"data-test-id":"location-editor"},a.createElement(C,{disabled:this.props.disabled||null===o,googleMapsKey:this.props.googleMapsKey,location:n,onGoogleApiLoaded:function(t){e.setState({mapsObject:t.maps})},onChangeLocation:function(t){e.setState({localValue:t}),e.props.setValue(L(t))}}),a.createElement(v,{disabled:this.props.disabled||null===o,value:n,view:this.props.selectedView,onChangeView:function(t){e.props.setSelectedView(t)},onChangeLocation:function(t){e.setState({localValue:t}),e.props.setValue(L(t))},onSearchAddress:this.onSearchAddress,onGetAddressFromLocation:this.onGetAddressFromLocation}))},t}(a.Component);function E(e){var o=e.field,n=e.parameters?e.parameters.instance.googleMapsKey:void 0,s=a.useState(t.Address),l=s[0],d=s[1];return a.createElement(i.FieldConnector,{isEqualValues:function(e,t){return r(e,t)},field:o,isInitiallyDisabled:e.isInitiallyDisabled},(function(e){return a.createElement(y,{key:"location-editor-"+e.externalReset,value:e.value,disabled:e.disabled,setValue:e.setValue,googleMapsKey:n,selectedView:l,setSelectedView:d})}))}E.defaultProps={isInitiallyDisabled:!0},exports.LocationEditor=E;
//# sourceMappingURL=field-editor-location.cjs.production.min.js.map
